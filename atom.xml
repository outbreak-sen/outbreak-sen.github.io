<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>This is a éƒ¨è½æ ¼ of outbreak_sen</title>
  
  <subtitle>[object Object]</subtitle>
  <link href="http://outbreak-sen.github.io/atom.xml" rel="self"/>
  
  <link href="http://outbreak-sen.github.io/"/>
  <updated>2025-03-25T14:03:10.353Z</updated>
  <id>http://outbreak-sen.github.io/</id>
  
  <author>
    <name>outbreak_sen</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>20250329é™•å¸ˆå¤§è®²è§£mindnlpæ¨¡å‹å¾®è°ƒ</title>
    <link href="http://outbreak-sen.github.io/2025/03/24/20250329%E9%99%95%E5%B8%88%E5%A4%A7%E8%AE%B2%E8%A7%A3mindnlp%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/"/>
    <id>http://outbreak-sen.github.io/2025/03/24/20250329%E9%99%95%E5%B8%88%E5%A4%A7%E8%AE%B2%E8%A7%A3mindnlp%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/</id>
    <published>2025-03-24T05:38:37.000Z</published>
    <updated>2025-03-25T14:03:10.353Z</updated>
    
    <content type="html"><![CDATA[<h1>è®²è§£mindnlpæ¨¡å‹å¾®è°ƒ20250329</h1><p>å…ˆç»™å¤§å®¶è¯´è‡ªå·±æ˜¯ä¸‰ç»´è§†è§‰é¢†åŸŸ</p><p>é¦–å…ˆè®²è§£mindnlpçš„ç»„æˆï¼Œè®­ç»ƒæ–¹æ³•</p><p>ç„¶åè®²è§£æ¨¡å‹ä»»åŠ¡ï¼Œæ¨¡å‹åˆ†ä¸ºå››ç§</p><p>ç„¶åè®²è§£å¾®è°ƒæ•°æ®é›†çš„é€‰æ‹©ï¼Œå¾®è°ƒçš„ä¸¤ç§æ–¹æ³•</p><p>ç„¶åè®²è§£å¾®è°ƒæ•°æ®é›†çš„æ ¼å¼</p><p>ç„¶åè®²è§£PEFT</p><p>ç„¶åè®²è§£Ascend 910B</p><p>çœ‹æ•ˆæœ</p><h1>MindNLP</h1><p>MindNLPæ˜¯åŸºäºMindSporeçš„ä¸€ä¸ªè‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰å¼€æºåº“ï¼Œå…¶ä¸­åŒ…å«äº†è®¸å¤šè‡ªç„¶è¯­è¨€å¤„ç†çš„å¸¸ç”¨æ–¹æ³•ï¼Œæä¾›äº†ä¸€ä¸ªæ˜“ç”¨çš„NLPå¹³å°ï¼Œæ—¨åœ¨å¸®åŠ©ç ”ç©¶äººå‘˜å’Œå¼€å‘è€…æ›´é«˜æ•ˆåœ°æ„å»ºå’Œè®­ç»ƒæ¨¡å‹ã€‚</p><ul><li><strong>ä¸°å¯Œå®Œå¤‡çš„æ•°æ®é¢„å¤„ç†æ¨¡å—</strong><ul><li>æä¾›ä¸°å¯Œçš„NLPæ•°æ®å¤„ç†æ¨¡å—ï¼Œå¯çµæ´»é«˜æ•ˆåœ°å®Œæˆæ•°æ®é¢„å¤„ç†ï¼ŒåŒ…æ‹¬Multi30kã€SQuADã€CoNLLç­‰ç»å…¸æ•°æ®é›†ã€‚</li></ul></li><li><strong>ç”¨æˆ·å‹å¥½çš„NLPæ¨¡å‹å·¥å…·é›†</strong><ul><li>æä¾›å¤šç§å¯é…ç½®ç¥ç»ç½‘ç»œç»„ä»¶ï¼Œæ˜“äºç”¨æˆ·è‡ªå®šä¹‰æ¨¡å‹ï¼Œå¯å¤§å¹…æå‡NLPä»»åŠ¡å»ºæ¨¡çš„æ•ˆç‡ã€‚</li></ul></li><li><strong>çµæ´»æ˜“ç”¨çš„è®­ç»ƒä¸æ¨ç†å¼•æ“</strong><ul><li>ç®€åŒ–äº†MindSporeä¸­å¤æ‚çš„è®­ç»ƒè¿‡ç¨‹ï¼Œæä¾›äº†çµæ´»æ˜“ç”¨çš„ <code>Trainer</code> å’Œ <code>Evaluator</code> ï¼Œå¯ä»¥è½»æ¾åœ°è®­ç»ƒå’Œè¯„ä¼°æ¨¡å‹</li></ul></li></ul><p><strong>MindNLP</strong></p><ul><li>åä¸ºæ˜‡æ€MindSporeç”Ÿæ€ä¸‹çš„å¼€æºNLPåº“</li><li>ä¸“ä¸ºMindSporeæ¡†æ¶ä¼˜åŒ–è®¾è®¡</li><li>å……åˆ†åˆ©ç”¨å…¶è‡ªåŠ¨å¹¶è¡Œã€åŠ¨é™æ€å›¾ç»Ÿä¸€ç­‰ç‰¹æ€§</li><li>ç‰¹åˆ«é’ˆå¯¹åä¸ºæ˜‡è…¾èŠ¯ç‰‡ä¼˜åŒ–</li><li>å…¨é¢é€‚é…Hugging Faceä¸»è¦å¼€å‘åº“(å¦‚Transformersã€Peftã€Trl)ï¼Œå¯ç›´æ¥ä½¿ç”¨datasetsåº“ï¼Œä¿æŒä¸Hugging Faceç”Ÿæ€çš„ä¸€è‡´æ€§</li></ul><p><strong>Transformers</strong></p><ul><li><p>ç”±Hugging Faceå¼€å‘ç»´æŠ¤ï¼Œå·²æˆä¸ºå…¨çƒæœ€æµè¡Œçš„NLPå¼€æºåº“ä¹‹ä¸€ã€‚</p></li><li><p>æ”¯æŒPyTorchã€TensorFlowå’ŒJAXç­‰å¤šç§æ·±åº¦å­¦ä¹ æ¡†æ¶</p></li><li><p>æ¡†æ¶æ— å…³è®¾è®¡ï¼ŒåŸç”Ÿæ”¯æŒPyTorchã€TensorFlowï¼Œé€šè¿‡é€‚é…å±‚ä¹Ÿå¯æ”¯æŒå…¶ä»–æ¡†æ¶å¦‚JAX</p></li><li><p>å®ƒæä¾›äº†æ•°ä¸‡ä¸ªé¢„è®­ç»ƒæ¨¡å‹</p></li><li><p>ä½œä¸ºHugging Faceç”Ÿæ€æ ¸å¿ƒï¼Œä¸Model Hubã€Datasetsã€Evaluateã€Gradioç­‰å·¥å…·æ— ç¼é›†æˆ</p></li></ul><h2 id="æ¨¡å‹">æ¨¡å‹</h2><p><a href="https://mindnlp-ai.readthedocs.io/en/latest/zh/api/transformers/models/blenderbot_small/#mindnlp.transformers.models.blenderbot_small.modeling_blenderbot_small.BlenderbotSmallModel">https://mindnlp-ai.readthedocs.io/en/latest/zh/api/transformers/models/blenderbot_small/#mindnlp.transformers.models.blenderbot_small.modeling_blenderbot_small.BlenderbotSmallModel</a></p><table><thead><tr><th>æ¨¡å‹åç§°</th><th>æ¶æ„ç±»å‹</th><th>è¾“å…¥è¾“å‡ºæ¨¡å¼</th><th>ä¸»è¦ç”¨é€”</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>BlenderbotSmallModel</code></td><td>Encoder-Decoder</td><td>æ¥å—è¾“å…¥ï¼Œè¿”å›æœªç»è¯­è¨€æ¨¡å‹å¤´ï¼ˆLM Headï¼‰å¤„ç†çš„åŸå§‹éšè—çŠ¶æ€</td><td>æå–æ–‡æœ¬ç‰¹å¾æˆ–è‡ªå®šä¹‰ä»»åŠ¡å¤´</td><td>ç ”ç©¶ã€ç‰¹å¾æå–</td></tr><tr><td><code>BlenderbotSmallForConditionalGeneration</code></td><td>Encoder-Decoder + LM Head</td><td>æ¥å—è¾“å…¥ï¼Œç›´æ¥ç”Ÿæˆæ–‡æœ¬åºåˆ—ï¼ˆé€šè¿‡ <code>LM Head</code> è§£ç ï¼‰</td><td>å¯¹è¯ç”Ÿæˆï¼ˆå¦‚å¾®è°ƒ <code>Synthetic-Persona-Chat</code>ï¼‰ã€‚ æ–‡æœ¬æ‘˜è¦ã€ç¿»è¯‘ç­‰éœ€è¦åŒå‘ä¸Šä¸‹æ–‡ç†è§£çš„ä»»åŠ¡ã€‚</td><td>å¯¹è¯ç”Ÿæˆã€ç¿»è¯‘ã€æ‘˜è¦</td></tr><tr><td><code>BlenderbotSmallForCausalLM</code></td><td>Decoder-only</td><td>ä»å·¦åˆ°å³ç”Ÿæˆæ–‡æœ¬ï¼ˆç±»ä¼¼ GPTï¼‰</td><td>å¼€æ”¾å¼æ–‡æœ¬ç”Ÿæˆï¼ˆå¦‚æ•…äº‹ç»­å†™ï¼‰ã€‚ å•è½®é—®ç­”ã€æ–‡æœ¬è¡¥å…¨ã€‚</td><td>æ•…äº‹ç»­å†™ã€æ–‡æœ¬è¡¥å…¨</td></tr></tbody></table><hr><ol><li>BlenderbotSmallModel</li></ol><ul><li><strong>å®šä½</strong>: åŸºç¡€æ¨¡å‹ï¼Œä»…åŒ…å«ç¼–ç å™¨ï¼ˆEncoderï¼‰å’Œè§£ç å™¨ï¼ˆDecoderï¼‰éª¨æ¶ã€‚</li><li><strong>è¾“å‡º</strong>: è¿”å›æœªç»è¯­è¨€æ¨¡å‹å¤´ï¼ˆLM Headï¼‰å¤„ç†çš„åŸå§‹éšè—çŠ¶æ€ã€‚</li><li><strong>ç”¨é€”</strong>:<ul><li>ç ”ç©¶æ¨¡å‹å†…éƒ¨æœºåˆ¶ã€‚</li><li>è‡ªå®šä¹‰ä»»åŠ¡å¤´ï¼ˆå¦‚åˆ†ç±»ã€æ£€ç´¢ï¼‰ã€‚</li></ul></li></ul><ol start="2"><li><strong>BlenderbotSmallForConditionalGeneration</strong>:<ul><li><strong>é€‚ç”¨åœºæ™¯</strong>: å¯¹è¯ç”Ÿæˆä»»åŠ¡ï¼Œå°¤å…¶æ˜¯éœ€è¦æ ¹æ®ä¸Šä¸‹æ–‡ç”Ÿæˆè¿è´¯å›å¤çš„åœºæ™¯ã€‚</li><li><strong>ç‰¹ç‚¹</strong>: è¿™æ˜¯ä¸€ä¸ªæ¡ä»¶ç”Ÿæˆæ¨¡å‹ï¼Œé€‚åˆå¤„ç†è¾“å…¥è¾“å‡ºå¯¹çš„ä»»åŠ¡ï¼Œå¦‚å¯¹è¯ç”Ÿæˆã€æ–‡æœ¬æ‘˜è¦ç­‰ã€‚</li><li><strong>æ¨è</strong>: å¦‚æœä½ çš„ç›®æ ‡æ˜¯ç”Ÿæˆå¯¹è¯å›å¤ï¼Œ<code>BlenderbotSmallForConditionalGeneration</code> æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</li></ul></li><li><strong>BlenderbotSmallForCausalLM</strong>:<ul><li><strong>é€‚ç”¨åœºæ™¯</strong>: è‡ªå›å½’æ–‡æœ¬ç”Ÿæˆä»»åŠ¡ï¼Œå¦‚æ•…äº‹ç”Ÿæˆæˆ–æ–‡æœ¬è¡¥å…¨ã€‚</li><li><strong>ç‰¹ç‚¹</strong>: è¿™æ˜¯ä¸€ä¸ªå› æœè¯­è¨€æ¨¡å‹ï¼Œé€‚åˆä»å·¦åˆ°å³ç”Ÿæˆæ–‡æœ¬ï¼Œä¸ä¾èµ–ç‰¹å®šè¾“å…¥æ¡ä»¶ã€‚</li><li><strong>æ¨è</strong>: å¦‚æœä½ çš„ä»»åŠ¡æ˜¯ç”Ÿæˆè¿ç»­æ–‡æœ¬è€Œéå¯¹è¯å›å¤ï¼Œå¯ä»¥é€‰æ‹© <code>BlenderbotSmallForCausalLM</code>ã€‚</li></ul></li></ol><h1>æ¨¡å‹å¾®è°ƒæ–¹æ³•</h1><p>å¾®è°ƒçš„ä¸€èˆ¬ç­–ç•¥ã€‚é€šå¸¸æœ‰ä¸¤ç§æ–¹æ³•ï¼šä¸€ç§æ˜¯å…¨å‚æ•°å¾®è°ƒï¼Œå¦ä¸€ç§æ˜¯éƒ¨åˆ†å†»ç»“ï¼Œåªè®­ç»ƒæŸäº›å±‚ã€‚</p><p>ConditionalGenerationï¼Œæ‰€ä»¥æ¥ä¸‹æ¥åº”è¯¥æ˜¯å…·ä½“çš„å¾®è°ƒæ­¥éª¤ã€‚å†»ç»“å±‚é€šå¸¸æ˜¯ä¸ºäº†é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œç‰¹åˆ«æ˜¯åœ¨æ•°æ®é‡è¾ƒå°çš„æƒ…å†µä¸‹ï¼Œæˆ–è€…ä¿ç•™é¢„è®­ç»ƒæ¨¡å‹çš„ä¸€äº›é€šç”¨ç‰¹å¾ã€‚Synthetic-Persona-Chatæ•°æ®é›†å¯èƒ½æ˜¯ä¸€ä¸ªå¯¹è¯ç”Ÿæˆæ•°æ®é›†ï¼Œæœ‰è¶³å¤Ÿçš„æ•°æ®é‡ã€‚</p><p>æ¥ä¸‹æ¥è¦è€ƒè™‘BlenderbotSmallçš„ç»“æ„ã€‚BlenderbotSmallæ˜¯åŸºäºTransformerçš„æ¨¡å‹ï¼ŒåŒ…å«ç¼–ç å™¨å’Œè§£ç å™¨ã€‚å¯¹äºç”Ÿæˆä»»åŠ¡ï¼Œé€šå¸¸è§£ç å™¨éƒ¨åˆ†æ›´å…³é”®ï¼Œå°¤å…¶æ˜¯åœ¨ç”Ÿæˆå“åº”æ—¶ã€‚ç”¨æˆ·æ˜¯å¦éœ€è¦å†»ç»“å‰é¢çš„æƒé‡ï¼Œå¯èƒ½æŒ‡çš„æ˜¯ç¼–ç å™¨éƒ¨åˆ†ï¼Œæˆ–è€…æ˜¯åº•å±‚çš„åµŒå…¥å±‚ï¼Ÿ</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨å¾®è°ƒæ—¶ï¼Œå¦‚æœæ•°æ®é‡ä¸å¤§ï¼Œå†»ç»“éƒ¨åˆ†åº•å±‚å‚æ•°å¯ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆï¼ŒåŒæ—¶è®©æ¨¡å‹ä¿ç•™æ›´å¤šçš„é€šç”¨è¯­è¨€ç†è§£èƒ½åŠ›ã€‚åä¹‹ï¼Œå¦‚æœæ•°æ®è¶³å¤Ÿï¼Œè§£å†»æ‰€æœ‰å±‚è¿›è¡Œå¾®è°ƒå¯èƒ½æ•ˆæœæ›´å¥½ã€‚éœ€è¦è¯¢é—®ç”¨æˆ·çš„æ•°æ®é‡å—ï¼Ÿä½†ç”¨æˆ·æ²¡æœ‰æåˆ°ï¼Œå¯èƒ½éœ€è¦ç»™å‡ºä¸€èˆ¬æ€§çš„å»ºè®®ã€‚</p><p>ç„¶åï¼Œå…³äºå¦‚ä½•ç”¨transformersåº“å†»ç»“å‚æ•°ã€‚é€šå¸¸æ˜¯é€šè¿‡è®¾ç½®å‚æ•°çš„requires_gradä¸ºFalseã€‚ä¾‹å¦‚ï¼Œéå†æ¨¡å‹çš„å‚æ•°ï¼Œå¯¹æŸäº›å±‚è¿›è¡Œå†»ç»“ã€‚ä¾‹å¦‚ï¼Œå†»ç»“åµŒå…¥å±‚ã€ç¼–ç å™¨çš„å‰å‡ å±‚ç­‰ã€‚</p><ul><li><strong>ä¸å†»ç»“ï¼ˆé»˜è®¤æ¨èï¼‰</strong>:<ul><li><strong>é€‚ç”¨åœºæ™¯</strong>: æ•°æ®é›†è¶³å¤Ÿå¤§ï¼ˆä¸é¢„è®­ç»ƒæ•°æ®åˆ†å¸ƒç›¸ä¼¼ï¼‰ï¼Œæˆ–éœ€è¦æ¨¡å‹å……åˆ†é€‚åº”å¯¹è¯ä»»åŠ¡ã€‚</li><li><strong>ä¼˜ç‚¹</strong>: æ¨¡å‹çš„æ‰€æœ‰å‚æ•°å‡å¯æ›´æ–°ï¼Œèƒ½æ›´å¥½åœ°å­¦ä¹ å¯¹è¯ä»»åŠ¡çš„ç‰¹æ€§ã€‚</li><li><strong>ç¼ºç‚¹</strong>: è®­ç»ƒæ—¶é—´è¾ƒé•¿ï¼Œæ˜¾å­˜å ç”¨é«˜ï¼Œå¯èƒ½åœ¨å°æ•°æ®é›†ä¸Šè¿‡æ‹Ÿåˆã€‚</li></ul></li><li><strong>å†»ç»“éƒ¨åˆ†æƒé‡</strong>:<ul><li><strong>é€‚ç”¨åœºæ™¯</strong>: æ•°æ®é›†è¾ƒå°ï¼Œæˆ–å¸Œæœ›å¿«é€Ÿå¾®è°ƒã€èŠ‚çœèµ„æºã€‚</li><li><strong>ä¼˜ç‚¹</strong>: å‡å°‘æ˜¾å­˜å ç”¨ã€åŠ é€Ÿè®­ç»ƒï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆã€‚</li><li><strong>ç¼ºç‚¹</strong>: å¯èƒ½é™åˆ¶æ¨¡å‹å¯¹æ–°ä»»åŠ¡çš„é€‚åº”èƒ½åŠ›ã€‚</li><li><ol><li><strong>è½»é‡çº§å¾®è°ƒ</strong>:<ul><li>å†»ç»“ç¼–ç å™¨ï¼Œä»…è®­ç»ƒè§£ç å™¨ã€‚</li><li>é€‚åˆèµ„æºæœ‰é™æˆ–æ•°æ®é›†è¾ƒå°çš„æƒ…å†µã€‚</li></ul></li><li><strong>å¹³è¡¡ç­–ç•¥</strong>:<ul><li>å†»ç»“å‰å‡ å±‚ï¼ˆå¦‚ç¼–ç å™¨çš„å‰ 3 å±‚ï¼‰ï¼Œè®­ç»ƒæ·±å±‚ç½‘ç»œã€‚</li><li>ä¿ç•™æµ…å±‚é€šç”¨ç‰¹å¾ï¼Œè°ƒæ•´æ·±å±‚ä»»åŠ¡ç›¸å…³ç‰¹å¾ã€‚</li></ul></li><li><strong>å…¨å‚æ•°å¾®è°ƒ</strong>:<ul><li>ä¸å†»ç»“ä»»ä½•å‚æ•°ï¼Œç›´æ¥å¾®è°ƒã€‚</li><li>é€‚åˆæ•°æ®é›†è¾ƒå¤§ä¸”ä¸é¢„è®­ç»ƒä»»åŠ¡å·®å¼‚è¾ƒå¤§çš„åœºæ™¯ã€‚</li></ul></li></ol></li></ul></li></ul><h1>æ•°æ®é›†é€‰æ‹©</h1><h3 id="é’ˆå¯¹-synthetic-persona-chat-çš„å¾®è°ƒé€‰æ‹©æ¨èæ¨¡å‹-blenderbotsmallforconditionalgeneration">é’ˆå¯¹ <code>Synthetic-Persona-Chat</code> çš„å¾®è°ƒé€‰æ‹©æ¨èæ¨¡å‹:<code>BlenderbotSmallForConditionalGeneration</code></h3><h3 id="åŸå› ">åŸå› :</h3><ol><li><strong>ä»»åŠ¡åŒ¹é…</strong>: è¯¥æ•°æ®é›†æ˜¯ <strong>å¤šè½®å¯¹è¯</strong>ï¼Œéœ€è¦æ¨¡å‹æ ¹æ®ä¸Šä¸‹æ–‡ï¼ˆç”¨æˆ·è¾“å…¥ + è§’è‰²è®¾å®šï¼‰ç”Ÿæˆå›å¤ï¼Œå®Œç¾å¥‘åˆ Seq2Seq æ¶æ„ã€‚</li><li><strong>åŒå‘ä¸Šä¸‹æ–‡</strong>: ç¼–ç å™¨å¯æ•æ‰è¾“å…¥å¯¹è¯çš„å…¨å±€ä¿¡æ¯ï¼Œè§£ç å™¨ç”Ÿæˆæ—¶ç»“åˆç¼–ç å™¨çŠ¶æ€å’Œå·²ç”Ÿæˆéƒ¨åˆ†ã€‚</li><li><strong>æ€§èƒ½ä¼˜åŠ¿</strong>: åœ¨å¯¹è¯ä»»åŠ¡ä¸­ï¼Œæ¡ä»¶ç”Ÿæˆæ¨¡å‹çš„æµç•…åº¦å’Œç›¸å…³æ€§æ˜¾è‘—ä¼˜äºçº¯è§£ç å™¨æ¨¡å‹ã€‚</li></ol><h3 id="ä¸ºä»€ä¹ˆä¸é€‰å…¶ä»–æ¨¡å‹ï¼Ÿ">ä¸ºä»€ä¹ˆä¸é€‰å…¶ä»–æ¨¡å‹ï¼Ÿ</h3><ul><li><code>BlenderbotSmallModel</code>:<ul><li>ç¼ºå°‘ç”Ÿæˆå¤´ï¼ˆLM Headï¼‰ï¼Œéœ€è‡ªè¡Œæ·»åŠ ç”Ÿæˆé€»è¾‘ï¼Œä¸é€‚åˆç›´æ¥å¾®è°ƒç”Ÿæˆä»»åŠ¡ã€‚</li></ul></li><li><code>BlenderbotSmallForCausalLM</code>:<ul><li>ä»…è§£ç å™¨æ¶æ„æ— æ³•æœ‰æ•ˆåˆ©ç”¨åŒå‘ä¸Šä¸‹æ–‡ï¼Œå¯¹è¯ç”Ÿæˆæ•ˆæœå—é™ã€‚</li><li>æ›´é€‚åˆå•è½®æ–‡æœ¬ç»­å†™ï¼Œè€Œéå¤šè½®äº¤äº’å¼å¯¹è¯ã€‚</li></ul></li></ul><h3 id="å¦‚ä½•è°ƒç”¨">å¦‚ä½•è°ƒç”¨</h3><h2 id="å¦‚ä½•å¤„ç†æ•°æ®é›†">å¦‚ä½•å¤„ç†æ•°æ®é›†</h2><p>ä¸€ä¸ªdatasetåº“è·å¾—çš„æ•°æ®é›†è¦ç”¨åœ¨mindnlpè®­ç»ƒä¸­ï¼Œè¦ç»è¿‡ä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š</p><ol><li>å°†æ•°æ®é›†è½¬åŒ–ä¸ºæ¨¡å‹éœ€è¦çš„æ ¼å¼ï¼Œå¦‚åºåˆ—ç”Ÿæˆæ¨¡å‹éœ€è¦å¯¹è¯å¯¹æ ¼å¼ï¼Œåºç±»åˆ†ç±»æ¨¡å‹éœ€è¦åºåˆ—+æ ‡ç­¾æ ¼å¼</li><li>è¿›è¡Œtokenizer</li><li>è½¬åŒ–ä¸ºmindnlpå¯ä»¥ç›´æ¥ä½¿ç”¨çš„mindspore.datasetæ ¼å¼</li></ol><p>ç»™ä¸€ä¸ªhuggingfaceçš„å›¾</p><h3 id="æ•°æ®é›†çš„ç›®æ ‡ç»“æ„ï¼šå¯¹è¯å½¢å¼">æ•°æ®é›†çš„ç›®æ ‡ç»“æ„ï¼šå¯¹è¯å½¢å¼</h3><p>BlenderbotSmall æ˜¯ä¸“ä¸º <strong>å¤šè½®å¯¹è¯ç”Ÿæˆ</strong> è®¾è®¡çš„æ¨¡å‹ï¼Œå› æ­¤æ•°æ®é›†éœ€è¦ä»¥ <strong>å¯¹è¯å¯¹ï¼ˆContext-Response Pairsï¼‰</strong> ä¸ºæ ¸å¿ƒã€‚å…·ä½“æ¥è¯´ï¼Œæ¯æ¡æ ·æœ¬åº”åŒ…å«ï¼š</p><ul><li><p><strong>è¾“å…¥ï¼ˆContextï¼‰</strong>ï¼šå¯¹è¯å†å²ï¼ˆå¤šè½®ä¸Šä¸‹æ–‡ï¼‰ã€‚</p></li><li><p><strong>ç›®æ ‡è¾“å‡ºï¼ˆTarget Responseï¼‰</strong>ï¼šæ¨¡å‹éœ€è¦ç”Ÿæˆçš„å›å¤ã€‚</p></li><li><p><strong>å•è½®å¯¹è¯ï¼ˆç®€å•åœºæ™¯ï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># è¾“å…¥ï¼ˆä¸Šä¸‹æ–‡ï¼‰</span><br><span class="line">&quot;Hi, how are you?&quot;</span><br><span class="line"># ç›®æ ‡è¾“å‡ºï¼ˆå›å¤ï¼‰</span><br><span class="line">&quot;I&#x27;m good, thanks! How about you?&quot;</span><br></pre></td></tr></table></figure><h4 id="å¤šè½®å¯¹è¯-æ›´å¸¸è§"><strong>å¤šè½®å¯¹è¯ï¼ˆæ›´å¸¸è§ï¼‰</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># è¾“å…¥ï¼ˆä¸Šä¸‹æ–‡ï¼‰</span><br><span class="line">&quot;User: Hi, what&#x27;s your favorite movie? \nBot: I like science fiction. \nUser: Why?&quot;</span><br><span class="line"># ç›®æ ‡è¾“å‡ºï¼ˆå›å¤ï¼‰</span><br><span class="line">&quot;Because it explores futuristic ideas.&quot;</span><br></pre></td></tr></table></figure><h4 id="å¸¦æœ‰è§’è‰²è®¾å®š-persona-çš„å¯¹è¯"><strong>å¸¦æœ‰è§’è‰²è®¾å®šï¼ˆPersonaï¼‰çš„å¯¹è¯</strong></h4><p>å¦‚æœæ•°æ®é›†åŒ…å«è§’è‰²ä¿¡æ¯ï¼ˆå¦‚ <code>Synthetic-Persona-Chat</code>ï¼‰ï¼Œéœ€è¦åœ¨è¾“å…¥ä¸­æ˜¾å¼æ·»åŠ è§’è‰²æè¿°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># è¾“å…¥ï¼ˆä¸Šä¸‹æ–‡ï¼‰</span><br><span class="line">&quot;Persona: I am a robot. I love reading books. \nUser: What do you do for fun?&quot;</span><br><span class="line"># ç›®æ ‡è¾“å‡ºï¼ˆå›å¤ï¼‰</span><br><span class="line">&quot;I enjoy reading books, especially science fiction.&quot;</span><br></pre></td></tr></table></figure></li></ul><p>print(â€œdataset:â€, dataset)</p><p>dataset: DatasetDict({<br>train: Dataset({<br>features: [â€˜user 1 personasâ€™, â€˜user 2 personasâ€™, â€˜Best Generated Conversationâ€™],<br>num_rows: 8938<br>})<br>validation: Dataset({<br>features: [â€˜user 1 personasâ€™, â€˜user 2 personasâ€™, â€˜Best Generated Conversationâ€™],<br>num_rows: 1000<br>})<br>test: Dataset({<br>features: [â€˜user 1 personasâ€™, â€˜user 2 personasâ€™, â€˜Best Generated Conversationâ€™],<br>num_rows: 968<br>})<br>})</p><p>dataset_train = dataset[â€œtrainâ€]</p><p>print(â€œdataset_train:â€, dataset_train)</p><p>dataset_train: Dataset({<br>features: [â€˜user 1 personasâ€™, â€˜user 2 personasâ€™, â€˜Best Generated Conversationâ€™],<br>num_rows: 8938<br>})</p><p>print(â€œdataset_train[â€˜Best Generated Conversationâ€™][0]:\nâ€, dataset_train[â€œBest Generated Conversationâ€][0])</p><p>dataset_train[â€˜Best Generated Conversationâ€™][0]:<br>User 1: Hi! Iâ€™m [user 1â€™s name].<br>User 2: Hi [user 1â€™s name], Iâ€™m [user 2â€™s name].<br>User 1: What do you do for fun?<br>User 2: I like to play video games, go to the beach, and read.<br>User 1: I like to play video games too! Iâ€™m not much of a reader, though.<br>User 2: What video games do you like to play?<br>User 1: I like to play a lot of different games, but Iâ€™m really into competitive online games right now.<br>User 2: Iâ€™m not really into competitive games, I like to play more relaxing games.<br>User 1: Thatâ€™s cool. What kind of relaxing games do you like to play?<br>User 2: I like to play puzzle games, simulation games, and story-based games.<br>User 1: Iâ€™ve never been much of a puzzle game person, but I do like simulation games and story-based games.<br>User 2: Nice! Whatâ€™s your favorite simulation game?<br>User 1: I like Stardew Valley a lot. Itâ€™s a farming game, but itâ€™s also really relaxing and fun.<br>User 2: Iâ€™ve heard good things about that game. I might have to check it out.<br>User 1: You should! Itâ€™s a lot of fun.<br>User 2: Well, Iâ€™m glad we met. Maybe we can play some games together sometime.<br>User 1: That would be fun!<br>User 2: Great! Iâ€™ll send you my Steam name.<br>User 1: Ok, sounds good.</p><p>print(â€œdataset_train[â€˜user 1 personasâ€™][0]:â€, dataset_train[â€œuser 1 personasâ€][0])</p><p>dataset_train[â€˜user 1 personasâ€™][0]: I am 32.<br>I do not want a job.<br>I play video games all day.<br>I still live at home with my parents.</p><p>print(â€œdataset_train[â€˜user 2 personasâ€™][0]:â€, dataset_train[â€œuser 2 personasâ€][0])</p><p>dataset_train[â€˜user 2 personasâ€™][0]: My favorite drink is iced coffee.<br>I have a black belt in karate.<br>I m in a jazz band and play the saxophone.<br>I vacation along lake michigan every summer.</p><h4 id="tokenizer">tokenizer</h4><p>def tokenize_function(examples):</p><p>â€‹        model_inputs = tokenizer(</p><p>â€‹            examples[â€œinputâ€],</p><p>â€‹            max_length=128,</p><p>â€‹            truncation=True,</p><p>â€‹            padding=â€œmax_lengthâ€,</p><p>â€‹        )</p><p>â€‹        with tokenizer.as_target_tokenizer():</p><p>â€‹            labels = tokenizer(</p><p>â€‹                examples[â€œtargetâ€],</p><p>â€‹                max_length=128,</p><p>â€‹                truncation=True,</p><p>â€‹                padding=â€œmax_lengthâ€,</p><p>â€‹            )</p><p>â€‹        model_inputs[â€œlabelsâ€] = labels[â€œinput_idsâ€]#è·å¾—&quot;labels&quot; â€œinput_idsâ€ â€œattention_maskâ€ã€‚é€šè¿‡æŸ¥é˜…forwardå‡½æ•°ï¼Œlabelè¦æ”¹ålabels</p><p>â€‹        return model_inputs</p><p>â€‹    dataset_train_tokenized = dataset_train_tokenized.map(tokenize_function, batched=True)</p><h4 id="è½¬åŒ–ä¸ºmingnlpæ ¼å¼">è½¬åŒ–ä¸ºmingnlpæ ¼å¼</h4><p>import mindspore.dataset as ds</p><p>def data_generator(dataset):</p><p>â€‹    for item in dataset:</p><p>â€‹        yield item[â€œinput_idsâ€], item[â€œattention_maskâ€], item[â€œlabelsâ€]</p><p>import mindspore.dataset as ds</p><p># å°†è®­ç»ƒé›†å’ŒéªŒè¯é›†è½¬æ¢ä¸º MindSpore æ•°æ®é›†ï¼Œæ³¨æ„forwardå‡½æ•°ä¸­labelè¦æ”¹æˆlabels</p><p>def create_mindspore_dataset(dataset, shuffle=True):</p><p>â€‹    return ds.GeneratorDataset(</p><p>â€‹        source=lambda: data_generator(dataset),  # ä½¿ç”¨ lambda åŒ…è£…ç”Ÿæˆå™¨</p><p>â€‹        column_names=[â€œinput_idsâ€, â€œattention_maskâ€, â€œlabelsâ€],</p><p>â€‹        shuffle=shuffle</p><p>â€‹    )</p><p>dataset_train_tokenized = create_mindspore_dataset(dataset_train_tokenized, shuffle=True)</p><h3 id="äºŒ-ç¯å¢ƒå‡†å¤‡ä¸æ•°æ®è¯´æ˜-10åˆ†é’Ÿ"><strong>äºŒã€ç¯å¢ƒå‡†å¤‡ä¸æ•°æ®è¯´æ˜ï¼ˆ10åˆ†é’Ÿï¼‰</strong></h3><ol><li><p><strong>ç¯å¢ƒé…ç½®</strong></p><ul><li>MindNLPå®‰è£…æŒ‡å—ï¼ˆç»“åˆæ˜‡è…¾NPU/GPUç‰ˆæœ¬ï¼‰</li><li>ä¾èµ–åº“ï¼šmindspore, mindnlp, datasets, peft</li></ul></li><li><p><strong>æ•°æ®å‡†å¤‡</strong></p><ul><li><p>æ•°æ®é›†ç¤ºä¾‹ï¼šDailyDialogï¼ˆæ—¥å¸¸å¯¹è¯ï¼‰ã€Custom JSONæ ¼å¼æ•°æ®</p></li><li><p>æ•°æ®é¢„å¤„ç†ï¼š</p><p>python</p><p>å¤åˆ¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def format_dialogue(example):  </span><br><span class="line">    return &#123;&quot;text&quot;: f&quot;User: &#123;example[&#x27;input&#x27;]&#125;\nBot: &#123;example[&#x27;output&#x27;]&#125;&quot;&#125;  </span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®åˆ’åˆ†ï¼š8:1:1ï¼ˆè®­ç»ƒ/éªŒè¯/æµ‹è¯•ï¼‰</p></li></ul></li></ol><hr><h3 id="ä¸‰-æ¨¡å‹åŠ è½½ä¸pefté…ç½®-15åˆ†é’Ÿ"><strong>ä¸‰ã€æ¨¡å‹åŠ è½½ä¸PEFTé…ç½®ï¼ˆ15åˆ†é’Ÿï¼‰</strong></h3><ol><li><p><strong>åŠ è½½BlenderBot-Smallé¢„è®­ç»ƒæ¨¡å‹</strong></p><ul><li><p>MindNLPä»£ç ç¤ºä¾‹ï¼š</p><p>python</p><p>å¤åˆ¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from mindnlp.models import BlenderbotSmall  </span><br><span class="line">model = BlenderbotSmall.from_pretrained(&quot;blenderbot_small-90M&quot;)  </span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>PEFTå‚æ•°æ³¨å…¥ï¼ˆä»¥LoRAä¸ºä¾‹ï¼‰</strong></p><ul><li><p>å…³é”®å‚æ•°è§£æï¼ˆè¡”æ¥å‰åºPEFTçŸ¥è¯†ï¼‰ï¼š</p><ul><li><code>target_modules=[&quot;q_proj&quot;, &quot;v_proj&quot;]</code>ï¼ˆé€‰æ‹©æ³¨æ„åŠ›å±‚ï¼‰</li><li><code>r=8, lora_alpha=32</code>ï¼ˆå¹³è¡¡å‚æ•°é‡ä¸æ•ˆæœï¼‰</li><li><code>lora_dropout=0.1</code>ï¼ˆé˜²æ­¢å°æ•°æ®è¿‡æ‹Ÿåˆï¼‰</li></ul></li><li><p>ä»£ç å®ç°ï¼š</p><p>python</p><p>å¤åˆ¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from peft import LoraConfig, get_peft_model  </span><br><span class="line">peft_config = LoraConfig(  </span><br><span class="line">    r=8, lora_alpha=32,  </span><br><span class="line">    target_modules=[&quot;q_proj&quot;, &quot;v_proj&quot;],  </span><br><span class="line">    lora_dropout=0.1  </span><br><span class="line">)  </span><br><span class="line">model = get_peft_model(model, peft_config)  </span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>å†»ç»“åŸæ¨¡å‹å‚æ•°</strong></p><ul><li>éªŒè¯å‚æ•°å†»ç»“çŠ¶æ€ï¼š<code>print_trainable_parameters(model)</code></li></ul></li></ol><hr><h3 id="å››-è®­ç»ƒæµç¨‹ä¸ä¼˜åŒ–æŠ€å·§-20åˆ†é’Ÿ"><strong>å››ã€è®­ç»ƒæµç¨‹ä¸ä¼˜åŒ–æŠ€å·§ï¼ˆ20åˆ†é’Ÿï¼‰</strong></h3><ol><li><p><strong>è®­ç»ƒé…ç½®</strong></p><ul><li>ä¼˜åŒ–å™¨é€‰æ‹©ï¼š<code>AdamWeightDecay</code>ï¼ˆMindSporeå…¼å®¹ï¼‰</li><li>å­¦ä¹ ç‡è®¾ç½®ï¼š<code>5e-4</code>ï¼ˆPEFTé€šå¸¸éœ€æ›´å¤§å­¦ä¹ ç‡ï¼‰</li><li>Batch Sizeä¸æ¢¯åº¦ç´¯ç§¯ï¼šæ ¹æ®æ˜¾å­˜åŠ¨æ€è°ƒæ•´</li></ul></li><li><p><strong>è®­ç»ƒä»£ç æ ¸å¿ƒç‰‡æ®µ</strong></p><p>python</p><p>å¤åˆ¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from mindnlp.engine import Trainer, TrainingArguments  </span><br><span class="line">training_args = TrainingArguments(  </span><br><span class="line">    output_dir=&quot;./results&quot;,  </span><br><span class="line">    per_device_train_batch_size=4,  </span><br><span class="line">    num_train_epochs=3,  </span><br><span class="line">    learning_rate=5e-4,  </span><br><span class="line">    logging_steps=50  </span><br><span class="line">)  </span><br><span class="line">trainer = Trainer(  </span><br><span class="line">    model=model,  </span><br><span class="line">    args=training_args,  </span><br><span class="line">    train_dataset=train_dataset  </span><br><span class="line">)  </span><br><span class="line">trainer.train()  </span><br></pre></td></tr></table></figure></li><li><p><strong>æ€§èƒ½ç›‘æ§ä¸è°ƒè¯•</strong></p><ul><li>ä½¿ç”¨MindInsightå¯è§†åŒ–è®­ç»ƒæ›²çº¿ï¼ˆLoss/Perplexityï¼‰</li><li>å¸¸è§é—®é¢˜ï¼š<ul><li>æ˜¾å­˜ä¸è¶³ï¼šå¯ç”¨æ¢¯åº¦æ£€æŸ¥ç‚¹ï¼ˆ<code>gradient_checkpointing=True</code>ï¼‰</li><li>æ”¶æ•›æ…¢ï¼šæ£€æŸ¥å­¦ä¹ ç‡ä¸å‚æ•°æ˜¯å¦è§£å†»</li></ul></li></ul></li></ol><hr><ol><li><ul><li></li></ul></li></ol><hr>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;è®²è§£mindnlpæ¨¡å‹å¾®è°ƒ20250329&lt;/h1&gt;
&lt;p&gt;å…ˆç»™å¤§å®¶è¯´è‡ªå·±æ˜¯ä¸‰ç»´è§†è§‰é¢†åŸŸ&lt;/p&gt;
&lt;p&gt;é¦–å…ˆè®²è§£mindnlpçš„ç»„æˆï¼Œè®­ç»ƒæ–¹æ³•&lt;/p&gt;
&lt;p&gt;ç„¶åè®²è§£æ¨¡å‹ä»»åŠ¡ï¼Œæ¨¡å‹åˆ†ä¸ºå››ç§&lt;/p&gt;
&lt;p&gt;ç„¶åè®²è§£å¾®è°ƒæ•°æ®é›†çš„é€‰æ‹©ï¼Œå¾®è°ƒçš„ä¸¤ç§æ–¹æ³•&lt;/p&gt;
&lt;p&gt;ç„¶åè®²è§£å¾®è°ƒ</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>swiftUIçš„ç¬”è®°</title>
    <link href="http://outbreak-sen.github.io/2025/03/19/swiftUI%E7%9A%84%E7%AC%94%E8%AE%B0/"/>
    <id>http://outbreak-sen.github.io/2025/03/19/swiftUI%E7%9A%84%E7%AC%94%E8%AE%B0/</id>
    <published>2025-03-19T12:10:50.245Z</published>
    <updated>2025-03-19T12:11:11.170Z</updated>
    
    
    
    
    <category term="swift" scheme="http://outbreak-sen.github.io/categories/swift/"/>
    
    
  </entry>
  
  <entry>
    <title>macbookä½¿ç”¨æ–¹æ³•</title>
    <link href="http://outbreak-sen.github.io/2025/03/19/macbook%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/"/>
    <id>http://outbreak-sen.github.io/2025/03/19/macbook%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/</id>
    <published>2025-03-19T12:07:28.000Z</published>
    <updated>2025-03-19T12:08:10.922Z</updated>
    
    <content type="html"><![CDATA[<h1>Macbookä½¿ç”¨ç¬”è®°</h1><ul><li>å·¦å³åˆ†å±ï¼šæŒ‰ä½Optioné”®æ‹–ç§»çª—å£ï¼Œæˆ–å°†æŒ‡é’ˆæ”¾åœ¨å·¦ä¸Šè§’çš„ç»¿è‰²å›¾æ ‡ä¸Š</li><li>åˆ†å±å¹•ï¼šä¸‰æŒ‡å¾€ä¸Šæ¨ç„¶åå†åœ¨é¡¶éƒ¨æŠŠä¸¤ä¸ªè½¯ä»¶å•æŒ‡ç»“åˆåˆ°ä¸€èµ·</li><li>deleteé”®æŒ‰ï¼šfn+åˆ é™¤é”®ï¼Œå¯ä»¥åˆ é™¤å…‰æ ‡åé¢çš„å­—ç¬¦</li><li>ç›´æ¥åˆ°è¾¾æ¡Œé¢ï¼šå››ä¸ªæŒ‡å¤´æ”¾å¤§ç„¶åæ‰‹æ‹¿å¼€</li><li>åˆ‡æ¢è¾“å…¥æ³•ï¼šcontrolç©ºæ ¼</li><li>åˆ é™¤æ–‡ä»¶ï¼šcommand+delete</li><li>Safariæ–°å»ºæ ‡ç­¾é¡µæ‰“å¼€ï¼šcommand+å·¦é”®</li><li>æˆªå›¾å¤§å…¨<ol><li>å…¨å±æˆªå›¾å¹¶ä¿å­˜åˆ°å‰ªåˆ‡æ¿ï¼šControl + Command + Shift + 3</li><li>é€‰æ‹©åŒºåŸŸæˆªå›¾å¹¶ä¿å­˜åˆ°å‰ªåˆ‡æ¿ï¼šæŒ‰ä¸‹Control + Command + Shift + 4</li><li>å…¨å±æˆªå›¾ï¼šcomâ•shiftâ•3ï¼ˆipadæ ‡æ³¨åŒæ­¥ï¼‰</li><li>çŸ©å½¢æˆªå›¾ï¼šcomâ•shiftâ•4 ï¼ˆç©ºæ ¼ç§»åŠ¨ï¼Œoptionä¸­å¿ƒç¼©æ”¾ï¼‰</li><li>å½•å±å·¥å…·ï¼ï¼ï¼ï¼ï¼ï¼šcomâ•shiftâ•5</li></ol></li><li>é€€å‡ºåº”ç”¨ç›´æ¥é€€å‡ºï¼šcomâ•Q</li><li>éšè—çª—å£ï¼šcomâ•H</li><li>å…³é—­çª—å£ï¼šcomâ•W</li><li>æ–°å»ºçª—å£ï¼šcomâ•N</li><li>æœ€å¤§åŒ–/æœ€å°åŒ–çª—å£ï¼šcom+ctrl+F</li><li>Macçš„é¼ æ ‡æ»šè½®æ˜¯åçš„ï¼Œä½†æ˜¯æ”¹å›å»è§¦æ‘¸æ¿åˆå˜æˆåçš„äº†ï¼Œåˆ«æ‰­å¾ˆæ­£å¸¸</li><li>Â¼éŸ³é‡ï¼šoptionâ•shiftâ•å¢/å‡éŸ³é‡</li><li>Safariæ¿€æ´»åœ°å€æ  comâ•L</li><li>åº”ç”¨æ ï¼šç¨‹åºåï½œæœ€è¿‘ä½¿ç”¨ï½œç¼©å°çš„å’Œ</li><li>èšç„¦æœç´¢ï¼šcommand+ç©ºæ ¼æ‰“å¼€spotlight</li><li>é¡¶éƒ¨å³è¾¹çš„èœå•å›¾æ ‡ï¼Œcommandæ‹–åŠ¨å¯ä»¥æ›´æ¢ä½ç½®ï¼Œä¹Ÿå¯ä»¥æ‹–å‡ºæ¥åˆ é™¤</li><li>æ‰“å¼€åº”ç”¨ï¼šå››ä¸ªæŒ‡å¤´ç¼©å°ç„¶åæ‰‹æ‹¿å¼€</li><li>å®‰è£…è½¯ä»¶ï¼šDMGæ–‡ä»¶ç›¸å½“äºISOæ–‡ä»¶ç£ç›˜ï¼Œä¹‹åè¿˜éœ€é€€å‡ºç£ç›˜ï¼Œ</li><li>å¸è½½è½¯ä»¶ï¼šè®¿è¾¾ä¸­åº”ç”¨ç¨‹åºæŠŠä»–æ‰”åˆ°åƒåœ¾æ¡¶å°±è¡Œäº†</li><li>åˆ‡æ¢çª—å£åº”ç”¨comâ•tabï¼Œå›é€€comâ•shiftâ•tabï¼Œé€€å‡ºesc</li><li>å¤åˆ¶å¤šä¸€ä»½æ–‡ä»¶ï¼šcomâ•Dï¼ˆåˆ›å»ºå¤šä¸€ä»½å‰¯æœ¬ï¼‰</li><li>ç§»åŠ¨ï¼ˆéå¤åˆ¶ï¼‰æ–‡ä»¶ Ctrlâ•C ï¼Œcomâ•optionâ•V    /   comâ•æ‹–æ‹½</li></ul><h1>æ–‡ä»¶ç®¡ç†</h1><p>æœ€è¿‘ä½¿ç”¨åŒ…å«äº†ä»¥ä¸‹ä¸¤ä¸ªéƒ¨åˆ†icloudå’Œæœ¬æœºä¸­æœ€è¿‘æ‰“å¼€çš„æ–‡ä»¶<br>æœ‰ä¸¤ä¸ªéƒ¨åˆ†</p><ul><li>iCloudï¼šå…¨ç”Ÿæ€å…±äº«ï¼ŒåŒ…å«äº†å½“å‰macæ¡Œé¢ï¼Œæœ‰äº› app ä¼šæœ‰è‡ªå·±çš„ iCloud æ–‡ä»¶å¤¹ï¼Œæ—¢è§£å†³äº†å¤‡ä»½åŒæ­¥ï¼Œåˆè‡ªåŠ¨åˆ›å»ºäº†åˆ†ç±»æ–‡ä»¶å¤¹ã€‚æ¯”å¦‚ MindNode ä¼šåˆ›å»ºè‡ªå·±çš„ iCloud æ–‡ä»¶å¤¹</li><li>æœ¬æœºï¼š å¯ä»¥æ˜¾ç¤ºæœ¬æœºï¼Œä½†æ˜¯å¦‚æœè¦å¿«é€Ÿæµè§ˆåˆ™åŒ…å«ä»¥ä¸‹ä¸¤ä¸ªéƒ¨åˆ†<ul><li>ä¸‹è½½</li><li>åº”ç”¨ç¨‹åº:æƒ³æŠŠä¸‹è½½çš„è½¯ä»¶å®‰è£…è¿›åº”ç”¨é¡µé¢ï¼Œç›´æ¥æ‹–åˆ°åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹ä¸­<br>ç¾åŒºidï¼š<a href="https://appid.mynatapp.cc/wx/index/aget/9b482d5e-2ad5-44e4-ac7f-c055df9b7566">https://appid.mynatapp.cc/wx/index/aget/9b482d5e-2ad5-44e4-ac7f-c055df9b7566</a></li></ul></li></ul><p>åœ¨ç»ˆç«¯ä¸­è¿›å…¥cloudç›®å½•æ–¹æ³•ï¼š cd Library/Mobile\ Documents/com~apple~CloudDocs</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;Macbookä½¿ç”¨ç¬”è®°&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;å·¦å³åˆ†å±ï¼šæŒ‰ä½Optioné”®æ‹–ç§»çª—å£ï¼Œæˆ–å°†æŒ‡é’ˆæ”¾åœ¨å·¦ä¸Šè§’çš„ç»¿è‰²å›¾æ ‡ä¸Š&lt;/li&gt;
&lt;li&gt;åˆ†å±å¹•ï¼šä¸‰æŒ‡å¾€ä¸Šæ¨ç„¶åå†åœ¨é¡¶éƒ¨æŠŠä¸¤ä¸ªè½¯ä»¶å•æŒ‡ç»“åˆåˆ°ä¸€èµ·&lt;/li&gt;
&lt;li&gt;deleteé”®æŒ‰ï¼šfn+åˆ é™¤é”®ï¼Œå¯ä»¥åˆ é™¤å…‰æ ‡åé¢çš„å­—ç¬¦&lt;/</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>swiftç¬”è®°</title>
    <link href="http://outbreak-sen.github.io/2025/03/19/swift%E7%AC%94%E8%AE%B0/"/>
    <id>http://outbreak-sen.github.io/2025/03/19/swift%E7%AC%94%E8%AE%B0/</id>
    <published>2025-03-19T11:48:00.000Z</published>
    <updated>2025-03-26T07:38:57.377Z</updated>
    
    <content type="html"><![CDATA[<p>0326çœ‹åˆ°äº†åŸºæœ¬è¿ç®—ç¬¦å·</p><h1>siwftç¬”è®°</h1><h2 id="å¼•è¨€-å†™ç»™æˆ‘è‡ªå·±åœ¨å­¦ä¹ swiftæˆä¸ºè‹¹æœå¼€å‘è€…ä¹‹å‰çš„çŒœæƒ³">å¼•è¨€-å†™ç»™æˆ‘è‡ªå·±åœ¨å­¦ä¹ swiftæˆä¸ºè‹¹æœå¼€å‘è€…ä¹‹å‰çš„çŒœæƒ³</h2><p>æ€ä¹ˆå­¦ä¹ swiftï¼Ÿå¦‚ä½•åˆ¶ä½œå¹¶å‘å¸ƒä¸€ä¸ªç”±swiftåˆ¶ä½œçš„è½¯ä»¶å¹¶å‘å¸ƒåˆ°ioså•†åº—ï¼Œé¦–å…ˆæˆ‘åœ¨çŸ¥ä¹ç­‰æ¸ é“å·²ç»çŸ¥é“å¼€å‘è€…çš„ä¸€äº›å†…å®¹ï¼Œå¹¶ä¸”çŸ¥é“äº†swiftå’Œc-sharpçš„é€‰æ‹©é—®é¢˜ã€‚é‡ç‚¹æ˜¯æ€ä¹ˆå­¦ï¼Ÿæˆ‘è¿™é‡Œæƒ³çš„æ˜¯å¯ä»¥<strong>å…ˆä»å›½å†…åˆ«äººæ•´ç†å¥½çš„æ•™ç¨‹å…ˆé€Ÿé€šä¸€éï¼Œç„¶ååœ¨è‹¹æœå¼€å‘è€…ç½‘ç«™å­¦ä¹ æ–°çš„swiftç‰¹æ€§</strong>ã€‚</p><p>æˆ‘çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘çš„æ—¶é—´å¯å¤ªå®è´µäº†ï¼Œåšè¿™ä¸ªäº‹ä¸€å®šäº‹å‡ºæœ‰å› å¹¶ä¸”æœ‰æ‰€æˆå°±ï¼Œæˆ‘çš„ç›®æ ‡å¾ˆç®€å•ï¼Œå°±æ˜¯å®Œæˆä¸€ä¸ªæˆå“è½¯ä»¶ï¼Œåœ¨ç«äº‰çš„æ—¶å€™å¯ä»¥å±•å‡ºï¼Œå¯ä»¥é¡¶æ›¿ä¸€ä¸ªå®ä¹ ç»å†ã€‚</p><h3 id="å­¦ä¹ é“¾æ¥ï¼š">å­¦ä¹ é“¾æ¥ï¼š</h3><p><a href="https://developer.apple.com/cn/swift/">appleå¼€å‘è€…çš„å®˜æ–¹æ•™ç¨‹</a></p><p><a href="https://developer.apple.com/cn/documentation/swift/">appleçš„å®˜æ–¹ä¸­æ–‡æ•™ç¨‹</a></p><p><a href="https://www.runoob.com/swift/swift-tutorial.html">èœé¸Ÿæ•™ç¨‹</a></p><p><a href="https://swift.bootcss.com/">swiftç¼–ç¨‹è¯­è¨€ä¸­æ–‡æ•™ç¨‹</a></p><p>[youtubeä¸Šä¸€ä¸ªå£°éŸ³å¾ˆå¥½å¬çš„æ•™å­¦up](<a href="https://www.youtube.com/ChaoCode">https://www.youtube.com/ChaoCode</a> åšä¸»)</p><h3 id="å¦‚ä½•é˜…è¯»apple-developerç½‘ç«™">å¦‚ä½•é˜…è¯»Apple developerç½‘ç«™</h3><p><a href="https://developer.apple.com/cn/">è¿™æ˜¯ä¸»é¡µ</a></p><p>é¦–é¡µçš„è®²åº§ã€WWDCã€å¼€å‘è€…ä½ å¥½ï¼ˆå…¶å®æŒ‡å‘æ–°é—»helloï¼‰ã€å¼€å‘è€…è§é¢ï¼ˆå…¶å®æŒ‡å‘eventsï¼Œæ˜¯è‹¹æœæœ€è¿‘çš„é—²æš‡è¿‡ä»ï¼‰æ˜¯å•ç‹¬ä¸€ä¸ªç½‘é¡µ</p><p>é¡¶éƒ¨æ¢ç´¢ å’Œ é¦–é¡µpathway å’Œpathwayä¸‹é¢çš„æ¯ä¸ª æ¨¡å—æŒ‡å‘åŒä¸€ä¸ªä½ç½®ï¼ˆios18 visionOS2ç­‰ï¼‰</p><p>é¢å‘å¼€å‘è€…çš„æ–°å†…å®¹å…¶å®æ˜¯whatsnew,æŒ‡å‘ä¸€ä¸ªå•ç‹¬çš„<a href="https://developer.apple.com/cn/whats-new/">whatsnewç½‘é¡µ</a>ï¼Œé‡Œé¢çš„å†…å®¹å…¶å®å°±æ˜¯pathwayé‡Œçš„æ¨¡å—</p><p><a href="https://developer.apple.com/cn/programs/">å¼€å‘è€…å·¥ç¨‹</a></p><p><a href="https://developer.apple.com/cn/videos/">è¿™é‡Œæ˜¯è§†é¢‘ï¼Œå¤§å¤šæ•°æ˜¯WWDCçš„</a></p><p>ä¹Ÿå°±æ˜¯è¯´å…¶å®é‡è¦çš„æ˜¯pathwayä¸‹é¢çš„æ¨¡å—ï¼Œæœ‰æ—¶å€™ä¹Ÿå¯ä»¥çœ‹çœ‹WWDCæ¯æ¬¡ä¸åŒçš„ä¸“é¢˜ã€‚æˆ‘çš„è¯„ä»·æ˜¯ç›´æ¥çœ‹åº•ä¸‹çš„æ¨¡å—</p><p><img src="/home/outbreak/BlogOutbreak/source/_posts/swift%E7%AC%94%E8%AE%B0/image-20250326113552399.png" alt="image-20250326113552399"></p><h1>swiftç¼–ç¨‹è¯­è¨€ä¸­æ–‡æ•™ç¨‹çš„å­¦ä¹ ç¬”è®°</h1><p>ä¸éœ€è¦ <code>main()</code> å‡½æ•°ã€‚ä½ åŒæ ·ä¸éœ€è¦åœ¨æ¯ä¸ªè¯­å¥ç»“å°¾å†™ä¸Šåˆ†å·</p><h2 id="å˜é‡å£°æ˜">å˜é‡å£°æ˜</h2><h3 id="å¸¸é‡å’Œå˜é‡">å¸¸é‡å’Œå˜é‡</h3><p><code>let</code> æ¥å£°æ˜å¸¸é‡ç¼–è¯‘çš„æ—¶å€™ï¼Œå¹¶ä¸éœ€è¦æœ‰æ˜ç¡®çš„å€¼ï¼Œä½†æ˜¯ä½ åªèƒ½ä¸ºå®ƒèµ‹å€¼ä¸€æ¬¡ã€‚</p><p><code>var</code> æ¥å£°æ˜<strong>å˜é‡</strong></p><ul><li><p>ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ¨æ–­å…¶ç±»å‹</p></li><li><p>åˆå§‹å€¼æ²¡æœ‰æä¾›è¶³å¤Ÿçš„ä¿¡æ¯ï¼ˆæˆ–è€…æ²¡æœ‰åˆå§‹å€¼ï¼‰ï¼Œé‚£ä½ <strong>éœ€è¦åœ¨å˜é‡åé¢å£°æ˜ç±»å‹ï¼Œç”¨å†’å·åˆ†å‰²</strong></p></li><li><p><strong>å€¼æ°¸è¿œä¸ä¼šè¢«éšå¼è½¬æ¢ä¸ºå…¶ä»–ç±»å‹</strong>ã€‚å¦‚æœä½ éœ€è¦æŠŠä¸€ä¸ªå€¼è½¬æ¢æˆå…¶ä»–ç±»å‹ï¼Œéœ€è¦æ˜¾å¼è½¬æ¢ã€‚</p></li><li><pre><code class="language-swift">var myVariable = 42myVariable = 50let explicitDouble: Double = 70let widthLabel = label + String(explicitDouble)var x = 0.0, y = 0.0, z = 0.0// å¸¸é‡å’Œå˜é‡åå¯ä»¥åŒ…å«å‡ ä¹æ‰€æœ‰çš„å­—ç¬¦let Ï€ = 3.14159let ä½ å¥½ = &quot;ä½ å¥½ä¸–ç•Œ&quot;let ğŸ¶ğŸ® = &quot;dogcow&quot;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  ### å˜é‡ç±»å‹</span><br><span class="line"></span><br><span class="line">  ```</span><br><span class="line">  Intæ•´å‹å€¼</span><br><span class="line">  Double å’Œ Floatæµ®ç‚¹å‹å€¼64ä½32ä½ï¼ŒDouble ç²¾ç¡®åº¦å¾ˆé«˜ï¼Œè‡³å°‘æœ‰ 15 ä½å°æ•°ï¼Œè€Œ Float åªæœ‰ 6 ä½å°æ•°</span><br><span class="line">  Boolå¸ƒå°”å‹å€¼</span><br><span class="line">  Stringæ–‡æœ¬å‹æ•°æ®</span><br><span class="line">  Swift è¿˜æä¾›äº†ä¸‰ä¸ªåŸºæœ¬çš„é›†åˆç±»å‹ï¼ŒArrayã€Setå’Œ Dictionary</span><br><span class="line">  Tupleå…ƒç»„</span><br><span class="line">  Optionalå¯é€‰</span><br><span class="line">  UIntæ— ç¬¦å·ç±»å‹ </span><br><span class="line">  ```</span><br><span class="line"></span><br><span class="line">  ### å­—ç¬¦ä¸²</span><br><span class="line"></span><br><span class="line">* æ›´ç®€å•çš„**æŠŠå€¼è½¬æ¢æˆå­—ç¬¦ä¸²çš„æ–¹æ³•ï¼šæŠŠå€¼å†™åˆ°æ‹¬å·ä¸­ï¼Œå¹¶ä¸”åœ¨æ‹¬å·ä¹‹å‰å†™ä¸€ä¸ªåæ–œæ ï¼ˆ\ï¼‰**</span><br><span class="line"></span><br><span class="line">* ~~~swift</span><br><span class="line">  let apples = 3</span><br><span class="line">  let appleSummary = &quot;I have \(apples) apples.&quot;</span><br></pre></td></tr></table></figure></code></pre></li><li><p>ä½¿ç”¨ä¸‰ä¸ªåŒå¼•å·ï¼ˆ<code>&quot;&quot;&quot;</code>ï¼‰æ¥åŒ…å«å¤šè¡Œå­—ç¬¦ä¸²å†…å®¹ã€‚</p></li><li><pre><code class="language-swift">let quotation = &quot;&quot;&quot;I said &quot;I have \(apples) apples.&quot;And then I said &quot;I have \(apples + oranges) pieces of fruit.&quot;&quot;&quot;&quot;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  ### ä½¿ç”¨æ–¹æ‹¬å· `[]` æ¥åˆ›å»ºæ•°ç»„å’Œå­—å…¸ï¼Œå¹¶ä½¿ç”¨ä¸‹æ ‡æˆ–è€…é”®ï¼ˆkeyï¼‰æ¥è®¿é—®å…ƒç´ ã€‚</span><br><span class="line"></span><br><span class="line">* ~~~swift</span><br><span class="line">  # è¿™ä¸ªæ˜¯æ•°ç»„</span><br><span class="line">  var shoppingList = [&quot;catfish&quot;, &quot;water&quot;, &quot;tulips&quot;, &quot;blue paint&quot;]</span><br><span class="line">  shoppingList[1] = &quot;bottle of water&quot;</span><br><span class="line">  shoppingList.append(&quot;blue paint&quot;)</span><br><span class="line">  # è¿™ä¸ªæ˜¯å­—å…¸</span><br><span class="line">  var occupations = [</span><br><span class="line">      &quot;Malcolm&quot;: &quot;Captain&quot;,</span><br><span class="line">      &quot;Kaylee&quot;: &quot;Mechanic&quot;,</span><br><span class="line">  ]</span><br><span class="line">  occupations[&quot;Jayne&quot;] = &quot;Public Relations&quot;</span><br></pre></td></tr></table></figure>### åˆ›å»ºä¸€ä¸ªç©ºæ•°ç»„æˆ–ç©ºå­—å…¸</code></pre></li><li><pre><code class="language-swift">let emptyArray: [String] = []let emptyDictionary: [String: Float] = [:]shoppingList = []occupations = [:]<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### bool</span><br><span class="line"></span><br><span class="line">```swift</span><br><span class="line">let orangesAreOrange = true</span><br><span class="line">let turnipsAreDelicious = false</span><br></pre></td></tr></table></figure></code></pre></li></ul><h2 id="å…ƒç»„">å…ƒç»„</h2><p>*å…ƒç»„ï¼ˆtuplesï¼‰*æŠŠå¤šä¸ªå€¼ç»„åˆæˆä¸€ä¸ªå¤åˆå€¼ã€‚å…ƒç»„å†…çš„å€¼å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œå¹¶ä¸è¦æ±‚æ˜¯ç›¸åŒç±»å‹ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> http404Error <span class="operator">=</span> (<span class="number">404</span>, <span class="string">&quot;Not Found&quot;</span>)</span><br><span class="line"><span class="comment">// http404Error çš„ç±»å‹æ˜¯ (Int, String)ï¼Œå€¼æ˜¯ (404, &quot;Not Found&quot;)</span></span><br></pre></td></tr></table></figure><ul><li>å°†ä¸€ä¸ªå…ƒç»„çš„å†…å®¹åˆ†è§£ï¼ˆdecomposeï¼‰æˆå•ç‹¬çš„å¸¸é‡å’Œå˜é‡</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> (statusCode, statusMessage) <span class="operator">=</span> http404Error</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The status code is <span class="subst">\(statusCode)</span>&quot;</span>)</span><br><span class="line"><span class="comment">// è¾“å‡ºâ€œThe status code is 404â€</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The status message is <span class="subst">\(statusMessage)</span>&quot;</span>)</span><br><span class="line"><span class="comment">// è¾“å‡ºâ€œThe status message is Not Foundâ€</span></span><br></pre></td></tr></table></figure><ul><li>å¦‚æœä½ åªéœ€è¦ä¸€éƒ¨åˆ†å…ƒç»„å€¼ï¼Œåˆ†è§£çš„æ—¶å€™å¯ä»¥æŠŠè¦å¿½ç•¥çš„éƒ¨åˆ†ç”¨ä¸‹åˆ’çº¿ï¼ˆ<code>_</code>ï¼‰æ ‡è®°ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> (justTheStatusCode, <span class="keyword">_</span>) <span class="operator">=</span> http404Error</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The status code is <span class="subst">\(justTheStatusCode)</span>&quot;</span>)</span><br><span class="line"><span class="comment">// è¾“å‡ºâ€œThe status code is 404â€</span></span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡ä¸‹æ ‡æ¥è®¿é—®å…ƒç»„ä¸­çš„å•ä¸ªå…ƒç´ ï¼Œä¸‹æ ‡ä»é›¶å¼€å§‹ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The status code is <span class="subst">\(http404Error.<span class="number">0</span>)</span>&quot;</span>)</span><br><span class="line"><span class="comment">// è¾“å‡ºâ€œThe status code is 404â€</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The status message is <span class="subst">\(http404Error.<span class="number">1</span>)</span>&quot;</span>)</span><br><span class="line"><span class="comment">// è¾“å‡ºâ€œThe status message is Not Foundâ€</span></span><br></pre></td></tr></table></figure><ul><li>åœ¨å®šä¹‰å…ƒç»„çš„æ—¶å€™ç»™å•ä¸ªå…ƒç´ å‘½åï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> http200Status <span class="operator">=</span> (statusCode: <span class="number">200</span>, description: <span class="string">&quot;OK&quot;</span>)</span><br></pre></td></tr></table></figure><ul><li>ç»™å…ƒç»„ä¸­çš„å…ƒç´ å‘½ååï¼Œä½ å¯ä»¥é€šè¿‡åå­—æ¥è·å–è¿™äº›å…ƒç´ çš„å€¼ï¼š</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The status code is <span class="subst">\(http200Status.statusCode)</span>&quot;</span>)</span><br><span class="line"><span class="comment">// è¾“å‡ºâ€œThe status code is 200â€</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The status message is <span class="subst">\(http200Status.description)</span>&quot;</span>)</span><br><span class="line"><span class="comment">// è¾“å‡ºâ€œThe status message is OKâ€</span></span><br></pre></td></tr></table></figure><h2 id="è¿ç®—ç¬¦å·">è¿ç®—ç¬¦å·</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// èµ‹å€¼</span></span><br><span class="line"><span class="keyword">let</span> (x, y) <span class="operator">=</span> (<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// è®¡ç®—</span></span><br><span class="line"><span class="number">1</span> <span class="operator">+</span> <span class="number">2</span>       <span class="comment">// ç­‰äº 3</span></span><br><span class="line"><span class="number">5</span> <span class="operator">-</span> <span class="number">3</span>       <span class="comment">// ç­‰äº 2</span></span><br><span class="line"><span class="number">2</span> <span class="operator">*</span> <span class="number">3</span>       <span class="comment">// ç­‰äº 6</span></span><br><span class="line"><span class="number">10.0</span> <span class="operator">/</span> <span class="number">2.5</span>  <span class="comment">// ç­‰äº 4.0</span></span><br><span class="line"><span class="comment">// æ±‚ä½™è¿ç®—ç¬¦ï¼ˆ%ï¼‰åœ¨å…¶ä»–è¯­è¨€ä¹Ÿå«å–æ¨¡è¿ç®—ç¬¦</span></span><br><span class="line"><span class="number">9</span> <span class="operator">%</span> <span class="number">4</span>    <span class="comment">// ç­‰äº 1</span></span><br><span class="line"><span class="comment">// ä¸€å…ƒè´Ÿå·è¿ç®—ç¬¦</span></span><br><span class="line"><span class="keyword">let</span> three <span class="operator">=</span> <span class="number">3</span></span><br><span class="line"><span class="keyword">let</span> minusThree <span class="operator">=</span> <span class="operator">-</span>three       <span class="comment">// minusThree ç­‰äº -3</span></span><br><span class="line"><span class="keyword">let</span> plusThree <span class="operator">=</span> <span class="operator">-</span>minusThree   <span class="comment">// plusThree ç­‰äº 3, æˆ– &quot;è´Ÿè´Ÿ3&quot;</span></span><br><span class="line"><span class="comment">// è¡¨è¾¾å¼ a += 2 æ˜¯ a = a + 2 çš„ç®€å†™</span></span><br><span class="line">ç­‰äºï¼ˆa <span class="operator">==</span> bï¼‰</span><br><span class="line">ä¸ç­‰äºï¼ˆa <span class="operator">!=</span> bï¼‰</span><br><span class="line">å¤§äºï¼ˆa <span class="operator">&gt;</span> bï¼‰</span><br><span class="line">å°äºï¼ˆa <span class="operator">&lt;</span> bï¼‰</span><br><span class="line">å¤§äºç­‰äºï¼ˆa <span class="operator">&gt;=</span> bï¼‰</span><br><span class="line">å°äºç­‰äºï¼ˆa <span class="operator">&lt;=</span> bï¼‰</span><br></pre></td></tr></table></figure><ul><li>ä¸‰å…ƒè¿ç®—ç¬¦å·<code>é—®é¢˜ ? ç­”æ¡ˆ 1 : ç­”æ¡ˆ 2</code>ã€‚å®ƒç®€æ´åœ°è¡¨è¾¾æ ¹æ® <code>é—®é¢˜</code>æˆç«‹ä¸å¦ä½œå‡ºäºŒé€‰ä¸€çš„æ“ä½œã€‚å¦‚æœ <code>é—®é¢˜</code> æˆç«‹ï¼Œè¿”å› <code>ç­”æ¡ˆ 1</code> çš„ç»“æœï¼›åä¹‹è¿”å› <code>ç­”æ¡ˆ 2</code> çš„ç»“æœã€‚</li></ul><h2 id="åŒºé—´è¿ç®—ç¬¦-range-operators">åŒºé—´è¿ç®—ç¬¦ï¼ˆRange Operatorsï¼‰</h2><p>Swift æä¾›äº†å‡ ç§æ–¹ä¾¿è¡¨è¾¾ä¸€ä¸ªåŒºé—´çš„å€¼çš„<em>åŒºé—´è¿ç®—ç¬¦</em>ã€‚</p><h3 id="é—­åŒºé—´è¿ç®—ç¬¦">é—­åŒºé—´è¿ç®—ç¬¦</h3><p><em>é—­åŒºé—´è¿ç®—ç¬¦</em>ï¼ˆ<code>a...b</code>ï¼‰å®šä¹‰ä¸€ä¸ªåŒ…å«ä» <code>a</code> åˆ° <code>b</code>ï¼ˆåŒ…æ‹¬ <code>a</code> å’Œ <code>b</code>ï¼‰çš„æ‰€æœ‰å€¼çš„åŒºé—´ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> <span class="number">1</span><span class="operator">...</span><span class="number">5</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(index)</span> * 5 = <span class="subst">\(index <span class="operator">*</span> <span class="number">5</span>)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŠå¼€åŒºé—´è¿ç®—ç¬¦">åŠå¼€åŒºé—´è¿ç®—ç¬¦</h3><p><em>åŠå¼€åŒºé—´è¿ç®—ç¬¦</em>ï¼ˆ<code>a..&lt;b</code>ï¼‰å®šä¹‰ä¸€ä¸ªä» <code>a</code> åˆ° <code>b</code> ä½†ä¸åŒ…æ‹¬ <code>b</code> çš„åŒºé—´ã€‚ ä¹‹æ‰€ä»¥ç§°ä¸º<em>åŠå¼€åŒºé—´</em></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span>count &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç¬¬ <span class="subst">\(i <span class="operator">+</span> <span class="number">1</span>)</span> ä¸ªäººå« <span class="subst">\(names[i])</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å•ä¾§åŒºé—´">å•ä¾§åŒºé—´</h3><p>é—­åŒºé—´æ“ä½œç¬¦æœ‰å¦ä¸€ä¸ªè¡¨è¾¾å½¢å¼ï¼Œå¯ä»¥è¡¨è¾¾å¾€ä¸€ä¾§æ— é™å»¶ä¼¸çš„åŒºé—´</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> names[<span class="operator">..&lt;</span><span class="number">2</span>] &#123;</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> names[<span class="operator">...</span><span class="number">2</span>] &#123;</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> names[<span class="number">2</span><span class="operator">...</span>] &#123;</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä»£ç è§„èŒƒ">ä»£ç è§„èŒƒ</h2><h3 id="åˆ†å·">åˆ†å·</h3><p>Swift å¹¶ä¸å¼ºåˆ¶è¦æ±‚ä½ åœ¨æ¯æ¡è¯­å¥çš„ç»“å°¾å¤„ä½¿ç”¨åˆ†å·ï¼ˆ<code>;</code>ï¼‰</p><p>æœ‰ä¸€ç§æƒ…å†µä¸‹å¿…é¡»è¦ç”¨åˆ†å·ï¼Œå³ä½ æ‰“ç®—åœ¨åŒä¸€è¡Œå†…å†™å¤šæ¡ç‹¬ç«‹çš„è¯­å¥ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> cat <span class="operator">=</span> <span class="string">&quot;ğŸ±&quot;</span>; <span class="built_in">print</span>(cat)</span><br><span class="line"><span class="comment">// è¾“å‡ºâ€œğŸ±â€</span></span><br></pre></td></tr></table></figure><h3 id="è¾“å‡ºå¸¸é‡å’Œå˜é‡">è¾“å‡ºå¸¸é‡å’Œå˜é‡</h3><p>å‡½æ•°å…¨åprint(_:separator:terminator:)</p><ul><li><p>ç”¨ Xcodeï¼Œ<code>print(_:separator:terminator:)</code> å°†ä¼šè¾“å‡ºå†…å®¹åˆ°â€œconsoleâ€é¢æ¿ä¸Šã€‚</p></li><li><p>è¯¥å‡½æ•°é€šè¿‡æ·»åŠ æ¢è¡Œç¬¦æ¥ç»“æŸå½“å‰è¡Œã€‚å¦‚æœä¸æƒ³æ¢è¡Œï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ç»™ <code>terminator</code> å‚æ•°â€“ä¾‹å¦‚ï¼Œ<code>print(someValue, terminator:&quot;&quot;)</code></p></li><li><pre><code class="language-swift">//å°†å¸¸é‡æˆ–å˜é‡åæ”¾å…¥åœ†æ‹¬å·ä¸­ï¼Œå¹¶åœ¨å¼€æ‹¬å·å‰ä½¿ç”¨åæ–œæ å°†å…¶è½¬ä¹‰print(&quot;The current value of friendlyWelcome is \(friendlyWelcome)&quot;)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### æ³¨é‡Š</span><br><span class="line"></span><br><span class="line">```swift</span><br><span class="line">// è¿™æ˜¯ä¸€ä¸ªæ³¨é‡Š</span><br><span class="line"></span><br><span class="line">/* è¿™ä¹Ÿæ˜¯ä¸€ä¸ªæ³¨é‡Šï¼Œ</span><br><span class="line">ä½†æ˜¯æ˜¯å¤šè¡Œçš„ */</span><br><span class="line"></span><br><span class="line">// ä»¥ä¸‹æ˜¯ä¸€ä¸ªåµŒå¥—æ³¨é‡Šï¼Œå¥—äº†ä¸€å±‚</span><br><span class="line">/* è¿™æ˜¯ç¬¬ä¸€ä¸ªå¤šè¡Œæ³¨é‡Šçš„å¼€å¤´</span><br><span class="line">/* è¿™æ˜¯ç¬¬äºŒä¸ªè¢«åµŒå¥—çš„å¤šè¡Œæ³¨é‡Š */</span><br><span class="line">è¿™æ˜¯ç¬¬ä¸€ä¸ªå¤šè¡Œæ³¨é‡Šçš„ç»“å°¾ */</span><br></pre></td></tr></table></figure></code></pre></li></ul><h3 id="æ•°å€¼å‹å­—é¢é‡">æ•°å€¼å‹å­—é¢é‡</h3><p>æ•´æ•°å­—é¢é‡å¯ä»¥è¢«å†™ä½œï¼š</p><ul><li><p>ä¸€ä¸ª<em>åè¿›åˆ¶</em>æ•°ï¼Œæ²¡æœ‰å‰ç¼€</p></li><li><p>ä¸€ä¸ª<em>äºŒè¿›åˆ¶</em>æ•°ï¼Œå‰ç¼€æ˜¯ <code>0b</code></p></li><li><p>ä¸€ä¸ª<em>å…«è¿›åˆ¶</em>æ•°ï¼Œå‰ç¼€æ˜¯ <code>0o</code></p></li><li><p>ä¸€ä¸ª<em>åå…­è¿›åˆ¶</em>æ•°ï¼Œå‰ç¼€æ˜¯ <code>0x</code></p></li><li><pre><code class="language-swift">let decimalInteger = 17let binaryInteger = 0b10001       // äºŒè¿›åˆ¶çš„17let octalInteger = 0o21           // å…«è¿›åˆ¶çš„17let hexadecimalInteger = 0x11     // åå…­è¿›åˆ¶çš„17<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- åè¿›åˆ¶æµ®ç‚¹æ•°å¯æœ‰ä¸€ä¸ªå¯é€‰çš„æŒ‡æ•°ï¼ˆexponent)ï¼Œé€šè¿‡å¤§å†™æˆ–è€…å°å†™çš„ `e` æ¥æŒ‡å®š</span><br><span class="line"></span><br><span class="line">  - `1.25e2` è¡¨ç¤º 1.25 Ã— 10^2ï¼Œç­‰äº `125.0`ã€‚</span><br><span class="line">  - `1.25e-2` è¡¨ç¤º 1.25 Ã— 10^-2ï¼Œç­‰äº `0.0125`</span><br><span class="line"></span><br><span class="line">* åå…­è¿›åˆ¶æµ®ç‚¹æ•°å¿…é¡»æœ‰ä¸€ä¸ªæŒ‡æ•°ï¼Œé€šè¿‡å¤§å†™æˆ–è€…å°å†™çš„ `p` æ¥æŒ‡å®š</span><br><span class="line">  - `0xFp2` è¡¨ç¤º 15 Ã— 2^2ï¼Œç­‰äº `60.0`ã€‚</span><br><span class="line">  - `0xFp-2` è¡¨ç¤º 15 Ã— 2^-2ï¼Œç­‰äº `3.75`ã€‚</span><br><span class="line"></span><br><span class="line">### ç±»å‹åˆ«å</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨ `typealias` å…³é”®å­—æ¥å®šä¹‰ç±»å‹åˆ«åã€‚</span><br><span class="line"></span><br><span class="line">```swift</span><br><span class="line">typealias AudioSample = UInt16</span><br></pre></td></tr></table></figure></code></pre></li></ul><h2 id="æ§åˆ¶æµ">æ§åˆ¶æµ</h2><h3 id="if">if</h3><h4 id="å¼ºåˆ¶è§£æ">å¼ºåˆ¶è§£æï¼</h4><p>å½“ä½ ç¡®å®šå¯é€‰ç±»å‹ç¡®å®åŒ…å«å€¼ä¹‹åï¼Œå¯ä»¥åœ¨å¯é€‰çš„åå­—åé¢åŠ ä¸€ä¸ªæ„Ÿå¹å·ï¼ˆ<code>!</code>ï¼‰æ¥è·å–å€¼ã€‚</p><p>è¿™ä¸ªæƒŠå¹å·è¡¨ç¤ºâ€œæˆ‘çŸ¥é“è¿™ä¸ªå¯é€‰æœ‰å€¼ï¼Œè¯·ä½¿ç”¨å®ƒã€‚è¿™è¢«ç§°ä¸ºå¯é€‰å€¼çš„å¼ºåˆ¶è§£æï¼ˆforced unwrappingï¼‰ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> convertedNumber <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;convertedNumber has an integer value of <span class="subst">\(convertedNumber<span class="operator">!</span>)</span>.&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºâ€œconvertedNumber has an integer value of 123.â€</span></span><br></pre></td></tr></table></figure><h3 id="for-in">for-in</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> interestingNumbers <span class="operator">=</span> [</span><br><span class="line">    <span class="string">&quot;Prime&quot;</span>: [<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>],</span><br><span class="line">    <span class="string">&quot;Fibonacci&quot;</span>: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>],</span><br><span class="line">    <span class="string">&quot;Square&quot;</span>: [<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>],</span><br><span class="line">]</span><br><span class="line"><span class="keyword">var</span> largest <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">_</span>, numbers) <span class="keyword">in</span> interestingNumbers &#123;</span><br><span class="line">    <span class="keyword">for</span> number <span class="keyword">in</span> numbers &#123;</span><br><span class="line">        <span class="keyword">if</span> number <span class="operator">&gt;</span> largest &#123;</span><br><span class="line">            largest <span class="operator">=</span> number</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="switch">Switch</h3><p>è¿è¡Œ <code>switch</code> ä¸­åŒ¹é…åˆ°çš„ <code>case</code> è¯­å¥ä¹‹åï¼Œç¨‹åºä¼šé€€å‡º <code>switch</code> è¯­å¥ï¼Œå¹¶ä¸ä¼šç»§ç»­å‘ä¸‹è¿è¡Œï¼Œæ‰€ä»¥ä¸éœ€è¦åœ¨æ¯ä¸ªå­å¥ç»“å°¾å†™ <code>break</code>ã€‚</p><p>éœ€è¦default</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> vegetable <span class="operator">=</span> <span class="string">&quot;red pepper&quot;</span></span><br><span class="line"><span class="keyword">switch</span> vegetable &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;celery&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Add some raisins and make ants on a log.&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;cucumber&quot;</span>, <span class="string">&quot;watercress&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;That would make a good tea sandwich.&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> x <span class="keyword">where</span> x.hasSuffix(<span class="string">&quot;pepper&quot;</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Is it a spicy <span class="subst">\(x)</span>?&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Everything tastes good in soup.&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="for">for</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> total <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="comment">//  ..&lt; åˆ›å»ºçš„èŒƒå›´ä¸åŒ…å«ä¸Šç•Œ</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span><span class="number">4</span> &#123;</span><br><span class="line">    total <span class="operator">+=</span> i</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¦‚æœæƒ³åŒ…å«çš„è¯éœ€è¦ä½¿ç”¨ ...</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">...</span><span class="number">4</span> &#123;</span><br><span class="line">    total <span class="operator">+=</span> i</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(total)</span><br></pre></td></tr></table></figure><h2 id="å¯é€‰å€¼optional">å¯é€‰å€¼optional</h2><ul><li><p>ä¸€ä¸ªå¯é€‰å€¼çš„å£°æ˜æ–¹æ³•ï¼š**åœ¨ç±»å‹åé¢åŠ ä¸€ä¸ªé—®å·ï¼ˆ<code>?</code>ï¼‰æ¥æ ‡è®°è¿™ä¸ªå˜é‡çš„å€¼æ˜¯å¯é€‰çš„ã€‚**ä¸€ä¸ªå¯é€‰çš„ <code>Int</code> è¢«å†™ä½œ <code>Int?</code> è€Œä¸æ˜¯ <code>Int</code></p></li><li><p>å£°æ˜ä¸€ä¸ªå¯é€‰å¸¸é‡æˆ–è€…å˜é‡ä½†æ˜¯<strong>æ²¡æœ‰èµ‹å€¼ï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨è¢«è®¾ç½®ä¸º <code>nil</code></strong></p></li><li><p><strong>å¯é€‰å€¼æœ‰ç¼ºå¤±å€¼nilå’Œæœ‰å…·ä½“çš„å€¼ä¸¤ç§</strong>ï¼Œå¦‚æœå£°æ˜äº†åˆ™æœ‰å€¼ã€‚</p></li><li><pre><code class="language-swift">var optionalString: String? = &quot;Hello&quot;let nickName: String? = nil<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* å¯é€‰ç»‘å®š</span><br><span class="line"></span><br><span class="line">  ä½¿ç”¨*å¯é€‰ç»‘å®šï¼ˆoptional bindingï¼‰*æ¥åˆ¤æ–­å¯é€‰ç±»å‹æ˜¯å¦åŒ…å«å€¼ï¼Œå¦‚æœåŒ…å«å°±æŠŠå€¼èµ‹ç»™ä¸€ä¸ªä¸´æ—¶å¸¸é‡æˆ–è€…å˜é‡ã€‚å¯é€‰ç»‘å®šå¯ä»¥ç”¨åœ¨ `if` å’Œ `while` è¯­å¥ä¸­ï¼Œè¿™æ¡è¯­å¥ä¸ä»…å¯ä»¥ç”¨æ¥åˆ¤æ–­å¯é€‰ç±»å‹ä¸­æ˜¯å¦æœ‰å€¼ï¼ŒåŒæ—¶å¯ä»¥å°†å¯é€‰ç±»å‹ä¸­çš„å€¼èµ‹ç»™ä¸€ä¸ªå¸¸é‡æˆ–è€…å˜é‡ã€‚``</span><br><span class="line"></span><br><span class="line">  **ç”¨letè¿›è¡Œèµ‹å€¼ï¼Œå¦‚æœå€¼æ˜¯nilåˆ™è¿”å›false**ï¼Œå¦‚æœä¸æ˜¯ `nil`ï¼Œä¼šå°†å€¼è§£åŒ…å¹¶èµ‹ç»™ `let` åé¢çš„å¸¸é‡ï¼Œä»£ç å—ä¸­å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå€¼äº†ã€‚</span><br><span class="line"></span><br><span class="line">  ```swift</span><br><span class="line">  if let name = optionalName &#123;</span><br><span class="line">      greeting = &quot;Hello, \(name)&quot;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br></pre></td></tr></table></figure></code></pre></li><li><p><strong>ä½¿ç”¨ <code>??</code> æ“ä½œç¬¦æ¥æä¾›ä¸€ä¸ªé»˜è®¤å€¼</strong>ã€‚å¦‚æœå¯é€‰å€¼ç¼ºå¤±çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨é»˜è®¤å€¼æ¥ä»£æ›¿ã€‚</p></li><li><pre><code class="language-swift">let nickName: String? = nillet fullName: String = &quot;John Appleseed&quot;# nilåˆ™å–åé¢fullnameçš„å€¼let informalGreeting = &quot;Hi \(nickName ?? fullName)&quot;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* å¤„ç†å˜é‡çš„å¯é€‰å€¼æ—¶å¯ä»¥åœ¨æ“ä½œï¼ˆæ¯”å¦‚æ–¹æ³•ã€å±æ€§å’Œå­è„šæœ¬ï¼‰ä¹‹å‰åŠ  `?`ã€‚</span><br><span class="line"></span><br><span class="line">  * å¦‚æœ `?` ä¹‹å‰çš„å€¼æ˜¯ `nil`ï¼Œ`?` åé¢çš„ä¸œè¥¿éƒ½ä¼šè¢«å¿½ç•¥ï¼Œå¹¶ä¸”æ•´ä¸ªè¡¨è¾¾å¼è¿”å› `nil`ã€‚</span><br><span class="line">  * ä¸æ˜¯nilï¼Œå¯é€‰å€¼ä¼šè¢«è§£åŒ…ï¼Œä¹‹åçš„æ‰€æœ‰ä»£ç éƒ½ä¼šæŒ‰ç…§è§£åŒ…åçš„å€¼è¿è¡Œã€‚</span><br><span class="line"></span><br><span class="line">* ```swift</span><br><span class="line">  // è¿™ä¸ªè¿”å›çš„æ˜¯çœŸçš„è§£åŒ…å€¼ï¼Œå°±æ˜¯2.5</span><br><span class="line">  let optionalSquare: Square? = Square(sideLength: 2.5, name: &quot;optional square&quot;)</span><br><span class="line">  let sideLength = optionalSquare?.sideLength</span><br><span class="line">  // è¿™ä¸ªè¿”å›çš„çš„å°±æ˜¯nil</span><br><span class="line">  let optionalSquare: Square? = nil</span><br><span class="line">  let sideLength = optionalSquare?.sideLength</span><br></pre></td></tr></table></figure></code></pre></li><li><p>å¼ºåˆ¶è§£æï¼</p><p>å½“ä½ ç¡®å®šå¯é€‰ç±»å‹ç¡®å®åŒ…å«å€¼ä¹‹åï¼Œå¯ä»¥åœ¨å¯é€‰çš„åå­—åé¢åŠ ä¸€ä¸ªæ„Ÿå¹å·ï¼ˆ<code>!</code>ï¼‰æ¥è·å–å€¼ã€‚</p><p>è¿™ä¸ªæƒŠå¹å·è¡¨ç¤ºâ€œæˆ‘çŸ¥é“è¿™ä¸ªå¯é€‰æœ‰å€¼ï¼Œè¯·ä½¿ç”¨å®ƒã€‚è¿™è¢«ç§°ä¸ºå¯é€‰å€¼çš„å¼ºåˆ¶è§£æï¼ˆforced unwrappingï¼‰ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> convertedNumber <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;convertedNumber has an integer value of <span class="subst">\(convertedNumber<span class="operator">!</span>)</span>.&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºâ€œconvertedNumber has an integer value of 123.â€</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="å‡½æ•°">å‡½æ•°</h2><ul><li><p>ä½¿ç”¨ <code>func</code> æ¥å£°æ˜ä¸€ä¸ªå‡½æ•°ï¼Œä½¿ç”¨åå­—å’Œå‚æ•°æ¥è°ƒç”¨å‡½æ•°ã€‚<strong>ä½¿ç”¨ <code>-&gt;</code> æ¥æŒ‡å®šå‡½æ•°è¿”å›å€¼çš„ç±»å‹ã€‚</strong></p></li><li><p><strong>é»˜è®¤æƒ…å†µä¸‹ï¼Œå‡½æ•°ä½¿ç”¨å®ƒä»¬çš„å‚æ•°åç§°ä½œä¸ºå®ƒä»¬å‚æ•°çš„æ ‡ç­¾</strong>ï¼Œä¹Ÿå¯ä»¥æ¢ä¸€ä¸ªå‚æ•°æ ‡ç­¾ï¼šåœ¨å‚æ•°åç§°å‰å¯ä»¥è‡ªå®šä¹‰å‚æ•°æ ‡ç­¾ï¼Œæˆ–è€…ä½¿ç”¨ <code>_</code> è¡¨ç¤ºä¸ä½¿ç”¨å‚æ•°æ ‡ç­¾ã€‚</p></li><li><pre><code class="language-swift">func greet(person: String, day: String) -&gt; String &#123;    return &quot;Hello \(person), today is \(day).&quot;&#125;// é»˜è®¤ç”¨å‚æ•°åç§°ä½œä¸ºæ ‡ç­¾greet(person:&quot;Bob&quot;, day: &quot;Tuesday&quot;)func greet(_ person: String, on day: String) -&gt; String &#123;    return &quot;Hello \(person), today is \(day).&quot;&#125;// è¿™æ ·è°ƒç”¨çš„æ—¶å€™ç›´æ¥å†™è‡ªå®šä¹‰æ ‡ç­¾greet(&quot;John&quot;, on: &quot;Wednesday&quot;)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* ç”¨å…ƒç»„è¿”å›å¤šä¸ªå€¼ï¼Œå‡½æ•°å‚æ•°æ˜¯æ•°ç»„çš„ä¼ å‚æ–¹æ³•</span><br><span class="line"></span><br><span class="line">* ```swift</span><br><span class="line">  func calculateStatistics(scores: [Int]) -&gt; (min: Int, max: Int, sum: Int) &#123;</span><br><span class="line">      var min = scores[0]</span><br><span class="line">      var max = scores[0]</span><br><span class="line">      var sum = 0</span><br><span class="line">  </span><br><span class="line">      for score in scores &#123;</span><br><span class="line">          if score &gt; max &#123;</span><br><span class="line">              max = score</span><br><span class="line">          &#125; else if score &lt; min &#123;</span><br><span class="line">              min = score</span><br><span class="line">          &#125;</span><br><span class="line">          sum += score</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      return (min, max, sum)</span><br><span class="line">  &#125;</span><br><span class="line">  let statistics = calculateStatistics(scores:[5, 3, 100, 3, 9])</span><br><span class="line">  // è¿™é‡Œçœ‹åˆ°æ˜¯ä¸€ä¸ªå…ƒç»„</span><br><span class="line">  print(statistics.sum)</span><br><span class="line">  print(statistics.2)</span><br></pre></td></tr></table></figure></code></pre></li><li><p>å‡½æ•°ä¹Ÿå¯ä»¥ä½œä¸ºå‚æ•°è¿”å›ï¼Œå¯è¿™æ ·å†™ï¼š((Int) -&gt; Int) ï¼Œä¹Ÿå¯ä¸æ‰“æ‹¬å·</p></li><li><pre><code class="language-swift">func makeIncrementer() -&gt; ((Int) -&gt; Int) &#123;    func addOne(number: Int) -&gt; Int &#123;        return 1 + number    &#125;    return addOne&#125;var increment = makeIncrementer()increment(7)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* å‡½æ•°ä¹Ÿå¯ä»¥å½“åšå‚æ•°ä¼ å…¥å¦ä¸€ä¸ªå‡½æ•°ã€‚</span><br><span class="line"></span><br><span class="line">```swift</span><br><span class="line">func hasAnyMatches(list: [Int], condition: (Int) -&gt; Bool) -&gt; Bool &#123;</span><br><span class="line">    for item in list &#123;</span><br><span class="line">        if condition(item) &#123;</span><br><span class="line">            return true</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return false</span><br><span class="line">&#125;</span><br><span class="line">func lessThanTen(number: Int) -&gt; Bool &#123;</span><br><span class="line">    return number &lt; 10</span><br><span class="line">&#125;</span><br><span class="line">var numbers = [20, 19, 7, 12]</span><br><span class="line">hasAnyMatches(list: numbers, condition: lessThanTen)</span><br></pre></td></tr></table></figure></code></pre></li></ul><h2 id="é—­åŒ…">é—­åŒ…</h2><ul><li><p>ç”¨inå®šä¹‰çš„å°±æ˜¯é—­åŒ…</p></li><li><p><strong>ä½¿ç”¨ <code>&#123;&#125;</code> åŒ…èµ·æ¥ä¸€æ•´ä¸ªå‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªåŒ¿åé—­åŒ…ã€‚ä½¿ç”¨ <code>in</code> å°†å‚æ•°å’Œè¿”å›å€¼ç±»å‹çš„å£°æ˜ä¸é—­åŒ…å‡½æ•°ä½“è¿›è¡Œåˆ†ç¦»ã€‚</strong></p></li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">numbers.map(&#123;</span><br><span class="line">    (number: <span class="type">Int</span>) -&gt; <span class="type">Int</span> <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">let</span> result <span class="operator">=</span> <span class="number">3</span> <span class="operator">*</span> number</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li><p>å¦‚æœä¸€ä¸ªé—­åŒ…çš„ç±»å‹å·²çŸ¥ï¼Œä½ å¯ä»¥å¿½ç•¥å‚æ•°ï¼Œè¿”å›å€¼ï¼Œç”šè‡³ä¸¤ä¸ªéƒ½å¿½ç•¥ã€‚å•ä¸ªè¯­å¥é—­åŒ…ä¼šæŠŠå®ƒè¯­å¥çš„å€¼å½“åšç»“æœè¿”å›ã€‚</p></li><li><pre><code class="language-swift">let mappedNumbers = numbers.map(&#123; number in 3 * number &#125;)print(mappedNumbers)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* é€šè¿‡å‚æ•°ä½ç½®$0,$1è€Œä¸æ˜¯å‚æ•°åå­—æ¥å¼•ç”¨å‚æ•°</span><br><span class="line"></span><br><span class="line">  ```swift</span><br><span class="line">  let sortedNumbers = numbers.sorted (&#123; $0 &gt; $1 &#125;)</span><br><span class="line">  // è¿™é‡Œå› ä¸ºæ˜¯æœ€åä¸€ä¸ªå‚æ•°ï¼Œé—­åŒ…ä½œä¸ºå‚æ•°ï¼Œå¯ä»¥æŠŠæ‹¬å·ä¹Ÿå¿½ç•¥</span><br><span class="line">  let sortedNumbers = numbers.sorted &#123; $0 &gt; $1 &#125;</span><br></pre></td></tr></table></figure></code></pre></li></ul><h2 id="å¯¹è±¡å’Œç±»">å¯¹è±¡å’Œç±»</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å­ç±»çš„å®šä¹‰æ–¹æ³•æ˜¯åœ¨å®ƒä»¬çš„ç±»ååé¢åŠ ä¸Šçˆ¶ç±»çš„åå­—ï¼Œç”¨å†’å·åˆ†å‰²ã€‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span>: <span class="title class_ inherited__">NamedShape</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> numberOfSides: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="comment">//ä½¿ç”¨ init æ¥åˆ›å»ºä¸€ä¸ªæ„é€ å™¨</span></span><br><span class="line">    <span class="comment">// self è¢«ç”¨æ¥åŒºåˆ«å®ä¾‹å˜é‡ name å’Œæ„é€ å™¨çš„å‚æ•° name</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">simpleDescription</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;A shape with <span class="subst">\(numberOfSides)</span> sides.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é‡å†™çˆ¶ç±»çš„æ–¹æ³•çš„è¯ï¼Œéœ€è¦ç”¨ override æ ‡è®°</span></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">simpleDescription</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;A square with sides of length <span class="subst">\(sideLength)</span>.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹ï¼Œåœ¨ç±»ååé¢åŠ ä¸Šæ‹¬å·ã€‚</span></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç‚¹è¯­æ³•æ¥è®¿é—®å®ä¾‹çš„å±æ€§å’Œæ–¹æ³•ã€‚</span></span><br><span class="line"><span class="keyword">var</span> shape <span class="operator">=</span> <span class="type">Shape</span>()</span><br><span class="line">shape.numberOfSides <span class="operator">=</span> <span class="number">7</span></span><br><span class="line"><span class="keyword">var</span> shapeDescription <span class="operator">=</span> shape.simpleDescription()</span><br></pre></td></tr></table></figure><h3 id="setterå’Œgetterç‰¹æ€§-è¿™ä¸ªæ²¡çœ‹æ‡‚">setterå’Œgetterç‰¹æ€§ï¼Œè¿™ä¸ªæ²¡çœ‹æ‡‚</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EquilateralTriangle</span>: <span class="title class_ inherited__">NamedShape</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> sideLength: <span class="type">Double</span> <span class="operator">=</span> <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">sideLength</span>: <span class="type">Double</span>, <span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.sideLength <span class="operator">=</span> sideLength</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(name: name)</span><br><span class="line">        numberOfSides <span class="operator">=</span> <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> perimeter: <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">3.0</span> <span class="operator">*</span> sideLength</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            sideLength <span class="operator">=</span> newValue <span class="operator">/</span> <span class="number">3.0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">simpleDescription</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;An equilateral triangle with sides of length <span class="subst">\(sideLength)</span>.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> triangle <span class="operator">=</span> <span class="type">EquilateralTriangle</span>(sideLength: <span class="number">3.1</span>, name: <span class="string">&quot;a triangle&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(triangle.perimeter)</span><br><span class="line">triangle.perimeter <span class="operator">=</span> <span class="number">9.9</span></span><br><span class="line"><span class="built_in">print</span>(triangle.sideLength)</span><br></pre></td></tr></table></figure><h3 id="willsetå’Œ-didsetç‰¹æ€§-è¿™ä¸ªä¹°çœ‹æ‡‚">willSetå’Œ didSetç‰¹æ€§ï¼Œè¿™ä¸ªä¹°çœ‹æ‡‚</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TriangleAndSquare</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> triangle: <span class="type">EquilateralTriangle</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            square.sideLength <span class="operator">=</span> newValue.sideLength</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> square: <span class="type">Square</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            triangle.sideLength <span class="operator">=</span> newValue.sideLength</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">init</span>(<span class="params">size</span>: <span class="type">Double</span>, <span class="params">name</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        square <span class="operator">=</span> <span class="type">Square</span>(sideLength: size, name: name)</span><br><span class="line">        triangle <span class="operator">=</span> <span class="type">EquilateralTriangle</span>(sideLength: size, name: name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> triangleAndSquare <span class="operator">=</span> <span class="type">TriangleAndSquare</span>(size: <span class="number">10</span>, name: <span class="string">&quot;another test shape&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(triangleAndSquare.square.sideLength)</span><br><span class="line"><span class="built_in">print</span>(triangleAndSquare.triangle.sideLength)</span><br><span class="line">triangleAndSquare.square <span class="operator">=</span> <span class="type">Square</span>(sideLength: <span class="number">50</span>, name: <span class="string">&quot;larger square&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(triangleAndSquare.triangle.sideLength)</span><br></pre></td></tr></table></figure><h2 id="æšä¸¾-è¿™ä¸ªä¹°çœ‹æ‡‚">æšä¸¾ï¼Œè¿™ä¸ªä¹°çœ‹æ‡‚</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Rank</span>: <span class="title class_ inherited__">Int</span> &#123;</span><br><span class="line">    <span class="comment">// æŒ‰ç…§ä» 0 å¼€å§‹æ¯æ¬¡åŠ  1 çš„æ–¹å¼ä¸ºåŸå§‹å€¼è¿›è¡Œèµ‹å€¼ï¼Œä¸è¿‡ä½ å¯ä»¥é€šè¿‡æ˜¾å¼èµ‹å€¼è¿›è¡Œæ”¹å˜ã€‚</span></span><br><span class="line">    <span class="comment">//Ace è¢«æ˜¾å¼èµ‹å€¼ä¸º 1ï¼Œå¹¶ä¸”å‰©ä¸‹çš„åŸå§‹å€¼ä¼šæŒ‰ç…§é¡ºåºèµ‹å€¼ã€‚ </span></span><br><span class="line">    <span class="keyword">case</span> ace <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">case</span> two, three, four, five, six, seven, eight, nine, ten</span><br><span class="line">    <span class="keyword">case</span> jack, queen, king</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">simpleDescription</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> .ace:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;ace&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .jack:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;jack&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .queen:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;queen&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .king:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;king&quot;</span></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="type">String</span>(<span class="keyword">self</span>.rawValue)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> ace <span class="operator">=</span> <span class="type">Rank</span>.ace</span><br><span class="line"><span class="comment">// ä½¿ç”¨ rawValue å±æ€§æ¥è®¿é—®ä¸€ä¸ªæšä¸¾æˆå‘˜çš„åŸå§‹å€¼ã€‚</span></span><br><span class="line"><span class="keyword">let</span> aceRawValue <span class="operator">=</span> ace.rawValue</span><br><span class="line"><span class="comment">// ä»åŸå§‹å€¼åˆ›å»ºä¸€ä¸ªæšä¸¾å®ä¾‹ã€‚å¦‚æœå­˜åœ¨ä¸åŸå§‹å€¼ç›¸åº”çš„æšä¸¾æˆå‘˜å°±è¿”å›è¯¥æšä¸¾æˆå‘˜ï¼Œå¦åˆ™å°±è¿”å› nilã€‚</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> convertedRank <span class="operator">=</span> <span class="type">Rank</span>(rawValue: <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> threeDescription <span class="operator">=</span> convertedRank.simpleDescription()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åè®®å’Œæ‰©å±•">åè®®å’Œæ‰©å±•</h2><p>ä½¿ç”¨ <code>protocol</code> æ¥å£°æ˜ä¸€ä¸ªåè®®ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protocol</span> <span class="title class_">ExampleProtocol</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> simpleDescription: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// mutating å…³é”®å­—ç”¨æ¥æ ‡è®°ä¸€ä¸ªä¼šä¿®æ”¹ç»“æ„ä½“çš„æ–¹æ³•ã€‚</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">adjust</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç±»ã€æšä¸¾å’Œç»“æ„ä½“éƒ½å¯ä»¥éµå¾ªåè®®ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleClass</span>: <span class="title class_ inherited__">ExampleProtocol</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> simpleDescription: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;A very simple class.&quot;</span></span><br><span class="line">    <span class="keyword">var</span> anotherProperty: <span class="type">Int</span> <span class="operator">=</span> <span class="number">69105</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">adjust</span>() &#123;</span><br><span class="line">        simpleDescription <span class="operator">+=</span> <span class="string">&quot;  Now 100% adjusted.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a <span class="operator">=</span> <span class="type">SimpleClass</span>()</span><br><span class="line">a.adjust()</span><br><span class="line"><span class="keyword">let</span> aDescription <span class="operator">=</span> a.simpleDescription</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SimpleStructure</span>: <span class="title class_ inherited__">ExampleProtocol</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> simpleDescription: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;A simple structure&quot;</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">adjust</span>() &#123;</span><br><span class="line">        simpleDescription <span class="operator">+=</span> <span class="string">&quot; (adjusted)&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> b <span class="operator">=</span> <span class="type">SimpleStructure</span>()</span><br><span class="line">b.adjust()</span><br><span class="line"><span class="keyword">let</span> bDescription <span class="operator">=</span> b.simpleDescription</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨ <code>extension</code> æ¥ä¸ºç°æœ‰çš„ç±»å‹æ·»åŠ åŠŸèƒ½</strong>ï¼Œæ¯”å¦‚æ–°çš„æ–¹æ³•å’Œè®¡ç®—å±æ€§ã€‚ä½ å¯ä»¥<strong>ä½¿ç”¨æ‰©å±•è®©æŸä¸ªåœ¨åˆ«å¤„å£°æ˜çš„ç±»å‹ï¼ˆä¸‹é¢çš„intï¼‰æ¥éµå®ˆæŸä¸ªåè®®</strong>ï¼Œè¿™åŒæ ·é€‚ç”¨äºä»å¤–éƒ¨åº“æˆ–è€…æ¡†æ¶å¼•å…¥çš„ç±»å‹ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œè®©intç±»å‹æ»¡è¶³ExampleProtocolåè®®ï¼Œå¹¶å®šä¹‰äº†åè®®éœ€è¦çš„ä¸¤ä¸ªå‡½æ•°</span></span><br><span class="line"><span class="comment">// intæ˜¯åˆ«çš„åœ°æ–¹å®šä¹‰çš„ï¼Œå¯åŠ ä¸Šextensionä¹‹åè®©ä»–æ»¡è¶³åè®®</span></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Int</span>: <span class="title class_ inherited__">ExampleProtocol</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> simpleDescription: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;The number <span class="subst">\(<span class="keyword">self</span>)</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">adjust</span>() &#123;</span><br><span class="line">        <span class="keyword">self</span> <span class="operator">+=</span> <span class="number">42</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="number">7</span>.simpleDescription)</span><br></pre></td></tr></table></figure><h2 id="é”™è¯¯å¤„ç†">é”™è¯¯å¤„ç†</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  Erroræ˜¯ä¸ªåè®®</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">PrinterError</span>: <span class="title class_ inherited__">Error</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> outOfPaper</span><br><span class="line">    <span class="keyword">case</span> noToner</span><br><span class="line">    <span class="keyword">case</span> onFire</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä½¿ç”¨ throw æ¥æŠ›å‡ºä¸€ä¸ªé”™è¯¯å’Œä½¿ç”¨ throws æ¥è¡¨ç¤ºä¸€ä¸ªå¯ä»¥æŠ›å‡ºé”™è¯¯çš„å‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">// å¦‚æœåœ¨å‡½æ•°ä¸­æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè¿™ä¸ªå‡½æ•°ä¼šç«‹åˆ»è¿”å›å¹¶ä¸”è°ƒç”¨è¯¥å‡½æ•°çš„ä»£ç ä¼šè¿›è¡Œé”™è¯¯å¤„ç†ã€‚</span></span><br><span class="line"><span class="keyword">if</span> printerName <span class="operator">==</span> <span class="string">&quot;Never Has Toner&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="type">PrinterError</span>.noToner</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰å¤šç§æ–¹å¼å¯ä»¥ç”¨æ¥è¿›è¡Œé”™è¯¯å¤„ç†ã€‚</p><p>ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ <code>do-catch</code> ã€‚åœ¨ <code>do</code> ä»£ç å—ä¸­ï¼Œä½¿ç”¨ <code>try</code> æ¥æ ‡è®°å¯ä»¥æŠ›å‡ºé”™è¯¯çš„ä»£ç ã€‚åœ¨ <code>catch</code> ä»£ç å—ä¸­ï¼Œé™¤éä½ å¦å¤–å‘½åï¼Œå¦åˆ™é”™è¯¯ä¼šè‡ªåŠ¨å‘½åä¸º <code>error</code> ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> printerResponse <span class="operator">=</span> <span class="keyword">try</span> send(job: <span class="number">1040</span>, toPrinter: <span class="string">&quot;Bi Sheng&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(printerResponse)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">PrinterError</span>.onFire &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;I&#x27;ll just put this over here, with the rest of the fire.&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="keyword">let</span> printerError <span class="keyword">as</span> <span class="type">PrinterError</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Printer error: <span class="subst">\(printerError)</span>.&quot;</span>)</span><br><span class="line">&#125;<span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="comment">// åœ¨ `catch` ä»£ç å—ä¸­ï¼Œé™¤éä½ å¦å¤–å‘½åï¼Œå¦åˆ™é”™è¯¯ä¼šè‡ªåŠ¨å‘½åä¸º `error` ã€‚</span></span><br><span class="line">    <span class="built_in">print</span>(error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦ä¸€ç§å¤„ç†é”™è¯¯çš„æ–¹å¼ä½¿ç”¨ <code>try?</code> å°†ç»“æœè½¬æ¢ä¸ºå¯é€‰çš„ã€‚å¦‚æœå‡½æ•°æŠ›å‡ºé”™è¯¯ï¼Œè¯¥é”™è¯¯ä¼šè¢«æŠ›å¼ƒå¹¶ä¸”ç»“æœä¸º <code>nil</code>ã€‚å¦åˆ™ï¼Œç»“æœä¼šæ˜¯ä¸€ä¸ªåŒ…å«å‡½æ•°è¿”å›å€¼çš„å¯é€‰å€¼ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sendæŠ›å‡ºé”™è¯¯åˆ™printerSuccessä¸ºnil</span></span><br><span class="line"><span class="keyword">let</span> printerSuccess <span class="operator">=</span> <span class="keyword">try?</span> send(job: <span class="number">1884</span>, toPrinter: <span class="string">&quot;Mergenthaler&quot;</span>)</span><br><span class="line"><span class="comment">// sendä¸æŠ›å‡ºé”™è¯¯åˆ™printerSuccessä¸ºsendè¿”å›å€¼ä½†æ˜¯æ˜¯å¯é€‰ç±»å‹</span></span><br><span class="line"><span class="keyword">let</span> printerFailure <span class="operator">=</span> <span class="keyword">try?</span> send(job: <span class="number">1885</span>, toPrinter: <span class="string">&quot;Never Has Toner&quot;</span>)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>defer</code> ä»£ç å—æ¥è¡¨ç¤ºåœ¨å‡½æ•°è¿”å›å‰ï¼Œå‡½æ•°ä¸­æœ€åæ‰§è¡Œçš„ä»£ç ã€‚æ— è®ºå‡½æ•°æ˜¯å¦ä¼šæŠ›å‡ºé”™è¯¯ï¼Œè¿™æ®µä»£ç éƒ½å°†æ‰§è¡Œã€‚ä½¿ç”¨ <code>defer</code>ï¼Œå¯ä»¥æŠŠå‡½æ•°è°ƒç”¨ä¹‹åˆå°±è¦æ‰§è¡Œçš„ä»£ç å’Œå‡½æ•°è°ƒç”¨ç»“æŸæ—¶çš„æ‰«å°¾ä»£ç å†™åœ¨ä¸€èµ·ï¼Œè™½ç„¶è¿™ä¸¤è€…çš„æ‰§è¡Œæ—¶æœºæˆªç„¶ä¸åŒã€‚<strong>è¿™ä¸ªæ²¡çœ‹æ‡‚</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fridgeIsOpen <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"><span class="keyword">let</span> fridgeContent <span class="operator">=</span> [<span class="string">&quot;milk&quot;</span>, <span class="string">&quot;eggs&quot;</span>, <span class="string">&quot;leftovers&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">fridgeContains</span>(<span class="keyword">_</span> <span class="params">food</span>: <span class="type">String</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    fridgeIsOpen <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">    <span class="keyword">defer</span> &#123;</span><br><span class="line">        fridgeIsOpen <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> result <span class="operator">=</span> fridgeContent.contains(food)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line">fridgeContains(<span class="string">&quot;banana&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(fridgeIsOpen)</span><br></pre></td></tr></table></figure><h2 id="æ³›å‹">æ³›å‹</h2><p>åœ¨å°–æ‹¬å·é‡Œå†™ä¸€ä¸ªåå­—æ¥åˆ›å»ºä¸€ä¸ªæ³›å‹å‡½æ•°æˆ–è€…ç±»å‹ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Itemæ˜¯ä¸€ä¸ªä¸çŸ¥é“ä»€ä¹ˆçš„ç±»å‹</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">makeArray</span>&lt;<span class="type">Item</span>&gt;(<span class="params">repeating</span> <span class="params">item</span>: <span class="type">Item</span>, <span class="params">numberOfTimes</span>: <span class="type">Int</span>) -&gt; [<span class="type">Item</span>] &#123;</span><br><span class="line">    <span class="keyword">var</span> result: [<span class="type">Item</span>] <span class="operator">=</span> []</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">_</span> <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span>numberOfTimes &#123;</span><br><span class="line">        result.append(item)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line">makeArray(repeating: <span class="string">&quot;knock&quot;</span>, numberOfTimes: <span class="number">4</span>)</span><br></pre></td></tr></table></figure><h3 id="where">where</h3><p>åœ¨ç±»å‹ååé¢ä½¿ç”¨ <code>where</code> æ¥æŒ‡å®šå¯¹ç±»å‹çš„ä¸€ç³»åˆ—éœ€æ±‚ï¼Œæ¯”å¦‚ï¼Œé™å®šç±»å‹å®ç°æŸä¸€ä¸ªåè®®ï¼Œé™å®šä¸¤ä¸ªç±»å‹æ˜¯ç›¸åŒçš„ï¼Œæˆ–è€…é™å®šæŸä¸ªç±»å¿…é¡»æœ‰ä¸€ä¸ªç‰¹å®šçš„çˆ¶ç±»ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">anyCommonElements</span>&lt;<span class="type">T</span>: <span class="type">Sequence</span>, <span class="type">U</span>: <span class="type">Sequence</span>&gt;(<span class="keyword">_</span> <span class="params">lhs</span>: <span class="type">T</span>, <span class="keyword">_</span> <span class="params">rhs</span>: <span class="type">U</span>) -&gt; <span class="type">Bool</span></span><br><span class="line"><span class="comment">// ä¸¤ä¸ªç±»å‹å¿…é¡»æ˜¯Equatable</span></span><br><span class="line">    <span class="keyword">where</span> <span class="type">T</span>.<span class="type">Element</span>: <span class="type">Equatable</span>, <span class="type">T</span>.<span class="type">Element</span> <span class="operator">==</span> <span class="type">U</span>.<span class="type">Element</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> lhsItem <span class="keyword">in</span> lhs &#123;</span><br><span class="line">        <span class="keyword">for</span> rhsItem <span class="keyword">in</span> rhs &#123;</span><br><span class="line">            <span class="keyword">if</span> lhsItem <span class="operator">==</span> rhsItem &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">anyCommonElements([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">3</span>])</span><br></pre></td></tr></table></figure><h2 id="æ–­è¨€">æ–­è¨€</h2><p>å¯ä»¥è°ƒç”¨ Swift æ ‡å‡†åº“çš„ <code>assert(_:_:file:line:)</code> å‡½æ•°æ¥å†™ä¸€ä¸ªæ–­è¨€ã€‚</p><p>è¡¨è¾¾å¼çš„ç»“æœä¸º <code>false</code> çš„æ—¶å€™è¿™æ¡ä¿¡æ¯ä¼šè¢«æ˜¾ç¤ºï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> age <span class="operator">=</span> <span class="operator">-</span><span class="number">3</span></span><br><span class="line"><span class="comment">// åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåªæœ‰ `age &gt;= 0` ä¸º `true` æ—¶ï¼Œå³ `age` çš„å€¼éè´Ÿçš„æ—¶å€™ï¼Œä»£ç æ‰ä¼šç»§ç»­æ‰§è¡Œã€‚å¦‚æœ `age` çš„å€¼æ˜¯è´Ÿæ•°ï¼Œå°±åƒä»£ç ä¸­é‚£æ ·ï¼Œ`age &gt;= 0` ä¸º `false`ï¼Œæ–­è¨€è¢«è§¦å‘ï¼Œç»ˆæ­¢åº”ç”¨ã€‚</span></span><br><span class="line"><span class="built_in">assert</span>(age <span class="operator">&gt;=</span> <span class="number">0</span>, <span class="string">&quot;A person&#x27;s age cannot be less than zero&quot;</span>)</span><br><span class="line"><span class="comment">// å› ä¸º age &lt; 0ï¼Œæ‰€ä»¥æ–­è¨€ä¼šè§¦å‘</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä¸éœ€è¦æ–­è¨€ä¿¡æ¯ï¼Œå¯ä»¥å°±åƒè¿™æ ·å¿½ç•¥æ‰ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">assert</span>(age <span class="operator">&gt;=</span> <span class="number">0</span>)</span><br></pre></td></tr></table></figure><h1>åœ¨ä»¥ä¸‹æ˜¯swift Documentationçš„swift touréƒ¨åˆ†ï¼Œåé¢çš„æ²¡æœ‰çœ‹ï¼Œä¹Ÿä¸éœ€è¦çœ‹ï¼Œå› ä¸ºå·²ç»é€šè¿‡èœé¸Ÿæ•™ç¨‹çœ‹è¿‡äº†</h1><p><a href="https://docs.swift.org/swift-book/documentation/the-swift-programming-language/guidedtour">https://docs.swift.org/swift-book/documentation/the-swift-programming-language/guidedtour</a></p><p>Property WrappersåŒ…è£¹å±æ€§ï¼Œæ¯”å¦‚@binding @environment @state @observedStateéƒ½æ˜¯åŒ…è£¹å±æ€§ï¼Œè¿™æ ·çš„å¸¦æœ‰åŒ…è£¹å±æ€§çš„å˜é‡éƒ½æœ‰$Value _Valueä¸¤ç§ï¼Œ<br>@stateï¼šåªè¦è¿™ä¸ªæ•°å­—æ”¹å˜ï¼Œåˆ™ç”»é¢é‡æ–°ç”Ÿæˆï¼Œæ¯ä¸€ä¸ªwarrpçš„<br>@bindingï¼Œå¦‚æœä¸€ä¸ªsrtuctå«æœ‰bindingä¿®é¥°çš„å˜é‡åˆ™åˆ›å»ºçš„æ—¶å€™å¿…é¡»è¦è¦æŠŠbindingè¿›è¡Œèµ‹å€¼<br>å¯¹äºå ç”¨å¤šè¡Œçš„å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ä¸‰ä¸ªåŒå¼•å·ï¼ˆâ€œâ€ï¼‰ã€‚åˆ é™¤æ¯ä¸ªå¼•å·å¼€å¤´çš„ç¼©è¿›ï¼Œåªè¦å®ƒä¸å…³é—­å¼•å·çš„ç¼©è¿›ç›¸åŒ¹é…ã€‚ä¾‹å¦‚ï¼š</p><p>If youâ€™re assigning an empty array or dictionary to a new variable, or another place where there isnâ€™t any type information, you need to specify the type.<br>let emptyArray: [String] = []<br>let emptyDictionary: [String: Float] = [:]</p><p>Another way to handle optional values is to provide a default value using the ?? operator. If the optional value is missing, the default value is used instead.<br>let nickname: String? = nil<br>let fullName: String = â€œJohn Appleseedâ€<br>let informalGreeting = â€œHi (nickname ?? fullName)â€</p><p>write _ to use no argument label.<br>func greet(_ person: String, on day: String) -&gt; String {<br>return â€œHello (person), today is (day).â€<br>}<br>greet(â€œJohnâ€, on: â€œWednesdayâ€)</p><p>Use a tuple to make a compound value â€” for example, to return multiple values from a function. The elements of a tuple can be referred to either by name or by number.<br>å‡½æ•°å˜é‡ï¼Œå‡½æ•°ä½œä¸ºå½¢å‚<br>func makeIncrementer() -&gt; ((Int) -&gt; Int) {<br>func addOne(number: Int) -&gt; Int {<br>return 1 + number<br>}<br>return addOne<br>}<br>var increment = makeIncrementer()<br>increment(7)</p><p>A function can take another function as one of its arguments.<br>func hasAnyMatches(list: [Int], condition: (Int) -&gt; Bool) -&gt; Bool<br>condition is a function</p><p>closuresä¸å°±æ˜¯é—­åŒ…ä¹ˆ<br>çªç„¶æƒ³èµ·æ¥c++ä¹Ÿæœ‰é—­åŒ… lamdba</p><p>You can write a closure without a name by surrounding code with braces ({}). Use in to separate the arguments and return type from the body.<br>numbers.map({ (number: Int) -&gt; Int in<br>let result = 3 * number<br>return result<br>})</p><p>Overrideè¦†ç›–è¶…ç±»å®ç°çš„å­ç±»ä¸Šçš„æ–¹æ³•è¢«æ ‡è®°ä¸ºè¦†ç›–â€”â€”åœ¨æ²¡æœ‰è¦†ç›–çš„æƒ…å†µä¸‹æ„å¤–è¦†ç›–æ–¹æ³•è¢«ç¼–è¯‘å™¨æ£€æµ‹ä¸ºé”™è¯¯ã€‚ç¼–è¯‘å™¨è¿˜æ£€æµ‹å…·æœ‰è¦†ç›–çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å®é™…ä¸Šä¸ä¼šè¦†ç›–è¶…ç±»ä¸­çš„ä»»ä½•æ–¹æ³•ã€‚</p><p>æ²¡æœ‰çœ‹æ‡‚classä¸­willsetå’Œdidsetçš„ä½¿ç”¨ï¼Œæ²¡çœ‹æ‡‚rawvalueçš„ä½¿ç”¨</p><p>ç»“æ„å’Œç±»ä¹‹é—´æœ€é‡è¦çš„åŒºåˆ«ä¹‹ä¸€æ˜¯ï¼Œç»“æ„åœ¨ä»£ç ä¸­ä¼ é€’æ—¶æ€»æ˜¯è¢«å¤åˆ¶ï¼Œä½†ç±»æ˜¯é€šè¿‡å¼•ç”¨ä¼ é€’çš„ã€‚</p><p>ä½¿ç”¨asyncæ¥æ ‡è®°å¼‚æ­¥è¿è¡Œçš„å‡½æ•°ã€‚é€šè¿‡åœ¨å¼‚æ­¥å‡½æ•°å‰é¢å†™ä¸Šawaitæ¥æ ‡è®°å¯¹å¼‚æ­¥å‡½æ•°çš„è°ƒç”¨ã€‚ä½¿ç”¨asyncletè°ƒç”¨å¼‚æ­¥å‡½æ•°ï¼Œè®©å®ƒä¸å…¶ä»–å¼‚æ­¥ä»£ç å¹¶è¡Œè¿è¡Œã€‚å½“æ‚¨ä½¿ç”¨å®ƒè¿”å›çš„å€¼æ—¶ï¼Œè¯·å†™awaitã€‚<br>ä½¿ç”¨Task{}ä»åŒæ­¥ä»£ç ä¸­è°ƒç”¨å¼‚æ­¥å‡½æ•°ï¼Œæ— éœ€ç­‰å¾…å®ƒä»¬è¿”å›ã€‚</p><p>æ²¡çœ‹æ‡‚<br>Actorå’Œclassç›¸åŒï¼šåªæ˜¯actorç¡®ä¿ä¸åŒçš„å¼‚æ­¥å‡½æ•°å¯ä»¥åŒæ—¶ä¸åŒä¸€actorçš„å®ä¾‹å®‰å…¨äº¤äº’ï¼Œå½“æ‚¨åœ¨actorä¸Šè°ƒç”¨æ–¹æ³•æˆ–è®¿é—®å…¶å±æ€§ä¹‹ä¸€æ—¶ï¼Œæ‚¨å°†è¯¥ä»£ç æ ‡è®°ä¸ºç­‰å¾…ï¼Œä»¥è¡¨æ˜å®ƒå¯èƒ½å¿…é¡»ç­‰å¾…å·²ç»åœ¨actorä¸Šè¿è¡Œçš„å…¶ä»–ä»£ç å®Œæˆã€‚</p><p>You represent errors using any type that adopts the Error protocol.<br>enum PrinterError: Error {<br>case outOfPaper<br>case noToner<br>case onFire<br>}<br>throw PrinterError.noToner<br>Use throw to throw an error and throws to mark a function that can throw an error. If you throw an error in a function, the function returns immediately and the code that called the function handles the error</p><p>æœ‰å‡ ç§æ–¹æ³•å¯ä»¥å¤„ç†é”™è¯¯ã€‚ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨do-catchã€‚åœ¨doå—å†…ï¼Œä½ é€šè¿‡åœ¨ä»£ç å‰é¢å†™ä¸Štryæ¥æ ‡è®°å¯ä»¥æŠ›å‡ºé”™è¯¯çš„ä»£ç ã€‚åœ¨catchå—ä¸­ï¼Œé”™è¯¯ä¼šè‡ªåŠ¨è¢«èµ‹äºˆåç§°é”™è¯¯You can provide multiple catch blocks that handle specific errors.<br>æ²¡çœ‹æ‡‚å¦ä¸€ç§å¤„ç†é”™è¯¯çš„æ–¹æ³•æ˜¯ä½¿ç”¨tryï¼Ÿå°†ç»“æœè½¬æ¢ä¸ºå¯é€‰ç»“æœã€‚å¦‚æœå‡½æ•°æŠ›å‡ºé”™è¯¯ï¼Œåˆ™ä¸¢å¼ƒç‰¹å®šé”™è¯¯ï¼Œç»“æœä¸ºé›¶ã€‚å¦åˆ™ï¼Œç»“æœæ˜¯åŒ…å«å‡½æ•°è¿”å›çš„å€¼çš„å¯é€‰å€¼ã€‚</p><p>æ²¡çœ‹æ‡‚<br>ä½¿ç”¨deferç¼–å†™ä¸€ä¸ªä»£ç å—ï¼Œè¯¥ä»£ç å—åœ¨å‡½æ•°ä¸­æ‰€æœ‰å…¶ä»–ä»£ç ä¹‹åæ‰§è¡Œï¼Œå°±åœ¨å‡½æ•°è¿”å›ä¹‹å‰ã€‚æ— è®ºå‡½æ•°æ˜¯å¦æŠ›å‡ºé”™è¯¯ï¼Œä»£ç éƒ½ä¼šè¢«æ‰§è¡Œã€‚æ‚¨å¯ä»¥ä½¿ç”¨deferæ¥å¹¶æ’ç¼–å†™è®¾ç½®å’Œæ¸…ç†ä»£ç ï¼Œå³ä½¿å®ƒä»¬éœ€è¦åœ¨ä¸åŒçš„æ—¶é—´æ‰§è¡Œã€‚</p><p>åœ¨è§’æ‹¬å·å†…å†™ä¸€ä¸ªåç§°ï¼Œä»¥åˆ¶ä½œä¸€ä¸ªé€šç”¨å‡½æ•°æˆ–ç±»å‹ã€‚</p><p>åœ¨æ­£æ–‡å‰ä½¿ç”¨whereæ¥æŒ‡å®šè¦æ±‚åˆ—è¡¨â€”â€”ä¾‹å¦‚ï¼Œè¦æ±‚ç±»å‹å®ç°åè®®ï¼Œè¦æ±‚ä¸¤ç§ç±»å‹ç›¸åŒï¼Œæˆ–è¦æ±‚ä¸€ä¸ªç±»å…·æœ‰ç‰¹å®šçš„è¶…ç±»ã€‚<br>func anyCommonElements&lt;T: Sequence, U: Sequence&gt;(_ lhs: T, _ rhs: U) -&gt; Bool<br>where T.Element: Equatable, T.Element == U.Element{}</p><p>å‡½æ•°çš„ç¬¬ä¸€ä¸ªå½¢å‚å‰é¢åˆä¸ªäºº_ï¼Œå°±å¯ä»¥ä¸ç”¨å†™lhsï¼šï¼Œè€Œæ˜¯ç›´æ¥åŠ å®æƒ¨å°±å¯ä»¥</p><h2 id="ä»¥ä¸‹æ˜¯swift-documentationçš„swift-touréƒ¨åˆ†-åé¢çš„æ²¡æœ‰çœ‹-ä¹Ÿä¸éœ€è¦çœ‹-å› ä¸ºå·²ç»é€šè¿‡èœé¸Ÿæ•™ç¨‹çœ‹è¿‡äº†">ä»¥ä¸‹æ˜¯swift Documentationçš„swift touréƒ¨åˆ†ï¼Œåé¢çš„æ²¡æœ‰çœ‹ï¼Œä¹Ÿä¸éœ€è¦çœ‹ï¼Œå› ä¸ºå·²ç»é€šè¿‡èœé¸Ÿæ•™ç¨‹çœ‹è¿‡äº†</h2><p><a href="https://docs.swift.org/swift-book/documentation">https://docs.swift.org/swift-book/documentation</a><br>Property WrappersåŒ…è£¹å±æ€§ï¼Œæ¯”å¦‚@binding @envirYou donâ€™t need to import a separate library for functionality like outputting text or handling strings. Code written at global scope is used as the entry point for the program, so you donâ€™t need a main() function. You also donâ€™t need to write semicolons at the end of every statement.</p><p>Use let to make a constant and var to make a variable.<br>Providing a value when you create a constant or variable lets the compiler infer its type. If the initial value doesnâ€™t provide enough information (or if there isnâ€™t an initial value), specify the type by writing it after the variable, separated by a colononment @state @observedStateéƒ½æ˜¯åŒ…è£¹å±æ€§ï¼Œè¿™æ ·çš„å¸¦æœ‰åŒ…è£¹å±æ€§çš„å˜é‡éƒ½æœ‰$Value _Valueä¸¤ç§ï¼Œ<br>@stateï¼šåªè¦è¿™ä¸ªæ•°å­—æ”¹å˜ï¼Œåˆ™ç”»é¢é‡æ–°ç”Ÿæˆï¼Œæ¯ä¸€ä¸ªwarrpçš„<br>@bindingï¼Œå¦‚æœä¸€ä¸ªsrtuctå«æœ‰bindingä¿®é¥°çš„å˜é‡åˆ™åˆ›å»ºçš„æ—¶å€™å¿…é¡»è¦è¦æŠŠbindingè¿›è¡Œèµ‹å€¼<br>å¯¹äºå ç”¨å¤šè¡Œçš„å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ä¸‰ä¸ªæ˜ŸæœŸåŒå¼•å·ï¼ˆâ€œâ€ï¼‰ã€‚åˆ é™¤æ¯ä¸ªå¼•å·å¼€å¤´çš„ç¼©è¿›ï¼Œåªè¦å®ƒä¸å…³é—­å¼•å·çš„ç¼©è¿›ç›¸åŒ¹é…ã€‚ä¾‹å¦‚ï¼š</p><p>If youâ€™re assigning an empty array or dictionary to a new variable, or another place where there isnâ€™t any type information, you need to specify the type.<br>let emptyArray: [String] = []<br>let emptyDictionary: [String: Float] = [:]</p><p>Another way to handle optional values is to provide a default value using the ?? operator. If the optional value is missing, the default value is used instead.<br>let nickname: String? = nil<br>let fullName: String = â€œJohn Appleseedâ€<br>let informalGreeting = â€œHi (nickname ?? fullName)â€</p><p>write _ to use no argument label.<br>func greet(_ person: String, on day: String) -&gt; String {<br>return â€œHello (person), today is (day).â€<br>}<br>greet(â€œJohnâ€, on: â€œWednesdayâ€)</p><p>Use a tuple to make a compound value â€” for example, to return multiple values from a function. The elements of a tuple can be referred to either by name or by number.<br>å‡½æ•°å˜é‡ï¼Œå‡½æ•°ä½œä¸ºå½¢å‚<br>func makeIncrementer() -&gt; ((Int) -&gt; Int) {<br>func addOne(number: Int) -&gt; Int {<br>return 1 + number<br>}<br>return addOne<br>}<br>var increment = makeIncrementer()<br>increment(7)</p><p>A function can take another function as one of its arguments.<br>func hasAnyMatches(list: [Int], condition: (Int) -&gt; Bool) -&gt; Bool<br>condition is a function</p><p>closuresä¸å°±æ˜¯é—­åŒ…ä¹ˆ<br>çªç„¶æƒ³èµ·æ¥c++ä¹Ÿæœ‰é—­åŒ… lamdba</p><p>You can write a closure without a name by surrounding code with braces ({}). Use in to separate the arguments and return type from the body.<br>numbers.map({ (number: Int) -&gt; Int in<br>let result = 3 * number<br>return result<br>})</p><p>Overrideè¦†ç›–è¶…ç±»å®ç°çš„å­ç±»ä¸Šçš„æ–¹æ³•è¢«æ ‡è®°ä¸ºè¦†ç›–â€”â€”åœ¨æ²¡æœ‰è¦†ç›–çš„æƒ…å†µä¸‹æ„å¤–è¦†ç›–æ–¹æ³•è¢«ç¼–è¯‘å™¨æ£€æµ‹ä¸ºé”™è¯¯ã€‚ç¼–è¯‘å™¨è¿˜æ£€æµ‹å…·æœ‰è¦†ç›–çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å®é™…ä¸Šä¸ä¼šè¦†ç›–è¶…ç±»ä¸­çš„ä»»ä½•æ–¹æ³•ã€‚</p><p>æ²¡æœ‰çœ‹æ‡‚classä¸­willsetå’Œdidsetçš„ä½¿ç”¨ï¼Œæ²¡çœ‹æ‡‚rawvalueçš„ä½¿ç”¨</p><p>ç»“æ„å’Œç±»ä¹‹é—´æœ€é‡è¦çš„åŒºåˆ«ä¹‹ä¸€æ˜¯ï¼Œç»“æ„åœ¨ä»£ç ä¸­ä¼ é€’æ—¶æ€»æ˜¯è¢«å¤åˆ¶ï¼Œä½†ç±»æ˜¯é€šè¿‡å¼•ç”¨ä¼ é€’çš„ã€‚</p><p>ä½¿ç”¨asyncæ¥æ ‡è®°å¼‚æ­¥è¿è¡Œçš„å‡½æ•°ã€‚é€šè¿‡åœ¨å¼‚æ­¥å‡½æ•°å‰é¢å†™ä¸Šawaitæ¥æ ‡è®°å¯¹å¼‚æ­¥å‡½æ•°çš„è°ƒç”¨ã€‚ä½¿ç”¨asyncletè°ƒç”¨å¼‚æ­¥å‡½æ•°ï¼Œè®©å®ƒä¸å…¶ä»–å¼‚æ­¥ä»£ç å¹¶è¡Œè¿è¡Œã€‚å½“æ‚¨ä½¿ç”¨å®ƒè¿”å›çš„å€¼æ—¶ï¼Œè¯·å†™awaitã€‚<br>ä½¿ç”¨Task{}ä»åŒæ­¥ä»£ç ä¸­è°ƒç”¨å¼‚æ­¥å‡½æ•°ï¼Œæ— éœ€ç­‰å¾…å®ƒä»¬è¿”å›ã€‚</p><p>æ²¡çœ‹æ‡‚<br>Actorå’Œclassç›¸åŒï¼šåªæ˜¯actorç¡®ä¿ä¸åŒçš„å¼‚æ­¥å‡½æ•°å¯ä»¥åŒæ—¶ä¸åŒä¸€actorçš„å®ä¾‹å®‰å…¨äº¤äº’ï¼Œå½“æ‚¨åœ¨actorä¸Šè°ƒç”¨æ–¹æ³•æˆ–è®¿é—®å…¶å±æ€§ä¹‹ä¸€æ—¶ï¼Œæ‚¨å°†è¯¥ä»£ç æ ‡è®°ä¸ºç­‰å¾…ï¼Œä»¥è¡¨æ˜å®ƒå¯èƒ½å¿…é¡»ç­‰å¾…å·²ç»åœ¨actorä¸Šè¿è¡Œçš„å…¶ä»–ä»£ç å®Œæˆã€‚</p><p>You represent errors using any type that adopts the Error protocol.<br>enum PrinterError: Error {<br>case outOfPaper<br>case noToner<br>case onFire<br>}<br>throw PrinterError.noToner<br>Use throw to throw an error and throws to mark a function that can throw an error. If you throw an error in a function, the function returns immediately and the code that called the function handles the error</p><p>æœ‰å‡ ç§æ–¹æ³•å¯ä»¥å¤„ç†é”™è¯¯ã€‚ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨do-catchã€‚åœ¨doå—å†…ï¼Œä½ é€šè¿‡åœ¨ä»£ç å‰é¢å†™ä¸Štryæ¥æ ‡è®°å¯ä»¥æŠ›å‡ºé”™è¯¯çš„ä»£ç ã€‚åœ¨catchå—ä¸­ï¼Œé”™è¯¯ä¼šè‡ªåŠ¨è¢«èµ‹äºˆåç§°é”™è¯¯You can provide multiple catch blocks that handle specific errors.<br>æ²¡çœ‹æ‡‚å¦ä¸€ç§å¤„ç†é”™è¯¯çš„æ–¹æ³•æ˜¯ä½¿ç”¨tryï¼Ÿå°†ç»“æœè½¬æ¢ä¸ºå¯é€‰ç»“æœã€‚å¦‚æœå‡½æ•°æŠ›å‡ºé”™è¯¯ï¼Œåˆ™ä¸¢å¼ƒç‰¹å®šé”™è¯¯ï¼Œç»“æœä¸ºé›¶ã€‚å¦åˆ™ï¼Œç»“æœæ˜¯åŒ…å«å‡½æ•°è¿”å›çš„å€¼çš„å¯é€‰å€¼ã€‚</p><p>æ²¡çœ‹æ‡‚<br>ä½¿ç”¨deferç¼–å†™ä¸€ä¸ªä»£ç å—ï¼Œè¯¥ä»£ç å—åœ¨å‡½æ•°ä¸­æ‰€æœ‰å…¶ä»–ä»£ç ä¹‹åæ‰§è¡Œï¼Œå°±åœ¨å‡½æ•°è¿”å›ä¹‹å‰ã€‚æ— è®ºå‡½æ•°æ˜¯å¦æŠ›å‡ºé”™è¯¯ï¼Œä»£ç éƒ½ä¼šè¢«æ‰§è¡Œã€‚æ‚¨å¯ä»¥ä½¿ç”¨deferæ¥å¹¶æ’ç¼–å†™è®¾ç½®å’Œæ¸…ç†ä»£ç ï¼Œå³ä½¿å®ƒä»¬éœ€è¦åœ¨ä¸åŒçš„æ—¶é—´æ‰§è¡Œã€‚</p><p>åœ¨è§’æ‹¬å·å†…å†™ä¸€ä¸ªåç§°ï¼Œä»¥åˆ¶ä½œä¸€ä¸ªé€šç”¨å‡½æ•°æˆ–ç±»å‹ã€‚</p><p>åœ¨æ­£æ–‡å‰ä½¿ç”¨whereæ¥æŒ‡å®šè¦æ±‚åˆ—è¡¨â€”â€”ä¾‹å¦‚ï¼Œè¦æ±‚ç±»å‹å®ç°åè®®ï¼Œè¦æ±‚ä¸¤ç§ç±»å‹ç›¸åŒï¼Œæˆ–è¦æ±‚ä¸€ä¸ªç±»å…·æœ‰ç‰¹å®šçš„è¶…ç±»ã€‚<br>func anyCommonElements&lt;T: Sequence, U: Sequence&gt;(_ lhs: T, _ rhs: U) -&gt; Bool<br>where T.Element: Equatable, T.Element == U.Element{}</p><p>å‡½æ•°çš„ç¬¬ä¸€ä¸ªå½¢å‚å‰é¢åˆä¸ªäºº_ï¼Œå°±å¯ä»¥ä¸ç”¨å†™lhsï¼šï¼Œè€Œæ˜¯ç›´æ¥åŠ å®æƒ¨å°±å¯ä»¥</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;0326çœ‹åˆ°äº†åŸºæœ¬è¿ç®—ç¬¦å·&lt;/p&gt;
&lt;h1&gt;siwftç¬”è®°&lt;/h1&gt;
&lt;h2 id=&quot;å¼•è¨€-å†™ç»™æˆ‘è‡ªå·±åœ¨å­¦ä¹ swiftæˆä¸ºè‹¹æœå¼€å‘è€…ä¹‹å‰çš„çŒœæƒ³&quot;&gt;å¼•è¨€-å†™ç»™æˆ‘è‡ªå·±åœ¨å­¦ä¹ swiftæˆä¸ºè‹¹æœå¼€å‘è€…ä¹‹å‰çš„çŒœæƒ³&lt;/h2&gt;
&lt;p&gt;æ€ä¹ˆå­¦ä¹ swiftï¼Ÿå¦‚ä½•åˆ¶ä½œå¹¶å‘å¸ƒä¸€ä¸ªç”±swiftåˆ¶ä½œ</summary>
      
    
    
    
    <category term="swift" scheme="http://outbreak-sen.github.io/categories/swift/"/>
    
    
    <category term="siwft" scheme="http://outbreak-sen.github.io/tags/siwft/"/>
    
  </entry>
  
  <entry>
    <title>è¯åˆ¸æŠ•èµ„</title>
    <link href="http://outbreak-sen.github.io/2025/03/12/%E8%AF%81%E5%88%B8%E6%8A%95%E8%B5%84/"/>
    <id>http://outbreak-sen.github.io/2025/03/12/%E8%AF%81%E5%88%B8%E6%8A%95%E8%B5%84/</id>
    <published>2025-03-12T03:54:34.000Z</published>
    <updated>2025-03-19T09:11:52.583Z</updated>
    
    <content type="html"><![CDATA[<h1>è¯åˆ¸æŠ•èµ„è®¡åˆ’</h1><h1>å½“å‰ç»æµç¯å¢ƒåˆ†æ</h1><ul><li><strong>ä½åˆ©ç‡ç¯å¢ƒ</strong>ï¼šä¸­å›½ç›®å‰å¤„äºä½åˆ©ç‡å‘¨æœŸï¼Œå¤®è¡Œé€šè¿‡é™å‡†ã€é™æ¯ç­‰æ‰‹æ®µåˆºæ¿€ç»æµï¼Œå¯¼è‡´å›½å€ºæ”¶ç›Šç‡è¾ƒä½ã€‚</li><li><strong>é€šèƒ€æ°´å¹³</strong>ï¼šå½“å‰é€šèƒ€å‹åŠ›è¾ƒå°ï¼ˆCPIæ¶¨å¹…è¾ƒä½ï¼‰ï¼Œ2%çš„å›½å€ºæ”¶ç›Šç‡å°šèƒ½è¦†ç›–é€šèƒ€ï¼Œä½†è‹¥æœªæ¥é€šèƒ€ä¸Šå‡ï¼Œå®é™…æ”¶ç›Šå¯èƒ½è¿›ä¸€æ­¥ç¼©æ°´ã€‚</li><li><strong>ç»æµå¤è‹ä¸ç¡®å®šæ€§</strong>ï¼šä¸­å›½ç»æµå¤è‹ä»é¢ä¸´æŒ‘æˆ˜ï¼ˆå¦‚æ¶ˆè´¹ç–²è½¯ã€æˆ¿åœ°äº§ä½è¿·ï¼‰ï¼Œå›½å€ºä½œä¸ºé¿é™©èµ„äº§å¯èƒ½å—åˆ°é’çã€‚</li></ul><h1>ä¿¡æ‰˜è®¡åˆ’</h1><h1>å›½å€º</h1><p>å›½å€ºä¸»è¦åˆ†ä¸ºè®°è´¦å¼å›½å€ºå’Œå‚¨è“„å¼å›½å€º</p><p>å‚¨è“„å¼å›½å€ºåˆåˆ†ä¸ºç”µå­å‚¨è“„å¼å›½å€ºå’Œå‡­è¯å¼å›½å€º</p><p><img src="./%E8%AF%81%E5%88%B8%E6%8A%95%E8%B5%84/image-20250312140814603.png" alt="image-20250312140814603"></p><p><strong>å‡­è¯å¼å‚¨è“„å›½å€º</strong>ï¼š</p><ul><li><p>å‡­è¯å¼çš„è‡ª12å¹´ä¹‹åæ²¡æ–‡ä»¶äº†</p></li><li><p>å‡­è¯å¼å›½å€ºéœ€æºå¸¦èº«ä»½è¯å’Œèµ„é‡‘åˆ°é“¶è¡Œç½‘ç‚¹åŠç†ï¼Œ<strong>åªèƒ½åœ¨å‘è¡Œå½“å¤©æå‰å»æ‰¿é”€é“¶è¡Œç½‘ç‚¹æ’é˜Ÿ</strong></p></li><li><p>å‚¨è“„å›½å€º**æ”¯æŒæå‰å…‘å–ï¼Œä½†éœ€æ”¯ä»˜1â€°æ‰‹ç»­è´¹ï¼Œå¹¶æŒ‰æŒæœ‰æ—¶é—´åˆ†æ¡£è®¡æ¯.åˆ©ç‡å›ºå®šï¼Œåˆ°æœŸä¸€æ¬¡æ€§è¿˜æœ¬ä»˜æ¯ã€‚**ä¾‹å¦‚ï¼Œ2025å¹´3æœˆå‘è¡Œçš„å‚¨è“„å›½å€ºï¼Œ3å¹´æœŸåˆ©ç‡ä¸º1.93%ï¼Œ5å¹´æœŸä¸º2.0%.å‡è®¾æˆ‘èŠ±10ä¸‡å…ƒè´­ä¹°äº†å›½å€ºï¼Œå¹´åˆ©ç‡æ˜¯3.8%ï¼Œå¦‚æœæ˜¯ç”µå­å¼å›½å€ºï¼Œç¬¬ä¸€å¹´å¯ä»¥æ‹¿åˆ°3800å…ƒçš„åˆ©æ¯ï¼Œæˆ‘å¯ä»¥ç”¨è¿™ä»½åˆ©æ¯ç»§ç»­æŠ•èµ„ï¼Œè®©è¿™ä»½é’±ä¹Ÿå¯ä»¥äº§ç”Ÿæ”¶ç›Šã€‚ä½†å¦‚æœæ˜¯å‡­è¯å¼å›½å€ºï¼Œæˆ‘ä»¬åªæœ‰ç­‰åˆ°æœŸæ‰èƒ½æ‹¿åˆ°å…¨éƒ¨åˆ©æ¯ï¼Œå°±æ— æ³•è®©æˆ‘ä»¬çš„èµ„é‡‘å‘æŒ¥æœ€å¤§çš„ä½œç”¨ã€‚</p></li><li><p>é“¶è¡Œéƒ½æ‰¿é”€å›½å€ºï¼Œä½†æ˜¯ä»–ä»¬çš„æ‰¿é”€æ¯”ä¾‹ä¸åŒï¼Œå…·ä½“çš„æ‰¿é”€æ¯”ä¾‹ä¸€èˆ¬åœ¨å›½å€ºå‘è¡Œé€šçŸ¥é‡Œæœ‰ï¼Œä¸€èˆ¬å·¥è¡Œå’Œå»ºè¡Œæ˜¯æœ€é«˜çš„ã€‚ä¸è¿‡æ‰¿é”€æ¯”ä¾‹é«˜ä¹Ÿä¸æ„å‘³ç€è¿™äº›é“¶è¡Œæ›´å¥½ä¹°ï¼Œå› ä¸ºç”¨æˆ·ä¹Ÿæ›´å¤šã€‚</p></li></ul><p><strong>ç”µå­å¼å‚¨è“„å›½å€º</strong></p><ul><li><p><a href="https://www.chinabond.com.cn/xxpl/ywzc_fxyfxdh/fxyfxdh_zqzl/zqzl_gz/gz_cxs/cxs_fxwj_ath/202411/t20241107_853939027.html">2024å¹´ç¬¬ä¹æœŸå‚¨è“„å›½å€ºæ–‡ä»¶</a>,<strong>2024å¹´ç¬¬ä¹æœŸæœŸé™3å¹´ï¼Œç¥¨é¢å¹´åˆ©ç‡ä¸º1.93%,ç¬¬åæœŸæœŸé™5å¹´ï¼Œç¥¨é¢å¹´åˆ©ç‡ä¸º2%</strong>,æœ€åæœ‰æ‰¿æ‹…å•ä½æ¯”ä¾‹</p></li><li><p>ç”µå­å¼å›½å€ºå¯é€šè¿‡ç½‘é“¶ç›´æ¥è´­ä¹°</p></li><li><p>ç”µå­å¼å›½å€ºæ˜¯<strong>ä¸€å¹´ä¸€ä»˜æ¯</strong>ï¼Œå¯ä»¥äººä¸ºåœ°åˆ¶é€ å¤åˆ©æ•ˆæœã€‚</p></li></ul><p><strong>è®°è´¦å¼å›½å€º</strong>ï¼š</p><ul><li><p>2025å¹´ç¬¬äº”æ¬¡è®°è´¦å¼å›½å€ºåˆ©ç‡1.45&amp;</p></li><li><p>å¯åœ¨é“¶è¡ŒæŸœå°æˆ–è¯åˆ¸äº¤æ˜“æ‰€è´­ä¹°ï¼Œæ”¯æŒäºŒçº§å¸‚åœºäº¤æ˜“ï¼ŒæµåŠ¨æ€§è¾ƒé«˜.åˆ©ç‡æµ®åŠ¨ï¼Œæ”¶ç›Šéšå¸‚åœºæ³¢åŠ¨</p></li><li><p>å¯é€šè¿‡<strong>é“¶è¡Œæˆ–è¯åˆ¸äº¤æ˜“æ‰€</strong>æŸ¥è¯¢å®æ—¶æ”¶ç›Šç‡.è½¬è®©æ‰€å¾—<strong>éœ€æŒ‰20%ç¨ç‡ç¼´çº³ä¸ªäººæ‰€å¾—ç¨</strong></p></li></ul><p>è¶…é•¿æœŸå›½å€º</p><ul><li>2024å¹´è¶…é•¿æœŸç‰¹åˆ«å›½å€ºï¼ˆå…­æœŸï¼‰ï¼ˆ30å¹´æœŸï¼‰,ç»­å‘è¡Œå›½å€ºç¥¨é¢åˆ©ç‡ä¸ä¹‹å‰å‘è¡Œçš„åŒæœŸå›½å€ºç›¸åŒï¼Œä¸º2.19%ã€‚</li></ul><h3 id="å¦‚ä½•è´­ä¹°">å¦‚ä½•è´­ä¹°</h3><ul><li><p>å›½å€ºå‘è¡Œæ—¶é—´ã€åˆ©ç‡å’Œé¢åº¦ä¿¡æ¯ï¼Œå¯<strong>é€šè¿‡è´¢æ”¿éƒ¨å®˜ç½‘æˆ–æ‰¿é”€é“¶è¡Œå®˜ç½‘\ä¸­å›½äººæ°‘é“¶è¡Œå®˜ç½‘æŸ¥è¯¢</strong>,ä½†æ˜¯æˆ‘æ²¡æœ‰æ‰¾åˆ°,ä½†æ˜¯åœ¨<a href="https://www.chinabond.com.cn/">ä¸­å›½å€ºæƒä¿¡æ¯ç½‘</a>çœ‹åˆ°äº†å›½å€ºçš„å‘è¡Œæ–‡ä»¶,æœ‰å›½å€ºçš„ä¸“æ ,å¯ä»¥çœ‹åˆ°å‚¨è“„æ€§å’Œå‡­è¯æ€§.è¿˜èƒ½çœ‹åˆ°åœ°æ–¹æ€§å€ºæƒå’Œé“¶è¡Œé‡‘èè¡Œå€ºæƒ,å¯è¾¾1.66%</p></li><li><p>åœ¨æ²¡æœ‰æŒæ»¡6ä¸ªæœˆçš„æƒ…å†µä¸‹ï¼Œä¸ä»…æ²¡æœ‰åˆ©æ¯ï¼Œè¿˜è¦æ‰£é™¤ç›¸åº”çš„æ‰‹ç»­è´¹ã€‚</p></li><li><p>ä¸€èˆ¬æ¥è¯´ï¼Œå›½å€ºå‘è¡Œæ—¶é—´å›ºå®šåœ¨æ¯æœˆçš„10æ—¥~19æ—¥ä¹‹é—´ï¼Œä¸è¿‡ä¹Ÿå­˜åœ¨ä¸å‘è¡Œçš„æƒ…å†µã€‚æ¯”å¦‚æ¯å¹´æœ‰ä¸‰ä¸ªæœˆä»½åŸºæœ¬ä¸ä¼šå‘è¡Œï¼Œåˆ†åˆ«æ˜¯çš„1ã€2ã€12æœˆä»½ã€‚æ ¹æ®è´¢æ”¿éƒ¨2022å¹´ç¬¬ä¸€å­£åº¦å›½å€ºå‘è¡Œè®¡åˆ’ï¼Œæœ€è¿‘ä¸€æ¬¡æ˜¯3æœˆ10æ—¥ï¼Œå‘è¡Œçš„æ˜¯å‡­è¯å¼å›½å€º</p></li><li><p><strong>ç¬¬ä¸€æ¬¡è´­ä¹°éœ€è¦å¼€é€šå›½å€ºæ‰˜ç®¡è´¦æˆ·</strong>,è¿™ä¸ªæ‰˜ç®¡è´¦æˆ·å¯ä»¥åœ¨é“¶è¡Œç½‘ç‚¹åŠç†ï¼Œä¹Ÿå¯ä»¥åœ¨ç½‘ä¸Šé“¶è¡ŒåŠç†ã€‚ä½†æ˜¯å„é“¶è¡Œæœ‰è‡ªå·±çš„è¦æ±‚ï¼Œæœ‰äº›é“¶è¡Œåªæœ‰é«˜çº§ç”¨æˆ·æ‰å¯ä»¥ç”¨ç½‘é“¶å¼€ï¼Œæœ‰äº›é“¶è¡Œç”¨ç½‘é“¶å¼€éœ€è¦æ”¯ä»˜æ‰‹ç»­è´¹ï¼Œ<strong>çº¿ä¸‹ä¸éœ€è¦</strong>ã€‚å¼€é€šäº†å›½å€ºæ‰˜ç®¡è´¦æˆ·ä¹‹åï¼Œæˆ‘ä»¬å°±ç­‰åˆ°<strong>å‘è¡Œæ—¥å½“å¤©8:30ä¹‹å‰ç™»å½•ç½‘é“¶ï¼Œæ‰“å¼€å›½å€ºè´­ä¹°ç•Œé¢</strong>ï¼Œå¼€å§‹æŠ¢è´­</p></li></ul><h3 id="å…¶ä»–å†…å®¹">å…¶ä»–å†…å®¹</h3><ul><li><a href="https://cn.investing.com/">è‹±ä¸ºè´¢æƒ…</a>å¯æŸ¥åˆ°å„å›½å†å¹´å€ºæƒ,<a href="https://cn.investing.com/rates-bonds/world-government-bonds">å„å›½å€ºæƒæ”¶ç›Šç‡</a>,ä¹Œå…‹å…°çš„ä¸‰å¹´æœŸå€ºæƒæ”¶ç›Šç‡ä½äºä¸€å¹´æœŸå€ºæƒæ”¶ç›Šç‡ï¼Œä½†æ˜¯æ”¶ç›Šç‡å¯ä»¥è¾¾åˆ°30%,è¿™ç§ç°è±¡è¢«ç§°ä¸ºâ€œæ”¶ç›Šç‡æ›²çº¿å€’æŒ‚â€ï¼ˆYield Curve Inversionï¼‰ï¼Œé€šå¸¸åæ˜ äº†å¸‚åœºå¯¹ç»æµå‰æ™¯çš„æ‚²è§‚é¢„æœŸã€‚</li><li>2%çš„å¹´åŒ–æ”¶ç›Šç‡å¯èƒ½è·‘ä¸èµ¢é€šèƒ€ï¼ˆ2023å¹´ä¸­å›½CPIåŒæ¯”æ¶¨å¹…çº¦0.9%-1.5%ï¼‰ï¼Œå®é™…æ”¶ç›Šæœ‰é™ã€‚</li></ul><h1>å¾®ä¿¡</h1><p>'å¤§é¢å­˜å•</p><p>é“¶è¡Œåˆ©æ¯</p><p>ç­‰æŠ•èµ„å“ç§ä¸æ˜¯é—¨æ§›å¤ªé«˜å°±æ˜¯æ”¶ç›Šæ™®éä½äº5%</p><h2 id="aè‚¡å¸‚åœº">Aè‚¡å¸‚åœº</h2><p><a href="https://zhida.zhihu.com/search?content_id=343862019&amp;content_type=Answer&amp;match_order=1&amp;q=A%E8%82%A1%E5%B8%82%E5%9C%BA&amp;zhida_source=entity">Aè‚¡å¸‚åœº</a>é±¼é¾™æ··æ‚ï¼Œè“ç­¹ç™½é©¬è‚¡é€‚åˆå¤§èµ„é‡‘æŠ•èµ„è€…ï¼Œç¨³å¥é£æ ¼æŠ•èµ„è€…ï¼Œ<a href="https://zhida.zhihu.com/search?content_id=343862019&amp;content_type=Answer&amp;match_order=1&amp;q=%E8%82%A1%E6%81%AF%E6%8A%95%E8%B5%84%E8%80%85&amp;zhida_source=entity">è‚¡æ¯æŠ•èµ„è€…</a>ï¼›æˆé•¿è‚¡é€‚åˆä¸“ä¸šæŠ•èµ„è€…ï¼›<a href="https://zhida.zhihu.com/search?content_id=343862019&amp;content_type=Answer&amp;match_order=1&amp;q=%E7%A7%91%E5%88%9B%E7%A7%91%E6%8A%80%E8%82%A1&amp;zhida_source=entity">ç§‘åˆ›ç§‘æŠ€è‚¡</a>é€‚åˆèŒä¸šæŠ•èµ„è€…ï¼Œé€‚åˆå¯¹æŠ•èµ„æ”¶ç›Šæœ‰è¦æ±‚çš„æŠ•èµ„è€…</p><p>å¾ˆå¤šè‚¡ç¥¨è½¯ä»¶æœ€å¼€å§‹çš„é¦–é¡µå°±æ˜¯æ¶¨å¹…æ¦œå’Œè·Œå¹…æ¦œ</p><h3 id="æ€ä¹ˆåˆ†æä¸€åªè‚¡ç¥¨">æ€ä¹ˆåˆ†æä¸€åªè‚¡ç¥¨</h3><p>ç”µè„‘ä¸Šé¢å°±æ˜¯ä¸¤ä¸ªæŒ‰é”®<strong>ä¸€ä¸ªæ˜¯F5,ä¸€ä¸ªæ˜¯F10</strong>ï¼ŒF5å°±æ˜¯<a href="https://zhida.zhihu.com/search?content_id=343862019&amp;content_type=Answer&amp;match_order=1&amp;q=%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90&amp;zhida_source=entity">æŠ€æœ¯åˆ†æ</a>æ¿å—ï¼ŒF10å°±æ˜¯<a href="https://zhida.zhihu.com/search?content_id=343862019&amp;content_type=Answer&amp;match_order=1&amp;q=%E5%9F%BA%E6%9C%AC%E9%9D%A2%E5%88%86%E6%9E%90&amp;zhida_source=entity">åŸºæœ¬é¢åˆ†æ</a></p><p>F5å°±æ˜¯<a href="https://zhida.zhihu.com/search?content_id=343862019&amp;content_type=Answer&amp;match_order=1&amp;q=%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90&amp;zhida_source=entity">æŠ€æœ¯åˆ†æ</a>æ¿å—</p><p>æ—¥çº¿ï¼Œå‘¨çº¿ï¼Œæœˆçº¿å°±æ˜¯æŠ€æœ¯åˆ†æï¼Œ</p><p>çº¢çº¢ç»¿ç»¿çš„æ˜¯kçº¿å›´ç»•ç€kçº¿çš„æ˜¯å‡çº¿ä¸‹é¢çš„æ˜¯æˆäº¤é‡æœ€åçš„æ˜¯MACD</p><p>çº¢çº¢ç»¿ç»¿çš„æ˜¯kçº¿å›´ç»•ç€kçº¿çš„æ˜¯å‡çº¿ä¸‹é¢çš„æ˜¯æˆäº¤é‡æœ€åçš„æ˜¯MACD</p><p>è‚¡ä»·ä¸Šæ¶¨æŠ€æœ¯æŒ‡æ ‡å°±é‡‘å‰ï¼Œä¸‹è·Œå°±æ­»å‰</p><p>æ¶¨äº†å°±æ˜¯çº¢kï¼Œå¤§æ¶¨å°±æ˜¯å¤§ä½“ç§¯çš„çº¢kï¼Œåä¹‹äº¦ç„¶ï¼Œä¸‹è·Œå°±æ˜¯ç»¿k</p><p>æˆäº¤é‡ä¹Ÿæ˜¯ï¼Œæ¶¨çš„å°±æ˜¯çº¢ï¼Œè·Œçš„å°±æ˜¯ç»¿</p><p>F10å°±æ˜¯åŸºæœ¬é¢åˆ†æ</p><p>åŸºæœ¬é¢åˆ†æåœ¨ä¸‹é¢çš„è‚¡ç¥¨èµ„æ–™é‡Œé¢</p><p><strong>ä¸€ï¼Œå‡€åˆ©æ¶¦ï¼ˆè¦ç¨³å®šå¢åŠ ï¼Œå› ä¸ºå‡€åˆ©æ¶¦å°±æ˜¯ä¼ä¸šçš„èµšé’±èƒ½åŠ›ï¼‰</strong>**</p><p>äºŒï¼Œç°é‡‘æµï¼ˆä¸èƒ½ä¸ºè´Ÿã€‚å› ä¸ºç°é‡‘æµè´Ÿäº†æœ‰å¯èƒ½ä¼ä¸šèµ„é‡‘é“¾å›°éš¾ï¼‰</p><p>ä¸‰ï¼Œ<a href="https://zhida.zhihu.com/search?content_id=343862019&amp;content_type=Answer&amp;match_order=1&amp;q=%E5%B8%82%E7%9B%88%E7%8E%87&amp;zhida_source=entity">å¸‚ç›ˆç‡</a>ï¼ˆè¦å¹³ç¨³ï¼Œå› ä¸ºå¸‚ç›ˆç‡æ³¢åŠ¨å¤§è¯æ˜ä¸šç»©ä¸ç¨³å®šï¼‰</p><p>å››ï¼Œå‡€èµ„äº§ï¼ˆè¦ç¨³å®šå¢åŠ ï¼Œå› ä¸ºå‡€èµ„äº§æ˜¯ä¼ä¸šçš„æ ¹åŸºï¼‰</p><p>äº”ï¼Œè¥ä¸šæ”¶å…¥ï¼ˆè¦ç¨³å®šå¢åŠ ï¼Œå› ä¸ºè¥ä¸šæ”¶å…¥æ˜¯ä¼ä¸šçš„è§„æ¨¡ï¼‰**</p><p><strong>äº†è§£å®Œäº†å®˜ç½‘ä»¥åæˆ‘ç›¸ä¿¡å¤§å®¶è‚¯å®šæœ‰å„ç§ç–‘é—®</strong>æ‰“å¼€ä¸Šäº¤æ‰€äº’åŠ¨æ˜“è¿˜æœ‰ã€æ·±äº¤æ‰€äº’åŠ¨æ˜“ã€‚å¦‚æœå¯¹ä¼ä¸šæœ‰ä¸æ¸…æ¥šçš„éƒ½å¯ä»¥é—®ä¼ä¸šçš„è‘£ç§˜ï¼Œå¦‚æœæ˜¯å¯ä»¥äº’åŠ¨çš„éƒ½ä¼šå›ç­”ï¼Œä¸èƒ½é€éœ²çš„å°±è‚¯å®šä¸èƒ½å›ç­”ã€‚æœ‰äº›ä¼ä¸šè‘£ç§˜ä¸åœ¨æ„å’ŒæŠ•èµ„è€…çš„äº’åŠ¨ï¼Œè¿™äº›ä¼ä¸šå¤§å¤šæ˜¯å›½ä¼ï¼Œæˆ–è€…æ˜¯åƒµå°¸ä¼ä¸šï¼Œè¿™æ ·çš„ä¼ä¸šéƒ½å¾ˆéš¾å¾ˆç›´æ¥çš„å’Œé«˜ç®¡æœ‰ä¸€ä¸ªäº’åŠ¨å’Œè”ç³»</p><p>**è¿˜æœ‰ä¸€ç§æ–¹æ³•****é‚£å°±æ˜¯æ‰“ç”µè¯ï¼**ç”µè¯ä¹Ÿåœ¨F10é‡Œé¢çš„å…¬å¸æ¦‚å†µï¼Œæœ‰äº›å›½ä¼çœŸçš„ä¸å¤ªæ‡‚äº’è”ç½‘ï¼Œé«˜ç®¡ä¹Ÿå¹´çºªå¤§ï¼Œæ‰€ä»¥ä»–ä»¬éƒ½æ˜¯æ¥ç”µè¯æ¥å’ŒæŠ•èµ„è€…æ²Ÿé€šçš„</p><h3 id="è‚¡ç¥¨äº¤æ˜“é¢‘ç‡">è‚¡ç¥¨äº¤æ˜“é¢‘ç‡</h3><p>äº¤æ˜“é¢‘ç‡æœ€å½±å“çš„å…¶å®æ˜¯äº¤æ˜“è´¹ï¼Œç²—ç•¥çš„ä¼°ç®—ï¼Œ1ä¸‡å—é’±äº¤æ˜“è´¹ä¸€å…±åœ¨17-24ä¹‹é—´ï¼Œå¹³å‡20å—é’±ä¸Šä¸‹ã€‚å¦‚æœæ˜¯æ¯å¤©äº¤æ˜“ï¼ŒæŒ‰ç…§ä¸€å¹´250ä¸ªäº¤æ˜“æ—¥æ¥ç®—ï¼Œäº¤æ˜“è´¹5000å—é’±ï¼**æ’é™¤æ‰äº¤æ˜“è´¹ä¸ç®—ï¼Œè‚¡ç¥¨çš„äº¤æ˜“é¢‘ç‡å¤šå°‘ä¸ºå¥½?**äº¤æ˜“æ˜¯éœ€è¦å¥‘æœºçš„ã€‚</p><ul><li><p>æœ€å¿Œè®³çš„å°±æ˜¯æƒ…ç»ªåŒ–äº¤æ˜“ï¼Œæ— ç†ç”±äº¤æ˜“</p></li><li><p>äº¤æ˜“æ˜¯è¢«åŠ¨çš„ï¼Œäº¤æ˜“çš„ä¸»ä½“æ˜¯è‚¡ç¥¨å’Œå¸‚åœºï¼Œå¸‚åœºå’Œè‚¡ç¥¨å‘ç”Ÿäº†å˜åŒ–æˆ‘ä»¬æ‰éœ€è¦ç”¨äº¤æ˜“æ¥åº”å¯¹ã€‚å¦‚æœå¸‚åœºæ²¡æœ‰å˜åŒ–ï¼Œè‚¡ç¥¨ä¹Ÿæ²¡æœ‰å˜åŒ–ï¼Œæˆ‘ä»¬ä»€ä¹ˆéƒ½ä¸åšæ‰æ˜¯æœ€å¥½çš„äº¤æ˜“ã€‚</p></li><li><p>ä»€ä¹ˆæƒ…å†µä¸‹è¦åšå–å‡ºäº¤æ˜“ï¼Ÿ</p><ul><li>çªå‘çš„é‡å¤§åˆ©ç©º</li><li>çªå‘çš„ä¸ªè‚¡åˆ©ç©º è¿™ä¸¤ä¸ªæ˜¯å¾ˆéœ€è¦å–å‡ºçš„å› ç´ ï¼Œå°¤å…¶æ˜¯ä¸ªè‚¡çš„åˆ©ç©ºï¼Œé‡å¤§çš„ä¸ªè‚¡åˆ©ç©ºä¸€èˆ¬ä¼šå¯¼è‡´ä¸ªè‚¡çŸ­æœŸæš´è·Œï¼Œåªè¦ä¸æ˜¯è·Œåœæ¿éƒ½å¯ä»¥å–å‡ºï¼Œå› ä¸ºåæœŸå¾ˆå¯èƒ½å‡ ä¸ªæœˆï¼Œç”šè‡³ä¸€å¹´éƒ½è¢«è¿™ä¸ªåˆ©ç©ºç»™å‹åˆ¶ï¼Œè¿™æ˜¯å¾ˆéœ€è¦å–å‡ºçš„ å¸‚åœºçš„åˆ©ç©ºè¿˜å¥½ï¼Œè™½ç„¶å¤§éƒ¨åˆ†è‚¡ç¥¨ä¼šè·Œï¼Œä½†æ˜¯ä¹Ÿæœ‰30%å·¦å³çš„è‚¡ç¥¨ä¸»åŠ›æ¯”è¾ƒå¼ºæˆ–è€…æ˜¯ç»è¥èƒ½åŠ›æ¯”è¾ƒå¼ºï¼Œè·Œäº†å¾ˆå¿«å°±ä¼šæ¶¨å›æ¥ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„è‚¡ç¥¨æƒ…å†µæ¥é€‰æ‹©æ˜¯å¦å–å‡º</li><li>è¾¾åˆ°ä½ çš„é¢„æœŸæ¶¨å¹…</li><li>æœ‰æ›´å¥½çš„è‚¡ç¥¨è°ƒä»“æ¢è‚¡ ä½ é¢„æœŸä¸€å¹´å°±æ˜¯10%çš„æ”¶ç›Šï¼Œé‚£ä¹ˆæ—¢ç„¶è¾¾åˆ°äº†ï¼Œä½ å½“ç„¶å¯ä»¥å–å‡ºï¼Œè¿™ä¸ªæ˜¯å¾ˆå¥½çš„çºªå¾‹ï¼Œç„¶åå°±æ˜¯ä½ å‘ç°äº†æ›´å¥½çš„è‚¡ç¥¨ï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©å–å‡ºæ¢è‚¡ã€‚</li></ul></li><li><p>ä»€ä¹ˆæƒ…å†µä¸‹è¦åšä¹°å…¥äº¤æ˜“ï¼Ÿ</p><ul><li>è‚¡å¸‚æ…¢æ…¢åœ¨èµ°ç‰›</li><li>å‘ç°äº†åŸºæœ¬é¢ç‰¹åˆ«ä¼˜è´¨ä¸”ä½ä¼°çš„è‚¡ç¥¨ è‚¡å¸‚æ…¢æ…¢æœ‰èµ°ç‰›è¿¹è±¡çš„æ—¶å€™è‚¯å®šè¦åšå¥½ä¹°å…¥çš„å‡†å¤‡ï¼Œè¿™ä¸ªæ˜¯æ¯ä¸ªè‚¡æ°‘éƒ½è¦æœ‰çš„å‡†å¤‡ï¼Œç„¶åå°±æ˜¯å‘ç°äº†ç»è¥å¾ˆå¥½ï¼Œè¿˜å¾ˆä¾¿å®œçš„è‚¡ç¥¨ï¼Œé‚£è‚¯å®šè¦å‡†å¤‡å¥½ä¹°å…¥ã€‚ è¿™æ˜¯æœ€å¥½çš„ä¸¤ä¸ªä¹°å…¥ç­–ç•¥ï¼Œä¸€ä¸ªæ˜¯å¸‚åœºä¸€ä¸ªçš„ä¸ªè‚¡ï¼Œéƒ½æ˜¯éå¸¸å¥½çš„ä¹°å…¥ç†ç”±ã€‚</li><li>åšé•¿æœŸçš„è‚¡æ¯æŠ•èµ„</li><li>å®¶åº­æŠ•èµ„é…ç½®ä»“ä½ï¼Œä¸¤ä¸ªæ˜¯è¶…é•¿çº¿æŠ•èµ„è€…çš„é€‰æ‹©ï¼Œè‚¡æ¯æŠ•èµ„è¯´å®è¯99%çš„æŠ•èµ„è€…ä»æœªæ„Ÿå—åˆ°å…¶é­…åŠ›ï¼Œå› ä¸ºå¾ˆå°‘ä»¥åæŠ•èµ„è€…å¯ä»¥æŒè‚¡ä¸åŠ¨5å¹´ä»¥ä¸Šï¼Œè‚¡æ¯æ¯å¹´å‘1-2æ¬¡ï¼Œå‘äº†ä»¥åä½ å†ä¹°å…¥è‚¡ï¼Œåå¤æœ€å°‘3-5æ¬¡æ‰ä¼šæœ‰å¾ˆå¤§çš„æ”¶ç›Šç´¯ç§¯ï¼Œå¯¹äº3å¹´ä»¥ä¸‹æŒè‚¡çš„æŠ•èµ„è€…ï¼Œå¾ˆéš¾æ„Ÿå—åˆ°è‚¡æ¯æŠ•èµ„æœ‰å¤šä¹ˆèµšé’±ã€‚å®¶åº­æŠ•èµ„é…ç½®ä»“ä½é€‚åˆå¤§èµ„é‡‘æŠ•èµ„è€…ï¼Œå¯¹äºæœ‰å¾ˆå¤šé—²é’±çš„æŠ•èµ„è€…ï¼Œå¯ä»¥é…ç½®20%çš„èµ„é‡‘åˆ°è‚¡å¸‚ï¼Œé€‰æ‹©æœ€å¥½æœ€å®‰å…¨çš„ä¸€äº›å¤§å‹ä¼ä¸šé…ç½®ï¼Œä¸€æ–¹é¢å¯ä»¥è·å¾—è‚¡æ¯ï¼Œä¸€æ–¹é¢å¯ä»¥é•¿æœŸå¾—åˆ°è‚¡å¸‚çš„å‘å±•æ”¶è·ï¼Œè¿™ä¹Ÿæ˜¯æœ€å°‘3-5å¹´ä»¥ä¸Šçš„æŠ•èµ„ç­–ç•¥ã€‚</li></ul></li></ul><h3 id="æŒ‚å•æ•™å­¦">æŒ‚å•æ•™å­¦</h3><p>å‡å¦‚æ˜¯ä¹°å…¥100è‚¡ï¼Œè‚¡ä»·1å—é’±ï¼Œé«˜äºç›®å‰è‚¡ä»·æ˜¯9æ¯›9ï¼Œé‚£ä¹ˆä½ å¯ä»¥ç›´æ¥ä¹°å…¥ï¼Œç”šè‡³çœ‹ä¸è§å•å­å‡ºç°åœ¨å±å¹•ä¸Šï¼Œå› ä¸ºç›´æ¥æˆäº¤äº†ï¼Œå‡å¦‚ä½ çš„å•å­æŒ‚çš„æ˜¯9æ¯›8ï¼Œä½äºå½“å‰è‚¡ä»·9æ¯›9ã€‚é‚£ä¹ˆå¾ˆå¯èƒ½ä¸ä¼šé©¬ä¸Šæˆäº¤ï¼Œä½ ä¼šçœ‹è§9æ¯›8çš„ä»·ä½ä¸Šé¢å¤šäº†100è‚¡çš„å•å­ã€‚ è¿™å°±æ˜¯æŒ‚å•ï¼Œå°±æ˜¯æŒ‚å‡ºå»ä½ è¦æˆäº¤çš„ä»·æ ¼ã€‚</p><p>ç”µè„‘ç«¯äº¤æ˜“æ˜¯æŒ‰f12å¯ä»¥æŒ‚å•äº¤æ˜“.</p><p>é—ªç”µæŒ‚å•å¯ä»¥è®¾ç½®çš„æ›´å¿«ï¼åªè¦åŒå‡»ç›®å‰çš„ä¸€ä¸ªä»·ä½ï¼Œè‡ªåŠ¨ä¸‹å•ï¼Œä¸æ€•æ¥ä¸åŠæŒ‚å•ï¼Œæ¯”æ™®é€šçš„F12æŒ‚å•å¿«3å€ï¼Œæ¯”é—ªç”µæŒ‚å•å¿«2å€ï¼Œå¯ä»¥èŠ‚çº¦å¿«1åˆ†é’Ÿçš„æ—¶é—´ï¼Œæœ‰æ—¶å€™å¯ä»¥æœ‰å¥½å‡ ä¸ªç‚¹çš„å·®ä»·ï¼</p><p>å¿«æ·äº¤æ˜“å¯ä»¥è®©ä½ åœ¨ä¸‹å•çš„æ—¶å€™è¿‡æ»¤é‚£äº›ç¡®è®¤çš„è¿‡ç¨‹ï¼Œè°ƒæ•´åˆ°ç‰¹å¿«</p><p>è·Ÿç›˜æ˜¯å¾ˆé‡è¦çš„è®¾ç½®ï¼Œå› ä¸ºè‚¡ä»·ä¼šæ—¶æ—¶åˆ»åˆ»å˜åŒ–ï¼Œä½ ä¹‹å‰è¾“å…¥çš„ä»·æ ¼ä¼šä¸€ç›´æ”¹å˜ï¼Œå¦‚æœä½ ä¸è®¾ç½®è‡ªåŠ¨è·Ÿç›˜ï¼Œä½ å°±è¦ä¸æ–­çš„è°ƒæ•´ä¹°å–ä»·æ ¼ï¼Œå¤ªéº»çƒ¦</p><p>è¡Œæƒ…åˆ·æ–°è®¾ç½®åˆ°1-2ç§’ï¼Œä¸è¦ç”¨é»˜è®¤çš„5ç§’ï¼Œå¤ªæ…¢äº†ï¼ä¼šé”™è¿‡çŸ­çº¿çš„æœºä¼šï¼</p><p>è®¾ç½®ä¸€ä¸‹é—²ç½®60åˆ†é’Ÿï¼Œä¸ç„¶ä½ æ¯æ¬¡è¿‡ä¸€æ®µæ—¶é—´äº¤æ˜“å°±ä¼šé”å±ï¼Œå¾ˆéº»çƒ¦ï¼Œé”å±ä»¥åè¦é‡æ–°è¾“å…¥å¯†ç </p><h3 id="æš‚å®šå¹´åŒ–10-çš„æ”¶ç›Šä¸ºå­¦ä¼šç‚’è‚¡">æš‚å®šå¹´åŒ–10%çš„æ”¶ç›Šä¸ºå­¦ä¼šç‚’è‚¡</h3><p>æœ€ä¸»æµçš„3ç§èµšé’±ç­–ç•¥</p><p>æŠ•èµ„ä¼ä¸šçš„ç»¼åˆå®åŠ›ï¼Œèµšçš„æ˜¯ä¼ä¸šæˆé•¿å’Œç¤¾ä¼šå‘å±•çš„é’±ã€</p><p>æŠ•èµ„è‚¡ä»·çš„å·®ä»·æ³¢åŠ¨ï¼Œèµšçš„æ˜¯ç­¹ç åšå¼ˆå’Œäººæ€§åšå¼ˆçš„é’±</p><p>æŠ•èµ„çƒ­ç‚¹é¢˜æçš„åˆ©å¥½ï¼Œèµšçš„æ˜¯å¸‚åœºä¸Šæ‰€æœ‰æ— è„‘éŸ­èœçš„é’±ã€</p><p><strong>æŠ•æœº+çŸ­çº¿åº”è¯¥è¿™æ ·ç©</strong>:åˆ†æå¤§ç›˜â€”é€‰çƒ­ç‚¹é¢˜æâ€”é€‰è¡Œä¸šâ€”é€‰è‚¡â€”åˆ†æä¸ªè‚¡èµ°åŠ¿â€”æ§åˆ¶ä»“ä½â€”ä¹°å…¥â€”è·Ÿè¸ªä¸ªè‚¡å¤§ç›˜èµ°åŠ¿â€”å–å‡º</p><p>çŸ­çº¿æœ€çŸ­ä¹Ÿåº”è¯¥æŠŠæ¡4å‘¨å·¦å³çš„è¡Œæƒ…ã€‚<strong>æœ€çŸ­çš„æ“ä½œå‘¨æœŸéƒ½ä¼šé¢„è®¾åœ¨4å‘¨å·¦å³ï¼Œ4å‘¨ä¹Ÿå°±æ˜¯ä¸€ä¸ªæœˆçš„çŸ­çº¿å‘¨æœŸ</strong>è¿™æ ·çš„çŸ­çº¿å‘¨æœŸæ‰èƒ½æœ‰å¯æ“ä½œæ€§å’Œå¯æ“ä½œç©ºé—´ ä»»ä½•ç›ˆåˆ©æ¦‚ç‡ä¸é«˜çš„æ“ä½œéƒ½æ²¡æœ‰å¤åˆ©çš„ä»·å€¼ï¼Œæ²¡æœ‰å¤åˆ©çš„ä»·å€¼ä¹Ÿå°±æ²¡æœ‰å»æ“ä½œçš„ç†ç”±ï¼Œå°±ç®—æ˜¯æŠ•èµ„ä¹Ÿè¦å»ºç«‹åœ¨å¯å¤åˆ©çš„åŸåˆ™ä¸Šè¿›è¡Œï¼Œè¿™æ˜¯æˆ‘å¯¹æŠ•æœºçš„è§è§£</p><p>æœ€å¥½çš„æ“ä½œä¸æ˜¯ç”±æ”¶ç›Šçš„å¤§å°å†³å®šçš„ï¼Œè€Œæ˜¯ç”±é£é™©çš„å¤§å°å†³å®šçš„</p><p>.é£é™©è¶Šå¤§çš„äº¤æ˜“ï¼Œå°±è¶Šè¦æŠŠä»“ä½æ§åˆ¶çš„è¶Šä½ã€‚æ»¡ä»“å¯¹äºä»»ä½•äººæ¥è¯´ï¼Œéƒ½æ˜¯åœ¨æŠŠé£é™©æé«˜åˆ°æœ€å¤§</p><p>æŠ•æœºï¼ŒæŠ•çš„æ˜¯æœºä¼šï¼Œä¸æ˜¯æŠ•é£é™©ï¼Œå¤šç•™ä¸€ç‚¹ç°é‡‘ï¼Œä½ å°±åœ¨è‡ªå·±åˆ›é€ æ— é™çš„æœºä¼š</p><p>æŠ•æœºï¼ŒæŠ•çš„æ˜¯æœºä¼šï¼Œä¸æ˜¯æŠ•é£é™©ï¼Œå¤šç•™ä¸€ç‚¹ç°é‡‘ï¼Œä½ å°±åœ¨è‡ªå·±åˆ›é€ æ— é™çš„æœºä¼š</p><p><strong>é•¿çº¿+ä»·å€¼æŠ•èµ„åº”è¯¥è¿™æ ·åš</strong>é€‰è‚¡â€”åˆ†æè¡Œä¸šâ€”åˆ†æä¸ªè‚¡èµ°åŠ¿â€”åˆ†æå¤§ç›˜â€”æ§åˆ¶ä»“ä½â€”æ…¢æ…¢ä¹°å…¥â€”è·Ÿè¸ªä¸ªè‚¡å’Œå¤§ç›˜èµ°åŠ¿â€”å†³å®šå‡ä»“æˆ–åŠ ä»“</p><p><strong>è´¢åŠ¡æŠ¥è¡¨è¦çœ‹çš„æ˜¯ä¼ä¸šçš„å‘å±•å‰æ™¯è€Œéè¡¨é¢çš„æ•°æ®</strong>ä»·å€¼æŠ•èµ„èµšå¤§é’±æ›´éœ€è¦æŠ“ä½å¥½ä¼ä¸šçŸ­æš‚çš„ç»è¥å›°éš¾æœŸï¼ŒæŠ“ä½å¥½ä¼ä¸šçš„å‘¨æœŸæ€§æœºä¼šï¼Œè¿™ç§æ—¶å€™å¥½ä¼ä¸šå› ä¸ºä¸šç»©ä¸å¥½å¯¼è‡´è‚¡ä»·æš´è·Œï¼Œè¿™å°±æ˜¯å¤§æœºä¼š.è¿™å°±æ˜¯æœ€é«˜çº§çš„ä»·å€¼æŠ•èµ„ï¼Œå› ä¸ºç­‰ä½ çœŸæ­£çœ‹è§éå¸¸å¥½çš„è´¢åŠ¡æŠ¥è¡¨æ—¶ï¼Œè‚¡ä»·è‚¯å®šåœ¨é«˜ä½</p><p>**ä¸ç®¡ä½ æ˜¯ä»€ä¹ˆæŠ•èµ„è€…ï¼Œé•¿çº¿ï¼ŒçŸ­çº¿ï¼Œä»·å€¼ï¼Œæ³¢çŸ­ï¼Œå„ç§æŠ•èµ„è€…ä½ éƒ½éœ€è¦é‡è§†è‚¡æœ¬****è‚¡æœ¬å¤ªå¤§ä»£è¡¨ä»€ä¹ˆï¼Ÿ**å¸‚åœºä¸Šè‚¡ä»½å¾ˆå¤šï¼ŒæŠ•èµ„è€…æ•°é‡å¯èƒ½å¾ˆå¤šï¼Œèµ„é‡‘å±‚é¢ä¸Šå°±ä¼šå¯¼è‡´ç­¹ç å¾ˆåˆ†æ•£ï¼Œä¸å®¹æ˜“å¤§æ¶¨ã€‚</p><p><strong>è‚¡æœ¬å°çš„è‚¡ç¥¨æ›´å®¹æ˜“æ”¶é›†ç­¹ç ï¼Œæ‹‰å‡èµ·æ¥æ›´æµç•…ã€‚</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;è¯åˆ¸æŠ•èµ„è®¡åˆ’&lt;/h1&gt;
&lt;h1&gt;å½“å‰ç»æµç¯å¢ƒåˆ†æ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä½åˆ©ç‡ç¯å¢ƒ&lt;/strong&gt;ï¼šä¸­å›½ç›®å‰å¤„äºä½åˆ©ç‡å‘¨æœŸï¼Œå¤®è¡Œé€šè¿‡é™å‡†ã€é™æ¯ç­‰æ‰‹æ®µåˆºæ¿€ç»æµï¼Œå¯¼è‡´å›½å€ºæ”¶ç›Šç‡è¾ƒä½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€šèƒ€æ°´å¹³&lt;/strong&gt;ï¼šå½“å‰é€š</summary>
      
    
    
    
    <category term="éšä¾¿å­¦ç‚¹" scheme="http://outbreak-sen.github.io/categories/%E9%9A%8F%E4%BE%BF%E5%AD%A6%E7%82%B9/"/>
    
    
    <category term="è¯åˆ¸æŠ•èµ„" scheme="http://outbreak-sen.github.io/tags/%E8%AF%81%E5%88%B8%E6%8A%95%E8%B5%84/"/>
    
  </entry>
  
  <entry>
    <title>MindNLPæ¨¡å‹å¾®è°ƒè¶…çº§ç¬”è®°</title>
    <link href="http://outbreak-sen.github.io/2025/02/26/MindNLP-bigbird_pegasus%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/"/>
    <id>http://outbreak-sen.github.io/2025/02/26/MindNLP-bigbird_pegasus%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/</id>
    <published>2025-02-26T07:01:44.000Z</published>
    <updated>2025-03-19T09:14:02.907Z</updated>
    
    <content type="html"><![CDATA[<h1>MindNLPæ¨¡å‹å¾®è°ƒè¶…çº§ç¬”è®°</h1><h2 id="ä¹±ä¸ƒå…«ç³Ÿçš„å­¦ä¹ å‚è€ƒ">ä¹±ä¸ƒå…«ç³Ÿçš„å­¦ä¹ å‚è€ƒ</h2><h3 id="å·²å®Œæˆçš„bloomæ¨¡å‹å¾®è°ƒ">å·²å®Œæˆçš„bloomæ¨¡å‹å¾®è°ƒ</h3><p><a href="https://github.com/mindspore-lab/mindnlp/pull/1907">pullé“¾æ¥</a>è¿™é‡Œé¢åªæœ‰è®­ç»ƒçš„éƒ¨åˆ†ç»“æœï¼Œç„¶åè®²çš„æ˜¯å®ç°äº†bloom-3båœ¨databricks-dolly-15kæ•°æ®é›†ä¸Šé¢çš„loraå¾®è°ƒï¼Œä¸çŸ¥é“è¿™ä¸ªpytorchçš„è®­ç»ƒè¿‡ç¨‹æ˜¯ä»å“ªæ¥çš„ï¼Œç„¶åå‘ç°<strong>loraå¾®è°ƒæ˜¯ä¸€ç§å¾®è°ƒæ–¹æ³•</strong>ï¼Œç„¶åè¿™é‡Œèƒ½å¤Ÿæ‰¾åˆ°ä»–forkçš„ä»“åº“ï¼Œ<strong>åœ¨mindNLPä»“åº“æ˜¯çœ‹ä¸åˆ°æ”¹åŠ¨çš„ï¼Œéœ€è¦å»ä»–æäº¤pullrequstçš„forkçš„ä»“åº“ï¼Œç„¶ååœ¨è¿™é‡Œç‚¹å‡»å¯ä»¥åˆ°ä»–forkçš„ä»“åº“</strong>ï¼Œ<a href="https://github.com/guyueyuan/mindnlp/tree/intern">forkçš„ä»“åº“</a>ï¼ŒåŒæ—¶å¯ä»¥çœ‹åˆ°è¿™é‡Œforkåçš„ä»“åº“é‡æ–°åˆ›å»ºçš„åˆ†æ”¯å«åšinternï¼Œç„¶åæŸ¥çœ‹commitæ”¹å†²åœ¨å“ªé‡Œï¼Œæ‰¾åˆ°å‘ç°åœ¨è¿™é‡Œ<a href="https://github.com/guyueyuan/mindnlp/tree/intern">mindnlp</a>/<a href="https://github.com/guyueyuan/mindnlp/tree/intern/llm">llm</a>/<a href="https://github.com/guyueyuan/mindnlp/tree/intern/llm/finetune">finetune</a>/<a href="https://github.com/guyueyuan/mindnlp/tree/intern/llm/finetune/bloom">bloom</a>/<a href="https://github.com/guyueyuan/mindnlp/tree/intern/llm/finetune/bloom/bloom-3b-qlora">bloom-3b-qlora</a>ï¼Œä¹Ÿå°±æ˜¯è¯´ä»»åŠ¡æ˜¯å¾®è°ƒçš„è¯å°±æŠŠä»£ç æ”¾åœ¨llm/finetuneè¿™ä¸ªç›®å½•ä¸‹ï¼Œç„¶åå¯¹æ¯”å®˜æ–¹çš„mindsporeçš„ä»“åº“å‘ç°ç¡®å®è¿™é‡Œpull requstä¹‹åå°±æ²¡æœ‰åˆè¿›å»<a href="https://github.com/mindspore-lab/mindnlp/tree/master">mindnlp</a>/<a href="https://github.com/mindspore-lab/mindnlp/tree/master/llm">llm</a>/<a href="https://github.com/mindspore-lab/mindnlp/tree/master/llm/finetune">finetune</a>/bloom</p><p>ã€‚æ€»ç»“å°±æ˜¯è¿™æ˜¯æäº¤ä»£ç çš„æ–¹æ³•ã€‚</p><p>ç„¶åè¿™ä¸ªmindNLPåšçš„æ˜¯ä»€ä¹ˆï¼Ÿè¿™é‡Œé¢æœ‰æ¨¡å‹å’Œè®­ç»ƒå¥½çš„å‚æ•°ï¼Œcloneåˆ°æœ¬åœ°ä¹‹åå¯ä»¥ç”¨ï¼Œå…¶ä¸­çš„å¼€æºçš„æ¨¡å‹ï¼Œæ˜¯åä¸ºè‡ªå·±å¼€å‘çš„ï¼Œç„¶åæä¾›äº†loraå’Œpeftå¾®è°ƒçš„å·¥å…·ï¼Œä¹‹åæˆ‘ä»¬å°±å¯ä»¥åŸºäºè¿™ä¸ªmindNLPè¿›è¡Œæ“ä½œï¼Œå’Œä»–åŠŸèƒ½ç±»ä¼¼çš„è¿˜æœ‰huggingface çš„transformåº“</p><ul><li><strong>LoRA</strong> æ˜¯ä¸€ç§é€šè¿‡ä½ç§©åˆ†è§£å®ç°å‚æ•°é«˜æ•ˆå¾®è°ƒçš„æŠ€æœ¯ã€‚</li><li><strong>PEFT</strong> æ˜¯ä¸€ç±»å‚æ•°é«˜æ•ˆå¾®è°ƒæŠ€æœ¯çš„ç»Ÿç§°ï¼ŒåŒ…æ‹¬ LoRAã€Adapterã€Prefix Tuning ç­‰ã€‚</li><li>åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒLoRA æ˜¯æœ€å¸¸ç”¨çš„ PEFT æ–¹æ³•ä¹‹ä¸€ï¼Œé€‚åˆå¤§æ¨¡å‹çš„å¾®è°ƒä»»åŠ¡ã€‚å¦‚æœä½ éœ€è¦å¿«é€Ÿå®ç°å‚æ•°é«˜æ•ˆå¾®è°ƒï¼Œå¯ä»¥ä½¿ç”¨ Hugging Face çš„ <code>peft</code> åº“ï¼Œç»“åˆ LoRA æˆ–å…¶ä»– PEFT æ–¹æ³•ã€‚</li></ul><h3 id="å¦‚ä½•è¿›è¡Œæ¨¡å‹å¾®è°ƒ">å¦‚ä½•è¿›è¡Œæ¨¡å‹å¾®è°ƒ</h3><p><a href="https://www.mindspore.cn/tutorials/zh-CN/r1.3/intermediate/image_and_video/fine_tune.html">åˆ†å‰²ç½‘ç»œMaskRCNNå¾®è°ƒï¼Œè¿™ä¸ªå¥½</a></p><p><a href="https://www.mindspore.cn/docs/programming_guide/zh-CN/r1.5/cv_mobilenetv2_fine_tune.html">MobileNetV2å¾®è°ƒ</a></p><p>ä»å¤´å¼€å§‹è®­ç»ƒç½‘ç»œï¼Œéœ€è¦æ¶ˆè€—å¤§é‡çš„æ—¶é—´ä¸è®¡ç®—èƒ½åŠ›ï¼Œæ¨¡å‹å®¹æ˜“é™·å…¥å±€éƒ¨æå°å€¼å’Œè¿‡æ‹Ÿåˆã€‚</p><p>å¤§éƒ¨åˆ†ä»»åŠ¡éƒ½ä¼šé€‰æ‹©é¢„è®­ç»ƒæ¨¡å‹ï¼Œåœ¨å…¶ä¸Šåšå¾®è°ƒï¼ˆä¹Ÿç§°ä¸ºFine Tuneï¼‰ã€‚é¢„è®­ç»ƒæ¨¡å‹é€‰æ‹©çš„å¸¸è§çš„OpenImageã€ImageNetã€VOCã€COCOç­‰å…¬å¼€å¤§å‹æ•°æ®é›†</p><p>ä¸åŒæ•°æ®é›†å’Œä»»åŠ¡ä¸­ç‰¹å¾æå–å±‚ï¼ˆå·ç§¯å±‚ï¼‰åˆ†å¸ƒè¶‹äºä¸€è‡´ï¼Œä½†æ˜¯ç‰¹å¾å‘é‡çš„ç»„åˆï¼ˆå…¨è¿æ¥å±‚ï¼‰ä¸ç›¸åŒï¼Œåˆ†ç±»æ•°é‡ï¼ˆå…¨è¿æ¥å±‚output_sizeï¼‰é€šå¸¸ä¹Ÿä¸ä¸€è‡´ã€‚</p><ul><li>åœ¨å¾®è°ƒæ—¶ï¼ŒåªåŠ è½½ä¸è®­ç»ƒç‰¹å¾æå–å±‚å‚æ•°ï¼Œä¸åŠ è½½ä¸è®­ç»ƒå…¨è¿æ¥å±‚å‚æ•°ï¼›</li><li>åœ¨å¾®è°ƒè®­ç»ƒæ¨¡å¼ä¸‹ï¼Œéœ€è¦å°†é¢„è®­ç»ƒæ¨¡å‹åŠ è½½å…¥<code>backbone_net</code>å­ç½‘ç»œï¼Œå¹¶ä¸”å†»ç»“<code>backbone_net</code>ä¸­çš„å‚æ•°ï¼Œ param.requires_grad = Falseï¼Œä¸å‚ä¸è®­ç»ƒã€‚</li><li>åœ¨å¾®è°ƒä¸åˆå§‹è®­ç»ƒæ—¶ï¼ŒåŠ è½½ä¸è®­ç»ƒ ç‰¹å¾æå–å±‚å‚æ•°ä¸å…¨è¿æ¥å±‚å‚æ•°ã€‚</li></ul><p>æ ¹æ®å¾®è°ƒçš„å‚æ•°å æ¯”åˆ†ä¸ºï¼š</p><ol><li>å…¨é‡å¾®è°ƒï¼ˆFull Fine-Tuningï¼‰</li></ol><p>å…¨é‡å¾®è°ƒåˆ©ç”¨ç‰¹å®šä»»åŠ¡æ•°æ®è°ƒæ•´é¢„è®­ç»ƒæ¨¡å‹çš„æ‰€æœ‰å‚æ•°ï¼Œä»¥å……åˆ†é€‚åº”æ–°ä»»åŠ¡ã€‚å®ƒä¾èµ–å¤§è§„æ¨¡è®¡ç®—èµ„æºï¼Œä½†èƒ½æœ‰æ•ˆåˆ©ç”¨é¢„è®­ç»ƒæ¨¡å‹çš„é€šç”¨ç‰¹å¾ã€‚</p><ol start="2"><li>å‚æ•°é«˜æ•ˆå¾®è°ƒï¼ˆParameter-Efficient Fine-Tuning, PEFTï¼‰</li></ol><p>PEFTæ—¨åœ¨é€šè¿‡æœ€å°åŒ–å¾®è°ƒå‚æ•°æ•°é‡å’Œè®¡ç®—å¤æ‚åº¦ï¼Œå®ç°é«˜æ•ˆçš„è¿ç§»å­¦ä¹ ã€‚å®ƒä»…æ›´æ–°æ¨¡å‹ä¸­çš„éƒ¨åˆ†å‚æ•°ï¼Œæ˜¾è‘—é™ä½è®­ç»ƒæ—¶é—´å’Œæˆæœ¬ï¼Œé€‚ç”¨äºè®¡ç®—èµ„æºæœ‰é™çš„æƒ…å†µã€‚PEFTæŠ€æœ¯åŒ…æ‹¬Prefix Tuningã€Prompt Tuningã€Adapter Tuningç­‰å¤šç§æ–¹æ³•ï¼Œå¯æ ¹æ®ä»»åŠ¡å’Œæ¨¡å‹éœ€æ±‚çµæ´»é€‰æ‹©ã€‚</p><pre><code>Prefix Tuning    æ–¹æ³•ï¼šåœ¨è¾“å…¥å‰æ·»åŠ å¯å­¦ä¹ çš„virtual tokensä½œä¸ºPrefixã€‚    ç‰¹ç‚¹ï¼šä»…æ›´æ–°Prefixå‚æ•°ï¼ŒTransformerå…¶ä»–éƒ¨åˆ†å›ºå®šã€‚    ä¼˜ç‚¹ï¼šå‡å°‘éœ€è¦æ›´æ–°çš„å‚æ•°æ•°é‡ï¼Œæé«˜è®­ç»ƒæ•ˆç‡ã€‚Prompt Tuning    æ–¹æ³•ï¼šåœ¨è¾“å…¥å±‚åŠ å…¥prompt tokensã€‚    ç‰¹ç‚¹ï¼šç®€åŒ–ç‰ˆçš„Prefix Tuningï¼Œæ— éœ€MLPè°ƒæ•´ã€‚    ä¼˜ç‚¹ï¼šéšç€æ¨¡å‹è§„æ¨¡å¢å¤§ï¼Œæ•ˆæœæ¥è¿‘full fine-tuningã€‚P-Tuning    æ–¹æ³•ï¼šå°†Promptè½¬æ¢ä¸ºå¯å­¦ä¹ çš„Embeddingå±‚ï¼Œå¹¶ç”¨MLP+LSTMå¤„ç†ã€‚    ç‰¹ç‚¹ï¼šè§£å†³Promptæ„é€ å¯¹ä¸‹æ¸¸ä»»åŠ¡æ•ˆæœçš„å½±å“ã€‚    ä¼˜ç‚¹ï¼šæä¾›æ›´å¤§çš„çµæ´»æ€§å’Œæ›´å¼ºçš„è¡¨ç¤ºèƒ½åŠ›ã€‚P-Tuning v2    æ–¹æ³•ï¼šåœ¨å¤šå±‚åŠ å…¥Prompt tokensã€‚    ç‰¹ç‚¹ï¼šå¢åŠ å¯å­¦ä¹ å‚æ•°æ•°é‡ï¼Œå¯¹æ¨¡å‹é¢„æµ‹äº§ç”Ÿæ›´ç›´æ¥å½±å“ã€‚    ä¼˜ç‚¹ï¼šåœ¨ä¸åŒä»»åŠ¡å’Œæ¨¡å‹è§„æ¨¡ä¸Šå®ç°æ›´å¥½çš„æ€§èƒ½ã€‚Adapter Tuning    æ–¹æ³•ï¼šè®¾è®¡Adapterç»“æ„å¹¶åµŒå…¥Transformerä¸­ã€‚    ç‰¹ç‚¹ï¼šä»…å¯¹æ–°å¢çš„Adapterç»“æ„è¿›è¡Œå¾®è°ƒï¼ŒåŸæ¨¡å‹å‚æ•°å›ºå®šã€‚    ä¼˜ç‚¹ï¼šä¿æŒé«˜æ•ˆæ€§çš„åŒæ—¶å¼•å…¥å°‘é‡é¢å¤–å‚æ•°ã€‚LoRA    æ–¹æ³•ï¼šåœ¨çŸ©é˜µç›¸ä¹˜æ¨¡å—ä¸­å¼•å…¥ä½ç§©çŸ©é˜µæ¥æ¨¡æ‹Ÿfull fine-tuningã€‚    ç‰¹ç‚¹ï¼šæ›´æ–°è¯­è¨€æ¨¡å‹ä¸­çš„å…³é”®ä½ç§©ç»´åº¦ã€‚    ä¼˜ç‚¹ï¼šå®ç°é«˜æ•ˆçš„å‚æ•°è°ƒæ•´ï¼Œé™ä½è®¡ç®—å¤æ‚åº¦ã€‚</code></pre><h3 id="å› æœè¯­è¨€æ¨¡å‹-causal-language-model-clm"><strong>å› æœè¯­è¨€æ¨¡å‹ï¼ˆCausal Language Model, CLMï¼‰</strong></h3><h4 id="æ¦‚å¿µ">æ¦‚å¿µ</h4><p>å› æœè¯­è¨€æ¨¡å‹æ˜¯ä¸€ç§ç”Ÿæˆå¼æ¨¡å‹ï¼Œç”¨äºé¢„æµ‹åºåˆ—ä¸­ä¸‹ä¸€ä¸ªè¯ï¼ˆæˆ– tokenï¼‰çš„æ¦‚ç‡åˆ†å¸ƒã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯ï¼š</p><ul><li><strong>è‡ªå›å½’ï¼ˆAutoregressiveï¼‰</strong>ï¼šæ¨¡å‹æ ¹æ®å‰é¢çš„è¯ç”Ÿæˆåé¢çš„è¯ï¼Œæ¯æ¬¡ç”Ÿæˆä¸€ä¸ªè¯ã€‚</li><li><strong>å•å‘ä¸Šä¸‹æ–‡</strong>ï¼šæ¨¡å‹åªèƒ½åˆ©ç”¨å½“å‰è¯ä¹‹å‰çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè€Œä¸èƒ½åˆ©ç”¨åé¢çš„ä¿¡æ¯ã€‚</li></ul><h4 id="å…¸å‹åº”ç”¨">å…¸å‹åº”ç”¨</h4><ul><li><strong>æ–‡æœ¬ç”Ÿæˆ</strong>ï¼šå¦‚æ•…äº‹ç”Ÿæˆã€å¯¹è¯ç”Ÿæˆã€ä»£ç ç”Ÿæˆç­‰ã€‚</li><li><strong>è¯­è¨€å»ºæ¨¡</strong>ï¼šè®¡ç®—ä¸€æ®µæ–‡æœ¬çš„æ¦‚ç‡ï¼Œæˆ–ç”Ÿæˆç¬¦åˆè¯­è¨€è§„å¾‹çš„æ–‡æœ¬ã€‚</li></ul><h4 id="ç¤ºä¾‹">ç¤ºä¾‹</h4><ul><li>ç»™å®šè¾“å…¥åºåˆ— <code>[&quot;I&quot;, &quot;love&quot;, &quot;to&quot;]</code>ï¼Œæ¨¡å‹ä¼šé¢„æµ‹ä¸‹ä¸€ä¸ªè¯å¯èƒ½æ˜¯ <code>&quot;eat&quot;</code>ã€<code>&quot;play&quot;</code> ç­‰ã€‚</li></ul><h4 id="å¸¸è§æ¨¡å‹">å¸¸è§æ¨¡å‹</h4><ul><li><strong>GPT ç³»åˆ—</strong>ï¼ˆå¦‚ GPT-2ã€GPT-3ï¼‰ï¼šOpenAI å¼€å‘çš„å› æœè¯­è¨€æ¨¡å‹ã€‚</li><li><strong>Bloom</strong>ï¼šBigScience å¼€å‘çš„å¤šè¯­è¨€å› æœè¯­è¨€æ¨¡å‹ã€‚</li><li><strong>LLaMA</strong>ï¼šMeta å¼€å‘çš„é«˜æ•ˆå› æœè¯­è¨€æ¨¡å‹ã€‚</li></ul><h3 id="åˆ†è¯å™¨-tokenizer"><strong>åˆ†è¯å™¨ï¼ˆTokenizerï¼‰</strong></h3><h4 id="æ¦‚å¿µ">æ¦‚å¿µ</h4><p>åˆ†è¯å™¨æ˜¯å°†åŸå§‹æ–‡æœ¬è½¬æ¢ä¸ºæ¨¡å‹å¯ä»¥ç†è§£çš„è¾“å…¥æ ¼å¼çš„å·¥å…·ã€‚å®ƒçš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</p><ul><li><strong>åˆ†è¯ï¼ˆTokenizationï¼‰</strong>ï¼šå°†æ–‡æœ¬åˆ†å‰²æˆè¯æˆ–å­è¯ï¼ˆsubwordï¼‰ã€‚</li><li><strong>ç¼–ç ï¼ˆEncodingï¼‰</strong>ï¼šå°†åˆ†è¯åçš„ç»“æœè½¬æ¢ä¸ºæ¨¡å‹è¾“å…¥çš„æ•°å­— IDï¼ˆ<code>input_ids</code>ï¼‰ã€‚</li><li><strong>è§£ç ï¼ˆDecodingï¼‰</strong>ï¼šå°†æ¨¡å‹è¾“å‡ºçš„æ•°å­— ID è½¬æ¢å›æ–‡æœ¬ã€‚</li></ul><h4 id="åˆ†è¯æ–¹å¼">åˆ†è¯æ–¹å¼</h4><ol><li><p><strong>è¯çº§åˆ«åˆ†è¯</strong>ï¼š</p><ul><li>å°†æ–‡æœ¬æŒ‰ç©ºæ ¼æˆ–æ ‡ç‚¹ç¬¦å·åˆ†å‰²æˆè¯ã€‚</li><li>ä¾‹å¦‚ï¼š<code>&quot;I love NLP&quot;</code> â†’ <code>[&quot;I&quot;, &quot;love&quot;, &quot;NLP&quot;]</code>ã€‚</li></ul></li><li><p><strong>å­è¯çº§åˆ«åˆ†è¯</strong>ï¼š</p><ul><li>å°†è¯è¿›ä¸€æ­¥åˆ†å‰²ä¸ºæ›´å°çš„å­è¯å•å…ƒï¼Œä»¥è§£å†³æœªç™»å½•è¯ï¼ˆOOVï¼‰é—®é¢˜ã€‚</li><li>ä¾‹å¦‚ï¼š<code>&quot;unhappiness&quot;</code> â†’ <code>[&quot;un&quot;, &quot;happiness&quot;]</code>ã€‚</li></ul></li><li><p><strong>å­—ç¬¦çº§åˆ«åˆ†è¯</strong>ï¼š</p><ul><li>å°†æ–‡æœ¬åˆ†å‰²ä¸ºå•ä¸ªå­—ç¬¦ã€‚</li><li>ä¾‹å¦‚ï¼š<code>&quot;NLP&quot;</code> â†’ <code>[&quot;N&quot;, &quot;L&quot;, &quot;P&quot;]</code>ã€‚</li></ul></li></ol><h4 id="å¸¸è§åˆ†è¯å™¨">å¸¸è§åˆ†è¯å™¨</h4><ul><li><strong>Byte-Pair Encoding (BPE)</strong>ï¼šå¦‚ GPT ç³»åˆ—ä½¿ç”¨çš„åˆ†è¯å™¨ã€‚</li><li><strong>WordPiece</strong>ï¼šå¦‚ BERT ä½¿ç”¨çš„åˆ†è¯å™¨ã€‚</li><li><strong>SentencePiece</strong>ï¼šå¦‚ Bloom å’Œ LLaMA ä½¿ç”¨çš„åˆ†è¯å™¨ã€‚</li></ul><hr><h4 id="ä¸€ä¸ªæ¨¡å‹å¯¹åº”ä¸€ä¸ªåˆ†è¯å™¨ï¼Ÿ"><strong>ä¸€ä¸ªæ¨¡å‹å¯¹åº”ä¸€ä¸ªåˆ†è¯å™¨ï¼Ÿ</strong></h4><p><strong>æ¨¡å‹å’Œåˆ†è¯å™¨çš„åŒ¹é…</strong>ï¼šä¸€ä¸ªæ¨¡å‹é€šå¸¸å¯¹åº”ä¸€ä¸ªç‰¹å®šçš„åˆ†è¯å™¨ï¼Œåˆ†è¯å™¨çš„è¯æ±‡è¡¨å’Œåˆ†è¯æ–¹å¼å¿…é¡»ä¸æ¨¡å‹ä¸€è‡´ã€‚æ˜¯çš„ï¼Œ<strong>ä¸€ä¸ªæ¨¡å‹é€šå¸¸å¯¹åº”ä¸€ä¸ªç‰¹å®šçš„åˆ†è¯å™¨</strong>ã€‚åŸå› å¦‚ä¸‹ï¼š</p><h4 id="1-åˆ†è¯å™¨å’Œæ¨¡å‹çš„åŒ¹é…">ï¼ˆ1ï¼‰åˆ†è¯å™¨å’Œæ¨¡å‹çš„åŒ¹é…</h4><ul><li>åˆ†è¯å™¨çš„åˆ†è¯æ–¹å¼å’Œè¯æ±‡è¡¨ï¼ˆvocabularyï¼‰å¿…é¡»ä¸æ¨¡å‹è®­ç»ƒæ—¶ä½¿ç”¨çš„åˆ†è¯å™¨ä¸€è‡´ã€‚</li><li>å¦‚æœåˆ†è¯å™¨ä¸åŒ¹é…ï¼Œæ¨¡å‹å¯èƒ½æ— æ³•æ­£ç¡®ç†è§£è¾“å…¥ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</li></ul><h4 id="2-è¯æ±‡è¡¨çš„ä¸€è‡´æ€§">ï¼ˆ2ï¼‰è¯æ±‡è¡¨çš„ä¸€è‡´æ€§</h4><ul><li>æ¨¡å‹çš„è¾“å…¥æ˜¯åˆ†è¯å™¨ç”Ÿæˆçš„ <code>input_ids</code>ï¼Œè¿™äº› ID æ˜¯åŸºäºåˆ†è¯å™¨çš„è¯æ±‡è¡¨æ˜ å°„çš„ã€‚</li><li>å¦‚æœåˆ†è¯å™¨çš„è¯æ±‡è¡¨ä¸æ¨¡å‹ä¸åŒ¹é…ï¼Œ<code>input_ids</code> çš„æ˜ å°„ä¼šå‡ºé”™ã€‚</li></ul><h4 id="3-ç‰¹æ®Š-token-çš„å¤„ç†">ï¼ˆ3ï¼‰ç‰¹æ®Š token çš„å¤„ç†</h4><ul><li>åˆ†è¯å™¨ä¼šæ·»åŠ ä¸€äº›ç‰¹æ®Š tokenï¼ˆå¦‚ <code>[CLS]</code>ã€<code>[SEP]</code>ã€<code>[PAD]</code>ï¼‰ï¼Œè¿™äº› token åœ¨æ¨¡å‹ä¸­æœ‰ç‰¹å®šçš„å«ä¹‰ã€‚</li><li>å¦‚æœåˆ†è¯å™¨ä¸åŒ¹é…ï¼Œç‰¹æ®Š token çš„å¤„ç†å¯èƒ½ä¼šå‡ºé”™ã€‚</li></ul><h4 id="ç¤ºä¾‹">ç¤ºä¾‹</h4><ul><li><strong>Bloom æ¨¡å‹</strong>ï¼šå¿…é¡»ä½¿ç”¨ <code>BloomTokenizerFast</code> æˆ– <code>BloomTokenizer</code>ã€‚</li><li><strong>GPT æ¨¡å‹</strong>ï¼šå¿…é¡»ä½¿ç”¨ <code>GPT2Tokenizer</code> æˆ– <code>GPT2TokenizerFast</code>ã€‚</li><li><strong>BERT æ¨¡å‹</strong>ï¼šå¿…é¡»ä½¿ç”¨ <code>BertTokenizer</code> æˆ– <code>BertTokenizerFast</code>ã€‚</li></ul><hr><h4 id="å¦‚ä½•åŠ è½½æ¨¡å‹å’Œåˆ†è¯å™¨ï¼Ÿ"><strong>å¦‚ä½•åŠ è½½æ¨¡å‹å’Œåˆ†è¯å™¨ï¼Ÿ</strong></h4><p>ä»¥ Hugging Face çš„ <code>transformers</code> åº“ä¸ºä¾‹ï¼š</p><h4 id="åŠ è½½æ¨¡å‹å’Œåˆ†è¯å™¨">åŠ è½½æ¨¡å‹å’Œåˆ†è¯å™¨</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoModelForCausalLM, AutoTokenizer</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½æ¨¡å‹å’Œåˆ†è¯å™¨</span></span><br><span class="line">model_name = <span class="string">&quot;bigscience/bloom-560m&quot;</span></span><br><span class="line">model = AutoModelForCausalLM.from_pretrained(model_name)</span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(model_name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tokenizer = BertTokenizer.from_pretrained(<span class="string">&quot;bert-base-cased&quot;</span>)</span><br><span class="line">tokenizer(<span class="string">&quot;Using a Transformer network is simple&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#123;&#x27;input_ids&#x27;: [101, 7993, 170, 11303, 1200, 2443, 1110, 3014, 102],</span></span><br><span class="line"><span class="string"> &#x27;token_type_ids&#x27;: [0, 0, 0, 0, 0, 0, 0, 0, 0],</span></span><br><span class="line"><span class="string"> &#x27;attention_mask&#x27;: [1, 1, 1, 1, 1, 1, 1, 1, 1]&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨åˆ†è¯å™¨">ä½¿ç”¨åˆ†è¯å™¨</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ†è¯å’Œç¼–ç </span></span><br><span class="line">text = <span class="string">&quot;I love NLP&quot;</span></span><br><span class="line">inputs = tokenizer(text, return_tensors=<span class="string">&quot;pt&quot;</span>)  <span class="comment"># è¿”å› PyTorch å¼ é‡</span></span><br><span class="line"><span class="built_in">print</span>(inputs)</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š&#123;&#x27;input_ids&#x27;: tensor([[ 100,  123, 4567]]), &#x27;attention_mask&#x27;: tensor([[1, 1, 1]])&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£ç </span></span><br><span class="line">output_ids = model.generate(inputs[<span class="string">&quot;input_ids&quot;</span>])</span><br><span class="line">output_text = tokenizer.decode(output_ids[<span class="number">0</span>], skip_special_tokens=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(output_text)</span><br></pre></td></tr></table></figure><hr><h2 id="å¼€å§‹å®è·µ">å¼€å§‹å®è·µ</h2><p><strong>æ”¯æŒå¾®è°ƒçš„æ¨¡å‹å’Œæ•°æ®é›†å¤§å‹è¯­è¨€æ¨¡å‹é€šè¿‡å¾®è°ƒå¯ä»¥é€‚åº”ä¸åŒä»»åŠ¡ï¼Œè€Œä¸­æ–‡å¾®è°ƒæ•°æ®é›†ä¸ºæ¨¡å‹åœ¨ä¸­æ–‡é¢†åŸŸçš„åº”ç”¨æä¾›äº†å…³é”®èµ„æºã€‚</strong></p><p><img src="MindNLP-bigbird_pegasus%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/0441ccee9040588a9eadb3f6562eeefc.png" alt="å›¾ç‰‡"></p><p>å¸¸ç”¨ä¸­æ–‡å¾®è°ƒæ•°æ®é›†å¯èƒ½åŒ…æ‹¬ï¼š</p><pre><code>ä¸­æ–‡é—®ç­”æ•°æ®é›†ï¼ˆå¦‚CMRC 2018ã€DRCDç­‰ï¼‰ï¼Œç”¨äºè®­ç»ƒé—®ç­”ç³»ç»Ÿã€‚ä¸­æ–‡æƒ…æ„Ÿåˆ†ææ•°æ®é›†ï¼ˆå¦‚ChnSentiCorpã€Fudan Newsç­‰ï¼‰ï¼Œç”¨äºè®­ç»ƒæƒ…æ„Ÿåˆ†ç±»æ¨¡å‹ã€‚ä¸­æ–‡æ–‡æœ¬ç›¸ä¼¼åº¦æ•°æ®é›†ï¼ˆå¦‚LCQMCã€BQ Corpusç­‰ï¼‰ï¼Œç”¨äºè®­ç»ƒå¥å­å¯¹åŒ¹é…å’Œç›¸ä¼¼åº¦åˆ¤æ–­ä»»åŠ¡ã€‚ä¸­æ–‡æ‘˜è¦ç”Ÿæˆæ•°æ®é›†ï¼ˆå¦‚LCSTSã€NLPCCç­‰ï¼‰ï¼Œç”¨äºè®­ç»ƒæ–‡æœ¬æ‘˜è¦ç”Ÿæˆæ¨¡å‹ã€‚ä¸­æ–‡å¯¹è¯æ•°æ®é›†ï¼ˆå¦‚LCCCã€ECDTç­‰ï¼‰ï¼Œç”¨äºè®­ç»ƒèŠå¤©æœºå™¨äººæˆ–å¯¹è¯ç³»ç»Ÿã€‚</code></pre><p><a href="https://hugging-face.cn/docs/transformers/model_doc/bigbird_pegasus#google_vignette">è¿™é‡Œæœ‰ä¸€ä¸ªhuggingfaceçš„æ–‡æ¡£ï¼Œç‰¹åˆ«å¥½</a></p><p><a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/dataset.html">mindNLPä¸­æœ‰çš„æ•°æ®é›†</a></p><p>è¿™ä¸ªhuggingfaceæ”¯æŒå„ç§ä»»åŠ¡</p><h4 id="1-åºåˆ—åˆ†ç±»ä»»åŠ¡-sequence-classification"><strong>(1) åºåˆ—åˆ†ç±»ä»»åŠ¡ï¼ˆSequence Classificationï¼‰</strong></h4><ul><li><strong>ç‰¹ç‚¹</strong>ï¼šå°†æ–‡æœ¬åˆ†ç±»åˆ°é¢„å®šä¹‰çš„ç±»åˆ«ï¼ˆå¦‚æƒ…æ„Ÿåˆ†ç±»ã€åƒåœ¾é‚®ä»¶æ£€æµ‹ï¼‰ï¼Œè¾“å‡ºå±‚ä»…éœ€æ·»åŠ ä¸€ä¸ªåˆ†ç±»å¤´ï¼Œç»“æ„ç®€å•ã€‚</li><li><strong>ä¼˜åŠ¿</strong>ï¼š<ul><li><strong>è®¡ç®—é‡å°</strong>ï¼šä»…éœ€è°ƒæ•´åˆ†ç±»å¤´å‚æ•°ï¼Œè®­ç»ƒé€Ÿåº¦å¿«ã€‚</li><li><strong>æ•°æ®è¦æ±‚ä½</strong>ï¼šé€šå¸¸éœ€è¦è¾ƒå°‘çš„æ ‡æ³¨æ•°æ®å³å¯è¾¾åˆ°è¾ƒå¥½æ•ˆæœã€‚</li><li><strong>æ˜¾å­˜å ç”¨ä½</strong>ï¼šè¾“å…¥æ–‡æœ¬å¯æˆªæ–­æˆ–å¡«å……è‡³å›ºå®šé•¿åº¦ï¼Œèµ„æºæ¶ˆè€—å¯æ§911ã€‚</li></ul></li><li><strong>æ¨èåœºæ™¯</strong>ï¼šå…¥é—¨çº§ä»»åŠ¡ï¼Œé€‚åˆå¿«é€ŸéªŒè¯æ¨¡å‹å¾®è°ƒæµç¨‹ã€‚</li></ul><h4 id="2-æ¡ä»¶ç”Ÿæˆä»»åŠ¡-conditional-generation"><strong>(2) æ¡ä»¶ç”Ÿæˆä»»åŠ¡ï¼ˆConditional Generationï¼‰</strong></h4><ul><li><strong>ç‰¹ç‚¹</strong>ï¼šç”Ÿæˆä¸è¾“å…¥ç›¸å…³çš„æ–‡æœ¬ï¼ˆå¦‚æ‘˜è¦ã€ç¿»è¯‘ï¼‰ï¼Œéœ€å¤„ç†é•¿åºåˆ—ä¾èµ–ã€‚</li><li><strong>æŒ‘æˆ˜</strong>ï¼š<ul><li><strong>è‡ªå›å½’ç”Ÿæˆ</strong>ï¼šé€è¯ç”Ÿæˆéœ€å¤šæ¬¡å‰å‘è®¡ç®—ï¼Œè®­ç»ƒå’Œæ¨ç†é€Ÿåº¦è¾ƒæ…¢ã€‚</li><li><strong>æ˜¾å­˜å ç”¨é«˜</strong>ï¼šé•¿æ–‡æœ¬è¾“å…¥éœ€æ›´å¤§çš„ä¸Šä¸‹æ–‡çª—å£ï¼Œå†…å­˜æ¶ˆè€—æ˜¾è‘—å¢åŠ 38ã€‚</li></ul></li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šéœ€ç”Ÿæˆè¿è´¯é•¿æ–‡æœ¬çš„ä»»åŠ¡ï¼ˆå¦‚æ–‡æ¡£æ‘˜è¦ï¼‰ã€‚</li></ul><h4 id="3-é—®é¢˜å›ç­”ä»»åŠ¡-question-answering"><strong>(3) é—®é¢˜å›ç­”ä»»åŠ¡ï¼ˆQuestion Answeringï¼‰</strong></h4><ul><li><strong>ç‰¹ç‚¹</strong>ï¼šä»é•¿æ–‡æœ¬ä¸­å®šä½ç­”æ¡ˆï¼Œéœ€åŒæ—¶å¤„ç†é—®é¢˜å’Œä¸Šä¸‹æ–‡ã€‚</li><li><strong>å¤æ‚åº¦</strong>ï¼š<ul><li><strong>é•¿æ–‡æœ¬å¤„ç†</strong>ï¼šBigBirdçš„ç¨€ç–æ³¨æ„åŠ›æœºåˆ¶é€‚åˆé•¿æ–‡æœ¬ï¼Œä½†è®­ç»ƒéœ€å¤„ç†é—®ç­”å¯¹é—´çš„å¤æ‚äº¤äº’ï¼Œè®¡ç®—é‡è¾ƒå¤§810ã€‚</li><li><strong>æ•°æ®æ ‡æ³¨è¦æ±‚é«˜</strong>ï¼šéœ€ç²¾ç¡®çš„ç­”æ¡ˆä½ç½®æ ‡æ³¨ï¼ˆå¦‚SQuADæ•°æ®é›†ï¼‰ã€‚</li></ul></li></ul><h4 id="4-causallmä»»åŠ¡-å› æœè¯­è¨€å»ºæ¨¡"><strong>(4) CausalLMä»»åŠ¡ï¼ˆå› æœè¯­è¨€å»ºæ¨¡ï¼‰</strong></h4><ul><li><strong>ç‰¹ç‚¹</strong>ï¼šé¢„æµ‹ä¸‹ä¸€ä¸ªè¯ï¼ˆè‡ªå›å½’ç”Ÿæˆï¼‰ï¼Œé€‚ç”¨äºæ–‡æœ¬ç»­å†™æˆ–å¯¹è¯ç”Ÿæˆã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li><strong>è®­ç»ƒæ•ˆç‡ä½</strong>ï¼šéœ€å¤„ç†å®Œæ•´åºåˆ—çš„ç”Ÿæˆï¼Œæ˜¾å­˜å’Œè®¡ç®—èµ„æºæ¶ˆè€—é«˜ã€‚</li><li><strong>é•¿æ–‡æœ¬æŒ‘æˆ˜</strong>ï¼šéœ€ç»“åˆBigBirdçš„ç¨€ç–æ³¨æ„åŠ›ä¼˜åŒ–ï¼Œä½†æ•´ä½“é€Ÿåº¦ä»ä½äºåˆ†ç±»ä»»åŠ¡810ã€‚</li></ul></li></ul><hr><h3 id="2-ä»»åŠ¡æ¨èä¸æ•°æ®é›†é€‰æ‹©"><strong>2. ä»»åŠ¡æ¨èä¸æ•°æ®é›†é€‰æ‹©</strong></h3><h4 id="æ¨èä»»åŠ¡ï¼šåºåˆ—åˆ†ç±»ä»»åŠ¡"><strong>æ¨èä»»åŠ¡ï¼šåºåˆ—åˆ†ç±»ä»»åŠ¡</strong></h4><ul><li><strong>ç®€å•æ€§</strong>ï¼šä»…éœ€è°ƒæ•´åˆ†ç±»å¤´ï¼Œæ— éœ€å¤æ‚ç”Ÿæˆé€»è¾‘ã€‚</li><li><strong>é€Ÿåº¦ä¼˜åŠ¿</strong>ï¼šè®­ç»ƒé€Ÿåº¦å¿«ï¼Œæ˜¾å­˜å ç”¨ä½ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨LoRAå¾®è°ƒæ—¶æ˜¾å­˜å¯æ§åˆ¶åœ¨42Gå†…ï¼‰9ã€‚</li><li><strong>æ•°æ®é›†æ¨è</strong>ï¼š<ul><li><strong>IMDbå½±è¯„åˆ†ç±»</strong>ï¼šäºŒåˆ†ç±»ä»»åŠ¡ï¼ˆæ­£é¢/è´Ÿé¢æƒ…æ„Ÿï¼‰ï¼Œé€‚åˆéªŒè¯æ¨¡å‹åŸºç¡€èƒ½åŠ›11ã€‚</li><li><strong>SMSSpamCollection</strong>ï¼šåƒåœ¾çŸ­ä¿¡åˆ†ç±»ï¼ˆäºŒåˆ†ç±»ï¼‰ï¼Œæ•°æ®é‡å°ï¼ˆ747æ¡/ç±»ï¼‰ï¼Œé€‚åˆå¿«é€Ÿå®éªŒ11ã€‚</li><li><strong>GLUEåŸºå‡†çš„å­ä»»åŠ¡ï¼ˆå¦‚CoLAã€MRPCï¼‰</strong>ï¼šæ ‡å‡†åŒ–è¯„æµ‹é›†ï¼Œé€‚åˆå¯¹æ¯”æ¨¡å‹æ€§èƒ½12ã€‚</li></ul></li></ul><h4 id="å…¶ä»–ä»»åŠ¡å¤‡é€‰æ•°æ®é›†"><strong>å…¶ä»–ä»»åŠ¡å¤‡é€‰æ•°æ®é›†</strong></h4><ul><li><strong>æ¡ä»¶ç”Ÿæˆ</strong>ï¼šCNN/Daily Mailï¼ˆé•¿æ–‡æœ¬æ‘˜è¦ä»»åŠ¡ï¼‰3ã€‚</li><li><strong>é—®é¢˜å›ç­”</strong>ï¼šSQuADï¼ˆæ–¯å¦ç¦é—®ç­”æ•°æ®é›†ï¼‰8ã€‚</li><li><strong>CausalLM</strong>ï¼šWikiText-103ï¼ˆé•¿æ–‡æœ¬è¯­è¨€å»ºæ¨¡ï¼‰10ã€‚</li></ul><h1>æ¨¡å‹å¾®è°ƒæ€»ç»“</h1><h4 id="å¼€æºå®ä¹ -peft-ia3-seq2seqæ¨¡å‹å¾®è°ƒ"><a href="https://gitee.com/mindspore/community/issues/IAN28H">ã€å¼€æºå®ä¹ ã€‘peft_ia3_seq2seqæ¨¡å‹å¾®è°ƒ</a></h4><p>è¿™ä¸ªå®ä¹ çš„ä»»åŠ¡æ˜¯ç”¨peftåº“ä¸­çš„ia3æ–¹æ³•ï¼Œå¯¹seq2seqè¿›è¡Œå¾®è°ƒã€‚ä»£ç æ”¾åœ¨mindnlp/llm/peft]/ia3/seq_2_seq</p><p>ç„¶åå†™äº†ä¸¤ä¸ªipynbï¼Œä¸€ä¸ªæ˜¯pytochçš„åˆ©ç”¨transformersåº“ï¼Œå¹¶ä¸”è§„å®šä½¿ç”¨GPUï¼Œå¦ä¸€ä¸ªä½¿ç”¨mindsporeï¼Œæ²¡æŒ‡å®šè®¾å¤‡ï¼Œç„¶åå†™äº†ä¸€ä¸ªhttps://hf-mirror.comç”¨äºè·å¾—æ•°æ®é›†ã€‚æœ€åæœ‰ä¸€ä¸ªmdå†™äº†mindNLPçš„å‡†ç¡®ç‡æ²¡æœ‰pytorchçš„é«˜</p><p>IA3ï¼ˆè®ºæ–‡ï¼š<strong>Few-Shot Parameter-Efficient Fine-Tuning is Better and Cheaper than In-Context Learning</strong>ï¼‰ï¼Œé€šè¿‡å­¦ä¹ å‘é‡æ¥å¯¹æ¿€æ´»å±‚åŠ æƒè¿›è¡Œç¼©æ”¾ï¼Œä»è€Œè·å¾—æ›´å¼ºçš„æ€§èƒ½ï¼ŒåŒæ—¶ä»…å¼•å…¥ç›¸å¯¹å°‘é‡çš„æ–°å‚æ•°ï¼Œå¦‚ä¸‹å›¾å·¦è¾¹æ‰€ç¤ºï¼Œå®ƒçš„è¯ç”ŸèƒŒæ™¯æ˜¯ä¸ºäº†æ”¹è¿› LoRAã€‚</p><h4 id="å¼€æºå®ä¹ -peft-lora-seq2seqæ¨¡å‹å¾®è°ƒ"><a href="https://gitee.com/mindspore/community/issues/IAN29M">ã€å¼€æºå®ä¹ ã€‘peft_lora_seq2seqæ¨¡å‹å¾®è°ƒ</a></h4><p>è¿™ä¸ªè¿™é‡Œæ²¡æœ‰å†™ä½ç½®ï¼Œä½†æ˜¯æ‰¾åˆ°åœ¨<a href="https://github.com/mindspore-lab/mindnlp/tree/master">mindnlp</a>/<a href="https://github.com/mindspore-lab/mindnlp/tree/master/llm">llm</a>/<a href="https://github.com/mindspore-lab/mindnlp/tree/master/llm/peft">peft</a>/dora/ï¼Œæ„Ÿè§‰å¯æŠ„</p><p>åŸæ¥ä»»åŠ¡åº•ä¸‹æä¾›äº†huggingfaceçš„å¾®è°ƒçš„æ–‡ä»¶å‚è€ƒï¼Œä½¿ç”¨transformerså’Œå¯¹åº”çš„å¾®è°ƒæ–¹æ³•è¿›è¡Œæµ‹è¯•çš„</p><h4 id="å¼€æºå®ä¹ -dna-lmæ¨¡å‹å¾®è°ƒ"><a href="https://gitee.com/mindspore/community/issues/IAN247">ã€å¼€æºå®ä¹ ã€‘dna_lmæ¨¡å‹å¾®è°ƒ</a></h4><p>åˆ©ç”¨ PEFT æ–‡åº“ä¸­çš„å‚æ•°é«˜æ•ˆå¾®è°ƒæŠ€æœ¯ ï¼ˆPEFTï¼‰ æ¥å¾®è°ƒ DNA è¯­è¨€æ¨¡å‹ ï¼ˆDNA-LMï¼‰ã€‚å¾®è°ƒåçš„ DNA-LM å°†ç”¨äºè§£å†³æ ¸è‹·é…¸åŸºå‡†æ•°æ®é›†ä¸­çš„ä»»åŠ¡ã€‚</p><h4 id="å¼€æºå®ä¹ -dora-finetuningæ¨¡å‹å¾®è°ƒ"><a href="https://gitee.com/mindspore/community/issues/IAN239">ã€å¼€æºå®ä¹ ã€‘dora_finetuningæ¨¡å‹å¾®è°ƒ</a></h4><p>Loraæƒ³å¿…å¤§å®¶éƒ½ç†Ÿæ‚‰ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯<strong>æŠŠå¤§çŸ©é˜µæ‹†æˆä¸¤ä¸ªå°çŸ©é˜µçš„ä¹˜æ³•</strong>.è€Œ<a href="https://zhida.zhihu.com/search?content_id=240315419&amp;content_type=Article&amp;match_order=1&amp;q=DoRA&amp;zhida_source=entity">DoRA</a>ï¼ˆWeight-Decomposed Low-Rank Adaptationï¼‰çš„ä¸»è¦æ€æƒ³æ˜¯<strong>å°†é¢„è®­ç»ƒæƒé‡åˆ†è§£ä¸ºå¹…åº¦ï¼ˆmagnitudeï¼‰å’Œæ–¹å‘ï¼ˆdirectionï¼‰ï¼Œå¹¶åˆ©ç”¨LoRAæ¥å¾®è°ƒæ–¹å‘çŸ©é˜µ</strong></p><p><a href="https://gitee.com/mindspore/community/issues/IAN1ZS">ã€å¼€æºå®ä¹ ã€‘image_classification_timm_peft_loraæ¨¡å‹å¾®è°ƒ</a></p><p>ä½¿ç”¨ PEFT çš„ ğŸ¤— LoRA æ¥å¾®è°ƒå›¾åƒåˆ†ç±»æ¨¡å‹ï¼Œåªéœ€ä½¿ç”¨æ¨¡å‹åŸå§‹å¯è®­ç»ƒå‚æ•°çš„ 0.77%ã€‚LoRA å°†ä½ç§©çš„ â€œupdate matricesâ€ æ·»åŠ åˆ°åº•å±‚æ¨¡å‹çš„æŸäº›å—ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º attention blocksï¼‰ï¼Œå¹¶ä¸”ä»…åœ¨å¾®è°ƒæœŸé—´è®­ç»ƒè¿™äº›çŸ©é˜µã€‚åœ¨æ¨ç†è¿‡ç¨‹ä¸­ï¼Œè¿™äº›æ›´æ–°çŸ©é˜µå°†ä¸åŸå§‹æ¨¡å‹å‚æ•°åˆå¹¶ã€‚</p><p><a href="https://gitee.com/mindspore/community/issues/IAN1W9">ã€å¼€æºå®ä¹ ã€‘multilayer_perceptron_loraæ¨¡å‹å¾®è°ƒ</a></p><p>å±•ç¤ºäº†å¦‚ä½•å°† LoRA  åº”ç”¨äºç®€å•çš„å¤šå±‚æ„ŸçŸ¥å™¨ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥è®­ç»ƒæ¨¡å‹ä»¥æ‰§è¡Œåˆ†ç±»ä»»åŠ¡ã€‚PEFT æ”¯æŒå¾®è°ƒä»»ä½•ç±»å‹çš„æ¨¡å‹ï¼Œåªè¦æ”¯æŒçš„å±‚æ˜¯æ”¯æŒçš„ã€‚ä¾‹å¦‚ï¼Œè¯¥æ¨¡å‹ä¸å¿…æ˜¯ transformers æ¨¡å‹ã€‚</p><p><a href="https://gitee.com/mindspore/community/issues/IAN04F">ã€å¼€æºå®ä¹ ã€‘sequence_classification/fourier ftæ¨¡å‹å¾®è°ƒ</a></p><p>ä½¿ç”¨ FourierFT åœ¨åºåˆ—åˆ†ç±»ä»»åŠ¡ä¸Šå¾®è°ƒ Roberta ï¼ˆbaseï¼‰ã€‚</p><h2 id="ä»¥ä¸Šæ˜¯ä¸Šä¸€æœŸçš„-ä¸»è¦é’ˆå¯¹peftåº“å’Œå¯¹åº”çš„huggingfaceä¾‹ç¨‹è¿›è¡Œæµ‹è¯•peft">ä»¥ä¸Šæ˜¯ä¸Šä¸€æœŸçš„ï¼Œä¸»è¦é’ˆå¯¹PEFTåº“å’Œå¯¹åº”çš„huggingfaceä¾‹ç¨‹è¿›è¡Œæµ‹è¯•PEFT</h2><h2 id="ä»¥ä¸‹æ˜¯ä¸Šä¸€æœŸçš„-ä¸»è¦é’ˆå¯¹æ–°çš„æ¨¡å‹è¿›è¡Œæµ‹è¯•å¾®è°ƒ">ä»¥ä¸‹æ˜¯ä¸Šä¸€æœŸçš„ï¼Œä¸»è¦é’ˆå¯¹æ–°çš„æ¨¡å‹è¿›è¡Œæµ‹è¯•å¾®è°ƒ</h2><h2 id="å¼€æºå®ä¹ -bertæ¨¡å‹å¾®è°ƒ"><a href="https://gitee.com/mindspore/community/issues/IAUP1T">ã€å¼€æºå®ä¹ ã€‘bertæ¨¡å‹å¾®è°ƒ</a></h2><p><a href="https://github.com/mindspore-lab/mindnlp/compare/master...Alemax067:mindnlp:%E3%80%90%E5%BC%80%E6%BA%90%E5%AE%9E%E4%B9%A0%E3%80%91bert%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83">commitè®°å½•ï¼Œä½†æ˜¯è¿™é‡Œçœ‹ä¸åˆ°ipynb</a></p><p><a href="https://github.com/Alemax067/mindnlp/blob/%E3%80%90%E5%BC%80%E6%BA%90%E5%AE%9E%E4%B9%A0%E3%80%91bert%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/llm/finetune/bert/bert_finetune_with_Stanford_Sentiment_Tree_Bank.ipynb">çœ‹è¿™é‡Œå§</a></p><p>ä¿®æ”¹åœ¨llm/finetune/bert/bert_for_classification.py</p><p>ç»™å‡ºè¿™æ ·çš„ç»“æœResults</p><h3 id="my-results-on-mindspore">my results on mindspore</h3><table><thead><tr><th>Model Variant</th><th>Accuracy on Dev Set</th></tr></thead><tbody><tr><td>BERT (no finetuning)</td><td>81.25%</td></tr><tr><td>BERT (with finetuning)</td><td>90.07%</td></tr></tbody></table><p>requirements:</p><ul><li>Ascend 910B</li><li>Python 3.9</li><li>MindSpore 2.3.1</li><li>MindNLP 0.4.1</li></ul><h3 id="my-results-on-pytorch">my results on pytorch</h3><table><thead><tr><th>Model Variant</th><th>Accuracy on Dev Set</th></tr></thead><tbody><tr><td>BERT (no finetuning)</td><td>81.03%</td></tr><tr><td>BERT (with finetuning)</td><td>89.84%</td></tr></tbody></table><p>requirements:</p><ul><li>GPU 1080ti</li><li>CUDA 11.1.1</li><li>Python 3.9</li><li>Pytorch 1.10.2</li><li>Transformers 4.45.2</li></ul><h3 id="original-results-from-the-repo">Original results from the repo</h3><table><thead><tr><th>Model Variant</th><th>Accuracy on Dev Set</th></tr></thead><tbody><tr><td>BERT (no finetuning)</td><td>82.59%</td></tr><tr><td>BERT (with finetuning)</td><td>88.29%</td></tr></tbody></table><p>requirements:</p><ul><li>Python 3.6</li><li>Pytorch 1.2.0</li><li>Transformers 2.0.0</li></ul><h2 id="å¼€æºå®ä¹ -blipæ¨¡å‹å¾®è°ƒ"><a href="https://gitee.com/mindspore/community/issues/IAUPL0">ã€å¼€æºå®ä¹ ã€‘blipæ¨¡å‹å¾®è°ƒ</a></h2><p><a href="https://github.com/Alemax067/mindnlp/tree/%E3%80%90%E5%BC%80%E6%BA%90%E5%AE%9E%E4%B9%A0%E3%80%91blip%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/llm/finetune/blip">çœ‹è¿™é‡Œå§</a></p><p>è¿™ä¸ªæ²¡æœ‰å†™ä»–çš„transformersçš„ç»“æœæ¥æºï¼Œè€Œæ˜¯åªæœ‰ä¸€ä¸ªmindsporeçš„ipynbï¼Œåº”è¯¥è¿˜éœ€è¦ä¸€ä¸ªpytorchçš„ï¼Œè¿™é‡Œåº”è¯¥æ˜¯ä»–æ‰¾åˆ°äº†ä½†æ˜¯æ²¡æœ‰è´´ä¸Šæ¥ï¼Œæ¯•ç«ŸæŠŠä¸€ä¸ªpytorchçš„ipynbæ”¾åœ¨mindsporeçš„ä»“åº“é‡Œæœ‰ç‚¹å¥‡æ€ª</p><p>åæ¥å»é—®ä»–</p><p><a href="https://github.com/eeshashetty/captionary-api/blob/main/blip_finetune.ipynb">githubçš„pytorchå‚è€ƒåœ¨è¿™ï¼Œæ˜¯ä»–è‡ªå·±è‰˜çš„ï¼Œç„¶åæ”¹åŠ¨åˆ°å…¶ä»–æ•°æ®é›†</a></p><p>å¦‚æœæ²¡æœ‰è¿™æ ·çš„pytorchå¾®è°ƒçš„ï¼Œå°±è‡ªå·±æŒ‘ä¸€ä¸ªæ•°æ®é›†ç”¨mindsporeå’ŒpytorchMindsporeåˆ†åˆ«è¿›è¡Œè®­ç»ƒå’Œè¯„ä¼°</p><h3 id="my-results-on-mindspore">my results on mindspore</h3><p>20 epochs:</p><ul><li>train loss: 0.0132</li><li>val loss: 0.0126</li></ul><p>requirements:</p><ul><li>Ascend 910B</li><li>Python 3.9</li><li>MindSpore 2.3.1</li><li>MindNLP 0.4.1</li></ul><h3 id="my-results-on-pytorch">my results on pytorch</h3><p>10 epochs:</p><ul><li>train loss: 0.0135</li><li>val loss: 0.0125</li></ul><p>requirements:</p><ul><li>GPU 1080ti</li><li>CUDA 11.1.1</li><li>Python 3.9</li><li>Pytorch 1.10.2</li><li>Transformers 4.45.2</li></ul><h3 id="original-results-from-the-repo">Original results from the repo</h3><p>20 epochs:</p><ul><li>train loss: 1.3579</li><li>val loss: 1.3584</li></ul><h2 id="å¼€æºå®ä¹ -bloomæ¨¡å‹å¾®è°ƒ"><a href="https://gitee.com/mindspore/community/issues/IAUPL8">ã€å¼€æºå®ä¹ ã€‘bloomæ¨¡å‹å¾®è°ƒ</a></h2><p>å®ç°äº†bloom-3båœ¨databricks-dolly-15kæ•°æ®é›†ä¸Šé¢çš„loraå¾®è°ƒï¼Œè¿™ä¸ªæ–‡ä»¶ä¹Ÿå¾ˆä¸æ¸…æ™°å•Šï¼Œpytorchçš„ä¸çŸ¥é“åœ¨é‚£</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;MindNLPæ¨¡å‹å¾®è°ƒè¶…çº§ç¬”è®°&lt;/h1&gt;
&lt;h2 id=&quot;ä¹±ä¸ƒå…«ç³Ÿçš„å­¦ä¹ å‚è€ƒ&quot;&gt;ä¹±ä¸ƒå…«ç³Ÿçš„å­¦ä¹ å‚è€ƒ&lt;/h2&gt;
&lt;h3 id=&quot;å·²å®Œæˆçš„bloomæ¨¡å‹å¾®è°ƒ&quot;&gt;å·²å®Œæˆçš„bloomæ¨¡å‹å¾®è°ƒ&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/mindspor</summary>
      
    
    
    
    <category term="æ·±åº¦å­¦ä¹ " scheme="http://outbreak-sen.github.io/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="mindsporeå®ä¹ " scheme="http://outbreak-sen.github.io/tags/mindspore%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="mindNLP" scheme="http://outbreak-sen.github.io/tags/mindNLP/"/>
    
  </entry>
  
  <entry>
    <title>NLPä»»åŠ¡å¾®è°ƒç¬”è®°</title>
    <link href="http://outbreak-sen.github.io/2025/02/26/NLP%E4%BB%BB%E5%8A%A1%E5%BE%AE%E8%B0%83%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://outbreak-sen.github.io/2025/02/26/NLP%E4%BB%BB%E5%8A%A1%E5%BE%AE%E8%B0%83%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2025-02-26T07:01:44.000Z</published>
    <updated>2025-03-19T09:15:22.884Z</updated>
    
    <content type="html"><![CDATA[<h1>NLPä»»åŠ¡å¾®è°ƒç¬”è®°</h1><p>NLPæ•°æ®é›†æ²¡æœ‰åƒCVä¸€æ ·å¤§é‡æ ‡å·çš„æ•°æ®é›†ï¼Œæ‰€ä»¥NLPä¸€èˆ¬æ˜¯è‡ªç›‘ç£çš„ï¼Œæœ‰ä¸¤ç§è‡ªç›‘ç£çš„æ¨¡å‹ï¼š</p><ul><li><p>LMï¼šè¯­è¨€æ¨¡å‹ï¼Œé¢„æµ‹ä¸‹ä¸€ä¸ªè¯</p></li><li><p>MLMï¼šå¸¦æ©ç çš„è¯­è¨€æ¨¡å‹ï¼Œå®Œå½¢å¡«ç©º</p></li></ul><p>æ¯ç§é¢„è®­ç»ƒæ¨¡å‹åŸºäºä¸åŒçš„æŠ€æœ¯ä¹Ÿåˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li><p>Word embddingsï¼š</p><ul><li>LSTMä¹‹ç±»çš„ä¼ ç»Ÿçš„</li></ul></li><li><p>Transformer based pretrained modelï¼š</p><ul><li>Bertï¼šåŸºäºencoderï¼Œé’ˆå¯¹Bertçš„å¾®è°ƒï¼ŒæŠŠæœ€åä¸€å±‚é‡æ–°è®¾è®¡éšæœºåˆå§‹åŒ–ï¼Œåšåˆ†ç±»åªéœ€è¦æ‹¿å‡ºä¸€ä¸ªç„¶åè®­ç»ƒï¼ŒåšQAåªéœ€è¦è¾“å‡ºç­”æ¡ˆçš„ä½ç½®</li><li>GPTï¼šåŸºäºdecoder</li><li>T5ï¼šåŸºäºencoderå’Œdecode</li></ul></li></ul><h2 id="å¦‚ä½•åšåˆ†è¯">å¦‚ä½•åšåˆ†è¯</h2><p><strong>æ•°æ®é›†ä¸€èˆ¬æ˜¯ç”¨Unicodeè¿›è¡Œç¼–ç ï¼Œæ˜¯å¯¹ä¸–ç•Œæ‰€æœ‰è¯­è¨€çš„ä¸€ç§ç¼–ç ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦å°†è¿™äº›æ–‡å­—å˜æˆæ•°å­—ç¼–ç çš„å‘é‡ï¼Œå°±éœ€è¦åˆ†è¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;æˆ‘æ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯•è¾“å‡ºunicodeç¼–ç çš„æ–‡å­—&quot;.encode(&#x27;utf-8&#x27;)#å¯ä»¥çœ‹åˆ°æ¯ä¸ªå­—å¯¹åº”çš„unicodeç¼–ç  </span><br></pre></td></tr></table></figure><p>åˆ†è¯Tokenizerï¼šå°±æ˜¯æŠŠæ–‡å­—å˜æˆæ•°å­—ï¼Œæ•°å­—å°±æ˜¯tokenï¼Œæ¯ä¸ªè¯å˜æˆä¸€ä¸ªç¼–å·</p><h3 id="tokenizeråˆ†ç±»">Tokenizeråˆ†ç±»</h3><p>Tokenizeræœ‰å¤šç§ï¼Œå…¶ä¸­subword-basedæ˜¯ç°åœ¨æœ€å¸¸ç”¨çš„</p><ol><li>Word-based Toeknizersï¼šæŠŠæ¯ä¸ªè¯ä¸€ä¸€å¯¹åº”åˆ†å¼€ï¼Œç„¶åå°†ä¾‹å¦‚â€œdonâ€˜tâ€å¼•å…¥ç‰¹æ®Šè§„åˆ™åˆ’åˆ†ä¸ºâ€œdoâ€å’Œâ€œnotâ€ï¼Œè¿™å°±å¯¼è‡´è™½ç„¶ç¬¦åˆäººçš„è‡ªç„¶è¯­è¨€çŸ¥è§‰ï¼Œä½†æ˜¯è§„åˆ™å¤ªå¤šï¼Œæ­¤è¡¨å¾ˆå¤§ï¼Œæ‰€ä»¥ä¸€èˆ¬é™åˆ¶åˆ°ä¸€ä¸‡ä¸ªè¯ï¼Œå…¶ä½™çš„è¯æ ‡è®°ä¸ºæœªçŸ¥</li><li>Character-baesd ï¼šæŠŠä¸€ä¸ªå•è¯å˜æˆä¸€ä¸ªä¸ªå­—æ¯ï¼Œloveå˜æˆl,o,v,eï¼Œè¿™æ ·tokenåºåˆ—é•¿ï¼Œå•ä¸ªtokenä¿¡æ¯é‡ä½æ¨¡å‹æ€§èƒ½å·®ï¼Œä¸­æ–‡çš„è¯è¡¨æ›´é•¿ã€‚</li><li>subword-based Tokenizerï¼šè¿™ä¸ªåˆç†ï¼Œdogå°±æ˜¯dogï¼Œä½†æ˜¯dogsä¸ºdog+sã€‚tokenizationå˜æˆtokenå’Œization</li></ol><h3 id="å¸¸ç”¨çš„subword-tokenizer">å¸¸ç”¨çš„subword tokenizer</h3><p>ç„¶åsubword tokenizerä¹Ÿåˆ†ä¸ºå¾ˆå¤šç±»</p><ol><li>Byte-pair encodingï¼ˆGPTä½¿ç”¨çš„p50kï¼‰ï¼šBPEæ–¹æ³•ï¼Œé¦–å…ˆè¿›è¡Œè¯é¢‘ç»Ÿè®¡ï¼Œç„¶åæ„å»ºåŸºæœ¬æ­¤è¡¨ï¼Œæ ¹æ®è¯è¡¨åˆ‡åˆ†è¯ï¼Œç»Ÿè®¡ç›¸é‚»tokenåŒæ—¶å‡ºç°çš„é¢‘ç‡ï¼Œå–å‡ºæ–°çš„é¢‘ç‡é«˜çš„ç»„åˆtokenæ›¿æ¢åŸå…ˆçš„å°tokenï¼Œè¿™æ ·å°±å¯ä»¥æ„æˆæ–°çš„è¯è¡¨ï¼Œæœ€åå°±ä¼šè·å¾—ä¸€ä¸ªå……æ»¡é«˜é¢‘è¯å•å…ƒçš„è¯è¡¨ã€‚çœ‹<a href="https://www.bilibili.com/video/BV1Fc411C7sz/?spm_id_from=333.337.search-card.all.click&amp;vd_source=fab8d1d67ff3f15a964074b193e057da">è§†é¢‘21åˆ†</a>äº†è§£ã€‚æœ‰ä¸ªgihubä»“åº“miniBPEä¸é”™ã€‚åŒæ—¶è¿˜æœ‰ä¸€äº›å‡ºç°ä¹Ÿå¾ˆé«˜ä½†æ˜¯ç»„åˆåˆ°ä¸€èµ·æ²¡æœ‰æ„ä¹‰çš„ï¼Œé‚£å¯ä»¥ç”¨åŠ ä¸ªæ­£åˆ™è¡¨è¾¾åˆ é™¤è¿™ç§ç»„åˆ</li><li>Btye-level BPEï¼ˆGPT2ä½¿ç”¨çš„ï¼‰ï¼šBPEçš„è¯è¡¨å¤ªå¤§ï¼Œæ”¹è¿›çš„æ–¹æ³•å°†å­—èŠ‚byteçœ‹ä½œåŸºæœ¬token</li><li>wordpieceï¼šå’ŒBPEç±»ä¼¼ï¼Œæ¯ä¸ªå•è¯é™¤äº†ç¬¬ä¸€ä¸ªå­—æ¯éƒ½ä¼šåŠ ä¸€ä¸ª#ä½œä¸ºå‰ç¼€ï¼Œç„¶ååˆ©ç”¨è”åˆæ¦‚ç‡è¿›è¡Œtokenåˆå¹¶ï¼Œåæ­£å°±æ›´ç§‘å­¦äº†</li><li>sentencePieceï¼ˆgoogleï¼‰ï¼š</li><li>unigramï¼ˆBigbirdï¼ŒT5ï¼ŒXLNetï¼‰ï¼šåˆå§‹åŒ–ä¸€ä¸ªå¾ˆå¤§çš„è¯è¡¨ï¼Œå°è¯•åˆ å‡ç„¶åè®¡ç®—unigram lossï¼Œç„¶åä½¿unigramlossä¸‹é™çš„ä¸å¤§å°±å±±è°ƒï¼Œé€æ­¥åˆ å‡</li></ol><p><strong>æ¯ä¸ªæ¨¡å‹éƒ½æœ‰å¯¹åº”çš„åˆ†è¯å™¨ï¼Œæ¯ä¸ªæ¨¡å‹çš„tokenizerä¸ä¸€æ ·ï¼Œä¸èƒ½éšä¾¿æ¢</strong>ï¼Œå¯æŸ¥çœ‹https://huggingface.co/spaces/Xenova/the-tokenizer-playgroundçœ‹tokenizerçš„åˆ†è¯æ•ˆæœ</p><img src="./NLPä»»åŠ¡å¾®è°ƒå­¦ä¹ ç¬”è®°/image-20250303114108026.png" alt="image-20250303114108026" style="zoom:50%;" /><h2 id="æ„å»ºè¯è¡¨">æ„å»ºè¯è¡¨</h2><p><strong>è¯è¡¨ï¼ˆVocabularyï¼‰æ˜¯é€šè¿‡ä½¿ç”¨ Tokenizer å¯¹è®­ç»ƒè¯­æ–™è¿›è¡Œå¤„ç†åè·å¾—çš„è¯ï¼ˆæˆ–å­è¯ã€å­—ç¬¦ç­‰ï¼‰ä¸ token çš„å¯¹åº”å…³ç³»ã€‚è¯è¡¨ä¸­å·²ç»å®šä¹‰äº† token ä¸ ID çš„æ˜ å°„å…³ç³»ã€‚</strong></p><p><strong>å¦‚æœä½ çš„æ¨¡å‹å¾®è°ƒä»»åŠ¡ä¸­å·²ç»æœ‰ä¸€ä¸ªé¢„è®­ç»ƒçš„ å¯¹åº”Tokenizerï¼Œé‚£ä¹ˆè¿™ä¸ª Tokenizer å…¶å®åŒ…å«äº†å¯¹åº”çš„è¯è¡¨ï¼Œé‚£ä¹ˆä¸éœ€è¦é‡æ–°æ„å»ºè¯è¡¨ï¼</strong></p><p>é¢„è®­ç»ƒçš„ Tokenizer é€šå¸¸æ˜¯åœ¨å¤§è§„æ¨¡è¯­æ–™ä¸Šè®­ç»ƒçš„ï¼Œå·²ç»åŒ…å«äº†è¶³å¤Ÿå¤§çš„è¯è¡¨ï¼ˆä¾‹å¦‚ 30,000 åˆ° 100,000 ä¸ª tokenï¼‰ã€‚</p><p><strong>å¦‚æœä½ æƒ³è®­ç»ƒä¸€ä¸ªæ–°æ¨¡å‹ï¼Œä½†æ˜¯æ²¡æœ‰tokenizerï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨è¯è¡¨</strong>ä¸‹é¢ä»‹ç»æ€ä¹ˆä½¿ç”¨è¯è¡¨ï¼š</p><ul><li>ä½¿ç”¨é¢„è®­ç»ƒEmbeddingçš„è¯è¡¨ï¼Œå¦‚Gloveï¼Œword2Vec<ul><li>GloVe çš„è¯è¡¨ä¸»è¦ç”¨äºè®­ç»ƒè¯å‘é‡ï¼ˆword embeddingsï¼‰ï¼Œè€Œä¸æ˜¯ç›´æ¥ç”¨äºæ¨¡å‹çš„è¾“å…¥ã€‚</li></ul></li><li>ä½¿ç”¨æ•°æ®é›†ç»Ÿè®¡è¯è¡¨ï¼šä½¿ç”¨from_datasetå‡½æ•°ä»æ•°æ®é›†æ„å»ºä¸€ä¸ªVocabè¯è¡¨</li><li>ä½¿ç”¨Subwordè®­ç»ƒå¾—åˆ°çš„è¯è¡¨ï¼Œç›´æ¥å°±è·å¾—äº†ï¼Œä¸éœ€è¦è®­ç»ƒè·å¾—è¯è¡¨</li></ul><p>å¦‚ä½•ä½¿ç”¨åˆ«äººè®­ç»ƒçš„è¯è¡¨word2Vecç”Ÿæˆinput</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gensim.models <span class="keyword">import</span> KeyedVectors</span><br><span class="line"><span class="comment"># åŠ è½½é¢„è®­ç»ƒçš„ Word2Vec æ¨¡å‹</span></span><br><span class="line">word2vec_model = KeyedVectors.load_word2vec_format(<span class="string">&quot;path/to/word2vec.bin&quot;</span>, binary=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># è·å–è¯è¡¨</span></span><br><span class="line">vocab = word2vec_model.key_to_index  <span class="comment"># å•è¯åˆ°ç´¢å¼•çš„æ˜ å°„</span></span><br><span class="line">word_vectors = word2vec_model.vectors  <span class="comment"># è¯å‘é‡çŸ©é˜µ</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tokenize</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="comment"># ç®€å•çš„ç©ºæ ¼åˆ†è¯ï¼Œè½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">    <span class="keyword">return</span> text.lower().split()python</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹æ•°æ®é›†</span></span><br><span class="line">data = [</span><br><span class="line">    <span class="string">&quot;I love NLP.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;This is a test sentence.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;How are you?&quot;</span></span><br><span class="line">]</span><br><span class="line"><span class="comment"># å¯¹æ•°æ®é›†ä¸­çš„æ¯ä¸ªå¥å­è¿›è¡Œåˆ†è¯</span></span><br><span class="line">tokenized_data = [tokenize(text) <span class="keyword">for</span> text <span class="keyword">in</span> data]</span><br><span class="line"><span class="built_in">print</span>(tokenized_data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="comment"># è·å–è¯å‘é‡çš„ç»´åº¦</span></span><br><span class="line">embedding_dim = word_vectors.shape[<span class="number">1</span>]</span><br><span class="line"><span class="comment"># å°†å•è¯æ˜ å°„åˆ°è¯å‘é‡</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">map_tokens_to_vectors</span>(<span class="params">tokens, vocab, word_vectors, embedding_dim</span>):</span><br><span class="line">    vectors = []</span><br><span class="line">    <span class="keyword">for</span> token <span class="keyword">in</span> tokens:</span><br><span class="line">        <span class="keyword">if</span> token <span class="keyword">in</span> vocab:</span><br><span class="line">            <span class="comment"># å¦‚æœå•è¯åœ¨è¯è¡¨ä¸­ï¼Œè·å–å¯¹åº”çš„è¯å‘é‡</span></span><br><span class="line">            vectors.append(word_vectors[vocab[token]])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># å¦‚æœå•è¯ä¸åœ¨è¯è¡¨ä¸­ï¼Œä½¿ç”¨å…¨é›¶å‘é‡</span></span><br><span class="line">            vectors.append(np.zeros(embedding_dim))</span><br><span class="line">    <span class="keyword">return</span> np.array(vectors)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹åˆ†è¯åçš„æ•°æ®è¿›è¡Œæ˜ å°„</span></span><br><span class="line">vectorized_data = [map_tokens_to_vectors(tokens, vocab, word_vectors, embedding_dim) <span class="keyword">for</span> tokens <span class="keyword">in</span> tokenized_data]</span><br></pre></td></tr></table></figure><h2 id="å¦‚ä½•embedding">å¦‚ä½•embedding</h2><p>embeddingï¼šåšå®Œåˆ†è¯åè·å¾—æ˜¯ä¸€å †æ•°å­—ï¼Œ<strong>embeddingç°åœ¨éƒ½æˆä¸ºtransformerç®—æ³•ï¼Œä¸ç”¨è‡ªå·±æ¥å†™è¿™éƒ¨åˆ†æ•°æ®é¢„å¤„ç†çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥ä¸ç”¨å†™äº†</strong></p><p>Embedding layerçš„ä½œç”¨æ˜¯å°†ç¦»æ•£çš„ token ID æ˜ å°„ä¸ºè¿ç»­çš„å‘é‡è¡¨ç¤ºã€‚è¿™äº›å‘é‡é€šå¸¸æ˜¯å¯è®­ç»ƒçš„ï¼Œæ¨¡å‹ä¼šåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å­¦ä¹ å¦‚ä½•å°†æ¯ä¸ª token ID æ˜ å°„åˆ°ä¸€ä¸ªæœ‰æ„ä¹‰çš„å‘é‡ç©ºé—´ä¸­ã€‚æ¯”å¦‚è¯´ä¸€ä¸ªå¥å­é‡Œçš„ä¸€ä¸ªè¯çš„å‘é‡ æ˜¯ è¿™ä¸ªè¯çš„token + è¯çš„ä½ç½®ç¼–ç </p><img src="./NLPä»»åŠ¡å¾®è°ƒå­¦ä¹ ç¬”è®°/image-20250303113929963.png" alt="image-20250303113929963" style="zoom:50%;" /><h1>å°†æ•°æ®å˜ä¸ºæ•°æ®é›†ï¼ˆå¤ªé‡ç‚¹çš„ï¼‰</h1><p>AIéœ€è¦çš„æ˜¯é—®ç­”å¯¹æ•°æ®é›†ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ•°æ®é›†é‡Œè¦æœ‰é—®é¢˜å’Œç­”æ¡ˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">â€˜instructionâ€™:è¿™é‡Œè¦æœ‰é—®é¢˜</span><br><span class="line">â€˜inputâ€™:è¿™é‡Œè¦æœ‰ä¸€ä¸ªæ•°æ®,</span><br><span class="line">â€˜outputâ€™:è¿™é‡Œéœ€è¦è·å¾—è¾“å‡ºæ˜¯ä»€ä¹ˆ</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æœ‰å„ç§å„æ ·çš„æ•°æ®é›†ï¼Œç„¶åéœ€è¦ç”¨åœ¨ä¸åŒçš„ä»»åŠ¡ä¸­ï¼Œå…¶ä¸­ä»»åŠ¡å¯ä»¥åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼ŒåŸºç¡€æ¨¡å‹éƒ½æ˜¯bigbirdpegasusï¼Œä½†æ˜¯æ˜¯ç”¨äºä¸åŒä»»åŠ¡çš„</strong></p><table><thead><tr><th>ä»»åŠ¡ç±»å‹</th><th>æ•°æ®éœ€è¦åŒ…å«çš„é›†åˆ—</th></tr></thead><tbody><tr><td><strong>BigBirdPegasusForConditionalGeneration</strong></td><td><code>input_text</code>, <code>target_text</code></td></tr><tr><td><strong>BigBirdPegasusForSequenceClassification</strong></td><td><code>input_text</code>, <code>label</code></td></tr><tr><td><strong>BigBirdPegasusForQuestionAnswering</strong></td><td><code>context</code>, <code>question</code>, <code>answer</code></td></tr><tr><td><strong>BigBirdPegasusDecoderWrapper</strong></td><td><code>input_text</code>, <code>target_text</code></td></tr><tr><td><strong>BigBirdPegasusForCausalLMå› æœè¯­è¨€æ¨¡å‹ï¼ˆCLMï¼‰</strong></td><td><code>input_text</code>, <code>target_text</code>ï¼Œä¸‹ä¸€ä¸ªè¯æ˜¯target_text</td></tr><tr><td><strong>Masked Language Modelingæ©ç è¯­è¨€æ¨¡å‹ï¼ˆMLMï¼Œæ¯”å¦‚bertï¼‰</strong></td><td><code>input_text</code>, <code>target_text</code>ï¼Œç¼ºå°‘çš„è¯æ˜¯target_text</td></tr></tbody></table><p>ç„¶å<strong>æ¯ä¸€ç§ä»»åŠ¡çš„æ¨¡å‹éœ€è¦ä¸åŒç±»å‹çš„æ•°æ®é›†è¿›è¡Œè®­ç»ƒï¼Œéœ€è¦æ•°æ®é›†æœ‰å¯¹åº”ä¸åŒçš„columesï¼Œæ¯”å¦‚è¯´BigBirdPegasusForConditionalGenerationè¿™ä¸ªæ¡ä»¶ç”Ÿæˆä»»åŠ¡çš„æ¨¡å‹éœ€è¦æ•°æ®é›†åŒ…æ‹¬è¾“å…¥æ–‡æœ¬(input text)å’Œç›®æ ‡æ–‡æœ¬(target text)ï¼Œå…·ä½“æ ¼å¼å¦‚ä¸‹ã€‚</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data = [</span><br><span class="line">    &#123;&quot;input_text&quot;: &quot;The quick brown fox jumps over the lazy dog.&quot;, &quot;target_text&quot;: &quot;The fox is quick.&quot;&#125;,</span><br><span class="line">    &#123;&quot;input_text&quot;: &quot;In a galaxy far, far away...&quot;, &quot;target_text&quot;: &quot;A long time ago...&quot;&#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><strong>æœ‰ä¸€äº›æ•°æ®é›†æ˜¯å·²ç»é’ˆå¯¹è¿™äº›ä»»åŠ¡ç‰¹åŒ–å¥½çš„ï¼Œæ¯”å¦‚è¯´SQuAD (Stanford Question Answering Dataset)æ˜¯é’ˆå¯¹ConditionalGenerationä»»åŠ¡çš„ï¼Œä¸è¿‡éœ€è¦å°†è¿™ä¸ªæ•°æ®é›†å˜æˆæˆ‘ä»¬éœ€è¦çš„æ ¼å¼ã€‚SQuAD æ•°æ®é›†ä¸­çš„ä¸€ä¸ªä¾‹å­å¦‚ä¸‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;data&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;title&quot;: &quot;Super_Bowl_50&quot;,</span><br><span class="line">            &quot;paragraphs&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;context&quot;: &quot;Super Bowl 50 was an American football game...&quot;,</span><br><span class="line">                    &quot;qas&quot;: [</span><br><span class="line">                        &#123;</span><br><span class="line">                            &quot;question&quot;: &quot;Where did Super Bowl 50 take place?&quot;,</span><br><span class="line">                            &quot;id&quot;: &quot;56be4db0acb8001400a502ec&quot;,</span><br><span class="line">                            &quot;answers&quot;: [</span><br><span class="line">                                &#123;</span><br><span class="line">                                    &quot;text&quot;: &quot;Santa Clara, California&quot;,</span><br><span class="line">                                    &quot;answer_start&quot;: 269</span><br><span class="line">                                &#125;</span><br><span class="line">                            ]</span><br><span class="line">                        &#125;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>databricks-dolly-15kæ•°æ®é›†æ˜¯é’ˆå¾®è°ƒä»»åŠ¡çš„</strong>ï¼Œç‰›é€¼å§ï¼Œä¸“é—¨ç”¨äºå¾®è°ƒå„ç§ä»»åŠ¡çš„ï¼Œå¯ä»¥ç”¨äºé—®ç­”ã€åˆ†ç±»ã€æ‘˜è¦å„ç§ä»»åŠ¡ï¼Œåªéœ€è¦ä½ è‡ªå·±æ„é€ å¥½ã€‚æ•°æ®æ ¼å¼å¦‚ä¸‹:</p><p>æŒ‰ç…§ä½ çš„éœ€è¦å˜æˆä¸åŒçš„æ ¼å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DatasetDict(&#123;</span><br><span class="line">    train: Dataset(&#123;</span><br><span class="line">        features: [<span class="string">&#x27;instruction&#x27;</span>, <span class="string">&#x27;context&#x27;</span>, <span class="string">&#x27;response&#x27;</span>, <span class="string">&#x27;category&#x27;</span>],</span><br><span class="line">        num_rows: <span class="number">15011</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment"># instructionç”¨æˆ·çš„æŒ‡ä»¤æˆ–ä»»åŠ¡æè¿°ï¼ˆä¾‹å¦‚ï¼šâ€œå†™ä¸€ç¯‡å…³äºæ°”å€™å˜åŒ–çš„çŸ­æ–‡ã€‚â€ï¼‰ã€‚</span></span><br><span class="line"><span class="comment"># contextå¯é€‰çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¸ºæ¨¡å‹æä¾›é¢å¤–çš„èƒŒæ™¯çŸ¥è¯†ï¼ˆä¾‹å¦‚ï¼šâ€œæ°”å€™å˜åŒ–æ˜¯å…¨çƒå˜æš–çš„ä¸»è¦åŸå› ã€‚â€ï¼‰ã€‚</span></span><br><span class="line"><span class="comment"># responseæ¨¡å‹åº”ç”Ÿæˆçš„ç†æƒ³å“åº”ï¼ˆä¾‹å¦‚ï¼šâ€œæ°”å€™å˜åŒ–æ˜¯å½“ä»Šä¸–ç•Œé¢ä¸´çš„æœ€å¤§æŒ‘æˆ˜ä¹‹ä¸€...â€ï¼‰ã€‚ã€‚</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;instruction&quot;</span>: <span class="string">&quot;å†™ä¸€ç¯‡å…³äºæ°”å€™å˜åŒ–çš„çŸ­æ–‡ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;context&quot;</span>: <span class="string">&quot;æ°”å€™å˜åŒ–æ˜¯å…¨çƒå˜æš–çš„ä¸»è¦åŸå› ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;response&quot;</span>: <span class="string">&quot;æ°”å€™å˜åŒ–æ˜¯å½“ä»Šä¸–ç•Œé¢ä¸´çš„æœ€å¤§æŒ‘æˆ˜ä¹‹ä¸€ã€‚å…¨çƒå˜æš–å¯¼è‡´æç«¯å¤©æ°”äº‹ä»¶é¢‘å‘ï¼Œæµ·å¹³é¢ä¸Šå‡ï¼Œç”Ÿæ€ç³»ç»Ÿå—åˆ°ä¸¥é‡å¨èƒã€‚ä¸ºäº†åº”å¯¹æ°”å€™å˜åŒ–ï¼Œå„å›½éœ€è¦é‡‡å–ç´§æ€¥æªæ–½ï¼Œå‡å°‘æ¸©å®¤æ°”ä½“æ’æ”¾ï¼Œæ¨åŠ¨å¯æŒç»­å‘å±•ã€‚&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä½†æ˜¯è¿˜æœ‰ä¸€äº›æ•°æ®é›†æ˜¯éç‰¹åŒ–çš„</strong>ï¼Œéœ€è¦è‡ªå·±æ„å»ºæˆéœ€è¦çš„æ•°æ®é›†æ ¼å¼ï¼Œæ¯”å¦‚wikitextåªæ˜¯wikiä¸Šçš„æ–‡å­—ä¸€æ®µä¸€æ®µçš„ï¼Œè¿™ç§å°±æ ¹éœ€è¦è‡ªå·±å¯¹æ•°æ®é›†è¿›è¡Œç‰¹åŒ–å¤„ç†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;text&#x27;: &quot; The ship was assigned to the Austro @-@ Hungarian Fleet &#x27;s 1st Battle Squadron after her 1911 commissioning . In 1912 , ZrÃ­nyi and her two sister ships conducted two training cruises into the eastern Mediterranean Sea . On the second cruise into the Aegean Sea , conducted from November to December , ZrÃ­nyi and her sister ships were accompanied by the cruiser SMS Admiral Spaun and a pair of destroyers . After returning to Pola , the entire fleet mobilized for possible hostilities , as tensions flared in the Balkans . \n&quot;&#125;</span><br></pre></td></tr></table></figure><h2 id="æ•°æ®é›†ç‰¹åŒ–å¤„ç†å·¥å…·">æ•°æ®é›†ç‰¹åŒ–å¤„ç†å·¥å…·</h2><p>æˆ‘ä»¬å®Œå…¨å¯ä»¥è‡ªå·±æŠŠä¸€ä¸ªéç‰¹åŒ–çš„æ•°æ®é›†è½¬åŒ–ä¸ºç‰¹åŒ–çš„æ•°æ®é›†ï¼Œæ¯”å¦‚æŠŠwikitextçš„æ¯ä¸€å¥è¯æ‹¿å‡ºæ¥ï¼Œç„¶åä¸€å¥è¯çš„æœ€åä¸€ä¸ªè¯å°±æ˜¯è¦è·å¾—çš„ç»“æœï¼Œä½œä¸ºtarget_idsã€‚ä½†æ˜¯æœ‰æ›´å¥½çš„å·¥å…·å¯ä»¥ç›´æ¥æŠŠæ•°æ®é›†è½¬åŒ–ä¸ºæƒ³è¦çš„ç‰¹åŒ–çš„æ•°æ®é›†æ¯”å¦‚datasetä¸­çš„**<code>DataCollatorForLanguageModeling</code>**</p><p><code>DataCollatorForLanguageModeling</code>** æ˜¯ Hugging Face æä¾›çš„ä¸€ä¸ªå·¥å…·ï¼Œä¸“é—¨ç”¨äºå¤„ç†è¯­è¨€æ¨¡å‹è®­ç»ƒæ•°æ®ã€‚å®ƒå¯ä»¥è‡ªåŠ¨å°†æ•°æ®é›†ï¼ˆå¦‚ Wikitext-103-v1ï¼‰åˆ’åˆ†ä¸º <code>input_ids</code>ã€<code>attention_mask</code> å’Œ <code>labels</code>ï¼Œå¹¶ä¸”æ”¯æŒå› æœè¯­è¨€æ¨¡å‹ï¼ˆCausal Language Model, CLMï¼‰å’Œæ©ç è¯­è¨€æ¨¡å‹ï¼ˆMasked Language Model, MLMï¼‰çš„è®­ç»ƒã€‚</p><h3 id="datacollatorforlanguagemodeling-çš„ä½œç”¨"><strong><code>DataCollatorForLanguageModeling</code> çš„ä½œç”¨</strong></h3><ol><li><strong>åŠ¨æ€å¡«å……</strong>ï¼šå°†æ‰¹æ¬¡ä¸­çš„åºåˆ—å¡«å……åˆ°ç›¸åŒé•¿åº¦ã€‚</li><li><strong>ç”Ÿæˆ <code>labels</code></strong>ï¼šå¯¹äºå› æœè¯­è¨€æ¨¡å‹ï¼Œ<code>labels</code> æ˜¯ <code>input_ids</code> çš„åç§»ç‰ˆæœ¬ï¼ˆå³ä¸‹ä¸€ä¸ª token çš„é¢„æµ‹ç›®æ ‡ï¼‰ã€‚</li><li><strong>æ”¯æŒ MLM</strong>ï¼šå¦‚æœä½ ä½¿ç”¨çš„æ˜¯æ©ç è¯­è¨€æ¨¡å‹ï¼ˆå¦‚ BERTï¼‰ï¼Œå®ƒè¿˜å¯ä»¥éšæœºæ©ç  tokenã€‚</li><li>é™¤äº†ç”Ÿæˆinput_idså’Œtarget_idsä¹‹å¤–ï¼Œè¿˜ä¼šç”Ÿæˆ<code>attention_mask</code> ï¼ŒæŒ‡ç¤ºå“ªäº› token æ˜¯å®é™…æ•°æ®ï¼Œå“ªäº›æ˜¯å¡«å…… tokenã€‚</li></ol><p>DataCollatorForLanguageModelingçš„å·¥ä½œåŸç†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é¦–å…ˆå·²ç»æœ‰ä¸¤å¥è¿ç»­çš„è¯äº†</span></span><br><span class="line"><span class="comment">#  &quot;The quick brown fox&quot;</span></span><br><span class="line"><span class="comment">#     &quot;Jumps over the lazy dog&quot;</span></span><br><span class="line"><span class="comment"># CLMæ¨¡å‹çš„ä½œç”¨æ˜¯æ ¹æ®ä¹‹å‰çš„æ–‡å­—ç”Ÿæˆä¸‹ä¸€ä¸ªæ–‡å­—</span></span><br><span class="line"><span class="comment"># é¦–å…ˆç»è¿‡tokenizer</span></span><br><span class="line">input_ids_1 = [<span class="number">1996</span>, <span class="number">4248</span>, <span class="number">2829</span>, <span class="number">4419</span>]  <span class="comment"># &quot;The quick brown fox&quot;</span></span><br><span class="line">input_ids_2 = [<span class="number">12987</span>, <span class="number">345</span>, <span class="number">1996</span>, <span class="number">1234</span>, <span class="number">2345</span>]  <span class="comment"># &quot;Jumps over the lazy dog&quot;</span></span><br><span class="line"><span class="comment"># ç„¶åç»è¿‡datacollatrorForlanguageodelingä¹‹åï¼Œ-100æ˜¯ç”¨æ¥å¡«å……çš„ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™æ ·labelï¼Œä¹Ÿå°±æ˜¯target_idsçš„å˜åŒ–æ˜¯é¢„æµ‹çš„ä¸‹ä¸€å¥è¯</span></span><br><span class="line">input_ids = [</span><br><span class="line">    [<span class="number">1996</span>, <span class="number">4248</span>, <span class="number">2829</span>, <span class="number">4419</span>, -<span class="number">100</span>],  <span class="comment"># &quot;The quick brown fox&quot;</span></span><br><span class="line">    [<span class="number">12987</span>, <span class="number">345</span>, <span class="number">1996</span>, <span class="number">1234</span>, <span class="number">2345</span>]   <span class="comment"># &quot;Jumps over the lazy dog&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">labels = [</span><br><span class="line">    [<span class="number">4248</span>, <span class="number">2829</span>, <span class="number">4419</span>, -<span class="number">100</span>, -<span class="number">100</span>],  <span class="comment"># é¢„æµ‹ä¸‹ä¸€ä¸ª token</span></span><br><span class="line">    [<span class="number">345</span>, <span class="number">1996</span>, <span class="number">1234</span>, <span class="number">2345</span>, -<span class="number">100</span>]    <span class="comment"># é¢„æµ‹ä¸‹ä¸€ä¸ª token</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>ä¸‹é¢è®²è§£DataCollatorForLanguageModeling` æ€ä¹ˆè°ƒç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"><span class="comment"># åŠ è½½ Wikitext æ•°æ®é›†</span></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;wikitext&quot;</span>, <span class="string">&quot;wikitext-103-v1&quot;</span>)</span><br><span class="line"><span class="comment"># è¿‡æ»¤ç©ºè¡Œ</span></span><br><span class="line">dataset = dataset.<span class="built_in">filter</span>(<span class="keyword">lambda</span> x: x[<span class="string">&quot;text&quot;</span>].strip() != <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> DataCollatorForLanguageModeling</span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(<span class="string">&quot;gpt2&quot;</span>)</span><br><span class="line"><span class="comment"># å¯¹æ•°æ®é›†è¿›è¡Œ Tokenization</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tokenize_function</span>(<span class="params">examples</span>):</span><br><span class="line">    <span class="keyword">return</span> tokenizer(examples[<span class="string">&quot;text&quot;</span>], truncation=<span class="literal">True</span>, max_length=<span class="number">512</span>)</span><br><span class="line">tokenized_dataset = dataset.<span class="built_in">map</span>(tokenize_function, batched=<span class="literal">True</span>, remove_columns=[<span class="string">&quot;text&quot;</span>])</span><br><span class="line"><span class="comment"># åˆå§‹åŒ– DataCollator</span></span><br><span class="line">data_collator = DataCollatorForLanguageModeling(</span><br><span class="line">    tokenizer=tokenizer,</span><br><span class="line">    mlm=<span class="literal">False</span>,  <span class="comment"># ä½¿ç”¨å› æœè¯­è¨€æ¨¡å‹</span></span><br><span class="line">    return_tensors=<span class="string">&quot;pt&quot;</span>  <span class="comment"># è¿”å› PyTorch å¼ é‡</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¶åæŒ‰ç†è¯´å¯ä»¥ç”¨äºè®­ç»ƒï¼Œä½†æ˜¯è¿™é‡Œè®²ä¸‰ä¸ªæ–¹å¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. åˆ›å»º DataLoaderï¼Œè¿™ä¸ªDataLoaderçš„ä½œç”¨æ˜¯ä¸ºäº†ä¼ å…¥æ¨¡å‹ä½¿ç”¨çš„ï¼Œdataloaderéœ€è¦å°†æ•°æ®åˆ’åˆ†ä¸ºä¸åŒçš„batchï¼Œå¹¶ä¸”æ‰“ä¹±é¡ºåºç­‰</span></span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line">train_loader = DataLoader(</span><br><span class="line">    tokenized_dataset[<span class="string">&quot;train&quot;</span>],</span><br><span class="line">    batch_size=<span class="number">8</span>,</span><br><span class="line">    collate_fn=data_collator,</span><br><span class="line">    shuffle=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å¯ä»¥ä¸ä½¿ç”¨ DataLoaderï¼Œç›´æ¥å°† Tokenizer å¤„ç†åçš„æ•°æ®ä½¿ç”¨ DataCollatorForLanguageModeling è½¬æ¢ä¸ºæ¨¡å‹è®­ç»ƒæ‰€éœ€çš„æ ¼å¼ï¼Œç„¶åè¿›è¡Œè®­ç»ƒã€‚ä¸è¿‡ï¼Œè¿™ç§æ–¹å¼é€šå¸¸é€‚ç”¨äºå°è§„æ¨¡æ•°æ®é›†æˆ–è‡ªå®šä¹‰è®­ç»ƒå¾ªç¯çš„åœºæ™¯ã€‚</span></span><br><span class="line">batch_size = <span class="number">8</span></span><br><span class="line">batches = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(tokenized_dataset[<span class="string">&quot;train&quot;</span>]), batch_size):</span><br><span class="line">    batch = tokenized_dataset[<span class="string">&quot;train&quot;</span>][i:i + batch_size]</span><br><span class="line">    batches.append(data_collator(batch[<span class="string">&quot;input_ids&quot;</span>]))</span><br><span class="line">optimizer = AdamW(model.parameters(), lr=<span class="number">5e-5</span>)</span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):  <span class="comment"># è®­ç»ƒ 3 ä¸ª epoch</span></span><br><span class="line">    <span class="keyword">for</span> batch <span class="keyword">in</span> batches:</span><br><span class="line">        outputs = model(input_ids=batch[<span class="string">&quot;input_ids&quot;</span>], labels=batch[<span class="string">&quot;labels&quot;</span>])</span><br><span class="line">        loss = outputs.loss</span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Loss: <span class="subst">&#123;loss.item()&#125;</span>&quot;</span>)   </span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å¦‚æœä½ éœ€è¦å¾®è°ƒï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨dataloaderï¼Œç›´æ¥å°†DataCollatorForLanguageModelingå¤„ç†è¿‡çš„æ•°æ®ä¼ å…¥trainerå³å¯</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é™¤äº† <strong><code>DataCollatorForLanguageModeling</code></strong>ï¼Œhuggingfaceçš„transformerè¿˜æœ‰è®¸å¤šå…¶ä»– <strong>DataCollator</strong> å·¥å…·ï¼Œå¯ä»¥æ ¹æ®ä»»åŠ¡éœ€æ±‚å°†æ•°æ®é›†è½¬æ¢ä¸ºæ¨¡å‹è®­ç»ƒæ‰€éœ€çš„æ ¼å¼ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ DataCollator åŠå…¶é€‚ç”¨åœºæ™¯ï¼šè¯¦ç»†å¯çœ‹è¿™ä¸ª<a href="https://percent4.github.io/NLP%EF%BC%88%E4%B9%9D%E5%8D%81%E5%9B%9B%EF%BC%89transformers%E6%A8%A1%E5%9D%97%E4%B8%AD%E7%9A%84DataCollator/">å„ç§datacollator</a></p><table><thead><tr><th>DataCollator ç±»å‹</th><th>é€‚ç”¨ä»»åŠ¡</th></tr></thead><tbody><tr><td><code>DataCollatorWithPadding</code></td><td>å˜é•¿åºåˆ—ä»»åŠ¡ï¼ˆå¦‚æ–‡æœ¬åˆ†ç±»ï¼‰ã€‚</td></tr><tr><td><code>DataCollatorForTokenClassification</code></td><td>åºåˆ—æ ‡æ³¨ä»»åŠ¡ï¼ˆå¦‚å‘½åå®ä½“è¯†åˆ«ï¼‰ã€‚</td></tr><tr><td><code>DataCollatorForSeq2Seq</code></td><td>åºåˆ—åˆ°åºåˆ—ä»»åŠ¡ï¼ˆå¦‚æœºå™¨ç¿»è¯‘ï¼‰ã€‚</td></tr><tr><td><code>DataCollatorForSOP</code></td><td>å¥å­é¡ºåºé¢„æµ‹ä»»åŠ¡ï¼ˆå¦‚ ALBERTï¼‰ã€‚</td></tr><tr><td><code>DataCollatorForWholeWordMask</code></td><td>å…¨è¯æ©ç ä»»åŠ¡ï¼ˆå¦‚ BERTï¼‰ã€‚</td></tr><tr><td><code>DataCollatorForPermutationLanguageModeling</code></td><td>æ’åˆ—è¯­è¨€æ¨¡å‹ä»»åŠ¡ï¼ˆå¦‚ XLNetï¼‰ã€‚</td></tr><tr><td><code>DataCollatorForNextSentencePrediction</code></td><td>ä¸‹ä¸€å¥é¢„æµ‹ä»»åŠ¡ï¼ˆå¦‚ BERTï¼‰ã€‚</td></tr><tr><td><code>DataCollatorForImageCaptioning</code></td><td>å›¾åƒæè¿°ç”Ÿæˆä»»åŠ¡ã€‚</td></tr></tbody></table><p>ä¹Ÿå¯ä»¥è‡ªå·±å®šä¹‰ï¼Œç»§æ‰¿DataCollator</p><p>Mindsporeä¹Ÿæœ‰datacontrolçš„å·¥å…·ä¸è¿‡å«åšmindspore.dataset.GeneratorDatasetï¼Œå¹¶ä¸”éœ€è¦è‡ªå·±å®šä¹‰ï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰transformersé‡Œé¢çš„å·¥å…·æ™ºèƒ½</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def data_generator():</span><br><span class="line">    for i in range(100):</span><br><span class="line">        yield (np.random.randn(32, 32, 3), np.random.randint(0, 10)</span><br><span class="line"></span><br><span class="line">dataset = ds.GeneratorDataset(source=data_generator, column_names=[&quot;image&quot;, &quot;label&quot;])</span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–mindsporeå’ŒmindNLPåªæ”¯æŒä¸€äº›åŸºæœ¬æ“ä½œæ¯”å¦‚mapï¼Œpaddingä¹‹ç±»çš„</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;NLPä»»åŠ¡å¾®è°ƒç¬”è®°&lt;/h1&gt;
&lt;p&gt;NLPæ•°æ®é›†æ²¡æœ‰åƒCVä¸€æ ·å¤§é‡æ ‡å·çš„æ•°æ®é›†ï¼Œæ‰€ä»¥NLPä¸€èˆ¬æ˜¯è‡ªç›‘ç£çš„ï¼Œæœ‰ä¸¤ç§è‡ªç›‘ç£çš„æ¨¡å‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;LMï¼šè¯­è¨€æ¨¡å‹ï¼Œé¢„æµ‹ä¸‹ä¸€ä¸ªè¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MLMï¼šå¸¦æ©ç çš„è¯­è¨€æ¨¡å‹ï¼Œå®Œå½¢å¡«ç©º&lt;/p&gt;
</summary>
      
    
    
    
    <category term="æ·±åº¦å­¦ä¹ " scheme="http://outbreak-sen.github.io/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="huggingface" scheme="http://outbreak-sen.github.io/tags/huggingface/"/>
    
    <category term="mindsporeå®ä¹ " scheme="http://outbreak-sen.github.io/tags/mindspore%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="mindNLP" scheme="http://outbreak-sen.github.io/tags/mindNLP/"/>
    
  </entry>
  
  <entry>
    <title>mindNLPä½¿ç”¨æ–¹æ³•ä»¥åŠNLPæ¨¡å‹çš„ä½¿ç”¨</title>
    <link href="http://outbreak-sen.github.io/2025/02/26/mindNLP%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/"/>
    <id>http://outbreak-sen.github.io/2025/02/26/mindNLP%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/</id>
    <published>2025-02-26T02:53:47.000Z</published>
    <updated>2025-03-19T09:14:35.074Z</updated>
    
    <content type="html"><![CDATA[<h1>mindNLP</h1><p><a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/abc.html">API reference</a></p><p><a href="https://mindnlp-ai.readthedocs.io/en/latest/zh/api/accelerate/">å¦ä¸€ä¸ªAPI referenceï¼Œè¿™ä¸ªå…¨</a></p><h2 id="ä»‹ç»è¿™æ˜¯ä»€ä¹ˆ">ä»‹ç»è¿™æ˜¯ä»€ä¹ˆ</h2><ul><li><p>MindNLPæ˜¯åŸºäºMindSporeçš„å¼€æºNLPåº“ã€‚è¿™ä¸ªæ˜¯ä¸ªpackageï¼Œç±»ä¼¼äºhuggingfaceçš„transformeråº“ï¼Œæœ‰ 250+ é¢„è®­ç»ƒæ¨¡å‹æ”¯æŒç±»ä¼¼ huggingface transformers çš„ APIã€‚æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç ç‰‡æ®µè½»æ¾ä½¿ç”¨ï¼Œè¿™æ ·å¯ä»¥ç›´æ¥ä½¿ç”¨å·²ç»å®šä¹‰å¥½çš„æ¨¡å‹å¹¶ä¸”è¿˜æœ‰æ¨¡å‹çš„æƒé‡ï¼š<a href="https://mindnlp.cqu.ai/supported_models/">æ”¯æŒçš„æ¨¡å‹</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import mindnlp.transformers import AutoModel</span><br><span class="line"></span><br><span class="line">model = AutoModel.from_pretrainedï¼ˆ&#x27;bert-base-cased&#x27;ï¼‰</span><br></pre></td></tr></table></figure></li><li><p>å…¨é¢çš„æ•°æ®å¤„ç†ï¼šå°†å¤šä¸ªç»å…¸çš„ NLP æ•°æ®é›†æ‰“åŒ…æˆå‹å¥½çš„æ¨¡å—ï¼Œä»¥ä¾¿äºä½¿ç”¨ï¼Œä¾‹å¦‚ Multi30kã€SQuADã€CoNLL ç­‰ã€‚</p></li><li><p>å‹å¥½çš„ NLP æ¨¡å‹å·¥å…·é›†ï¼šMindNLP æä¾›äº†å„ç§å¯é…ç½®çš„ç»„ä»¶ã€‚ä½¿ç”¨ MindNLP è‡ªå®šä¹‰æ¨¡å‹å¾ˆå‹å¥½ã€‚</p></li><li><p>æ˜“äºä½¿ç”¨çš„å¼•æ“ï¼šMindNLP ç®€åŒ–äº† MindSpore ä¸­å¤æ‚çš„è®­ç»ƒè¿‡ç¨‹ã€‚å®ƒæ”¯æŒ Trainer å’Œ Evaluator æ¥å£ï¼Œå¯è½»æ¾è®­ç»ƒå’Œè¯„ä¼°æ¨¡å‹ã€‚</p></li><li><p>å…¨å¹³å°æ”¯æŒï¼šå…¨é¢æ”¯æŒæ˜‡è…¾ 910 ç³»åˆ—ã€æ˜‡è…¾ 310B ï¼ˆOrange Piï¼‰ã€GPU å’Œ CPUã€‚ï¼ˆæ³¨æ„ï¼šç›®å‰ Orange Pi ä¸Šå”¯ä¸€å¯ç”¨çš„ AI å¼€å‘å¥—ä»¶ã€‚</p></li><li><p>åˆ†å¸ƒå¼å¹¶è¡Œæ¨ç†ï¼šå¯¹è¶…è¿‡ 10B å‚æ•°çš„æ¨¡å‹æä¾›å¤šè®¾å¤‡ã€å¤šè¿›ç¨‹å¹¶è¡Œæ¨ç†æ”¯æŒã€‚</p></li><li><p>é‡åŒ–ç®—æ³•æ”¯æŒï¼šSmoothQuant å¯ç”¨äº Orange Pi;GPU æ”¯æŒç±»ä¼¼ bitsandbytes çš„ int8 é‡åŒ–ã€‚</p></li><li><p>Sentence Transformer æ”¯æŒï¼šå®ç°é«˜æ•ˆçš„ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰å¼€å‘ã€‚</p></li><li><p>åŠ¨æ€å›¾æ€§èƒ½ä¼˜åŒ–ï¼šåœ¨ Ascend ç¡¬ä»¶ä¸Šå®ç°åŠ¨æ€å›¾çš„ PyTorch+GPU çº§æ¨ç†é€Ÿåº¦ï¼ˆåœ¨ 85 æ¯«ç§’/ä»¤ç‰Œä¸‹æµ‹è¯• Llama æ€§èƒ½ï¼‰ã€‚</p></li><li><p>çœŸæ­£çš„é™æ€å’ŒåŠ¨æ€å›¾ç»Ÿä¸€ï¼šä½¿ç”¨ mindspore.jit å•è¡Œåˆ‡æ¢åˆ°å›¾å½¢æ¨¡å¼ï¼Œå®Œå…¨å…¼å®¹ Hugging Face  ä»£ç é£æ ¼ï¼Œæ—¢æ˜“äºä½¿ç”¨ï¼Œåˆèƒ½å¿«é€Ÿæå‡æ€§èƒ½ã€‚åœ¨Ascendç¡¬ä»¶ä¸Šæµ‹è¯•çš„Llamaæ€§èƒ½è¾¾åˆ°äº†2å€çš„åŠ¨æ€å›¾é€Ÿåº¦ï¼ˆ45ms/tokenï¼‰ï¼Œä¸å…¶ä»–MindSporeåŸºäºé™æ€å›¾çš„å¥—ä»¶ä¸€è‡´ã€‚</p></li><li><p>å¹¿æ³›çš„ LLM åº”ç”¨ç¨‹åºæ›´æ–°ï¼šåŒ…æ‹¬æ–‡æœ¬ä¿¡æ¯æå–ã€èŠå¤©æœºå™¨äººã€è¯­éŸ³è¯†åˆ«ã€ChatPDFã€éŸ³ä¹ç”Ÿæˆã€ä»£ç ç”Ÿæˆã€è¯­éŸ³å…‹éš†ç­‰ã€‚éšç€æ¨¡å‹æ”¯æŒçš„å¢åŠ ï¼Œæ›´å¤šä»¤äººå…´å¥‹çš„åº”ç”¨ç¨‹åºç­‰å¾…å¼€å‘ï¼</p></li></ul><h2 id="å®‰è£…">å®‰è£…</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># whlçš„ä¸‹è½½ä½ç½®ï¼š https://repo.mindspore.cn/mindspore-lab/mindnlp/newest/any/</span><br><span class="line"># ç›´æ¥pipå°±å¯ä»¥å®‰è£…</span><br><span class="line">pip install mindnlp</span><br><span class="line"># sourceå®‰è£…</span><br><span class="line">pip install git+https://github.com/mindspore-lab/mindnlp.git</span><br><span class="line"># or</span><br><span class="line">git clone https://github.com/mindspore-lab/mindnlp.git</span><br><span class="line">cd mindnlp</span><br><span class="line">bash scripts/build_and_reinstall.sh</span><br><span class="line"></span><br><span class="line"># ç‰ˆæœ¬è¦æ±‚ï¼špython &gt;=3.9, &lt;=3.11  mingspore &gt;=2.2.x</span><br></pre></td></tr></table></figure><h2 id="è¡¥å……çŸ¥è¯†">è¡¥å……çŸ¥è¯†</h2><h3 id="åˆ†è¯å™¨-è¯è¡¨-é¢„è®­ç»ƒçš„è¯å‘é‡æ¨¡å‹">åˆ†è¯å™¨ï¼Œè¯è¡¨ï¼Œé¢„è®­ç»ƒçš„è¯å‘é‡æ¨¡å‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨åˆ†è¯å™¨åˆ†è¯</span><br><span class="line">tokens = tokenizer.tokenize(&quot;Hello, how are you?&quot;)</span><br><span class="line">print(tokens)  # è¾“å‡º: [&#x27;hello&#x27;, &#x27;,&#x27;, &#x27;how&#x27;, &#x27;are&#x27;, &#x27;you&#x27;, &#x27;?&#x27;]</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨è¯è¡¨æ˜ å°„åˆ°ç´¢å¼•</span><br><span class="line">indices = vocab(tokens)</span><br><span class="line">print(indices)  # è¾“å‡º: [2, 3, 4, 5, 6, 7]</span><br></pre></td></tr></table></figure><h4 id="åˆ†è¯å™¨tokenizer">åˆ†è¯å™¨tokenizer</h4><p>åˆ†è¯å™¨çš„ä¸»è¦ä»»åŠ¡æ˜¯å°†æ–‡æœ¬åˆ†å‰²æˆåŸºæœ¬å•å…ƒï¼ˆå¦‚å•è¯ã€å­è¯æˆ–å­—ç¬¦ï¼‰ï¼Œå¹¶å°†è¿™äº›å•å…ƒè½¬æ¢ä¸ºæ¨¡å‹å¯ä»¥ç†è§£çš„æ•°å€¼å½¢å¼ï¼ˆå¦‚ç´¢å¼•ï¼‰ã€‚å¸¸è§çš„åˆ†è¯å™¨åŒ…æ‹¬ï¼š</p><ul><li><strong>ç©ºæ ¼åˆ†è¯å™¨</strong>ï¼šæŒ‰ç©ºæ ¼åˆ†å‰²æ–‡æœ¬ã€‚</li><li><strong>BPEï¼ˆByte Pair Encodingï¼‰åˆ†è¯å™¨</strong>ï¼šå°†æ–‡æœ¬åˆ†å‰²æˆå­è¯å•å…ƒã€‚</li><li><strong>WordPiece åˆ†è¯å™¨</strong>ï¼šBERT ç­‰æ¨¡å‹ä½¿ç”¨çš„åˆ†è¯å™¨ã€‚</li><li><strong>SentencePiece åˆ†è¯å™¨</strong>ï¼šæ”¯æŒæ— ç©ºæ ¼è¯­è¨€çš„åˆ†è¯å™¨ã€‚</li></ul><p>åˆ†è¯å™¨çš„å¤„ç†æµç¨‹ï¼š</p><ol><li><strong>åˆ†è¯</strong>ï¼šå°†æ–‡æœ¬åˆ†å‰²æˆåŸºæœ¬å•å…ƒï¼ˆå¦‚å•è¯æˆ–å­è¯ï¼‰ã€‚</li><li><strong>è½¬æ¢ä¸ºç´¢å¼•</strong>ï¼šå°†åˆ†è¯ç»“æœæ˜ å°„åˆ°è¯è¡¨ä¸­çš„ç´¢å¼•ã€‚</li><li><strong>æ·»åŠ ç‰¹æ®Šæ ‡è®°</strong>ï¼šå¦‚ <code>[CLS]</code>ã€<code>[SEP]</code>ã€<code>[PAD]</code> ç­‰ã€‚</li><li><strong>å¡«å……æˆ–æˆªæ–­</strong>ï¼šå°†åºåˆ—é•¿åº¦ç»Ÿä¸€ä¸ºå›ºå®šé•¿åº¦ã€‚</li></ol><h4 id="è¯è¡¨-vocab-çš„ä½œç”¨"><strong>è¯è¡¨ï¼ˆVocabï¼‰çš„ä½œç”¨</strong></h4><p>è¯è¡¨æ˜¯è¯æ±‡åˆ°ç´¢å¼•çš„æ˜ å°„è¡¨ã€‚å®ƒçš„ä½œç”¨æ˜¯å°†åˆ†è¯åçš„æ–‡æœ¬è½¬æ¢ä¸ºæ•°å€¼å½¢å¼ï¼Œä»¥ä¾¿æ¨¡å‹èƒ½å¤Ÿå¤„ç†ã€‚è¯è¡¨é€šå¸¸åŒ…æ‹¬ï¼š</p><ul><li><strong>è¯æ±‡è¡¨</strong>ï¼šæ‰€æœ‰å¯èƒ½çš„è¯æ±‡æˆ–å­è¯ã€‚</li><li><strong>ç‰¹æ®Šæ ‡è®°</strong>ï¼šå¦‚ <code>&lt;unk&gt;</code>ï¼ˆæœªçŸ¥è¯ï¼‰ã€<code>&lt;pad&gt;</code>ï¼ˆå¡«å……æ ‡è®°ï¼‰ç­‰ã€‚</li><li><strong>ç´¢å¼•æ˜ å°„</strong>ï¼šå°†æ¯ä¸ªè¯æ±‡æ˜ å°„åˆ°ä¸€ä¸ªå”¯ä¸€çš„ç´¢å¼•ã€‚</li></ul><h3 id="gloveé¢„è®­ç»ƒè¯å‘é‡">gloveé¢„è®­ç»ƒè¯å‘é‡</h3><p><strong>GloVeï¼ˆGlobal Vectors for Word Representationï¼‰</strong> æ˜¯ä¸€ç§é¢„è®­ç»ƒçš„è¯å‘é‡æ¨¡å‹ï¼Œå®ƒé€šè¿‡å…¨å±€è¯å…±ç°ç»Ÿè®¡æ¥å­¦ä¹ è¯æ±‡çš„åˆ†å¸ƒå¼è¡¨ç¤ºã€‚ä¸»è¦ä½œç”¨æ˜¯ä¸ºè¯æ±‡æä¾›è¯­ä¹‰ä¸°å¯Œçš„å‘é‡è¡¨ç¤ºï¼Œä»è€Œå¢å¼ºæ¨¡å‹å¯¹æ–‡æœ¬çš„ç†è§£èƒ½åŠ›ã€‚æ˜¯ä¸€ç§åµŒå…¥å±‚embeddingã€‚</p><p>ï¼ˆ1ï¼‰<strong>è¯­ä¹‰è¡¨ç¤º</strong>GloVe è¯å‘é‡æ•æ‰äº†è¯æ±‡ä¹‹é—´çš„è¯­ä¹‰å…³ç³»ã€‚ä¾‹å¦‚ï¼Œ<code>king - man + woman â‰ˆ queen</code>ï¼Œè¿™ç§å…³ç³»åœ¨å‘é‡ç©ºé—´ä¸­å¯ä»¥é€šè¿‡å‘é‡åŠ å‡æ¥è¡¨ç¤ºã€‚</p><p>ï¼ˆ2ï¼‰<strong>é™ç»´</strong>å°†é«˜ç»´çš„ç¦»æ•£è¯æ±‡è¡¨ç¤ºï¼ˆå¦‚ one-hot ç¼–ç ï¼‰è½¬æ¢ä¸ºä½ç»´çš„è¿ç»­å‘é‡è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªè¯æ±‡å¯ä»¥ç”¨ä¸€ä¸ª 100 ç»´çš„å‘é‡è¡¨ç¤ºï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ•°ä¸‡ç»´çš„ one-hot å‘é‡ã€‚</p><p>ï¼ˆ3ï¼‰<strong>åˆå§‹åŒ–åµŒå…¥å±‚</strong>åœ¨è®­ç»ƒ NLP æ¨¡å‹æ—¶ï¼ŒGloVe è¯å‘é‡å¯ä»¥ä½œä¸ºåµŒå…¥å±‚ï¼ˆEmbedding Layerï¼‰çš„åˆå§‹åŒ–å‚æ•°ï¼Œä»è€ŒåŠ é€Ÿæ¨¡å‹æ”¶æ•›å¹¶æå‡æ€§èƒ½ã€‚</p><p>ï¼ˆ4ï¼‰<strong>è§£å†³ç¨€ç–æ€§é—®é¢˜</strong>ä¼ ç»Ÿçš„ one-hot ç¼–ç ä¼šå¯¼è‡´æ•°æ®ç¨€ç–æ€§é—®é¢˜ï¼Œè€Œ GloVe è¯å‘é‡æ˜¯ç¨ å¯†çš„ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°è¡¨ç¤ºè¯æ±‡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from torchtext.vocab import GloVe</span><br><span class="line"></span><br><span class="line"># åŠ è½½é¢„è®­ç»ƒçš„ GloVe è¯å‘é‡ï¼ˆ6B è¡¨ç¤ºè®­ç»ƒè¯­æ–™ä¸º 60 äº¿è¯ï¼Œ100 è¡¨ç¤ºå‘é‡ç»´åº¦ï¼‰</span><br><span class="line">glove = GloVe(name=&#x27;6B&#x27;, dim=100)</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹è¯æ±‡è¡¨å¤§å°</span><br><span class="line">print(len(glove.itos))  # è¾“å‡º: 400000ï¼ˆGloVe 6B åŒ…å« 40 ä¸‡ä¸ªè¯æ±‡ï¼‰</span><br><span class="line"></span><br><span class="line"># è·å–å•è¯ &quot;king&quot; çš„è¯å‘é‡</span><br><span class="line">king_vector = glove[&#x27;king&#x27;]</span><br><span class="line">print(king_vector.shape)  # è¾“å‡º: torch.Size([100])</span><br></pre></td></tr></table></figure><h3 id="è¯è¡¨å’Œgloveé¢„è®­ç»ƒè¯å‘é‡ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿">è¯è¡¨å’Œgloveé¢„è®­ç»ƒè¯å‘é‡ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿</h3><p>è™½ç„¶ <strong>GloVe é¢„è®­ç»ƒè¯å‘é‡</strong> å’Œ <strong>è¯è¡¨ï¼ˆVocabï¼‰</strong> éƒ½æ¶‰åŠå°†è¯æ±‡è½¬æ¢ä¸ºå‘é‡æˆ–ç´¢å¼•ã€‚</p><p>å¤§å¤šæ•°æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼ˆå¦‚ LSTMã€Transformerï¼‰çš„è¾“å…¥æ˜¯ç´¢å¼•åºåˆ—ï¼Œè€Œä¸æ˜¯ç›´æ¥è¾“å…¥å‘é‡åºåˆ—ã€‚è¯è¡¨å°†æ–‡æœ¬è½¬æ¢ä¸ºç´¢å¼•åºåˆ—ï¼Œè€Œ GloVe è¯å‘é‡ç”¨äºå°†ç´¢å¼•æ˜ å°„ä¸ºå‘é‡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># å°†æ–‡æœ¬è½¬æ¢ä¸ºç´¢å¼•</span><br><span class="line">text = &quot;hello NLP&quot;</span><br><span class="line">indices = vocab(text.split())</span><br><span class="line">print(indices)  # è¾“å‡º: [2, 4]</span><br><span class="line"># åŠ è½½ GloVe è¯å‘é‡</span><br><span class="line">glove = GloVe(name=&#x27;6B&#x27;, dim=100)</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºåµŒå…¥å±‚ï¼Œå¹¶ä½¿ç”¨ GloVe è¯å‘é‡åˆå§‹åŒ–</span><br><span class="line">embedding_layer = nn.Embedding.from_pretrained(glove.vectors, freeze=False)</span><br><span class="line"></span><br><span class="line"># å°†ç´¢å¼•è½¬æ¢ä¸º GloVe å‘é‡</span><br><span class="line">input_indices = torch.LongTensor(indices)</span><br><span class="line">embedded_vectors = embedding_layer(input_indices)</span><br><span class="line">print(embedded_vectors.shape)  # è¾“å‡º: torch.Size([2, 100])</span><br></pre></td></tr></table></figure><h2 id="å­¦ä¹ ä½¿ç”¨">å­¦ä¹ ä½¿ç”¨</h2><p><a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/overview/about.html">å®˜æ–¹å‚è€ƒæ–‡ä»¶</a></p><p><a href="https://mindnlp-ai.readthedocs.io/en/latest/zh/tutorials/quick_start/">å¦ä¸€ä¸ªå®˜æ–¹å‚è€ƒæ–‡ä»¶</a></p><h3 id="ä½¿ç”¨æ¨¡å‹">ä½¿ç”¨æ¨¡å‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">import math</span><br><span class="line">from mindspore import nn</span><br><span class="line">from mindspore import ops</span><br><span class="line">from mindspore.common.initializer import Uniform, HeUniform</span><br><span class="line">from mindnlp.modules import Glove</span><br><span class="line">from mindnlp.modules import RNNEncoder</span><br><span class="line"># ä½¿ç”¨ Seq2vecModel è¿›è¡Œæ¨¡å‹æ„å»ºã€‚æ¨¡å— Seq2vecModel çš„åŠŸèƒ½æ˜¯æå–è¾“å…¥åºåˆ—æ•°æ®çš„è¯­ä¹‰ç‰¹å¾å¹¶è®¡ç®—å¾—åˆ°ç»“æœå‘é‡ã€‚è¿™ä¸€æ¨¡å—ç”± encoder å’Œ head ä¸¤éƒ¨åˆ†ç»„æˆï¼Œå…¶ä¸­ encoder å°†è¾“å…¥å¥å­æ˜ å°„ä¸ºè¯­ä¹‰å‘é‡ï¼Œè€Œ head å¯¹ encoder çš„è¾“å‡ºè¿›è¡Œè¿›ä¸€æ­¥è®¡ç®—å¾—åˆ°æœ€ç»ˆçš„ç»“æœã€‚</span><br><span class="line"># ä½¿ç”¨MindNLPæä¾›çš„ RNNEncoder ä½œä¸ºæ¨¡å‹çš„ encoder ï¼Œå¹¶ä½¿ç”¨è‡ªå®šä¹‰çš„æ¨¡å—ä½œä¸ºæ¨¡å‹çš„ head ã€‚</span><br><span class="line"></span><br><span class="line"># å®šä¹‰ä¸€ä¸ªhead</span><br><span class="line">class Head(nn.Cell):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Head for Sentiment Classification model</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    def __init__(self, hidden_dim, output_dim, dropout):</span><br><span class="line">        super().__init__()</span><br><span class="line">        weight_init = HeUniform(math.sqrt(5))</span><br><span class="line">        bias_init = Uniform(1 / math.sqrt(hidden_dim * 2))</span><br><span class="line">        self.fc = nn.Dense(hidden_dim * 2, output_dim, weight_init=weight_init, bias_init=bias_init)</span><br><span class="line">        self.sigmoid = nn.Sigmoid()</span><br><span class="line">        self.dropout = nn.Dropout(1 - dropout)</span><br><span class="line">    def construct(self, context):</span><br><span class="line">        context = ops.concat((context[-2, :, :], context[-1, :, :]), axis=1)</span><br><span class="line">        context = self.dropout(context)</span><br><span class="line">        return self.sigmoid(self.fc(context))</span><br><span class="line"># ä½¿ç”¨encoder</span><br><span class="line">hidden_size = 256</span><br><span class="line">output_size = 1</span><br><span class="line">num_layers = 2</span><br><span class="line">bidirectional = True</span><br><span class="line">drop = 0.5</span><br><span class="line">lr = 0.001</span><br><span class="line">embedding, vocab = Glove.from_pretrained(&#x27;6B&#x27;, 100, special_tokens=[&quot;&lt;unk&gt;&quot;, &quot;&lt;pad&gt;&quot;], dropout=drop)</span><br><span class="line">lstm_layer = nn.LSTM(100, hidden_size, num_layers=num_layers, batch_first=True,</span><br><span class="line">                    dropout=drop, bidirectional=bidirectional)</span><br><span class="line">sentiment_encoder = RNNEncoder(embedding, lstm_layer)</span><br><span class="line"></span><br><span class="line">sentiment_head = Head(hidden_size, output_size, drop)</span><br><span class="line"># æŠŠè¿™ä¸¤ä¸ªä¼ è¿›å»ç”Ÿæˆmodel</span><br><span class="line">net = SentimentClassification(sentiment_encoder, sentiment_head)</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨æ•°æ®é›†">ä½¿ç”¨æ•°æ®é›†</h3><h4 id="é€šè¿‡å¯¹åº”æ¥å£åŠ è½½">é€šè¿‡å¯¹åº”æ¥å£åŠ è½½</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from mindnlp.dataset import Multi30k</span><br><span class="line">multi30k_train, multi30k_valid, multi30k_test = Multi30k(&quot;./dataset&quot;)</span><br><span class="line">multi30k_train = Multi30k(root=&quot;./dataset&quot;, split=&#x27;train&#x27;)</span><br><span class="line"></span><br><span class="line">é€šè¿‡æ³¨é‡Šæˆ–è€…ç½‘ç«™å¯¹åº”çš„æ¥å£ æ–‡æ¡£ æŸ¥çœ‹å‚æ•°åˆ—è¡¨ä»¥åŠè¿”å›å€¼ç­‰ä¿¡æ¯ï¼š</span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line"># root (str) - å­˜æ”¾æ•°æ®é›†çš„ç›®å½•ã€‚é»˜è®¤ï¼šâ€~/.mindnlpâ€ã€‚</span><br><span class="line"># split (str|Tuple[str]) - è¦è¿”å›çš„æ•°æ®é›†åˆ†å—ã€‚é»˜è®¤ï¼š(â€˜trainâ€™, â€˜validâ€™, â€˜testâ€™).</span><br><span class="line"># language_pair (Tuple[str]) - åŒ…å«æºè¯­è¨€å’Œç›®æ ‡è¯­è¨€çš„å…ƒç»„ã€‚é»˜è®¤ï¼š(â€˜deâ€™, â€˜enâ€™).</span><br><span class="line"># proxies (dict) - å®šä¹‰ä»£ç†çš„å­—å…¸ï¼Œä¾‹å¦‚ï¼š&#123;â€œhttpsâ€: â€œhttps://127.0.0.1:7890â€&#125;.</span><br><span class="line"># è¿”å›ï¼š</span><br><span class="line"># datasets_list (list) - åŠ è½½å®Œæˆçš„æ•°æ®é›†åˆ†å—åˆ—è¡¨ã€‚å¦‚æœåªåŠ è½½äº†ä¸€ä¸ªæ•°æ®é›†åˆ†å—ï¼Œ å¦‚ï¼šâ€™trianâ€™ï¼Œé‚£ä¹ˆå°±åªè¿”å›è¿™ä¸ªæ•°æ®é›†åˆ†å—ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="é€šè¿‡å¯¹åº”æ¥å£loadé¢„å¤„ç†">é€šè¿‡å¯¹åº”æ¥å£loadé¢„å¤„ç†</h4><p>å¯ä»¥åœ¨ <code>mindnlp.dataset</code> ä¸‹æ‰¾åˆ°å¯¹åº”æ•°æ®é›†æ¥å£ï¼Œåç§°ä¸ºæ•°æ®é›†åç§°åŠ ä¸‹åˆ’çº¿ä»¥åŠ <code>Process</code> ï¼Œå…¶ä¸­çš„ <code>vocab</code> ä¸ºå¦‚ä¸Šç”Ÿæˆçš„è¯è¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from mindnlp.dataset import Multi30k_Process</span><br><span class="line">train_dataset = Multi30k_Process(train_dataset, vocab=vocab)</span><br><span class="line"># é€šè¿‡æ³¨é‡Šæˆ–è€…ç½‘ç«™å¯¹åº”çš„æ¥å£ [æ–‡æ¡£](https://mindnlp.cqu.ai/zh_CN/latest/api/dataset/machine_translation.html#module-mindnlp.dataset.machine_translation.multi30k) æŸ¥çœ‹å‚æ•°åˆ—è¡¨ä»¥åŠè¿”å›å€¼ç­‰ä¿¡æ¯ï¼š</span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line"># - **dataset** (*GeneratorDataset*) - Multi30kæ•°æ®é›†ã€‚</span><br><span class="line"># - **vocab** (*Vocab*) - è¯è¡¨å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨åˆ†è¯å’Œç´¢å¼•çš„æ˜ å°„ã€‚é»˜è®¤ä¸ºç©ºã€‚å¦‚æœä¸ºç©ºï¼Œä¸€ä¸ªæ–°çš„è¯è¡¨å¯¹è±¡å°†ä¼šè¢«åˆ›å»ºã€‚</span><br><span class="line"># - **batch_size** (*int*) - æŒ‡å®šæ¯ä¸ªæ‰¹å¤„ç†æ•°æ®åŒ…å«çš„æ•°æ®æ¡ç›®ã€‚é»˜è®¤å€¼ï¼š64ã€‚</span><br><span class="line"># - **max_len** (*int*) - å¥å­çš„æœ€å¤§é•¿åº¦ã€‚é»˜è®¤å€¼ï¼š500ã€‚</span><br><span class="line"># - **drop_remainder** (*bool*) - å½“æœ€åä¸€æ‰¹æ•°æ®åŒ…å«çš„æ•°æ®æ¡ç›®å°äºbatch_sizeæ—¶ï¼Œæ˜¯å¦ä¸¢å¼ƒè¯¥æ‰¹æ¬¡ï¼Œè€Œä¸å°†å…¶ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªæ“ä½œã€‚é»˜è®¤å€¼ï¼šFalseï¼Œä¸ä¸¢å¼ƒ</span><br><span class="line"># è¿”å›ï¼š</span><br><span class="line"># - **dataset** (MapDataset) - é¢„å¤„ç†æ“ä½œåè¿”å›çš„æ•°æ®é›†ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># å¤„ç†å’Œåˆ’åˆ†æ•°æ®ï¼Œé’ˆå¯¹è¯­éŸ³æ•°æ®é›†è¿˜éœ€è¦åˆ†è¯å™¨å’Œè¯æ±‡è¡¨</span><br><span class="line"># è°ƒç”¨æ¥è‡ª Glove çš„å‡½æ•° from_pretrained() ï¼Œè·å–åµŒå…¥å’Œè¯æ±‡è¡¨</span><br><span class="line">from mindnlp.modules import Glove</span><br><span class="line">embedding, vocab = Glove.from_pretrained(&#x27;6B&#x27;, 100, special_tokens=[&quot;&lt;unk&gt;&quot;, &quot;&lt;pad&gt;&quot;], dropout=drop)</span><br><span class="line"># å®ä¾‹åŒ–ç±» BasicTokenizer æ¥åˆå§‹åŒ–åˆ†è¯å™¨ï¼š</span><br><span class="line">from mindnlp.dataset.transforms import BasicTokenizer</span><br><span class="line">tokenizer = BasicTokenizer(True)</span><br><span class="line">å°†è·å–åˆ°çš„è®­ç»ƒé›†ã€åˆ†è¯å™¨å’Œè¯æ±‡è¡¨ç­‰ä¼ å…¥æ–¹æ³• process() ï¼Œåº”ç”¨è¯¥æ–¹æ³•è·å–å¤„ç†è¿‡çš„è®­ç»ƒé›†ï¼š</span><br><span class="line">from mindnlp.dataset import process</span><br><span class="line">imdb_train = process(&#x27;imdb&#x27;, imdb_train, tokenizer=tokenizer, vocab=vocab, bucket_boundaries=[400, 500], max_len=600, drop_remainder=True)</span><br><span class="line"># ä½¿ç”¨æ–¹æ³• split() æ¥åˆ’åˆ†å¤„ç†åçš„è®­ç»ƒé›†ï¼Œä»è€Œè·å–æ–°çš„è®­ç»ƒé›†å’ŒéªŒè¯é›†</span><br><span class="line">imdb_train, imdb_valid = imdb_train.split([0.7, 0.3])             </span><br></pre></td></tr></table></figure><h4 id="é€šè¿‡ç»Ÿä¸€æ¥å£åŠ è½½">é€šè¿‡ç»Ÿä¸€æ¥å£åŠ è½½</h4><p>é€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„ <code>load</code> æ¥å£è¿›è¡ŒåŠ è½½ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ•°æ®é›†çš„åç§°å­—ç¬¦ä¸²ï¼Œç”¨ä»¥æŒ‡å®šæ•°æ®é›†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from mindnlp.dataset import load</span><br><span class="line">multi30k_train, multi30k_valid, multi30k_test = load(&#x27;multi30k&#x27;)</span><br><span class="line">multi30k_train, multi30k_valid, multi30k_test = load(&#x27;multi30k&#x27;, root=&quot;./dataset&quot;) # å…¶ä»–å‚æ•°å¯ä»¥é€šè¿‡æŸ¥è¯¢æ¥å£ç»§ç»­æ·»åŠ </span><br></pre></td></tr></table></figure><h4 id="é€šè¿‡ç»Ÿä¸€æ¥å£processé¢„å¤„ç†">é€šè¿‡ç»Ÿä¸€æ¥å£processé¢„å¤„ç†</h4><p>å¯¹äºä¸åŒé¢†åŸŸä¸­çš„ä¸åŒæ•°æ®é›†ï¼Œæœ‰ä¸åŒçš„å¤„ç†æµç¨‹ï¼Œmindnlpæä¾›äº†æ•°æ®é›†çš„ç‰¹å®šå¤„ç†å‡½æ•°å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå¤„ç†æ•°æ®ã€‚å’Œå‰é¢çš„åŠ è½½æ–¹æ³•ä¸€æ ·ï¼Œè¿™é‡ŒåŒæ ·æœ‰ä¸¤ç§æ–¹æ³•è°ƒç”¨è¯¥å¤„ç†å‡½æ•°ã€‚ä»¥ <code>Multi30k</code> æ•°æ®é›†ä¸ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from mindnlp.dataset import process</span><br><span class="line">multi30k_train, multi30k_valid, multi30k_test = load(&#x27;multi30k&#x27;)</span><br><span class="line">dataset_train = process(&#x27;Multi30k&#x27;, multi30k_train, vocab = vocab)</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®é›†å˜æ¢å¤„ç†">æ•°æ®é›†å˜æ¢å¤„ç†</h3><p>æ•°æ®é›†å˜æ¢å¤„ç†ä¸­æœ€é‡è¦çš„æ“ä½œæ˜¯ <code>map</code> æ“ä½œï¼Œå¯ä»¥é’ˆå¯¹æ•°æ®é›†æŒ‡å®šåˆ—ï¼ˆcolumnï¼‰æ·»åŠ æ•°æ®å˜æ¢ï¼ˆTransformsï¼‰ï¼Œå°†æ•°æ®å˜æ¢åº”ç”¨äºè¯¥åˆ—æ•°æ®çš„æ¯ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›åŒ…å«å˜æ¢åå…ƒç´ çš„æ–°æ•°æ®é›†ã€‚è¿™é‡Œä½¿ç”¨ <code>BasicTokenizer</code> å¯¹æ•°æ®é›†çš„ä¸¤åˆ—è¿›è¡Œåˆ†è¯ï¼Œå¹¶ä½¿ç”¨ <code>from_dataset</code> ç”Ÿæˆè¯è¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from mindnlp.dataset.transforms import BasicTokenizer</span><br><span class="line"></span><br><span class="line">tokenizer = BasicTokenizer(True)</span><br><span class="line">dataset_train= dataset_train.map([tokenizer], &#x27;en&#x27;)</span><br><span class="line">dataset_train= dataset_train.map([tokenizer], &#x27;de&#x27;)</span><br><span class="line"></span><br><span class="line">en_vocab = text.Vocab.from_dataset(dataset_train, &#x27;en&#x27;, special_tokens=[&#x27;&lt;pad&gt;&#x27;, &#x27;&lt;unk&gt;&#x27;], special_first= True)</span><br><span class="line">de_vocab = text.Vocab.from_dataset(dataset_train, &#x27;de&#x27;, special_tokens=[&#x27;&lt;pad&gt;&#x27;, &#x27;&lt;unk&gt;&#x27;], special_first= True)</span><br><span class="line">vocab = &#123;&#x27;en&#x27;:en_vocab, &#x27;de&#x27;:de_vocab&#125;</span><br></pre></td></tr></table></figure><h3 id="ç”¨trainerè¿›è¡Œè®­ç»ƒ">ç”¨Trainerè¿›è¡Œè®­ç»ƒ</h3><h4 id="å®šä¹‰losså’Œä¼˜åŒ–å™¨">å®šä¹‰losså’Œä¼˜åŒ–å™¨</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨MindSporeæä¾›çš„ `mindspore.nn.BCELoss` æ¥å®šä¹‰ä¸€ä¸ªæŸå¤±å‡½æ•°ï¼š</span><br><span class="line">loss = nn.BCELoss(reduction=&#x27;mean&#x27;)</span><br><span class="line"># ç„¶åï¼Œè°ƒç”¨ `mindspore.nn.Adam` ï¼Œå¹¶ä¼ å…¥æ¨¡å‹çš„å¯è®­ç»ƒå‚æ•°ï¼Œä»è€Œå®šä¹‰è¿è¡Œæ¨¡å‹æ‰€éœ€è¦çš„ä¼˜åŒ–å™¨ï¼š</span><br><span class="line">optimizer = nn.Adam(net.trainable_params(), learning_rate=lr)</span><br></pre></td></tr></table></figure><h4 id="å®šä¹‰å›è°ƒå‡½æ•°">å®šä¹‰å›è°ƒå‡½æ•°</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from mindnlp.engine.callbacks.timer_callback import TimerCallback</span><br><span class="line">from mindnlp.engine.callbacks.earlystop_callback import EarlyStopCallback</span><br><span class="line">from mindnlp.engine.callbacks.best_model_callback import BestModelCallback</span><br><span class="line"># é¦–å…ˆéœ€è¦åˆå§‹åŒ–å›è°ƒå‡½æ•°å¯¹åº”çš„ç±»</span><br><span class="line">timer_callback_epochs = TimerCallback(print_steps=2) # ç”¨äºè®¡æ—¶çš„å›è°ƒå‡½æ•°</span><br><span class="line">earlystop_callback = EarlyStopCallback(patience=2) # ç”¨äºæ—©åœçš„å›è°ƒå‡½æ•°</span><br><span class="line">bestmodel_callback = BestModelCallback(save_path=&#x27;save/callback/best_model&#x27;, auto_load=True) #  BestModelCallback ç”¨äºä¿å­˜å’ŒåŠ è½½æœ€å¥½çš„æ¨¡å‹ä½¿ç”¨ CheckpointCallback æ¥ä¿å­˜checkpoint</span><br><span class="line"># å£°æ˜ä¸€ä¸ªç”±æˆ‘ä»¬äº‹å…ˆåˆå§‹åŒ–çš„å›è°ƒå‡½æ•°ç»„æˆçš„åˆ—è¡¨</span><br><span class="line">callbacks = [timer_callback_epochs, earlystop_callback, bestmodel_callback]</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯è‡ªå®šä¹‰Callbackï¼Œç»§æ‰¿è‡ªmindnlp.abc.callbackã€‚Callbackä¸­æ‰€æœ‰çš„ç±»æ–¹æ³•éƒ½ä¼šåœ¨Trainerçš„è®­ç»ƒä¸­åœ¨ç‰¹å®šçš„é˜¶æ®µè°ƒç”¨ã€‚å¦‚train_begin()ä¼šåœ¨è®­ç»ƒå¼€å§‹æ—¶è¢«è°ƒç”¨ï¼Œepoch_end()ä¼šåœ¨æ¯ä¸ªepochç»“æŸæ—¶è°ƒç”¨ã€‚å…·ä½“æœ‰å“ªäº›ç±»æ–¹æ³•ï¼Œå‚è§Callbackæ–‡æ¡£ã€‚è¿™é‡Œï¼ŒMyCallbackåœ¨æ¯ä¸ªepochç»“æŸæ—¶è°ƒç”¨epoch_end()ï¼Œè¾“å‡ºå½“å‰epochç»“æŸæ—¶çš„losså‡å€¼ã€‚</p><h4 id="å®šä¹‰è¯„ä»·æŒ‡æ ‡ïƒ">å®šä¹‰è¯„ä»·æŒ‡æ ‡<a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/quick_start/train_and_eval.html#define-metrics">ïƒ</a></h4><p>MindNLPä¸­æœ‰å¾ˆå¤š <a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/abc.html#mindnlp.abc.Metric"><code>Metric</code></a> å¯ä»¥ç”¨äºæ¨¡å‹è¯„ä¼°ï¼š <a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/engine/metrics.html#mindnlp.engine.metrics.accuracy.Accuracy"><code>Accuracy</code></a> ï¼Œ <a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/engine/metrics.html#mindnlp.engine.metrics.bleu.BleuScore"><code>BleuScore</code></a>ï¼Œ <a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/engine/metrics.html#mindnlp.engine.metrics.confusion_matrix.ConfusionMatrix"><code>ConfusionMatrix</code></a>ï¼Œ <a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/engine/metrics.html#mindnlp.engine.metrics.distinct.Distinct"><code>Distinct</code></a>ï¼Œ <a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/engine/metrics.html#mindnlp.engine.metrics.em_score.EmScore"><code>EmScore</code></a>ï¼Œ <a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/engine/metrics.html#mindnlp.engine.metrics.f1.F1Score"><code>F1Score</code></a>ï¼Œ <a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/engine/metrics.html#mindnlp.engine.metrics.matthews.MatthewsCorrelation"><code>MatthewsCorrelation</code></a>ï¼Œ <a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/engine/metrics.html#mindnlp.engine.metrics.pearson.PearsonCorrelation"><code>PearsonCorrelation</code></a>ï¼Œ <a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/engine/metrics.html#mindnlp.engine.metrics.perplexity.Perplexity"><code>Perplexity</code></a>ï¼Œ <a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/engine/metrics.html#mindnlp.engine.metrics.precision.Precision"><code>Precision</code></a>ï¼Œ <a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/engine/metrics.html#mindnlp.engine.metrics.recall.Recall"><code>Recall</code></a>ï¼Œ <a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/engine/metrics.html#mindnlp.engine.metrics.rouge.RougeL"><code>RougeL</code></a>ï¼Œ <a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/engine/metrics.html#mindnlp.engine.metrics.rouge.RougeN"><code>RougeN</code></a>ï¼Œ <a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/engine/metrics.html#mindnlp.engine.metrics.spearman.SpearmanCorrelation"><code>SpearmanCorrelation</code></a>ã€‚ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªè¯„ä»·æŒ‡æ ‡æ¥è¯„ä¼°æ¨¡å‹æ˜¯æœ‰å¿…è¦çš„ã€‚æˆ‘ä»¬é€‰æ‹© <a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/engine/metrics.html#mindnlp.engine.metrics.accuracy.Accuracy"><code>Accuracy</code></a> ä½œä¸ºæ¨¡å‹çš„è¯„ä»·æŒ‡æ ‡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from mindnlp.engine.metrics import Accuracy</span><br><span class="line">metric = Accuracy()</span><br></pre></td></tr></table></figure><p><strong>ä¹Ÿå¯ä»¥é€šè¿‡ç»§æ‰¿åŸºç±»Metricè‡ªå·±å®šä¹‰</strong></p><h4 id="ç‰¹åˆ«å¿«çš„ä½¿ç”¨trainer-ä¸éœ€è¦å¤šä½™å†™ä¸œè¥¿">ç‰¹åˆ«å¿«çš„ä½¿ç”¨trainerï¼Œä¸éœ€è¦å¤šä½™å†™ä¸œè¥¿</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from mindnlp.engine.trainer import Trainer</span><br><span class="line"></span><br><span class="line">trainer = Trainer(network=net, train_dataset=imdb_train, eval_dataset=imdb_valid, metrics=metric,epochs=5, loss_fn=loss, optimizer=optimizer, callbacks=callbacks)</span><br><span class="line">    # networkï¼šè®­ç»ƒçš„ç½‘ç»œã€‚</span><br><span class="line">    # train_datasetï¼šç”¨äºè®­ç»ƒæ¨¡å‹çš„æ•°æ®é›†ã€‚</span><br><span class="line">    # eval_datasetï¼šç”¨äºè¯„ä¼°æ¨¡å‹çš„æ•°æ®é›†ã€‚</span><br><span class="line">    # metricsï¼šç”¨äºè¯„ä¼°æ¨¡å‹çš„è¯„ä»·æŒ‡æ ‡ã€‚</span><br><span class="line">    # epochsï¼šè®­ç»ƒæ•°æ®çš„æ€»è¿­ä»£æ¬¡æ•°ã€‚</span><br><span class="line">    # loss_fnï¼šæŸå¤±å‡½æ•°ã€‚</span><br><span class="line">    # optimizerï¼šç”¨äºæ›´æ–°è®­ç»ƒå‚æ•°çš„ä¼˜åŒ–å™¨ã€‚</span><br><span class="line">    # callbacksï¼šè®­ç»ƒæ—¶æ‰§è¡Œçš„é¢å¤–æ“ä½œã€‚</span><br><span class="line"></span><br><span class="line">trainer.run(tgt_columns=&quot;label&quot;, jit=False)</span><br></pre></td></tr></table></figure><h3 id="ç»„ä»¶">ç»„ä»¶</h3><p><code>modules</code> ç”¨äºæ„å»ºç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œå¯ä»¥å’Œ MindSpore ä¸€èµ·ä½¿ç”¨ã€‚ <code>modules</code> å…·æœ‰ä¸‰å¤§åŠŸèƒ½æ¨¡å—ï¼šEmbedding, Encoder-Decoder å’Œ Attention</p><h3 id="embedding">Embedding</h3><p>embeddingç›´è¯‘æ˜¯<strong>åµŒå…¥å¼ã€åµŒå…¥å±‚</strong>ã€‚æœ¬è´¨ä¸Šæ˜¯ä¸€ç§è¯åµŒå…¥æŠ€æœ¯,èƒ½å¤Ÿå°†ä¸€ä¸ªå•è¯æˆ–çŸ­è¯­è¡¨ç¤ºä¸ºä½ç»´å‘é‡.mindnlpæä¾›äº†ä¸€ä¸ªå¿«é€Ÿé€šè¿‡é¢„è®­ç»ƒglove,fasttext,word2vecè¯å‘é‡ç®€å•æ„é€ embeddingçš„æ–¹æ³•</p><p><a href="https://zhuanlan.zhihu.com/p/150556238">embeddingçš„å‘å±•å’Œå¸¸ç”¨embedding</a><br><a href="https://zhuanlan.zhihu.com/p/164502624">embeddingåŸºæœ¬æ¦‚å¿µ</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import numpy as np</span><br><span class="line">from mindspore import Tensor</span><br><span class="line">from mindspore.dataset.text.utils import Vocab</span><br><span class="line">from mindnlp.modules.embeddings.glove_embedding import Glove</span><br><span class="line"></span><br><span class="line"># è¿™ä¸ªæ˜¯è‡ªå·±å®šä¹‰çš„ï¼Œéœ€è¦å­—å…¸å’Œå¯¹åº”çš„å‘é‡ï¼Œç„¶åå¯ä»¥ä¼ å…¥è¿™ä¸¤ä¸ªå‚æ•°åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„glove</span><br><span class="line"># Define your own vocab</span><br><span class="line">vocab = Vocab.from_list([&#x27;default&#x27;, &#x27;one&#x27;, &#x27;two&#x27;, &#x27;three&#x27;])</span><br><span class="line"># Define your own embedding table</span><br><span class="line">init_embed = Tensor(np.zeros((4, 4)).astype(np.float32))</span><br><span class="line"># Create your own embedding object</span><br><span class="line">glove_embed = Glove(vocab, init_embed)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ç›´æ¥ç”¨ä»–å®šä¹‰å¥½çš„ï¼Œpretrainedçš„</span><br><span class="line"># You can also use pre-trained word vectors</span><br><span class="line">glove_embed_pretrained, _ = Glove.from_pretrained()</span><br><span class="line"></span><br><span class="line"># è¿™ä¸ªEmbeddingæ€ä¹ˆåå‘é€šè¿‡å‘é‡è¾“å‡ºæ–‡å­—</span><br><span class="line"># The index to query for</span><br><span class="line">ids = Tensor([1, 2, 3])</span><br><span class="line"></span><br><span class="line"># Computed by the built embedding</span><br><span class="line">output = glove_embed(ids)</span><br></pre></td></tr></table></figure><h3 id="encoder-decoder">Encoder-Decoder</h3><p>Encoder-Decoderæ˜¯ä¸€ä¸ªæ¨¡å‹æ¶æ„ï¼Œæ˜¯ä¸€ç±»ç®—æ³•ç»Ÿç§°ã€‚åœ¨è¿™ä¸ªæ¡†æ¶ä¸‹å¯ä»¥ä½¿ç”¨ä¸åŒçš„ç®—æ³•æ¥è§£å†³ä¸åŒçš„äººç‰©ã€‚Encoderå°†è¾“å…¥åºåˆ—è½¬åŒ–ä¸ºè¯­ä¹‰å‘é‡ï¼ŒDecoderæ ¹æ®Encoderçš„è¾“å‡ºç”Ÿæˆç›®æ ‡è¯‘æ–‡ã€‚<a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/modules/encoder.html">MindNLP.modules.encoder</a> å’Œ <a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/modules/decoder.html">MindNLP.modules.decoder</a> ï¼ŒMindNLPä¸­åŒ…å«çš„Encoder-Decoderæ¨¡å—å¦‚ä¸‹è¡¨æ‰€ç¤º</p><table><thead><tr><th>åç§°</th><th>ä»‹ç»</th></tr></thead><tbody><tr><td><a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/modules/encoder.html#mindnlp.modules.encoder.cnn_encoder.CNNEncoder"><code>CNNEncoder</code></a></td><td>ç”±ä¼ å…¥å‚æ•°convolutionsç»„æˆçš„å·ç§¯ç¼–ç å™¨</td></tr><tr><td><a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/modules/encoder.html#mindnlp.modules.encoder.rnn_encoder.RNNEncoder"><code>RNNEncoder</code></a></td><td>å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰ç¼–ç å™¨</td></tr><tr><td><a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/modules/decoder.html#mindnlp.modules.decoder.rnn_decoder.RNNDecoder"><code>RNNDecoder</code></a></td><td>å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰è§£ç å™¨</td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">from mindspore import nn</span><br><span class="line">from mindnlp.abc import Seq2seqModel</span><br><span class="line">from mindnlp.modules import RNNEncoder, RNNDecoder</span><br><span class="line"></span><br><span class="line">class MachineTranslation(Seq2seqModel):</span><br><span class="line">    def __init__(self, encoder, decoder):</span><br><span class="line">        super().__init__(encoder, decoder)</span><br><span class="line">        self.encoder = encoder</span><br><span class="line">        self.decoder = decoder</span><br><span class="line"></span><br><span class="line">    def construct(self, en, de):</span><br><span class="line">        encoder_out = self.encoder(en)</span><br><span class="line">        decoder_out = self.decoder(de, encoder_out=encoder_out)</span><br><span class="line">        output = decoder_out[0]</span><br><span class="line">        return output.swapaxes(1,2)</span><br><span class="line"></span><br><span class="line">enc_emb_dim = 256</span><br><span class="line">dec_emb_dim = 256</span><br><span class="line">enc_hid_dim = 512</span><br><span class="line">dec_hid_dim = 512</span><br><span class="line">enc_dropout = 0.5</span><br><span class="line">dec_dropout = 0.5</span><br><span class="line"></span><br><span class="line"># encoder</span><br><span class="line">en_embedding = nn.Embedding(input_dim, enc_emb_dim)</span><br><span class="line">en_rnn = nn.RNN(enc_emb_dim, hidden_size=enc_hid_dim, num_layers=2, has_bias=True,batch_first=True, dropout=enc_dropout, bidirectional=False)</span><br><span class="line">rnn_encoder = RNNEncoder(en_embedding, en_rnn)</span><br><span class="line"></span><br><span class="line"># decoder</span><br><span class="line">de_embedding = nn.Embedding(output_dim, dec_emb_dim)</span><br><span class="line">input_feed_size = 0 if enc_hid_dim == 0 else dec_hid_dim</span><br><span class="line">rnns = [</span><br><span class="line">    nn.RNNCell(</span><br><span class="line">        input_size=dec_emb_dim + input_feed_size</span><br><span class="line">        if layer == 0</span><br><span class="line">            else dec_hid_dim,</span><br><span class="line">        hidden_size=dec_hid_dim</span><br><span class="line">        )</span><br><span class="line">        for layer in range(2)</span><br><span class="line">]</span><br><span class="line">rnn_decoder = RNNDecoder(de_embedding, rnns, dropout_in=enc_dropout, dropout_out = dec_dropout,attention=True, encoder_output_units=enc_hid_dim)</span><br></pre></td></tr></table></figure><h3 id="attention">Attention</h3><p>ç›®å‰ï¼ŒMindNlpå·²ç»å®ç°äº†8ç§æ³¨æ„åŠ›æœºåˆ¶ã€‚ <a href="https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/modules/attentions.html">MindNLP.modules.attentions</a> .</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import mindspore</span><br><span class="line">from mindspore import Tensor</span><br><span class="line">from mindspore.text.modules.attentions import ScaledDotAttention</span><br><span class="line">model = ScaledDotAttention(dropout=0.9)</span><br><span class="line"># You can customize the query, key, vlaue vector</span><br><span class="line">q = Tensor(np.ones((2, 32, 512)), mindspore.float32)</span><br><span class="line">k = Tensor(np.ones((2, 20, 512)), mindspore.float32)</span><br><span class="line">v = Tensor(np.ones((2, 20, 400)), mindspore.float32)</span><br><span class="line">output, att = model(q, k, v)</span><br><span class="line"># output shape is (2, 1024, 512)</span><br><span class="line"># att shape is (2, 1024, 32)</span><br></pre></td></tr></table></figure><h2 id="ç¤ºä¾‹å››ä¸ª">ç¤ºä¾‹å››ä¸ª</h2><h3 id="æ–‡æœ¬åˆ†ç±»">æ–‡æœ¬åˆ†ç±»</h3><h3 id="åºåˆ—ç¿»è¯‘">åºåˆ—ç¿»è¯‘</h3><h3 id="æœºå™¨å­¦ä¹ ">æœºå™¨å­¦ä¹ </h3><h3 id="å›ç­”é—®é¢˜">å›ç­”é—®é¢˜</h3>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;mindNLP&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://mindnlpdocs.readthedocs.io/zh-cn/latest/api/abc.html&quot;&gt;API reference&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://mindnlp</summary>
      
    
    
    
    
    <category term="mindsporeå®ä¹ " scheme="http://outbreak-sen.github.io/tags/mindspore%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="mindNLP" scheme="http://outbreak-sen.github.io/tags/mindNLP/"/>
    
  </entry>
  
  <entry>
    <title>æ¨¡å‹é¢„è®­ç»ƒä¸å¾®è°ƒçš„å‘å±•å†ç¨‹åŠæ ¸å¿ƒè®ºæ–‡/é¡¹ç›®æ¨è</title>
    <link href="http://outbreak-sen.github.io/2025/02/24/%E9%A2%84%E8%AE%AD%E7%BB%83%E7%9A%84%E4%B8%80%E7%82%B9%E7%AC%94%E8%AE%B0/"/>
    <id>http://outbreak-sen.github.io/2025/02/24/%E9%A2%84%E8%AE%AD%E7%BB%83%E7%9A%84%E4%B8%80%E7%82%B9%E7%AC%94%E8%AE%B0/</id>
    <published>2025-02-24T05:43:14.000Z</published>
    <updated>2025-03-19T11:40:03.533Z</updated>
    
    <content type="html"><![CDATA[<h3 id="æ¨¡å‹é¢„è®­ç»ƒä¸å¾®è°ƒçš„å‘å±•å†ç¨‹åŠæ ¸å¿ƒè®ºæ–‡-é¡¹ç›®æ¨è">æ¨¡å‹é¢„è®­ç»ƒä¸å¾®è°ƒçš„å‘å±•å†ç¨‹åŠæ ¸å¿ƒè®ºæ–‡/é¡¹ç›®æ¨è</h3><h4 id="ä¸€-æ¨¡å‹é¢„è®­ç»ƒ-pre-training"><strong>ä¸€ã€æ¨¡å‹é¢„è®­ç»ƒï¼ˆPre-trainingï¼‰</strong></h4><p>é¢„è®­ç»ƒæ¨¡å‹çš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡å¤§è§„æ¨¡æ— æ ‡æ³¨æ•°æ®è®­ç»ƒæ¨¡å‹ï¼Œå­¦ä¹ é€šç”¨è¯­è¨€æˆ–è§†è§‰è¡¨å¾ï¼Œå†é€šè¿‡å¾®è°ƒé€‚åº”å…·ä½“ä»»åŠ¡ã€‚å…¶å‘å±•ç»å†äº†ä»¥ä¸‹å…³é”®é˜¶æ®µï¼š</p><hr><h5 id="1-é¢„è®­ç»ƒæ¦‚å¿µçš„æå‡ºä¸æ—©æœŸæ¢ç´¢"><strong>1. é¢„è®­ç»ƒæ¦‚å¿µçš„æå‡ºä¸æ—©æœŸæ¢ç´¢</strong></h5><ul><li><strong>Word2Vecï¼ˆ2013ï¼‰</strong>ï¼šé€šè¿‡æ— ç›‘ç£å­¦ä¹ è¯å‘é‡ï¼Œé¦–æ¬¡å±•ç¤ºäº†ä»å¤§è§„æ¨¡æ–‡æœ¬ä¸­å­¦ä¹ è¯­ä¹‰è¡¨å¾çš„å¯èƒ½æ€§ã€‚</li><li><strong>ELMoï¼ˆ2018ï¼‰</strong>ï¼šå¼•å…¥ä¸Šä¸‹æ–‡ç›¸å…³çš„è¯å‘é‡ï¼Œé€šè¿‡åŒå‘LSTMæ¨¡å‹æ•æ‰è¯­å¢ƒä¿¡æ¯ï¼Œæ¨åŠ¨äº†é¢„è®­ç»ƒåœ¨NLPä¸­çš„åº”ç”¨ã€‚</li></ul><h5 id="2-é¢„è®­ç»ƒçš„èŒƒå¼é©æ–°"><strong>2. é¢„è®­ç»ƒçš„èŒƒå¼é©æ–°</strong></h5><ul><li><strong>BERTï¼ˆ2018ï¼‰</strong>ï¼šåŸºäºTransformerçš„åŒå‘ç¼–ç å™¨ï¼Œé€šè¿‡æ©ç è¯­è¨€æ¨¡å‹ï¼ˆMasked LMï¼‰å’Œä¸‹ä¸€å¥é¢„æµ‹ä»»åŠ¡ï¼Œé¦–æ¬¡åœ¨å¤šä¸ªNLPä»»åŠ¡ä¸­å®ç°SOTAæ€§èƒ½ã€‚</li><li><strong>GPTç³»åˆ—ï¼ˆ2018-2020ï¼‰</strong>ï¼šä»GPT-1åˆ°GPT-3ï¼Œé€æ­¥éªŒè¯äº†å•å‘è‡ªå›å½’è¯­è¨€æ¨¡å‹çš„ç”Ÿæˆèƒ½åŠ›ï¼Œå°¤å…¶æ˜¯GPT-3é€šè¿‡æµ·é‡å‚æ•°å’Œé›¶æ ·æœ¬å­¦ä¹ å±•ç¤ºäº†æ¨¡å‹çš„é€šç”¨æ€§ã€‚</li></ul><h5 id="3-é¢„è®­ç»ƒçš„æ”¹è¿›æ–¹å‘"><strong>3. é¢„è®­ç»ƒçš„æ”¹è¿›æ–¹å‘</strong></h5><ul><li><strong>æ¨¡å‹æ¶æ„ä¼˜åŒ–</strong>ï¼šå¦‚RoBERTaï¼ˆæ”¹è¿›BERTè®­ç»ƒç­–ç•¥ï¼‰ã€T5ï¼ˆç»Ÿä¸€æ–‡æœ¬ç”Ÿæˆæ¡†æ¶ï¼‰ã€Switch Transformerï¼ˆæ··åˆä¸“å®¶æ¶æ„MoEï¼‰ç­‰ã€‚</li><li><strong>è®­ç»ƒæ•ˆç‡æå‡</strong>ï¼šå¦‚DeepSeek-V3ï¼ˆ2024ï¼‰ç»“åˆMoEå’Œå¤šå¤´æ½œåœ¨æ³¨æ„åŠ›ï¼ˆMLAï¼‰ï¼Œæ˜¾è‘—é™ä½è®­ç»ƒæˆæœ¬å¹¶æå‡æ€§èƒ½ã€‚</li><li><strong>å¤šæ¨¡æ€é¢„è®­ç»ƒ</strong>ï¼šå¦‚CLIPï¼ˆå›¾æ–‡è·¨æ¨¡æ€å¯¹é½ï¼‰ã€DALLÂ·Eï¼ˆæ–‡æœ¬åˆ°å›¾åƒç”Ÿæˆï¼‰ï¼Œæ‰©å±•äº†é¢„è®­ç»ƒçš„é€‚ç”¨èŒƒå›´ã€‚</li></ul><hr><h4 id="äºŒ-æ¨¡å‹å¾®è°ƒ-fine-tuning"><strong>äºŒã€æ¨¡å‹å¾®è°ƒï¼ˆFine-tuningï¼‰</strong></h4><p>å¾®è°ƒæ˜¯åœ¨é¢„è®­ç»ƒæ¨¡å‹åŸºç¡€ä¸Šï¼Œé€šè¿‡ç‰¹å®šä»»åŠ¡çš„å°è§„æ¨¡æ ‡æ³¨æ•°æ®è°ƒæ•´å‚æ•°ï¼Œä½¿å…¶é€‚åº”ä¸‹æ¸¸ä»»åŠ¡ã€‚å…¶å‘å±•é‡ç‚¹åœ¨äº<strong>å¹³è¡¡æ€§èƒ½ä¸æ•ˆç‡</strong>ï¼š</p><hr><h5 id="1-å…¨å‚æ•°å¾®è°ƒ-full-fine-tuning"><strong>1. å…¨å‚æ•°å¾®è°ƒï¼ˆFull Fine-tuningï¼‰</strong></h5><ul><li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šæ›´æ–°é¢„è®­ç»ƒæ¨¡å‹çš„æ‰€æœ‰å‚æ•°ï¼Œé€‚ç”¨äºæ•°æ®é‡è¾ƒå¤§çš„åœºæ™¯ã€‚</li><li><strong>å±€é™æ€§</strong>ï¼šè®¡ç®—æˆæœ¬é«˜ï¼Œæ˜“å¯¼è‡´ç¾éš¾æ€§é—å¿˜ï¼ˆCatastrophic Forgettingï¼‰ã€‚</li></ul><h5 id="2-å‚æ•°é«˜æ•ˆå¾®è°ƒ-parameter-efficient-fine-tuning-peft"><strong>2. å‚æ•°é«˜æ•ˆå¾®è°ƒï¼ˆParameter-Efficient Fine-tuning, PEFTï¼‰</strong></h5><ul><li><strong>Adapterï¼ˆ2019ï¼‰</strong>ï¼šåœ¨Transformerå±‚ä¸­æ’å…¥å°å‹é€‚é…æ¨¡å—ï¼Œä»…è®­ç»ƒæ–°å¢å‚æ•°ã€‚</li><li><strong>LoRAï¼ˆ2021ï¼‰</strong>ï¼šé€šè¿‡ä½ç§©çŸ©é˜µåˆ†è§£è°ƒæ•´æƒé‡ï¼Œå‡å°‘å‚æ•°é‡ï¼Œé€‚ç”¨äºå¤§æ¨¡å‹å¾®è°ƒã€‚</li><li><strong>Prompt Tuning &amp; Prefix Tuningï¼ˆ2021ï¼‰</strong>ï¼šé€šè¿‡å¯å­¦ä¹ çš„æç¤ºè¯æˆ–å‰ç¼€å‘é‡å¼•å¯¼æ¨¡å‹è¾“å‡ºï¼Œå‡å°‘è®¡ç®—å¼€é”€ã€‚</li><li><strong>QLORAï¼ˆ2023ï¼‰</strong>ï¼šç»“åˆ4ä½é‡åŒ–å’ŒLoRAï¼Œå®ç°åœ¨å•å¡ä¸Šå¾®è°ƒè¶…å¤§è§„æ¨¡æ¨¡å‹ï¼ˆå¦‚65Bå‚æ•°ï¼‰ã€‚</li></ul><h5 id="3-å¾®è°ƒç­–ç•¥çš„åˆ›æ–°"><strong>3. å¾®è°ƒç­–ç•¥çš„åˆ›æ–°</strong></h5><ul><li><strong>æŒ‡ä»¤å¾®è°ƒï¼ˆInstruction Tuningï¼‰</strong>ï¼šé€šè¿‡æŒ‡ä»¤-å“åº”å¯¹æ•°æ®è°ƒæ•´æ¨¡å‹ï¼Œæå‡æ³›åŒ–èƒ½åŠ›ï¼ˆå¦‚Alpacaã€Vicunaï¼‰ã€‚</li><li><strong>å¤šä»»åŠ¡å¾®è°ƒ</strong>ï¼šè”åˆè®­ç»ƒå¤šä¸ªä»»åŠ¡ï¼Œå¢å¼ºæ¨¡å‹é²æ£’æ€§ã€‚</li><li><strong>å¢é‡é¢„è®­ç»ƒï¼ˆContinual Pre-trainingï¼‰</strong>ï¼šåœ¨é¢†åŸŸæ•°æ®ä¸Šç»§ç»­é¢„è®­ç»ƒï¼Œæ³¨å…¥ä¸“ä¸šçŸ¥è¯†ï¼ˆå¦‚MedicalGPTï¼‰ã€‚</li></ul><hr><h4 id="ä¸‰-å…³é”®è®ºæ–‡ä¸é¡¹ç›®æ¨è"><strong>ä¸‰ã€å…³é”®è®ºæ–‡ä¸é¡¹ç›®æ¨è</strong></h4><h5 id="æ ¸å¿ƒè®ºæ–‡"><strong>æ ¸å¿ƒè®ºæ–‡</strong></h5><ol><li><p><strong>é¢„è®­ç»ƒ</strong></p><ul><li><em>BERT: Pre-training of Deep Bidirectional Transformers for Language Understanding</em>ï¼ˆ2018ï¼‰</li><li><em>Language Models are Few-Shot Learners</em>ï¼ˆGPT-3, 2020ï¼‰</li><li><em>DeepSeek-V3: A Cost-Effective Foundation Model with MoE and MLA</em>ï¼ˆ2024ï¼‰</li></ul></li><li><p><strong>å¾®è°ƒ</strong></p><ul><li><em>LoRA: Low-Rank Adaptation of Large Language Models</em>ï¼ˆ2021ï¼‰<br>PEFT æ˜¯ä¸€ç±»å‚æ•°é«˜æ•ˆå¾®è°ƒæŠ€æœ¯çš„ç»Ÿç§°ï¼Œæ—¨åœ¨é€šè¿‡è°ƒæ•´å°‘é‡å‚æ•°æ¥å®Œæˆæ¨¡å‹çš„å¾®è°ƒã€‚LoRA æ˜¯ PEFT çš„ä¸€ç§å…·ä½“å®ç°ï¼ŒPEFT è¿˜åŒ…æ‹¬å…¶ä»–æ–¹æ³•ï¼Œå¦‚ Adapterã€Prefix Tuningã€Prompt Tuning ç­‰ã€‚</li><li><em>The Power of Scale for Parameter-Efficient Prompt Tuning</em>ï¼ˆ2021ï¼‰</li><li><em>QLORA: Efficient Finetuning of Quantized LLMs</em>ï¼ˆ2023ï¼‰</li></ul></li></ol><h5 id="å¼€æºé¡¹ç›®"><strong>å¼€æºé¡¹ç›®</strong></h5><ol><li><p><strong>é¢„è®­ç»ƒæ¡†æ¶</strong></p><ul><li><strong>Transformersï¼ˆHugging Faceï¼‰</strong>ï¼šæ”¯æŒBERTã€GPTç­‰ä¸»æµæ¨¡å‹çš„é¢„è®­ç»ƒä¸å¾®è°ƒã€‚</li><li><strong>DeepSpeedï¼ˆMicrosoftï¼‰</strong>ï¼šä¼˜åŒ–å¤§æ¨¡å‹è®­ç»ƒæ•ˆç‡ï¼Œæ”¯æŒåƒäº¿å‚æ•°æ¨¡å‹ã€‚</li></ul></li><li><p><strong>å¾®è°ƒå·¥å…·</strong></p><ul><li><strong>PEFTåº“</strong>ï¼šé›†æˆLoRAã€Prefix Tuningç­‰é«˜æ•ˆå¾®è°ƒæ–¹æ³•ã€‚</li><li><strong>LLaMA-Factory</strong>ï¼šæ”¯æŒå¤šæ¨¡æ€å¤§æ¨¡å‹çš„è½»é‡åŒ–å¾®è°ƒã€‚</li><li><strong>QLORAå®˜æ–¹ä»£ç </strong>ï¼šå¼€æºçš„é«˜æ•ˆé‡åŒ–å¾®è°ƒæ–¹æ¡ˆã€‚</li></ul></li><li><p><strong>é¢†åŸŸå®è·µ</strong></p><ul><li><strong>MedicalGPT</strong>ï¼šåŒ»ç–—é¢†åŸŸå¢é‡é¢„è®­ç»ƒä¸å¾®è°ƒçš„å…¸å‹æ¡ˆä¾‹ã€‚</li><li><strong>MetaMathQA</strong>ï¼šæ•°å­¦æ¨ç†ä»»åŠ¡çš„æŒ‡ä»¤å¾®è°ƒæ•°æ®é›†ä¸æ¨¡å‹ã€‚</li></ul></li></ol><hr><h4 id="å››-æœªæ¥è¶‹åŠ¿"><strong>å››ã€æœªæ¥è¶‹åŠ¿</strong></h4><ol><li><strong>æ›´é«˜æ•ˆçš„è®­ç»ƒæŠ€æœ¯</strong>ï¼šå¦‚Muonä¼˜åŒ–å™¨ï¼ˆ2025ï¼‰é€šè¿‡çŸ©é˜µæ­£äº¤åŒ–æå‡è®­ç»ƒæ•ˆç‡200%ã€‚</li><li><strong>å¤šæ¨¡æ€èåˆ</strong>ï¼šç»“åˆè§†è§‰ã€è¯­è¨€ç­‰å¤šæ¨¡æ€æ•°æ®çš„é¢„è®­ç»ƒä¸å¾®è°ƒï¼ˆå¦‚DeepSeek-R1ï¼‰ã€‚</li><li><strong>è‡ªåŠ¨åŒ–å¾®è°ƒ</strong>ï¼šé€šè¿‡å…ƒå­¦ä¹ ï¼ˆå¦‚MELTRæ¡†æ¶ï¼‰åŠ¨æ€ä¼˜åŒ–æŸå¤±å‡½æ•°ç»„åˆã€‚<br><strong>LoRA</strong>ï¼ˆLow-Rank Adaptationï¼‰å’Œ <strong>PEFT</strong>ï¼ˆParameter-Efficient Fine-tuningï¼‰æ˜¯ä¸¤ç§ç”¨äºæ¨¡å‹å¾®è°ƒçš„æŠ€æœ¯ï¼Œæ—¨åœ¨é€šè¿‡å‡å°‘éœ€è¦è°ƒæ•´çš„å‚æ•°æ•°é‡æ¥æé«˜å¾®è°ƒçš„æ•ˆç‡ï¼Œå°¤å…¶æ˜¯åœ¨å¤§æ¨¡å‹ï¼ˆå¦‚LLMï¼ŒLarge Language Modelsï¼‰çš„åœºæ™¯ä¸‹ã€‚ä»¥ä¸‹æ˜¯å¯¹å®ƒä»¬çš„è¯¦ç»†è§£é‡Šï¼š</li></ol><hr><h2 id="1-lora-low-rank-adaptation">1. <strong>LoRAï¼ˆLow-Rank Adaptationï¼‰</strong></h2><h3 id="æ¦‚å¿µ">æ¦‚å¿µ</h3><p>LoRA æ˜¯ä¸€ç§å‚æ•°é«˜æ•ˆçš„å¾®è°ƒæ–¹æ³•ï¼Œä¸“æ³¨äºé€šè¿‡ä½ç§©åˆ†è§£ï¼ˆLow-Rank Decompositionï¼‰æ¥å‡å°‘éœ€è¦è°ƒæ•´çš„å‚æ•°æ•°é‡ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåœ¨å¾®è°ƒè¿‡ç¨‹ä¸­ï¼Œä¸ç›´æ¥æ›´æ–°æ•´ä¸ªé¢„è®­ç»ƒæ¨¡å‹çš„å‚æ•°ï¼Œè€Œæ˜¯é€šè¿‡å¼•å…¥å°‘é‡çš„ä½ç§©çŸ©é˜µæ¥è°ƒæ•´æ¨¡å‹çš„æƒé‡ã€‚</p><h3 id="å·¥ä½œåŸç†">å·¥ä½œåŸç†</h3><ul><li>åœ¨é¢„è®­ç»ƒæ¨¡å‹çš„æŸäº›å±‚ï¼ˆé€šå¸¸æ˜¯æ³¨æ„åŠ›æœºåˆ¶ä¸­çš„æƒé‡çŸ©é˜µï¼‰ä¸­ï¼ŒLoRA ä¼šæ·»åŠ ä¸¤ä¸ªä½ç§©çŸ©é˜µ ( A ) å’Œ ( B )ã€‚</li><li>è¿™äº›ä½ç§©çŸ©é˜µçš„ä¹˜ç§¯ ( A \times B ) è¢«ç”¨æ¥è°ƒæ•´åŸå§‹æƒé‡çŸ©é˜µ ( W )ï¼Œå³ï¼š<br>[<br>Wâ€™ = W + A \times B<br>]<br>å…¶ä¸­ï¼Œ( A ) å’Œ ( B ) æ˜¯å¯è®­ç»ƒçš„å‚æ•°ï¼Œè€Œ ( W ) æ˜¯é¢„è®­ç»ƒæ¨¡å‹çš„å›ºå®šå‚æ•°ã€‚</li><li>ç”±äº ( A ) å’Œ ( B ) çš„ç»´åº¦è¿œå°äº ( W )ï¼Œå› æ­¤éœ€è¦è°ƒæ•´çš„å‚æ•°æ•°é‡å¤§å¤§å‡å°‘ã€‚</li></ul><h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h3><ul><li><strong>å‚æ•°é«˜æ•ˆ</strong>ï¼šåªéœ€è¦è°ƒæ•´å°‘é‡å‚æ•°ï¼Œé€‚åˆèµ„æºå—é™çš„åœºæ™¯ã€‚</li><li><strong>æ¨¡å—åŒ–</strong>ï¼šå¯ä»¥è½»æ¾æ·»åŠ åˆ°ç°æœ‰æ¨¡å‹ä¸­ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹æ¨¡å‹æ¶æ„ã€‚</li><li><strong>æ€§èƒ½æ¥è¿‘å…¨å‚æ•°å¾®è°ƒ</strong>ï¼šåœ¨è®¸å¤šä»»åŠ¡ä¸Šï¼ŒLoRA çš„æ€§èƒ½æ¥è¿‘å…¨å‚æ•°å¾®è°ƒï¼Œä½†è®¡ç®—æˆæœ¬æ›´ä½ã€‚</li></ul><h3 id="é€‚ç”¨åœºæ™¯">é€‚ç”¨åœºæ™¯</h3><ul><li>å¤§æ¨¡å‹ï¼ˆå¦‚ GPTã€BERT ç­‰ï¼‰çš„å¾®è°ƒã€‚</li><li>èµ„æºå—é™çš„ç¯å¢ƒï¼ˆå¦‚å•å¡ GPU æˆ–ä½æ˜¾å­˜è®¾å¤‡ï¼‰ã€‚</li></ul><hr><h2 id="2-peft-parameter-efficient-fine-tuning">2. <strong>PEFTï¼ˆParameter-Efficient Fine-tuningï¼‰</strong></h2><h3 id="æ¦‚å¿µ">æ¦‚å¿µ</h3><p>PEFT æ˜¯ä¸€ç±»å‚æ•°é«˜æ•ˆå¾®è°ƒæŠ€æœ¯çš„ç»Ÿç§°ï¼Œæ—¨åœ¨é€šè¿‡è°ƒæ•´å°‘é‡å‚æ•°æ¥å®Œæˆæ¨¡å‹çš„å¾®è°ƒã€‚LoRA æ˜¯ PEFT çš„ä¸€ç§å…·ä½“å®ç°ï¼ŒPEFT è¿˜åŒ…æ‹¬å…¶ä»–æ–¹æ³•ï¼Œå¦‚ <strong>Adapter</strong>ã€<strong>Prefix Tuning</strong>ã€<strong>Prompt Tuning</strong> ç­‰ã€‚</p><h3 id="å¸¸è§çš„-peft-æ–¹æ³•">å¸¸è§çš„ PEFT æ–¹æ³•</h3><ol><li><p><strong>Adapter</strong>ï¼š</p><ul><li>åœ¨æ¨¡å‹çš„æŸäº›å±‚ä¸­æ’å…¥å°å‹ç¥ç»ç½‘ç»œæ¨¡å—ï¼ˆAdapterï¼‰ï¼Œåªè®­ç»ƒè¿™äº›æ¨¡å—ï¼Œè€Œå†»ç»“åŸå§‹æ¨¡å‹çš„å‚æ•°ã€‚</li><li>Adapter é€šå¸¸ç”±ä¸¤å±‚å…¨è¿æ¥ç½‘ç»œç»„æˆï¼Œå‚æ•°é‡è¾ƒå°‘ã€‚</li></ul></li><li><p><strong>Prefix Tuning</strong>ï¼š</p><ul><li>åœ¨è¾“å…¥åºåˆ—å‰æ·»åŠ å¯å­¦ä¹ çš„â€œå‰ç¼€â€å‘é‡ï¼Œé€šè¿‡è°ƒæ•´è¿™äº›å‰ç¼€å‘é‡æ¥å¾®è°ƒæ¨¡å‹ã€‚</li><li>é€‚ç”¨äºç”Ÿæˆä»»åŠ¡ï¼ˆå¦‚æ–‡æœ¬ç”Ÿæˆï¼‰ã€‚</li></ul></li><li><p><strong>Prompt Tuning</strong>ï¼š</p><ul><li>ç±»ä¼¼äº Prefix Tuningï¼Œä½†åªè°ƒæ•´è¾“å…¥ä¸­çš„æç¤ºï¼ˆPromptï¼‰éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå‰ç¼€ã€‚</li><li>é€‚ç”¨äºå°‘æ ·æœ¬å­¦ä¹ ï¼ˆFew-shot Learningï¼‰ã€‚</li></ul></li><li><p><strong>LoRA</strong>ï¼š</p><ul><li>å¦‚ä¸Šæ‰€è¿°ï¼Œé€šè¿‡ä½ç§©çŸ©é˜µè°ƒæ•´æ¨¡å‹æƒé‡ã€‚</li></ul></li></ol><h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h3><ul><li><strong>é«˜æ•ˆ</strong>ï¼šå¤§å¹…å‡å°‘éœ€è¦è°ƒæ•´çš„å‚æ•°æ•°é‡ï¼Œé™ä½è®¡ç®—å’Œå­˜å‚¨æˆæœ¬ã€‚</li><li><strong>çµæ´»</strong>ï¼šå¯ä»¥æ ¹æ®ä»»åŠ¡éœ€æ±‚é€‰æ‹©ä¸åŒçš„ PEFT æ–¹æ³•ã€‚</li><li><strong>å¯æ‰©å±•</strong>ï¼šé€‚ç”¨äºå„ç§å¤§æ¨¡å‹å’Œä»»åŠ¡ã€‚</li></ul><h3 id="é€‚ç”¨åœºæ™¯">é€‚ç”¨åœºæ™¯</h3><ul><li>å¤§æ¨¡å‹çš„å¾®è°ƒï¼Œå°¤å…¶æ˜¯åœ¨èµ„æºå—é™çš„ç¯å¢ƒä¸­ã€‚</li><li>å¤šä»»åŠ¡å­¦ä¹ ï¼Œé€šè¿‡å…±äº«é¢„è®­ç»ƒæ¨¡å‹å¹¶é’ˆå¯¹ä¸åŒä»»åŠ¡ä½¿ç”¨ä¸åŒçš„ PEFT æ¨¡å—ã€‚</li></ul><hr><h2 id="3-lora-å’Œ-peft-çš„å…³ç³»">3. <strong>LoRA å’Œ PEFT çš„å…³ç³»</strong></h2><ul><li>LoRA æ˜¯ PEFT çš„ä¸€ç§å…·ä½“å®ç°ï¼ŒPEFT æ˜¯ä¸€ä¸ªæ›´å¹¿æ³›çš„æ¦‚å¿µï¼Œæ¶µç›–äº†å¤šç§å‚æ•°é«˜æ•ˆå¾®è°ƒæŠ€æœ¯ã€‚</li><li>LoRA é€šè¿‡ä½ç§©åˆ†è§£è°ƒæ•´æ¨¡å‹æƒé‡ï¼Œè€Œå…¶ä»– PEFT æ–¹æ³•ï¼ˆå¦‚ Adapterã€Prefix Tuningï¼‰åˆ™é€šè¿‡ä¸åŒçš„æ–¹å¼å®ç°å‚æ•°é«˜æ•ˆå¾®è°ƒã€‚</li></ul><hr><h2 id="4-å¦‚ä½•é€‰æ‹©-lora-æˆ–-peftï¼Ÿ">4. <strong>å¦‚ä½•é€‰æ‹© LoRA æˆ– PEFTï¼Ÿ</strong></h2><ul><li>å¦‚æœä½ çš„ä»»åŠ¡æ˜¯ç”Ÿæˆä»»åŠ¡ï¼ˆå¦‚æ–‡æœ¬ç”Ÿæˆï¼‰ï¼Œå¹¶ä¸”å¸Œæœ›å‡å°‘å‚æ•°è°ƒæ•´é‡ï¼Œå¯ä»¥é€‰æ‹© <strong>LoRA</strong> æˆ– <strong>Prefix Tuning</strong>ã€‚</li><li>å¦‚æœä½ çš„ä»»åŠ¡æ˜¯åˆ†ç±»ä»»åŠ¡ï¼Œå¹¶ä¸”å¸Œæœ›æ¨¡å—åŒ–åœ°æ’å…¥å¾®è°ƒæ¨¡å—ï¼Œå¯ä»¥é€‰æ‹© <strong>Adapter</strong>ã€‚</li><li>å¦‚æœä½ å¸Œæœ›æœ€å¤§é™åº¦åœ°å‡å°‘å‚æ•°è°ƒæ•´é‡ï¼Œå¹¶ä¸”ä»»åŠ¡å¯¹æç¤ºï¼ˆPromptï¼‰æ•æ„Ÿï¼Œå¯ä»¥é€‰æ‹© <strong>Prompt Tuning</strong>ã€‚</li></ul><hr><h2 id="5-å®é™…åº”ç”¨ä¸­çš„æ¨è">5. <strong>å®é™…åº”ç”¨ä¸­çš„æ¨è</strong></h2><ul><li><strong>LoRA</strong> æ˜¯ç›®å‰æœ€æµè¡Œçš„ PEFT æ–¹æ³•ä¹‹ä¸€ï¼Œå°¤å…¶æ˜¯åœ¨å¤§æ¨¡å‹å¾®è°ƒä¸­ï¼Œå› ä¸ºå®ƒç®€å•é«˜æ•ˆä¸”æ€§èƒ½æ¥è¿‘å…¨å‚æ•°å¾®è°ƒã€‚</li><li>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Hugging Face çš„ <code>transformers</code> åº“ï¼Œå¯ä»¥ç»“åˆ <code>peft</code> åº“ï¼ˆParameter-Efficient Fine-tuning Libraryï¼‰æ¥è½»æ¾å®ç° LoRA å’Œå…¶ä»– PEFT æ–¹æ³•ã€‚</li></ul><h3 id="ç¤ºä¾‹ä»£ç -ä½¿ç”¨-hugging-face-peft-å®ç°-lora">ç¤ºä¾‹ä»£ç ï¼ˆä½¿ç”¨ Hugging Face + PEFT å®ç° LoRAï¼‰</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoModelForCausalLM, AutoTokenizer</span><br><span class="line"><span class="keyword">from</span> peft <span class="keyword">import</span> get_peft_model, LoraConfig, TaskType</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½é¢„è®­ç»ƒæ¨¡å‹å’Œåˆ†è¯å™¨</span></span><br><span class="line">model_name = <span class="string">&quot;bigscience/bloom-560m&quot;</span></span><br><span class="line">model = AutoModelForCausalLM.from_pretrained(model_name)</span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(model_name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½® LoRA</span></span><br><span class="line">lora_config = LoraConfig(</span><br><span class="line">    task_type=TaskType.CAUSAL_LM,  <span class="comment"># ä»»åŠ¡ç±»å‹</span></span><br><span class="line">    r=<span class="number">8</span>,  <span class="comment"># ä½ç§©çŸ©é˜µçš„ç§©</span></span><br><span class="line">    lora_alpha=<span class="number">32</span>,  <span class="comment"># ç¼©æ”¾å› å­</span></span><br><span class="line">    lora_dropout=<span class="number">0.1</span>,  <span class="comment"># Dropout æ¦‚ç‡</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åº”ç”¨ LoRA</span></span><br><span class="line">model = get_peft_model(model, lora_config)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¾®è°ƒæ¨¡å‹</span></span><br><span class="line"><span class="comment"># ...ï¼ˆå®šä¹‰æ•°æ®é›†å’Œè®­ç»ƒå¾ªç¯ï¼‰</span></span><br></pre></td></tr></table></figure><hr><h2 id="6-æ€»ç»“">6. <strong>æ€»ç»“</strong></h2><ul><li><strong>LoRA</strong> æ˜¯ä¸€ç§é€šè¿‡ä½ç§©åˆ†è§£å®ç°å‚æ•°é«˜æ•ˆå¾®è°ƒçš„æŠ€æœ¯ã€‚</li><li><strong>PEFT</strong> æ˜¯ä¸€ç±»å‚æ•°é«˜æ•ˆå¾®è°ƒæŠ€æœ¯çš„ç»Ÿç§°ï¼ŒåŒ…æ‹¬ LoRAã€Adapterã€Prefix Tuning ç­‰ã€‚</li><li>åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒLoRA æ˜¯æœ€å¸¸ç”¨çš„ PEFT æ–¹æ³•ä¹‹ä¸€ï¼Œé€‚åˆå¤§æ¨¡å‹çš„å¾®è°ƒä»»åŠ¡ã€‚</li><li>å¦‚æœä½ éœ€è¦å¿«é€Ÿå®ç°å‚æ•°é«˜æ•ˆå¾®è°ƒï¼Œå¯ä»¥ä½¿ç”¨ Hugging Face çš„ <code>peft</code> åº“ï¼Œç»“åˆ LoRA æˆ–å…¶ä»– PEFT æ–¹æ³•ã€‚</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;æ¨¡å‹é¢„è®­ç»ƒä¸å¾®è°ƒçš„å‘å±•å†ç¨‹åŠæ ¸å¿ƒè®ºæ–‡-é¡¹ç›®æ¨è&quot;&gt;æ¨¡å‹é¢„è®­ç»ƒä¸å¾®è°ƒçš„å‘å±•å†ç¨‹åŠæ ¸å¿ƒè®ºæ–‡/é¡¹ç›®æ¨è&lt;/h3&gt;
&lt;h4 id=&quot;ä¸€-æ¨¡å‹é¢„è®­ç»ƒ-pre-training&quot;&gt;&lt;strong&gt;ä¸€ã€æ¨¡å‹é¢„è®­ç»ƒï¼ˆPre-trainingï¼‰&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;é¢„</summary>
      
    
    
    
    <category term="æ·±åº¦å­¦ä¹ " scheme="http://outbreak-sen.github.io/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="mindsporeå®ä¹ " scheme="http://outbreak-sen.github.io/tags/mindspore%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="æ·±åº¦å­¦ä¹ " scheme="http://outbreak-sen.github.io/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>å¤§æ’ç›¸æœºçš„å¤šç›¸æœºç¡¬è§¦å‘æ–¹æ¡ˆ</title>
    <link href="http://outbreak-sen.github.io/2025/02/17/%E5%A4%A7%E6%81%92%E7%9B%B8%E6%9C%BA%E7%9A%84%E5%A4%9A%E7%9B%B8%E6%9C%BA%E7%A1%AC%E8%A7%A6%E5%8F%91%E6%96%B9%E6%A1%88/"/>
    <id>http://outbreak-sen.github.io/2025/02/17/%E5%A4%A7%E6%81%92%E7%9B%B8%E6%9C%BA%E7%9A%84%E5%A4%9A%E7%9B%B8%E6%9C%BA%E7%A1%AC%E8%A7%A6%E5%8F%91%E6%96%B9%E6%A1%88/</id>
    <published>2025-02-17T06:49:03.000Z</published>
    <updated>2025-02-28T06:37:09.853Z</updated>
    
    
    
    
    
  </entry>
  
  <entry>
    <title>zedç›¸æœºä½¿ç”¨</title>
    <link href="http://outbreak-sen.github.io/2025/02/16/zed%E7%9B%B8%E6%9C%BA%E4%BD%BF%E7%94%A8/"/>
    <id>http://outbreak-sen.github.io/2025/02/16/zed%E7%9B%B8%E6%9C%BA%E4%BD%BF%E7%94%A8/</id>
    <published>2025-02-16T04:28:48.000Z</published>
    <updated>2025-03-19T11:40:12.530Z</updated>
    
    <content type="html"><![CDATA[<h1>Zedç›¸æœºçš„é©±åŠ¨å®‰è£…å’Œå›¾åƒè§†é¢‘è·å–</h1><p>å’Œä¼—å¤šçš„æ·±åº¦ç›¸æœºä¸€æ ·ï¼Œä¸‹è½½SDKï¼Œç„¶åSDKé‡Œæœ‰ä¸ªä¸Šä½æœºå¯ä»¥ç”¨æ¥å¿«é€Ÿçš„è·å–è§†é¢‘å’Œå¯è§†åŒ–ï¼Œç„¶åè¿˜æœ‰ä¸€å¥—ROSï¼ŒC++ï¼Œpythonçš„APIå¯ä»¥ç¼–å†™ä¸€äº›å®šåˆ¶ç¨‹åºã€‚</p><p>å‹å·</p><p><img src="/home/outbreak/BlogOutbreak/source/_posts/zed%E7%9B%B8%E6%9C%BA%E4%BD%BF%E7%94%A8/image-20250216161117215.png" alt="image-20250216161117215"></p><table><thead><tr><th>å‹å·</th><th>ZED miniåƒåœ¾</th><th>ZED 2 é»‘è‰²çš„</th><th>ZEDç™½è‰²çš„ æœ€åƒåœ¾</th><th>ZED 2I æƒ³è¦çš„</th></tr></thead><tbody><tr><td>ç‰¹ç‚¹</td><td>ä¸å†™äº†è‡ªå·±çœ‹</td><td></td><td></td><td></td></tr><tr><td>å¸§ç‡</td><td></td><td></td><td></td><td></td></tr><tr><td>é™€èºä»ª</td><td></td><td></td><td></td><td></td></tr></tbody></table><h2 id="é©±åŠ¨å®‰è£…">é©±åŠ¨å®‰è£…</h2><h3 id="zed-sdk-python-çš„ç¯å¢ƒåé¢è£…">ZED SDK-Python çš„ç¯å¢ƒåé¢è£…</h3><p>æˆ‘çš„cudaç¯å¢ƒï¼šcuda12.4</p><p>å‚è€ƒå®˜ç½‘çš„ä¸‹è½½æ–¹å¼æ˜¯SDKï¼Œé’ˆå¯¹ä¸åŒç¡¬ä»¶å¹³å°å’Œcudaç‰ˆæœ¬ä¸‹è½½ä¸åŒçš„SDKç‰ˆæœ¬ï¼Œè¿™é‡Œä¸‹è½½çš„SDKç‰ˆæœ¬å·æ˜¯4.2ã€‚</p><img src="./zedç›¸æœºä½¿ç”¨/image-20250216130038994.png" alt="image-20250216130038994" style="zoom:50%;" /><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">$ sh ./ZED_SDK_Ubuntu22_cuda12.1_v4.2.5.zstd.run</span><br><span class="line"></span><br><span class="line">Verifying archive integrity...  100%   MD5 checksums are OK. All good.</span><br><span class="line">Uncompressing &#x27;ZED camera SDK by Stereolabs (Use &#x27;sudo apt install zstd&#x27; if zstd is not found)&#x27;  100%  </span><br><span class="line">Ubuntu version 22.04 detected. OK</span><br><span class="line">To continue you have to accept the EULA. Accept  [Y/n] ?y</span><br><span class="line">Installing...Python çš„ç¯å¢ƒåé¢è£…</span><br><span class="line">Installation path: /usr/local/zed #å®‰è£…è·¯å¾„ï¼Œtools sampleséƒ½åœ¨è¿™</span><br><span class="line">Checking CUDA version...</span><br><span class="line">OK: Found CUDA 12.4 # æŸ¥cudaç‰ˆæœ¬ï¼Œæ‰¾ä¸åˆ°è¾“å‡ºä¸€ä¸‹è·¯å¾„</span><br><span class="line">Do you want to also install the static version of the ZED SDK (AI module will still require libsl_ai.so) [Y/n] ?y # å¿…é¡»çš„</span><br><span class="line">Do you want to install the AI module (required for Object detection and Neural Depth, recommended), cuDNN 8.9 and TensorRT 8.6 will be installed [Y/n] ?y # è¿™ä¸ªå°±æ˜¯æ˜¯å¦éœ€è¦ä¸‹è½½ä»–å†™å¥½çš„æ·±åº¦å­¦ä¹ çš„ä¸€äº›æ–¹æ³•ï¼Œå¯ä»¥è¯†åˆ«ç‰©ä½“è¿™ç±»çš„ï¼Œæ²¡å¿…è¦</span><br><span class="line">Install samples (recommended) [Y/n] ?y # sampleè¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œå¾—çœ‹çœ‹apiæ€ä¹ˆç”¨çš„</span><br><span class="line">Installation path: /usr/local/zed/samples/ # sampleçš„è·¯å¾„</span><br><span class="line">Do you want to auto-install dependencies (recommended) ? following packet will be installed via the package manager : libjpeg-turbo8 libturbojpeg libusb-1.0-0 libusb-1.0-0-dev libopenblas-dev libarchive-dev libv4l-0 curl unzip zlib1g mesa-utils libpng-dev python3-dev python3-pip python3-setuptools libglew-dev freeglut3-dev qtbase5-dev qtchooser qt5-qmake qtbase5-dev-tools libqt5opengl5 libqt5svg5 [Y/n] ?y # è£…å•Šï¼Œè¿˜èƒ½ä¸è£…ï¼Ÿ</span><br><span class="line">Do you want to install the Python API (recommended) [Y/n] ?N # è¿™é‡Œè£…çš„ä¸å¥½ï¼Œéœ€è¦æŒ‡å®špythonçš„è·¯å¾„ï¼Œå»ºè®®çœ‹ä¸‹é¢pythonçš„æ˜¯æ€ä¹ˆå®‰è£…çš„</span><br><span class="line">Please specify your python executable: python3 # è¿™é‡Œç›´æ¥æ‘äº†å›è½¦ ï¼Œæˆ‘æ„Ÿè§‰å¾—æå‰æ„å»ºä¸€ä¸ªç¯å¢ƒç»™zed</span><br><span class="line">Requirement already satisfied: numpy in /home/outbreak/anaconda3/lib/python3.11/site-packages (1.24.3)</span><br><span class="line">Requirement already satisfied: requests in /home/outbreak/anaconda3/lib/python3.11/site-packages (2.31.0)</span><br><span class="line">Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in /home/outbreak/anaconda3/lib/python3.11/site-packages (from requests) (2.0.4)</span><br><span class="line">Requirement already satisfied: idna&lt;4,&gt;=2.5 in /home/outbreak/anaconda3/lib/python3.11/site-packages (from requests) (3.4)</span><br><span class="line">Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /home/outbreak/anaconda3/lib/python3.11/site-packages (from requests) (1.26.16)</span><br><span class="line">Requirement already satisfied: certifi&gt;=2017.4.17 in /home/outbreak/anaconda3/lib/python3.11/site-packages (from requests) (2023.7.22)</span><br><span class="line"></span><br><span class="line">ERROR: pip&#x27;s dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.</span><br><span class="line">tables 3.8.0 requires blosc2~=2.0.0, which is not installed.</span><br><span class="line">gensim 4.3.0 requires FuzzyTM&gt;=0.4.0, which is not installed.</span><br><span class="line">numba 0.57.1 requires numpy&lt;1.25,&gt;=1.21, but you have numpy 1.26.4 which is incompatible.</span><br><span class="line">Successfully installed cython-3.0.12 numpy-1.24.3 pyzed-4.2</span><br><span class="line">Done</span><br><span class="line">  To install it later or on a different environment run : </span><br><span class="line"> python -m pip install --ignore-installed /tmp/selfgz29281/pyzed-4.2-cp311-cp311-linux_x86_64.whl</span><br><span class="line">The ZED Python API was installed for &#x27;python3&#x27; #è¿™é‡Œæ˜¯æŠ¥é”™äº†ï¼Œè‡ªåŠ¨å®‰è£…åˆ°anacondaé‡Œäº†ï¼Œç„¶åæœ‰å‡ ä¸ªä¸‹è½½çš„packageï¼Œæœ‰çš„æ²¡è£…ï¼Œä¹‹åè‡ªå·±è£…å§ï¼Œä½†æ˜¯æ²¡å…³ç³»ï¼Œå› ä¸ºZED SDK å®‰è£…æ–‡ä»¶å¤¹ä¸­æœ‰ä¸€ä¸ª Python è„šæœ¬ï¼ˆget_python_api.pyï¼‰ï¼Œå¯ä»¥è‡ªåŠ¨æ£€æµ‹æ“ä½œç³»ç»Ÿã€CUDA å’Œ Python ç‰ˆæœ¬å¹¶ä¸‹è½½ç›¸åº”çš„é¢„ç¼–è¯‘ Python API åŒ…ï¼ˆpyzedï¼‰ã€‚å¤§å®¶éƒ½æ˜¯å®‰è£…zedsdkæ—¶å€™ä¸å®‰è£…è¿™ä¸ªpythonAPIï¼Œç„¶ååé¢è‡ªå·±å®‰è£…</span><br><span class="line"></span><br><span class="line">Do you want to run the ZED Diagnostic to download all AI models [Y/n] ?y # æ·±åº¦å­¦ä¹ çš„modelï¼Œå¯ä»¥ä¸ç”¨</span><br><span class="line">Downloading all AI models</span><br><span class="line">Downloading: MULTI CLASS DETECTION...</span><br><span class="line">/usr/local/zed/resources/objects_ 100%[=============================================================&gt;]  35.84M  10.4MB/s    ç”¨æ—¶ 3.7s  </span><br><span class="line">Downloading: MULTI CLASS MEDIUM DETECTION...</span><br><span class="line"></span><br><span class="line">Do you want to run the ZED Diagnostic to optimize all AI models, it may take a very long time, up to multiple hours but will be done only once. Otherwise it will be optimized just in time when running the ZED SDK [Y/n] ?n # å¯¹ä¸èµ·æˆ‘èµ¶æ—¶é—´ï¼Œè¿™ä¸ªä¼˜åŒ–æˆ‘ä¸è£…äº†</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…zed-python-api-pyzed-é’ˆå¯¹conda">å®‰è£…ZED-Python-APIï¼ˆpyzedï¼‰-é’ˆå¯¹conda</h3><p>ZED SDK å®‰è£…æ–‡ä»¶å¤¹/usr/local/zedä¸­æœ‰ä¸€ä¸ª Python è„šæœ¬ï¼ˆget_python_api.pyï¼‰ï¼Œå¯ä»¥è‡ªåŠ¨æ£€æµ‹æ“ä½œç³»ç»Ÿã€CUDA å’Œ Python ç‰ˆæœ¬å¹¶ä¸‹è½½ç›¸åº”çš„é¢„ç¼–è¯‘ Python API çš„whlåŒ…ï¼ˆpyzedï¼‰ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /usr/local/zed</span><br><span class="line">$ conda activate ZED <span class="comment">#å…ˆæ¿€æ´»condaè¿˜ç¯å¢ƒï¼Œå› ä¸ºè¿™ä¸ªè„šæœ¬éœ€è¦æŸ¥çœ‹pythonç‰ˆæœ¬å’Œpythonè·¯å¾„</span></span><br><span class="line">$ python get_python_api.py</span><br><span class="line"></span><br><span class="line">Detected platform: </span><br><span class="line"> linux_x86_64</span><br><span class="line"> Python 3.10</span><br><span class="line"> ZED SDK 4.2</span><br><span class="line">-&gt; Checking <span class="keyword">if</span> https://download.stereolabs.com/zedsdk/4.2/whl/linux_x86_64/pyzed-4.2-cp310-cp310-linux_x86_64.whl exists and is available</span><br><span class="line">-&gt; Found ! Downloading python package into /usr/local/zed/pyzed-4.2-cp310-cp310-linux_x86_64.whl</span><br><span class="line">-&gt; Installing necessary dependencies</span><br><span class="line">Requirement already satisfied: numpy <span class="keyword">in</span> /home/outbreak/anaconda3/envs/pytorch2/lib/python3.10/site-packages (1.26.4)</span><br><span class="line">Processing ./pyzed-4.2-cp310-cp310-linux_x86_64.whl</span><br><span class="line">Collecting numpy&lt;2.0,&gt;=1.13 (from pyzed==4.2)</span><br><span class="line">  Downloading numpy-1.26.4-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (61 kB)</span><br><span class="line">Collecting cython&gt;=3.0.0 (from pyzed==4.2)</span><br><span class="line">  Downloading Cython-3.0.12-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (3.3 kB)</span><br><span class="line">Downloading Cython-3.0.12-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (3.6 MB)</span><br><span class="line">   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 3.6/3.6 MB 4.6 MB/s eta 0:00:00</span><br><span class="line">Downloading numpy-1.26.4-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (18.2 MB)</span><br><span class="line">   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 18.2/18.2 MB 5.0 MB/s eta 0:00:00</span><br><span class="line">Installing collected packages: numpy, cython, pyzed</span><br><span class="line">Successfully installed cython-3.0.12 numpy-1.26.4 pyzed-4.2</span><br><span class="line">Done</span><br><span class="line">  To install it later or on a different environment run : </span><br><span class="line"> python -m pip install --ignore-installed /usr/local/zed/pyzed-4.2-cp310-cp310-linux_x86_64.whl</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ python -m pip install --ignore-installed /usr/local/zed/pyzed-4.2-cp310-cp310-linux_x86_64.whl</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">è¿™ä¸ªè„šæœ¬å¯ä»¥æµ‹è¯•åˆæ²¡æœ‰å®‰è£…å¥½ï¼Œè¿™é‡Œæ–¹ä¾¿å¤åˆ¶ï¼Œå…¶å®å°±æ˜¯ä¸‹é¢çš„sampleçš„ç¬¬ä¸€ä¸ª</span><br><span class="line">import pyzed.sl as sl</span><br><span class="line">def main():</span><br><span class="line">    # Create a Camera object</span><br><span class="line">    zed = sl.Camera()</span><br><span class="line"></span><br><span class="line">    # Create a InitParameters object and set configuration parameters</span><br><span class="line">    init_params = sl.InitParameters()</span><br><span class="line">    init_params.sdk_verbose = False</span><br><span class="line"></span><br><span class="line">    # Open the camera</span><br><span class="line">    err = zed.open(init_params)</span><br><span class="line">    if err != sl.ERROR_CODE.SUCCESS:</span><br><span class="line">        exit(1)</span><br><span class="line"></span><br><span class="line">    # Get camera information (ZED serial number)</span><br><span class="line">    zed_serial = zed.get_camera_information().serial_number</span><br><span class="line">    print(&quot;Hello! This is my serial number: &#123;0&#125;&quot;.format(zed_serial))</span><br><span class="line"></span><br><span class="line">    # Close the camera</span><br><span class="line">    zed.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># å‘ç°æŠ¥é”™ï¼Œè¿™ä¸ªæŠ¥é”™å¾ˆå¸¸è§ï¼Œè‡ªå·±æœä¸€ä¸‹</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/home/outbreak/ZED/samples/tutorials/tutorial 1 - hello ZED/python/hello_zed.py&quot;, line 21, in &lt;module&gt;</span><br><span class="line">    import pyzed.sl as sl</span><br><span class="line">ImportError: /home/outbreak/anaconda3/envs/pytorch2/bin/../lib/libstdc++.so.6: version `GLIBCXX_3.4.30&#x27; not found (required by /usr/local/zed/lib/libsl_zed.so)</span><br><span class="line">#è§£å†³æ–¹æ³•ï¼šln -sf /usr/lib/x86_64-linux-gnu/libstdc++.so.6  /home/outbreak/anaconda3/envs/pytorch2/bin/../lib/libstdc++.so.6</span><br></pre></td></tr></table></figure><h2 id="ä¸Šä½æœºçš„ä½¿ç”¨">ä¸Šä½æœºçš„ä½¿ç”¨</h2><p>è¿™ç©æ„æœ‰å¤šä¸ªä¸Šä½æœºï¼Œå¯ä»¥ç›´æ¥å‘½ä»¤è¡Œè¾“å…¥å‘½ä»¤è¿è¡Œï¼Œè¿™äº›è½¯ä»¶çš„ä½ç½®éƒ½åœ¨toolsé‡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/zed/tools/ZED Depth Viewer</span><br><span class="line">ZED360             ZED_Depth_Viewer   ZED_Explorer       ZED_Sensor_Viewer</span><br><span class="line">ZED_Calibration    ZED_Diagnostic     ZEDfu              ZED_SVO_Editor</span><br></pre></td></tr></table></figure><h3 id="zed-explorer">ZED Explorer</h3><p>ZED Exploreræ˜¯ZEDå®æ—¶é¢„è§ˆå’Œå½•åˆ¶çš„åº”ç”¨ç¨‹åºã€‚å®ƒå…è®¸æ‚¨æ›´æ”¹è§†é¢‘åˆ†è¾¨ç‡ã€çºµæ¨ªæ¯”å’Œç›¸æœºå‚æ•°ï¼Œå¹¶æ•è·é«˜åˆ†è¾¨ç‡å¿«ç…§å’Œ3Dè§†é¢‘ã€‚<br>å¦‚æœZEDè¢«æ‚¨çš„è®¡ç®—æœºè¯†åˆ«ï¼Œæ‚¨å°†çœ‹åˆ°æ¥è‡ªç›¸æœºçš„3Dè§†é¢‘ã€‚</p><p><img src="./zed%E7%9B%B8%E6%9C%BA%E4%BD%BF%E7%94%A8/image-20250216134044179.png" alt="image-20250216134044179"></p><h3 id="zed-depth-viewer">ZED Depth Viewer</h3><p>ZED Depth Viewerä½¿ç”¨ZED SDKæ•è·å’Œæ˜¾ç¤ºæ·±åº¦å›¾å’Œ3Dç‚¹äº‘ã€‚è¿è¡ŒZED Depth Viewerï¼Œæ£€æŸ¥æ·±åº¦å›¾æ˜¯å¦æ­£ç¡®æ˜¾ç¤ºã€‚å°è¯•ä¸åŒçš„æ·±åº¦æ¨¡å¼ï¼Œä»¥é€‰æ‹©æœ€é€‚åˆæ‚¨çš„æ·±åº¦è´¨é‡/æ€§èƒ½æ¯”ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">å·¥ä¸šåƒåœ¾ï¼Œå†™çš„ä¸€æ‰˜ï¼Œç›¸æœºæ‰“ä¸å¼€</span><br><span class="line">ZED_Depth_Viewer</span><br><span class="line">[2025-02-16 05:49:06 UTC][ZED][INFO] Logging level INFO</span><br><span class="line">[2025-02-16 05:49:06 UTC][ZED][INFO] Logging level INFO</span><br><span class="line">[2025-02-16 05:49:06 UTC][ZED][INFO] [Init]  Depth mode: ULTRA</span><br><span class="line">[2025-02-16 05:49:07 UTC][ZED][INFO] [Init]  Camera successfully opened.</span><br><span class="line">[2025-02-16 05:49:07 UTC][ZED][INFO] [Init]  Camera FW version: 1523</span><br><span class="line">[2025-02-16 05:49:07 UTC][ZED][INFO] [Init]  Video mode: HD1080@30</span><br><span class="line">[2025-02-16 05:49:07 UTC][ZED][INFO] [Init]  Serial Number: S/N 25939373</span><br><span class="line">in bool ImageHandler::initialize(sl::Mat&amp;) : Err [999]: unknown error.</span><br><span class="line">Stack trace (most recent call last):</span><br><span class="line">#26   Object &quot;[0xffffffffffffffff]&quot;, at 0xffffffffffffffff, in </span><br><span class="line">#25   Object &quot;ZED_Depth_Viewer&quot;, at 0x64b315f97e44, in </span><br><span class="line">#24   Object &quot;/lib/x86_64-linux-gnu/libc.so.6&quot;, at 0x77912ce29e3f, in __libc_start_main</span><br><span class="line">#23   Object &quot;/lib/x86_64-linux-gnu/libc.so.6&quot;, at 0x77912ce29d8f, in </span><br><span class="line">#22   Object &quot;ZED_Depth_Viewer&quot;, at 0x64b315f97061, in </span><br><span class="line">#21   Object &quot;ZED_Depth_Viewer&quot;, at 0x64b315fc841d, in </span><br><span class="line">#20   Object &quot;ZED_Depth_Viewer&quot;, at 0x64b315fc341e, in </span><br><span class="line">#19   Object &quot;ZED_Depth_Viewer&quot;, at 0x64b315fdc499, in </span><br><span class="line">#18   Object &quot;/lib/x86_64-linux-gnu/libQt5Core.so.5&quot;, at 0x77912d8b875a, in QEventLoop::exec(QFlags&lt;QEventLoop::ProcessEventsFlag&gt;)</span><br><span class="line">#17   Object &quot;/lib/x86_64-linux-gnu/libQt5Core.so.5&quot;, at 0x77912d9130b7, in QEventDispatcherGlib::processEvents(QFlags&lt;QEventLoop::ProcessEventsFlag&gt;)</span><br><span class="line">#16   Object &quot;/lib/x86_64-linux-gnu/libglib-2.0.so.0&quot;, at 0x77912d1193e2, in g_main_context_iteration</span><br><span class="line">#15   Object &quot;/lib/x86_64-linux-gnu/libglib-2.0.so.0&quot;, at 0x77912d1712b7, in </span><br><span class="line">#14   Object &quot;/lib/x86_64-linux-gnu/libglib-2.0.so.0&quot;, at 0x77912d11bd3a, in g_main_context_dispatch</span><br><span class="line">#13   Object &quot;/lib/x86_64-linux-gnu/libQt5Core.so.5&quot;, at 0x77912d912d33, in </span><br><span class="line">#12   Object &quot;/lib/x86_64-linux-gnu/libQt5Core.so.5&quot;, at 0x77912d9123ea, in QTimerInfoList::activateTimers()</span><br><span class="line">#11   Object &quot;/lib/x86_64-linux-gnu/libQt5Core.so.5&quot;, at 0x77912d8b9e39, in QCoreApplication::notifyInternal2(QObject*, QEvent*)</span><br><span class="line">#10   Object &quot;/lib/x86_64-linux-gnu/libQt5Widgets.so.5&quot;, at 0x77912e56c712, in QApplicationPrivate::notify_helper(QObject*, QEvent*)</span><br><span class="line">#9    Object &quot;/lib/x86_64-linux-gnu/libQt5Core.so.5&quot;, at 0x77912d8e733e, in QObject::event(QEvent*)</span><br><span class="line">#8    Object &quot;/lib/x86_64-linux-gnu/libQt5Core.so.5&quot;, at 0x77912d8f57fd, in QTimer::timeout(QTimer::QPrivateSignal)</span><br><span class="line">#7    Object &quot;/lib/x86_64-linux-gnu/libQt5Core.so.5&quot;, at 0x77912d8f17c7, in </span><br><span class="line">#6    Object &quot;ZED_Depth_Viewer&quot;, at 0x64b315fc8eec, in </span><br><span class="line">#5    Object &quot;ZED_Depth_Viewer&quot;, at 0x64b315fc4434, in </span><br><span class="line">#4    Object &quot;ZED_Depth_Viewer&quot;, at 0x64b315fd48d3, in </span><br><span class="line">#3    Object &quot;ZED_Depth_Viewer&quot;, at 0x64b315fd3368, in </span><br><span class="line">#2    Object &quot;ZED_Depth_Viewer&quot;, at 0x64b31603654d, in </span><br><span class="line">#1    Object &quot;ZED_Depth_Viewer&quot;, at 0x64b315ff272d, in </span><br><span class="line">#0    Object &quot;/lib/x86_64-linux-gnu/libcuda.so.1&quot;, at 0x779139af30e9, in </span><br><span class="line">Segmentation fault (Address not mapped to object [0x1500000015])</span><br><span class="line">[1]    4712 segmentation fault (core dumped)  ZED_Depth_Viewer</span><br></pre></td></tr></table></figure><h4 id="å·¥ä¸šåƒåœ¾çš„ä¸Šä½æœºbugä¸€å †">å·¥ä¸šåƒåœ¾çš„ä¸Šä½æœºbugä¸€å †</h4><p>ç”¨ä¸Šä½æœºçœ‹zed miniæ·±åº¦å›¾ï¼Œçœ‹ä¸åˆ°ï¼Œè¿˜æŠŠæˆ‘ç³»ç»Ÿçš„æ‰€æœ‰å°å›¾è¡¨éƒ½å´©æ²¡äº†ï¼Œç„¶åè¿˜å¡ä½äº†ï¼Œåƒåœ¾è‡³æã€‚æ¯”realsenseä¸çŸ¥é“æ‹‰åˆ°å“ªé‡Œå»äº†ã€‚</p><h3 id="zed-sensor-viewer">ZED Sensor Viewer</h3><p>èƒ½çœ‹åˆ°å½“å‰çš„é™€èºä»ªï¼ŒåŠ é€Ÿåº¦ï¼Œç£åŠ›è®¡æ•°æ®ã€‚</p><p><img src="./zed%E7%9B%B8%E6%9C%BA%E4%BD%BF%E7%94%A8/image-20250216133853582.png" alt="image-20250216133853582"></p><h3 id="sed-svo-editor">SED_SVO_Editor</h3><h2 id="zed-tutorials">ZED tutorials</h2><p>ZED SDKåŒ…æ‹¬å‡ ä¸ªæ•™ç¨‹å’Œç¤ºä¾‹ï¼Œç”¨äºå­¦ä¹ å¦‚ä½•ä½¿ç”¨è§†é¢‘ã€æ·±åº¦ã€ä½ç½®è·Ÿè¸ªã€åœ°å›¾å’Œå…¶ä»–ä¿¡æ¯ï¼Œä»¥åŠè®¸å¤šç¬¬ä¸‰æ–¹é›†æˆã€‚è‡ªå·±çœ‹å§ã€‚ä»£ç è·¯å¾„åœ¨/usr/local/zed/samples/tutorialsé‡Œé¢</p><table><thead><tr><th>Tutorial</th><th>Description</th><th>Link</th></tr></thead><tbody><tr><td><a href="https://www.stereolabs.com/docs/tutorials/hello-zed/">Hello ZED</a></td><td>This is the simplest tutorial. It shows how to open a stereo camera and print its serial number in the terminal.</td><td>[C++](<a href="https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial">https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial</a> 1 - hello ZED/cpp/) [Python](<a href="https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial">https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial</a> 1 - hello ZED/python/)</td></tr><tr><td><a href="https://www.stereolabs.com/docs/tutorials/image-capture/">Image Capture</a></td><td>Shows how to open a stereo camera, capture an image and print its timestamp and image size in the terminal.</td><td>[C++](<a href="https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial">https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial</a> 2 - image capture/cpp/) [Python](<a href="https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial">https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial</a> 2 - image capture/python/)</td></tr><tr><td><a href="https://www.stereolabs.com/docs/tutorials/depth-sensing/">Depth Perception</a></td><td>Shows how to retrieve the depth and point cloud of a scene, and print the distance of a given point in the terminal.</td><td>[C++](<a href="https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial">https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial</a> 3 - depth sensing/cpp/) [Python](<a href="https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial">https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial</a> 3 - depth sensing/python/)</td></tr><tr><td><a href="https://www.stereolabs.com/docs/tutorials/positional-tracking/">Camera Tracking</a></td><td>Shows how to enable positional tracking and get the position and orientation of the camera in real time.</td><td>[C++](<a href="https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial">https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial</a> 4 - positional tracking/cpp/) [Python](<a href="https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial">https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial</a> 4 - positional tracking/python/)</td></tr><tr><td><a href="https://www.stereolabs.com/docs/tutorials/spatial-mapping/">Spatial Mapping</a></td><td>Shows how to enable spatial mapping and capture a mesh or fused point cloud of the environment.</td><td>[C++](<a href="https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial">https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial</a> 5 - spatial mapping/cpp/) [Python](<a href="https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial">https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial</a> 5 - spatial mapping/python/)</td></tr><tr><td><a href="https://www.stereolabs.com/docs/tutorials/3d-object-detection/">3D Object Detection</a></td><td>Shows how to detect objects in a scene and localize them in 3D.</td><td>[C++](<a href="https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial">https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial</a> 6 - object detection/cpp/) [Python](<a href="https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial">https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial</a> 6 - object detection/python/)</td></tr><tr><td><a href="https://www.stereolabs.com/docs/tutorials/using-sensors/">Using Sensors</a></td><td>Shows how to acquire IMU, barometer and magnetometer data.</td><td>[C++](<a href="https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial">https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial</a> 7 - sensor data/cpp/) [Python](<a href="https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial">https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial</a> 7 - sensor data/python/)</td></tr><tr><td><a href="https://www.stereolabs.com/docs/tutorials/body-tracking/">3D Body Tracking</a></td><td>Shows how to detect human body skeletons in a 3D scene.</td><td>[C++](<a href="https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial">https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial</a> 7 - sensor data/cpp/) [Python](<a href="https://github.com/stereolabs/zed-sdk/tree/master/tutorials/tutorial">https://github.com/stereolabs/zed-sdk/tree/master/tutorials/tutorial</a> 8 - body tracking/python)</td></tr><tr><td>Geo-tracking</td><td>Shows how to use the Geo-tracking Fusion API to display fused GNSS and positional tracking data on a map.</td><td>[C++](<a href="https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial">https://github.com/stereolabs/zed-examples/tree/master/tutorials/tutorial</a> 7 - sensor data/cpp/) [Python](<a href="https://github.com/stereolabs/zed-sdk/tree/master/tutorials/tutorial">https://github.com/stereolabs/zed-sdk/tree/master/tutorials/tutorial</a> 8 - body tracking/python)</td></tr></tbody></table><h3 id="åªè®²è§£æ·±åº¦å›¾-è§†å·®å›¾-å½©è‰²å›¾è·å–">åªè®²è§£æ·±åº¦å›¾/è§†å·®å›¾/å½©è‰²å›¾è·å–</h3><p>è¦è·å¾—æ•°æ®ï¼Œé¦–å…ˆè¦ä½¿ç”¨grabå‡½æ•°è·å¾—æ•°æ®</p><p>ç„¶åé€šè¿‡retrieve_imageå‡½æ•°è·å¾—æ¯ä¸ªè§†è§’çš„å½©è‰²å›¾ç­‰</p><p>ç„¶åé€šè¿‡retrieve_measureå‡½æ•°è·å¾—æ¯ä¸ªè§†è§’çš„æ·±åº¦å›¾è§†å·®å›¾ç­‰</p><p>é»˜è®¤åç§°è·å¾—çš„æ˜¯å·¦è§†è§’çš„æ·±åº¦å›¾å’Œè§†å·®å›¾ï¼Œæ¯”å¦‚è¯´DEPTHæ˜¯æŒ‡å·¦ç›®çš„æ·±åº¦å›¾ï¼Œå¦‚æœæƒ³è·å¾—å³ç›®çš„ï¼Œé‚£å°±å¾—å‚æ•°ä¸ºDEPTH_RIGHT</p><table><thead><tr><th>Enumerator</th><th></th></tr></thead><tbody><tr><td>DISPARITY</td><td>Disparity map. Each pixel contains 1 float.  Type: <a href="https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1MAT__TYPE.html">sl.MAT_TYPE.F32_C1</a></td></tr><tr><td>DEPTH</td><td>Depth map in <a href="https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1UNIT.html">sl.UNIT</a> defined in <a href="https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1InitParameters.html#a59b4de42de6f091613c01daa1c82e37b">sl.InitParameters.coordinate_units</a>. Each pixel contains 1 float.  Type: <a href="https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1MAT__TYPE.html">sl.MAT_TYPE.F32_C1</a></td></tr><tr><td>CONFIDENCE</td><td>Certainty/confidence of the depth map. Each pixel contains 1 float.  Type: <a href="https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1MAT__TYPE.html">sl.MAT_TYPE.F32_C1</a></td></tr><tr><td>XYZ</td><td>Point cloud. Each pixel contains 4 float (X, Y, Z, not used).  Type: <a href="https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1MAT__TYPE.html">sl.MAT_TYPE.F32_C4</a></td></tr><tr><td>XYZRGBA</td><td>Colored point cloud. Each pixel contains 4 float (X, Y, Z, color).  The color should to be read as an unsigned char[4] representing the RGBA color.  Type: <a href="https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1MAT__TYPE.html">sl.MAT_TYPE.F32_C4</a></td></tr><tr><td>XYZBGRA</td><td>Colored point cloud. Each pixel contains 4 float (X, Y, Z, color).  The color should to be read as an unsigned char[4] representing the BGRA color.  Type: <a href="https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1MAT__TYPE.html">sl.MAT_TYPE.F32_C4</a></td></tr><tr><td>XYZARGB</td><td>Colored point cloud. Each pixel contains 4 float (X, Y, Z, color).  The color should to be read as an unsigned char[4] representing the ARGB color.  Type: <a href="https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1MAT__TYPE.html">sl.MAT_TYPE.F32_C4</a></td></tr><tr><td>XYZABGR</td><td>Colored point cloud. Each pixel contains 4 float (X, Y, Z, color).  The color should to be read as an unsigned char[4] representing the ABGR color.  Type: <a href="https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1MAT__TYPE.html">sl.MAT_TYPE.F32_C4</a></td></tr><tr><td>NORMALS</td><td>Normal vectors map. Each pixel contains 4 float (X, Y, Z, 0).  Type: <a href="https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1MAT__TYPE.html">sl.MAT_TYPE.F32_C4</a></td></tr><tr><td>DISPARITY_RIGHT</td><td>Disparity map for right sensor. Each pixel contains 1 float.  Type: <a href="https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1MAT__TYPE.html">sl.MAT_TYPE.F32_C1</a></td></tr><tr><td>DEPTH_RIGHT</td><td>Depth map for right sensor. Each pixel contains 1 float.  Type: <a href="https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1MAT__TYPE.html">sl.MAT_TYPE.F32_C1</a></td></tr><tr><td>XYZ_RIGHT</td><td>Point cloud for right sensor. Each pixel contains 4 float (X, Y, Z, not used).  Type: <a href="https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1MAT__TYPE.html">sl.MAT_TYPE.F32_C4</a></td></tr><tr><td>XYZRGBA_RIGHT</td><td>Colored point cloud for right sensor. Each pixel contains 4 float (X, Y, Z, color).  The color needs to be read as an unsigned char[4] representing the RGBA color.  Type: <a href="https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1MAT__TYPE.html">sl.MAT_TYPE.F32_C4</a></td></tr><tr><td>XYZBGRA_RIGHT</td><td>Colored point cloud for right sensor. Each pixel contains 4 float (X, Y, Z, color).  The color needs to be read as an unsigned char[4] representing the BGRA color.  Type: <a href="https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1MAT__TYPE.html">sl.MAT_TYPE.F32_C4</a></td></tr><tr><td>XYZARGB_RIGHT</td><td>Colored point cloud for right sensor. Each pixel contains 4 float (X, Y, Z, color).  The color needs to be read as an unsigned char[4] representing the ARGB color.  Type: <a href="https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1MAT__TYPE.html">sl.MAT_TYPE.F32_C4</a></td></tr><tr><td>XYZABGR_RIGHT</td><td>Colored point cloud for right sensor. Each pixel contains 4 float (X, Y, Z, color).  The color needs to be read as an unsigned char[4] representing the ABGR color.  Type: <a href="https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1MAT__TYPE.html">sl.MAT_TYPE.F32_C4</a></td></tr><tr><td>NORMALS_RIGHT</td><td>Normal vectors map for right view. Each pixel contains 4 float (X, Y, Z, 0).  Type: <a href="https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1MAT__TYPE.html">sl.MAT_TYPE.F32_C4</a></td></tr><tr><td>DEPTH_U16_MM</td><td>Depth map in millimeter whatever the <a href="https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1UNIT.html">sl.UNIT</a> defined in <a href="https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1InitParameters.html#a59b4de42de6f091613c01daa1c82e37b">sl.InitParameters.coordinate_units</a>.  Invalid values are set to 0 and depth values are clamped at 65000.  Each pixel contains 1 unsigned short.  Type: <a href="https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1MAT__TYPE.html">sl.MAT_TYPE.U16_C1</a></td></tr><tr><td>DEPTH_U16_MM_RIGHT</td><td>Depth map in millimeter for right sensor. Each pixel contains 1 unsigned short.  Type: <a href="https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1MAT__TYPE.html">sl.MAT_TYPE.U16_C1</a></td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">########################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Copyright (c) 2022, STEREOLABS.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># All rights reserved.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></span><br><span class="line"><span class="comment"># &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></span><br><span class="line"><span class="comment"># LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span></span><br><span class="line"><span class="comment"># A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span></span><br><span class="line"><span class="comment"># OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></span><br><span class="line"><span class="comment"># SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></span><br><span class="line"><span class="comment"># LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></span><br><span class="line"><span class="comment"># DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></span><br><span class="line"><span class="comment"># THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></span><br><span class="line"><span class="comment"># (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></span><br><span class="line"><span class="comment"># OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></span><br><span class="line"><span class="comment"># æˆ‘è‡ªå·±æ ¹æ®å®˜æ–¹çš„sampleæ”¹çš„</span></span><br><span class="line"><span class="comment">########################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pyzed.sl <span class="keyword">as</span> sl</span><br><span class="line"><span class="keyword">import</span> cv2 </span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_camera_information</span>(<span class="params">cam_info</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ZED Model                 : &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(cam_info.camera_model))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ZED Serial Number         : &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(cam_info.serial_number))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ZED Camera Firmware       : &#123;0&#125;/&#123;1&#125;&quot;</span>.<span class="built_in">format</span>(cam_info.camera_configuration.firmware_version,</span><br><span class="line">                                                       cam_info.sensors_configuration.firmware_version))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ZED Camera Resolution     : &#123;0&#125;x&#123;1&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">round</span>(cam_info.camera_configuration.resolution.width, <span class="number">2</span>),</span><br><span class="line">                                                       cam_info.camera_configuration.resolution.height))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ZED Camera FPS            : &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">int</span>(cam_info.camera_configuration.fps))</span><br><span class="line">)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># æ‰¾åˆ°ç›¸æœºï¼Œåˆ›å»ºç›¸æœºå¯¹è±¡</span></span><br><span class="line">    zed = sl.Camera()</span><br><span class="line">    <span class="comment"># è¿™ä¸ªparaméœ€è¦è®¾ç½®å¼€å¯ç›¸æœºçš„å‚æ•°</span></span><br><span class="line">    init_params = sl.InitParameters()</span><br><span class="line">    <span class="comment"># è¿™é‡Œè¦è·å¾—å·¦å³è§†å·®å›¾ï¼Œæ·±åº¦å›¾ï¼Œç‚¹äº‘æ•°æ®ï¼Œæ‰€ä»¥è¦å¼€å¯å³ä¾§æµ‹é‡</span></span><br><span class="line">    init_params.enable_right_side_measure=<span class="literal">True</span></span><br><span class="line">    <span class="comment"># æ‹æ‘„2kçš„å›¾åƒï¼Œæˆ–è€…1080,720ï¼Œå‚æ•°æŸ¥è¯¢https://www.stereolabs.com/docs/api/python/classpyzed_1_1sl_1_1RESOLUTION.html</span></span><br><span class="line">    init_params.camera_resolution = sl.RESOLUTION.HD720   <span class="comment"># Use HD2K HD720 opr HD1200 video mode, depending on camera type.</span></span><br><span class="line">    <span class="comment"># å­˜å›¾è·¯å¾„</span></span><br><span class="line">    filefolder_name = <span class="string">&quot;2_720&quot;</span></span><br><span class="line">    <span class="comment"># init_params.camera_fps = 30  # Set fps at 30</span></span><br><span class="line">    <span class="comment"># è¿™é‡Œæ˜¯æ‰€æœ‰æ›´æ”¹çš„å‚æ•°ï¼Œè¯·é…åˆSetCameraSettingsæ–‡ä»¶ä½¿ç”¨</span></span><br><span class="line">    zed.set_camera_settings(sl.VIDEO_SETTINGS.LED_STATUS, <span class="literal">True</span>)</span><br><span class="line">    zed.set_camera_settings(sl.VIDEO_SETTINGS.BRIGHTNESS, -<span class="number">1</span>)</span><br><span class="line">    zed.set_camera_settings(sl.VIDEO_SETTINGS.CONTRAST, -<span class="number">1</span>)</span><br><span class="line">    zed.set_camera_settings(sl.VIDEO_SETTINGS.HUE, -<span class="number">1</span>)</span><br><span class="line">    zed.set_camera_settings(sl.VIDEO_SETTINGS.SATURATION, -<span class="number">1</span>)</span><br><span class="line">    zed.set_camera_settings(sl.VIDEO_SETTINGS.SHARPNESS, -<span class="number">1</span>)</span><br><span class="line">    zed.set_camera_settings(sl.VIDEO_SETTINGS.GAIN, -<span class="number">1</span>)</span><br><span class="line">    zed.set_camera_settings(sl.VIDEO_SETTINGS.EXPOSURE, -<span class="number">1</span>)</span><br><span class="line">    zed.set_camera_settings(sl.VIDEO_SETTINGS.WHITEBALANCE_TEMPERATURE, -<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[Sample] Reset all settings to default&quot;</span>)</span><br><span class="line">    err = zed.<span class="built_in">open</span>(init_params)</span><br><span class="line">    <span class="keyword">if</span> err != sl.ERROR_CODE.SUCCESS:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Camera Open : &quot;</span>+<span class="built_in">repr</span>(err)+<span class="string">&quot;. Exit program.&quot;</span>)</span><br><span class="line">        exit()</span><br><span class="line">    <span class="comment"># Capture flag</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    image_left = sl.Mat()  <span class="comment"># å›¾åƒ</span></span><br><span class="line">    disparity_left = sl.Mat()  <span class="comment"># è§†å·®å€¼</span></span><br><span class="line">    dep_left = sl.Mat()  <span class="comment"># æ·±åº¦å›¾</span></span><br><span class="line">    depth_left = sl.Mat()  <span class="comment"># æ·±åº¦å€¼</span></span><br><span class="line">    point_cloud_left = sl.Mat()  <span class="comment"># ç‚¹äº‘æ•°æ®</span></span><br><span class="line">    </span><br><span class="line">    image_right = sl.Mat()  <span class="comment"># å›¾åƒ</span></span><br><span class="line">    disparity_right = sl.Mat()  <span class="comment"># è§†å·®å€¼</span></span><br><span class="line">    dep_right = sl.Mat()  <span class="comment"># æ·±åº¦å›¾</span></span><br><span class="line">    depth_right = sl.Mat()  <span class="comment"># æ·±åº¦å€¼</span></span><br><span class="line">    point_cloud_right = sl.Mat()  <span class="comment"># ç‚¹äº‘æ•°æ®</span></span><br><span class="line">    runtime_parameters = sl.RuntimeParameters()</span><br><span class="line">     <span class="comment"># è·å–åˆ†è¾¨ç‡</span></span><br><span class="line">    cam_info = zed.get_camera_information()</span><br><span class="line">    print_camera_information(cam_info)</span><br><span class="line">    w, h = cam_info.camera_configuration.resolution.width , cam_info.camera_configuration.resolution.height</span><br><span class="line">    x,y = <span class="built_in">int</span>(w/<span class="number">2</span>),<span class="built_in">int</span>(h/<span class="number">2</span>)  <span class="comment"># ä¸­å¿ƒç‚¹</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å¾—å½“å‰ç›¸æœºçš„ä¸¤ä¸ªç›¸æœºçš„æ ‡å®šå‚æ•°ï¼ŒIntrinsics and extrinsic stereo parameters for rectified/undistorted images. </span></span><br><span class="line">    calibration_params = zed.get_camera_information().camera_configuration.calibration_parameters</span><br><span class="line">    <span class="comment"># Focal length of the left eye in pixels</span></span><br><span class="line">    focal_left_x = calibration_params.left_cam.fx</span><br><span class="line">    focal_left_y = calibration_params.left_cam.fy</span><br><span class="line">    opticalCenter_left_x = calibration_params.left_cam.cx</span><br><span class="line">    opticalCenter_left_y = calibration_params.left_cam.cy</span><br><span class="line">    distolist_lfet  = calibration_params.left_cam.disto</span><br><span class="line">    focal_length_meteric_left = calibration_params.left_cam.focal_length_metric</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Focal length of the right eye in pixels</span></span><br><span class="line">    focal_right_x = calibration_params.right_cam.fx</span><br><span class="line">    focal_right_y = calibration_params.right_cam.fy</span><br><span class="line">    opticalCenter_right_x = calibration_params.right_cam.cx</span><br><span class="line">    opticalCenter_right_y = calibration_params.right_cam.cy</span><br><span class="line">    distolist_right  = calibration_params.right_cam.disto</span><br><span class="line">    focal_length_meteric_right = calibration_params.right_cam.focal_length_metric</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;å·¦ç›®ç„¦è·&#x27;</span>,focal_left_x,focal_left_y,<span class="string">&#x27;å³ç›®ç„¦è·&#x27;</span>,focal_right_x,focal_right_y)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;å·¦ç›®å…‰å¿ƒ&#x27;</span>,opticalCenter_left_x,opticalCenter_left_y,<span class="string">&#x27;å³ç›®å…‰å¿ƒ&#x27;</span>,opticalCenter_right_x,opticalCenter_right_y) </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;å·¦ç›®ç•¸å˜å‚æ•°&#x27;</span>,distolist_lfet,<span class="string">&#x27;å³ç›®ç•¸å˜å‚æ•°&#x27;</span>,distolist_right)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;å·¦ç›®ç„¦è·&#x27;</span>,focal_length_meteric_left,<span class="string">&#x27;å³ç›®ç„¦è·&#x27;</span>,focal_length_meteric_right)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å¾—åŒç›®çš„è”åˆæ ‡å®šå‚æ•°ï¼Œçœ‹çœ‹éœ€è¦ä»€ä¹ˆ</span></span><br><span class="line">    <span class="comment"># get translation and rotation</span></span><br><span class="line">    rotation = calibration_params.stereo_transform.get_rotation_matrix()<span class="comment">#  3*3 matrix sl.Matrix3f</span></span><br><span class="line">    translation = calibration_params.stereo_transform.get_translation().get() <span class="comment"># [tx, ty, tz] </span></span><br><span class="line">    <span class="comment"># Returns the baseline of the camera in the sl.UNIT defined in sl.InitParameters.coordinate_units. </span></span><br><span class="line">    baseline = calibration_params.get_camera_baseline()</span><br><span class="line">    <span class="comment"># Translation between left and right eye on x-axis</span></span><br><span class="line">    tx = calibration_params.stereo_transform.get_translation().get()[<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;å¹³ç§»å‘é‡&#x27;</span>,translation)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;æ—‹è½¬çŸ©é˜µ&#x27;</span>,rotation) </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;åŒç›®åŸºçº¿&#x27;</span>,baseline,<span class="string">&#x27;å·¦å³ç›¸æœºçš„xè½´å¹³ç§»&#x27;</span>,tx)</span><br><span class="line">    <span class="comment"># å¯¼å‡ºæ ‡å®šå‚æ•°åˆ°txtæ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filefolder_name+<span class="string">&quot;/calibration_parameters.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        file.write(<span class="string">&quot;å·¦ç›®ç„¦è·: fx = &#123;0&#125;, fy = &#123;1&#125;\n&quot;</span>.<span class="built_in">format</span>(focal_left_x, focal_left_y))</span><br><span class="line">        file.write(<span class="string">&quot;å³ç›®ç„¦è·: fx = &#123;0&#125;, fy = &#123;1&#125;\n&quot;</span>.<span class="built_in">format</span>(focal_right_x, focal_right_y))</span><br><span class="line">        file.write(<span class="string">&quot;å·¦ç›®å…‰å¿ƒ: cx = &#123;0&#125;, cy = &#123;1&#125;\n&quot;</span>.<span class="built_in">format</span>(opticalCenter_left_x, opticalCenter_left_y))</span><br><span class="line">        file.write(<span class="string">&quot;å³ç›®å…‰å¿ƒ: cx = &#123;0&#125;, cy = &#123;1&#125;\n&quot;</span>.<span class="built_in">format</span>(opticalCenter_right_x, opticalCenter_right_y))</span><br><span class="line">        file.write(<span class="string">&quot;ç•¸å˜å‚æ•°æ ¼å¼: [k1, k2, p1, p2, k3, k4, k5, k6, s1, s2, s3, s4]\n&quot;</span>)</span><br><span class="line">        file.write(<span class="string">&quot;å·¦ç›®ç•¸å˜å‚æ•°: &#123;&#125;\n&quot;</span>.<span class="built_in">format</span>(distolist_lfet))</span><br><span class="line">        file.write(<span class="string">&quot;å³ç›®ç•¸å˜å‚æ•°: &#123;&#125;\n&quot;</span>.<span class="built_in">format</span>(distolist_right))</span><br><span class="line">        file.write(<span class="string">&quot;å·¦ç›®ç„¦è· (ç±³): &#123;&#125;\n&quot;</span>.<span class="built_in">format</span>(focal_length_meteric_left))</span><br><span class="line">        file.write(<span class="string">&quot;å³ç›®ç„¦è· (ç±³): &#123;&#125;\n&quot;</span>.<span class="built_in">format</span>(focal_length_meteric_right))</span><br><span class="line">        file.write(<span class="string">&quot;åŒç›®åŸºçº¿: &#123;&#125;\n&quot;</span>.<span class="built_in">format</span>(baseline))</span><br><span class="line">        file.write(<span class="string">&quot;å·¦å³ç›¸æœºçš„xè½´å¹³ç§»: &#123;&#125;\n&quot;</span>.<span class="built_in">format</span>(tx))</span><br><span class="line">        file.write(<span class="string">&quot;æ—‹è½¬çŸ©é˜µ: &#123;&#125;\n&quot;</span>.<span class="built_in">format</span>(rotation))</span><br><span class="line">        file.write(<span class="string">&quot;å¹³ç§»å‘é‡: &#123;&#125;\n&quot;</span>.<span class="built_in">format</span>(translation))</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># è·å–æœ€æ–°çš„å›¾åƒï¼Œä¿®æ­£å®ƒä»¬ï¼Œå¹¶åŸºäºæä¾›çš„RuntimeParameters(æ·±åº¦ï¼Œç‚¹äº‘ï¼Œè·Ÿè¸ªç­‰)è®¡ç®—æµ‹é‡å€¼ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> zed.grab(runtime_parameters) == sl.ERROR_CODE.SUCCESS:  <span class="comment"># ç›¸æœºæˆåŠŸè·å–å›¾è±¡</span></span><br><span class="line">            timestamp = zed.get_timestamp(sl.TIME_REFERENCE.CURRENT)  <span class="comment"># è·å–å›¾åƒè¢«æ•è·æ—¶çš„æ—¶é—´ç‚¹ï¼Œç”¨äºå›¾åƒå‘½å</span></span><br><span class="line">            <span class="comment"># è·å–å·¦ç›®å›¾åƒ</span></span><br><span class="line">            zed.retrieve_image(image_left, sl.VIEW.LEFT)  <span class="comment"># imageï¼šå®¹å™¨ï¼Œsl.VIEW.LEFTï¼šå†…å®¹</span></span><br><span class="line">            d_image_left = image_left.get_data()  <span class="comment"># è½¬æ¢æˆå›¾åƒæ•°ç»„ï¼Œä¾¿äºåç»­çš„æ˜¾ç¤ºæˆ–è€…å‚¨å­˜</span></span><br><span class="line">            <span class="comment"># è·å–è§†å·®å€¼</span></span><br><span class="line">            zed.retrieve_measure(disparity_left,sl.MEASURE.DISPARITY,sl.MEM.CPU)</span><br><span class="line">            d_disparity_left = disparity_left.get_data()</span><br><span class="line">            zed.retrieve_image(dep_left,sl.VIEW.DEPTH)  <span class="comment"># æ·±åº¦å›¾</span></span><br><span class="line">            d_dep_left = dep_left.get_data()</span><br><span class="line">            <span class="comment"># è·å–æ·±åº¦</span></span><br><span class="line">            zed.retrieve_measure(depth_left,sl.MEASURE.DEPTH,sl.MEM.CPU)  <span class="comment"># æ·±åº¦å€¼</span></span><br><span class="line">            d_depth_left = depth_left.get_data()</span><br><span class="line">            <span class="comment"># è·å–ç‚¹äº‘</span></span><br><span class="line">            zed.retrieve_measure(point_cloud_left,sl.MEASURE.XYZBGRA,sl.MEM.CPU)</span><br><span class="line">            d_point_map_left = point_cloud_left.get_data()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># è·å–å·¦ç›®å›¾åƒ</span></span><br><span class="line">            zed.retrieve_image(image_right, sl.VIEW.RIGHT)  <span class="comment"># imageï¼šå®¹å™¨ï¼Œsl.VIEW.rightï¼šå†…å®¹</span></span><br><span class="line">            d_image_right = image_right.get_data()  <span class="comment"># è½¬æ¢æˆå›¾åƒæ•°ç»„ï¼Œä¾¿äºåç»­çš„æ˜¾ç¤ºæˆ–è€…å‚¨å­˜</span></span><br><span class="line">            <span class="comment"># è·å–è§†å·®å€¼</span></span><br><span class="line">            zed.retrieve_measure(disparity_right,sl.MEASURE.DISPARITY_RIGHT ,sl.MEM.CPU)</span><br><span class="line">            d_disparity_right = disparity_right.get_data()</span><br><span class="line">            <span class="comment"># è·å–æ·±åº¦</span></span><br><span class="line">            zed.retrieve_measure(depth_right,sl.MEASURE.DEPTH_RIGHT,sl.MEM.CPU)  <span class="comment"># æ·±åº¦å€¼</span></span><br><span class="line">            d_depth_right = depth_right.get_data()</span><br><span class="line">            zed.retrieve_image(dep_right,sl.VIEW.DEPTH_RIGHT)  <span class="comment"># æ·±åº¦å›¾</span></span><br><span class="line">            d_dep_right = dep_right.get_data()</span><br><span class="line">            <span class="comment"># è·å–ç‚¹äº‘</span></span><br><span class="line">            zed.retrieve_measure(point_cloud_right,sl.MEASURE.XYZBGRA_RIGHT,sl.MEM.CPU)</span><br><span class="line">            d_point_cloud_right = point_cloud_right.get_data()</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;æ—¶é—´ç‚¹&#x27;</span>,timestamp.get_seconds(),<span class="string">&#x27;ä¸­å¿ƒç‚¹è§†å·®å€¼&#x27;</span>,d_disparity_left[x,y],<span class="string">&#x27;ä¸­å¿ƒç‚¹æ·±åº¦å€¼&#x27;</span>,d_depth_left[x,y],<span class="string">&#x27;ä¸­å¿ƒç‚¹äº‘æ•°æ®&#x27;</span>,d_point_map_left[x,y])</span><br><span class="line">            <span class="comment"># åˆ©ç”¨cv2.imshowæ˜¾ç¤ºè§†å›¾ï¼Œå¹¶å¯¹æƒ³è¦çš„è§†å›¾è¿›è¡Œä¿å­˜</span></span><br><span class="line">            view_color = np.concatenate((cv2.resize(d_image_left,(<span class="number">640</span>,<span class="number">360</span>)),cv2.resize(d_image_right,(<span class="number">640</span>,<span class="number">360</span>))),axis=<span class="number">1</span>)</span><br><span class="line">            cv2.imshow(<span class="string">&quot;ColorImage&quot;</span>, view_color)</span><br><span class="line">            view_depth = np.concatenate((cv2.resize(d_dep_left,(<span class="number">640</span>,<span class="number">360</span>)),cv2.resize(d_dep_right,(<span class="number">640</span>,<span class="number">360</span>))),axis=<span class="number">1</span>)</span><br><span class="line">            cv2.imshow(<span class="string">&quot;DepthImage&quot;</span>, view_depth)</span><br><span class="line">            key = cv2.waitKey(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> key &amp; <span class="number">0xFF</span> == <span class="built_in">ord</span>(<span class="string">&#x27;q&#x27;</span>):  <span class="comment"># qé€€å‡º</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> key &amp; <span class="number">0xFF</span> == <span class="built_in">ord</span>(<span class="string">&#x27;s&#x27;</span>):  <span class="comment"># å›¾åƒä¿å­˜</span></span><br><span class="line">                timestamp_ms = timestamp.get_milliseconds()</span><br><span class="line">                savePath = os.path.join(filefolder_name + <span class="string">&quot;/images&quot;</span>, <span class="string">&quot;left_&#123;:0&gt;3d&#125;.png&quot;</span>.<span class="built_in">format</span>(i))  <span class="comment"># æ³¨æ„æ ¹ç›®å½•æ˜¯å¦å­˜åœ¨&quot;./images&quot;æ–‡ä»¶å¤¹</span></span><br><span class="line">                cv2.imwrite(savePath, d_image_left)</span><br><span class="line">                savePath = os.path.join(filefolder_name+ <span class="string">&quot;/images&quot;</span>, <span class="string">&quot;right_&#123;:0&gt;3d&#125;.png&quot;</span>.<span class="built_in">format</span>(i))</span><br><span class="line">                cv2.imwrite(savePath, d_image_right)</span><br><span class="line">                i = i + <span class="number">1</span></span><br><span class="line">    <span class="comment"># Close the camera</span></span><br><span class="line">    zed.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/home/outbreak/BlogOutbreak/source/_posts/zed%E7%9B%B8%E6%9C%BA%E4%BD%BF%E7%94%A8/image-20250216160621095.png" alt="image-20250216160621095"></p><h2 id="sample-usage">Sample usage</h2><table><thead><tr><th>Sample</th><th>Description</th><th>Link</th></tr></thead><tbody><tr><td>Camera Control</td><td>Shows how camera settings like Exposure, Gain, Contrast, Sharpness, etc. can be modified and display the resulting image.</td><td>[C++](<a href="https://github.com/stereolabs/zed-sdk/tree/master/camera">https://github.com/stereolabs/zed-sdk/tree/master/camera</a> control/cpp) [Python](<a href="https://github.com/stereolabs/zed-sdk/tree/master/camera">https://github.com/stereolabs/zed-sdk/tree/master/camera</a> control/python)</td></tr><tr><td>Camera Streaming</td><td>Shows how to stream the ZED stereo video on an IP network, decode the video and display its live 3D point cloud.</td><td>[GitHub](<a href="https://github.com/stereolabs/zed-sdk/tree/master/camera">https://github.com/stereolabs/zed-sdk/tree/master/camera</a> streaming)</td></tr><tr><td>Depth Sensing</td><td>Shows how to capture a 3D point cloud and display it in an OpenGL window.</td><td>[C++](<a href="https://github.com/stereolabs/zed-sdk/tree/master/depth">https://github.com/stereolabs/zed-sdk/tree/master/depth</a> sensing/depth sensing/cpp) [Python](<a href="https://github.com/stereolabs/zed-sdk/tree/master/depth">https://github.com/stereolabs/zed-sdk/tree/master/depth</a> sensing/depth sensing/python)</td></tr><tr><td>Positional Tracking</td><td>Displays the live position and orientation of the camera in a 3D window.</td><td>[C++](<a href="https://github.com/stereolabs/zed-sdk/tree/master/positional">https://github.com/stereolabs/zed-sdk/tree/master/positional</a> tracking/positional tracking/cpp) [Python](<a href="https://github.com/stereolabs/zed-sdk/tree/master/positional">https://github.com/stereolabs/zed-sdk/tree/master/positional</a> tracking/positional tracking/python)</td></tr><tr><td>Spatial Object Detection</td><td><strong>2D Display</strong> Detect and track objects in the scene, and display their 3D bounding boxes over the live image.</td><td>[C++](<a href="https://github.com/stereolabs/zed-sdk/tree/master/object">https://github.com/stereolabs/zed-sdk/tree/master/object</a> detection/image viewer/cpp) [Python](<a href="https://github.com/stereolabs/zed-sdk/tree/master/object">https://github.com/stereolabs/zed-sdk/tree/master/object</a> detection/image viewer/python)</td></tr><tr><td>Spatial Object Detection</td><td><strong>3D Display</strong> Detect and track objects in the scene, and display their 3D bounding boxes over the live point cloud.</td><td>[C++](<a href="https://github.com/stereolabs/zed-sdk/tree/master/object">https://github.com/stereolabs/zed-sdk/tree/master/object</a> detection/birds eye viewer/cpp) [Python](<a href="https://github.com/stereolabs/zed-sdk/tree/master/object">https://github.com/stereolabs/zed-sdk/tree/master/object</a> detection/birds eye viewer/cpp)</td></tr><tr><td>Body Tracking</td><td>Shows how to detect and track 3D human bodies in space and display skeletons over the live image.</td><td>[C++](<a href="https://github.com/stereolabs/zed-sdk/tree/master/body">https://github.com/stereolabs/zed-sdk/tree/master/body</a> tracking/body tracking/cpp) [Python](<a href="https://github.com/stereolabs/zed-sdk/tree/master/body">https://github.com/stereolabs/zed-sdk/tree/master/body</a> tracking/body tracking/python)</td></tr><tr><td>Spatial Mapping</td><td>Captures a live 3D mesh of the environment and displays it as an overlay on the camera image.</td><td>[C++](<a href="https://github.com/stereolabs/zed-sdk/tree/master/spatial">https://github.com/stereolabs/zed-sdk/tree/master/spatial</a> mapping/spatial mapping/cpp) [Python](<a href="https://github.com/stereolabs/zed-sdk/tree/master/spatial">https://github.com/stereolabs/zed-sdk/tree/master/spatial</a> mapping/spatial mapping/python)</td></tr><tr><td>Plane Detection</td><td>Shows how to detect floor and planar areas in the scene and draw them on the image.</td><td>[C++](<a href="https://github.com/stereolabs/zed-sdk/tree/master/plane">https://github.com/stereolabs/zed-sdk/tree/master/plane</a> detection/plane detection/cpp) [Python](<a href="https://github.com/stereolabs/zed-examples/tree/master/plane">https://github.com/stereolabs/zed-examples/tree/master/plane</a> detection/plane detection/python)</td></tr><tr><td>Video Recording</td><td>Shows how to record a lossless or compressed video in SVO format.</td><td><a href="https://github.com/stereolabs/zed-sdk/tree/master/recording/recording/mono/cpp">C++</a> <a href="https://github.com/stereolabs/zed-sdk/tree/master/recording/recording/mono/python">Python</a></td></tr><tr><td>Video Playback</td><td>Shows how to playback a recorded SVO video.</td><td><a href="https://github.com/stereolabs/zed-sdk/tree/master/recording/playback/mono/cpp">C++</a> <a href="https://github.com/stereolabs/zed-sdk/tree/master/recording/playback/mono/python">Python</a></td></tr><tr><td>Video Export</td><td>Opens an SVO file and exports video and depth to PNG or AVI files.</td><td><a href="https://github.com/stereolabs/zed-sdk/tree/master/recording/export/svo/cpp">C++</a> <a href="https://github.com/stereolabs/zed-sdk/tree/master/recording/export/svo/python">Python</a></td></tr><tr><td>Multi Camera</td><td>Shows how to open and use multiple ZED cameras at the same time in a single application.</td><td>[C++](<a href="https://github.com/stereolabs/zed-sdk/tree/master/depth">https://github.com/stereolabs/zed-sdk/tree/master/depth</a> sensing/multi camera/cpp) [Python](<a href="https://github.com/stereolabs/zed-sdk/tree/master/depth">https://github.com/stereolabs/zed-sdk/tree/master/depth</a> sensing/multi camera/cpp)</td></tr></tbody></table><p>æ­£åœ¨æ›´æ–°</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;Zedç›¸æœºçš„é©±åŠ¨å®‰è£…å’Œå›¾åƒè§†é¢‘è·å–&lt;/h1&gt;
&lt;p&gt;å’Œä¼—å¤šçš„æ·±åº¦ç›¸æœºä¸€æ ·ï¼Œä¸‹è½½SDKï¼Œç„¶åSDKé‡Œæœ‰ä¸ªä¸Šä½æœºå¯ä»¥ç”¨æ¥å¿«é€Ÿçš„è·å–è§†é¢‘å’Œå¯è§†åŒ–ï¼Œç„¶åè¿˜æœ‰ä¸€å¥—ROSï¼ŒC++ï¼Œpythonçš„APIå¯ä»¥ç¼–å†™ä¸€äº›å®šåˆ¶ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;å‹å·&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/ho</summary>
      
    
    
    
    
    <category term="æ·±åº¦ç›¸æœº" scheme="http://outbreak-sen.github.io/tags/%E6%B7%B1%E5%BA%A6%E7%9B%B8%E6%9C%BA/"/>
    
    <category term="ç›¸æœºé©±åŠ¨" scheme="http://outbreak-sen.github.io/tags/%E7%9B%B8%E6%9C%BA%E9%A9%B1%E5%8A%A8/"/>
    
  </entry>
  
  <entry>
    <title>FPV ESCå­¦ä¹ ç¬”è®°</title>
    <link href="http://outbreak-sen.github.io/2025/02/13/FPV-ESC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://outbreak-sen.github.io/2025/02/13/FPV-ESC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2025-02-13T02:17:58.000Z</published>
    <updated>2025-03-19T09:12:17.160Z</updated>
    
    <content type="html"><![CDATA[<h1>BLheliç”µè°ƒä¸Dshoté€šè®¯</h1><p>è¿™é‡Œé¦–å…ˆä»‹ç»ä¸€ä¸‹åŸºæœ¬æ¦‚å¿µ</p><ul><li><p>ç”µè°ƒESCï¼šå…¨ç§°ç”µå­é€Ÿåº¦æ§åˆ¶å™¨ï¼Œä¸€ä¸ªç”µæœºéœ€è¦æ§åˆ¶è½¬åŠ¨ï¼Œéœ€è¦ç”µè°ƒESCï¼Œç”µè°ƒè´Ÿè´£æŠŠè¾“å…¥çš„ç›´æµç”µè½¬åŒ–ä¸ºä¸‰ç›¸ç”µç­‰è¾“å…¥ï¼Œæ ¹æ®é£è¡Œæ§åˆ¶å™¨çš„è¾“å…¥æŒ‡ä»¤ï¼ˆFCï¼‰è°ƒèŠ‚ç”µæœºçš„é€Ÿåº¦ï¼ˆå’Œæ–¹å‘ï¼‰ã€‚ã€‚</p></li><li><p>ç”µè°ƒåŸç†ï¼šç”µè°ƒæ˜¯èŠ¯ç‰‡åŠ ä¸€å †mosç»„æˆçš„ï¼ŒèŠ¯ç‰‡è´Ÿè´£æ¥æ”¶æ§åˆ¶ä¿¡å·ï¼Œç„¶åæ§åˆ¶mosçš„é€šæ–­ï¼ŒæŠŠè¾“å…¥çš„ç›´æµç”µé€šè¿‡mosé€šæ–­å˜åŒ–ä¸ºä¸åŒçš„ä¸‰ç›¸ç”µç­‰</p></li><li><p>ç”µè°ƒå›ºä»¶ï¼šç”µè°ƒé‡Œé¢çš„èŠ¯ç‰‡ä¼šçƒ§å½•ä¸€ä¸ªç¨‹åºï¼Œè¿™ä¸ªç¨‹åºå°±æ˜¯ç”µè°ƒå›ºä»¶ï¼Œè¿™ä¸ªç”µè°ƒå›ºä»¶æœ‰å¾ˆå¤šå¼€æºçš„æ–¹æ¡ˆï¼Œæ¯”å¦‚BLHeliï¼ŒBLHeli_Sï¼Œè¿™äº›æ˜¯å†™å¥½çš„ï¼Œå¹¶ä¸”æœ‰å¾ˆå¤šåŠŸèƒ½æ¯”å¦‚æ¸©åº¦æ§åˆ¶ç­‰ã€‚</p></li><li><p>ç”µè°ƒé€šè®¯åè®®ï¼šç”µè°ƒé‡Œçš„èŠ¯ç‰‡æ¥æ”¶æ§åˆ¶ä¿¡å·ä¹Ÿæœ‰å¾ˆå¤šï¼Œç§°ä¸ºç”µè°ƒé€šè®¯åè®®ï¼Œæ¯”å¦‚Dshotï¼ŒPWMï¼ŒOneshotï¼Œå…¶ä¸­dshotæ˜¯ç›®å‰æœ€å¥½çš„ã€‚æœ‰äººæå‡ºè¿™äº›é€šè®¯åè®®ä¹‹åï¼Œè¿™äº›BLHeliä¹‹ç±»çš„å›ºä»¶å°±ä¼šå…¼å®¹è¿™äº›åè®®ï¼Œæ¯”å¦‚BLHeliä¸€èˆ¬æ˜¯å…¼å®¹PWMï¼ŒOneshotï¼ŒDshotçš„ã€‚<strong>å…¶ä¸­PWMçš„æ˜¯éœ€è¦æ ¡å‡†æœ€å°å€¼å’Œæœ€å¤§å€¼ä¹‹åæ‰èƒ½æ§åˆ¶ã€‚</strong></p></li><li><p>ç”µè°ƒå›ºä»¶å¦‚ä½•å…¼å®¹ä¸åŒåè®®ï¼šç”µè°ƒå›ºä»¶å…¼å®¹å„ç§ç”µè°ƒé€šè®¯åè®®ï¼Œå…·ä½“è€Œè¨€ï¼Œåœ¨å›ºä»¶é‡Œæœ‰ä¸€ä¸ªåˆ†ç±»å™¨ï¼Œè¾“å…¥ä¸åŒåè®®çš„å‘½ä»¤ï¼Œä»–ä¼šå…ˆåˆ¤åˆ«æ˜¯ä»€ä¹ˆåè®®ç„¶åå†æ‰§è¡Œã€‚<br><a href="https://www.cnblogs.com/Sky-seeker/p/14358676.html">ä¸€ä¸ªå‚è€ƒ-æ— åˆ·ç”µè°ƒåŸºç¡€çŸ¥è¯†ä»¥åŠBLHeliå›ºä»¶çƒ§å½•å’Œå‚æ•°è°ƒæ•´ - æ¢¦å¹»ä¹‹å¿ƒæ˜Ÿ - åšå®¢å›­ (cnblogs.com)</a></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/122a27a4aa9bf878d4eef13b5458fdd5.jpeg" alt="ç”µè°ƒå·¥ä½œåŸç†"></p></li></ul><h2 id="ç”µè°ƒå›ºä»¶">ç”µè°ƒå›ºä»¶</h2><p>ç”µè°ƒå›ºä»¶æ˜¯åœ¨æ¯ä¸ªç”µè°ƒä¸Šè¿è¡Œçš„è½¯ä»¶ï¼Œå®ƒç¡®å®šç”µè°ƒçš„æ€§èƒ½ï¼Œæ”¯æŒçš„åè®®ä»¥åŠå¯ä»¥ä½¿ç”¨çš„é…ç½®æ¥å£ã€‚ç”µè°ƒå¯ä»¥ä½¿ç”¨çš„å›ºä»¶å–å†³äºç¡¬ä»¶ã€‚</p><ul><li><strong>SimonK</strong>ï¼šæœ€å¤è€çš„ä¸¤ç§å¼€æºç”µè°ƒå›ºä»¶ä¹‹ä¸€ï¼Œå·²ç»è¿‡æ—¶ä¸å†æ›´æ–°ã€‚å†…åµŒäº†ä¸€ä¸ªå¼€ç¯focé©±åŠ¨</li><li><strong>BLHeli</strong>ï¼šæœ€å¤è€çš„ä¸¤ç§å¼€æºç”µè°ƒå›ºä»¶ä¹‹ä¸€ï¼Œç”±äºå…¶å¹¿æ³›çš„åŠŸèƒ½å’Œå‹å¥½çš„ç”¨æˆ·ç•Œé¢è€Œå˜å¾—æµè¡Œã€‚</li><li><strong>BLHeli_S</strong>ï¼šBLHeliå›ºä»¶çš„ç¬¬äºŒä»£ã€‚ä¸“é—¨ä¸ºå…·æœ‰<em>Busybee</em>å¤„ç†å™¨çš„ç”µè°ƒå¼€å‘ã€‚</li><li><strong>BLHeli_32</strong>ï¼šç¬¬ä¸‰ä»£å’Œæœ€æ–°ä¸€ä»£BLHeliå›ºä»¶ã€‚ä¸“é—¨ä¸º32ä½ç”µè°ƒç¼–å†™ï¼Œä¸å†å¼€æºã€‚</li></ul><h2 id="blheliå›ºä»¶">BLheliå›ºä»¶</h2><h4 id="å›ºä»¶å‘½åï¼š">å›ºä»¶å‘½åï¼š</h4><p>BLHeli_Sä»£ç é™¤äº†ä¿®è®¢ç‰ˆå¤–ï¼Œè¿˜ç”¨ä¸€ä¸ªå­—æ¯ã€å¦ä¸€ä¸ªå­—æ¯å’Œä¸¤ä¸ªæ•°å­—å‘½åã€‚ä¾‹å¦‚&quot;A_L_10_REV16_0.HEX&quot;ã€‚</p><p>ç¬¬ä¸€ä¸ªå­—æ¯è¡¨ç¤ºMCUçš„å¼•è„šï¼›</p><p>ç¬¬äºŒä¸ªå­—æ¯æ˜¯Læˆ–Hï¼ˆLä»£è¡¨24MHz MCUï¼ŒHä»£è¡¨48MHz MCUï¼‰ï¼›</p><p>è¿™ä¸¤ä¸ªæ•°å­—è¡¨ç¤ºFETçš„å¼€å…³æ­»åŒºæ—¶é—´ã€‚å•ä½ä¸º20.4nsã€‚ä¸€äº›åœºæ•ˆåº”æ™¶ä½“ç®¡é©±åŠ¨å™¨å…·æœ‰è‡ªé€‚åº”åœºæ•ˆåº”æ™¶ä½“ç®¡æ­»åŒºæ—¶é—´æ§åˆ¶ï¼Œå¯¹äºè¿™äº›MOSç®¡ï¼Œåˆ™ç”¨00è¡¨ç¤ºåœºæ•ˆåº”æ™¶ä½“ç®¡å¼€å…³æ­»åŒºæ—¶é—´ã€‚</p><h4 id="å¯è®¾ç½®å‚æ•°">å¯è®¾ç½®å‚æ•°</h4><ul><li><p>å¯åŠ¨åŠŸç‡ï¼šå¯åŠ¨åŠŸç‡å¯è®¾ç½®ä¸º0.031åˆ°1.5ä¹‹é—´çš„ç›¸å¯¹å€¼ã€‚è¿™æ˜¯å¯åŠ¨æœŸé—´å…è®¸çš„æœ€å¤§åŠŸç‡ã€‚å®é™…åº”ç”¨çš„åŠŸç‡å–å†³äºèŠ‚æ°”é—¨è¾“å…¥ï¼Œå¯ä»¥æ›´ä½ï¼Œä½†æœ€ä½ç”µå¹³æ˜¯æœ€é«˜ç”µå¹³çš„å››åˆ†ä¹‹ä¸€ã€‚å¯åŠ¨åŠŸç‡ä¹Ÿä¼šå½±å“åŒå‘æ“ä½œï¼Œå› ä¸ºè¯¥å‚æ•°ç”¨äºé™åˆ¶æ–¹å‘åè½¬æœŸé—´åº”ç”¨çš„åŠŸç‡ã€‚äºä½è½¬é€Ÿï¼Œç”µæœºçš„æœ€å¤§åŠŸç‡æ˜¯æœ‰é™çš„ï¼Œä»¥ä¾¿äºæ£€æµ‹ä½åç”µåŠ¿ç”µå‹ã€‚å…è®¸çš„æœ€å¤§åŠŸç‡å¯é€šè¿‡å¯åŠ¨åŠŸç‡å‚æ•°è®¾ç½®ã€‚è¾ƒä½çš„å¯åŠ¨åŠŸç‡å‚æ•°å°†ä¸ºè¾ƒä½è½¬é€Ÿæä¾›è¾ƒä½çš„æœ€å¤§åŠŸç‡ï¼ˆè¿™ä»rev16.1å¼€å§‹å®æ–½ï¼‰ã€‚</p></li><li><p>**æ¢å‘æ—¶é—´ï¼š**æ¢å‘å®šæ—¶å¯è®¾ç½®ä¸ºä½/ä¸­ä½/ä¸­/ä¸­é«˜/é«˜ï¼Œå¯¹åº”äº00/7.50/150/22.50/300å®šæ—¶æå‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªä¸­ç­‰è®¾ç½®å°†å·¥ä½œè‰¯å¥½ï¼Œä½†å¦‚æœç”µæœºå£åƒå®ƒå¯ä»¥æ˜¯æœ‰ç›Šçš„æ”¹å˜æ—¶é—´ã€‚ä¸€äº›é«˜ç”µæ„Ÿçš„ç”µæœºå¯ä»¥æœ‰å¾ˆé•¿çš„æ¢ç›¸é€€ç£æ—¶é—´ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´ç”µæœºåœæ­¢æˆ–å£åƒæ—¶ï¼Œå¿«é€Ÿæ²¹é—¨å¢åŠ ï¼Œç‰¹åˆ«æ˜¯åœ¨è¿è¡Œåœ¨ä½è½¬é€Ÿã€‚å°†å®šæ—¶è®¾ç½®ä¸ºé«˜å°†å…è®¸æ›´å¤šçš„æ—¶é—´å»æ¶ˆç£ï¼Œé€šå¸¸æ˜¯æœ‰å¸®åŠ©çš„ã€‚</p></li><li><p>**æ¶ˆç£è¡¥å¿ï¼š**æ¶ˆç£è¡¥å¿æ˜¯ä¸€ç§ä¿æŠ¤ç”µæœºä¸å› æ¢ç›¸åè¾ƒé•¿çš„ç»•ç»„é€€ç£æ—¶é—´è€Œå¤±é€Ÿçš„åŠŸèƒ½ã€‚å…¸å‹çš„ç—‡çŠ¶æ˜¯å‘åŠ¨æœºåœæ­¢æˆ–å¿«é€Ÿå¢åŠ æ²¹é—¨æ—¶å¡é¡¿ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½è½¬é€Ÿè¿è¡Œæ—¶ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œè®¾ç½®é«˜æ¢å‘æ—¶é—´é€šå¸¸æœ‰å¸®åŠ©ï¼Œä½†ä»¥æ•ˆç‡ä¸ºä»£ä»·ã€‚</p></li><li><p>**æ–¹å‘ï¼š**æ—‹è½¬æ–¹å‘å¯è®¾ç½®ä¸ºå‰è¿›/åé€€/åŒå‘å‰è¿›/åŒå‘åé€€ã€‚åœ¨åŒå‘æ¨¡å¼ä¸‹ï¼Œä¸­å¤®æ²¹é—¨ä¸ºé›¶ï¼Œä¸Šé¢ä¸ºå‰è¿›æ–¹å‘æ—‹è½¬ï¼Œä¸‹é¢ä¸ºåå‘æ—‹è½¬ã€‚å½“é€‰æ‹©åŒå‘æ“ä½œæ—¶ï¼ŒTXç¼–ç¨‹è¢«ç¦ç”¨ã€‚</p></li><li><p>**å˜Ÿå˜Ÿå£°å¼ºåº¦ï¼š**è®¾ç½®æ­£å¸¸è¿è¡Œæ—¶çš„èœ‚é¸£éŸ³å¼ºåº¦ã€‚</p></li><li><p>**ä¿¡æ ‡å¼ºåº¦ï¼š**è®¾ç½®èœ‚é¸£ä¿¡æ ‡èœ‚é¸£æ—¶èœ‚é¸£çš„å¼ºåº¦ã€‚å¦‚æœæ²¹é—¨ä¿¡å·åœ¨ç»™å®šæ—¶é—´å†…ä¸ºé›¶ï¼Œç”µå­æ‚¬æ¶æ§åˆ¶ç³»ç»Ÿå°†å¼€å§‹å‘å‡ºèœ‚é¸£å£°ã€‚è¯·æ³¨æ„ï¼Œè®¾ç½®é«˜ä¿¡æ ‡å¼ºåº¦å¯èƒ½ä¼šå¯¼è‡´ç”µæœºæˆ–ESCè¿‡çƒ­ï¼</p></li><li><p>**ä¿¡æ ‡å»¶è¿Ÿï¼š**ä¿¡æ ‡å»¶è¿Ÿè®¾ç½®ä¿¡æ ‡å“”å“”å£°å¼€å§‹å‰çš„å»¶è¿Ÿã€‚</p></li><li><p>**æœ€å°æ²¹é—¨ã€æœ€å¤§æ²¹é—¨å’Œä¸­å€¼æ²¹é—¨ï¼š**è¿™äº›è®¾ç½®è®¾ç½®ESCçš„æ²¹é—¨èŒƒå›´ã€‚ä¸­å¤®æ²¹é—¨ä»…ç”¨äºåŒå‘æ“ä½œã€‚ä¸ºè¿™äº›è®¾ç½®æä¾›çš„å€¼é€‚ç”¨äºæ­£å¸¸çš„1000usåˆ°2000usè¾“å…¥ä¿¡å·ï¼Œå¯¹äºå…¶ä»–è¾“å…¥ä¿¡å·ï¼Œè¿™äº›å€¼å¿…é¡»æŒ‰æ¯”ä¾‹ç¼©æ”¾ã€‚</p></li><li><p>**çƒ­ä¿æŠ¤ï¼š**å¯ä»¥å¯ç”¨æˆ–ç¦ç”¨çƒ­ä¿æŠ¤ã€‚æ¸©åº¦é˜ˆå€¼å¯ä»¥åœ¨800Cå’Œ1400Cä¹‹é—´ç¼–ç¨‹ï¼ˆå¯ç¼–ç¨‹é˜ˆå€¼ä»rev16.3å¼€å§‹æ‰§è¡Œï¼‰ã€‚å¯ç¼–ç¨‹é˜ˆå€¼ä¸»è¦æ˜¯ä¸ºäº†æ”¯æŒç¡¬ä»¶åˆ¶é€ å•†ä½¿ç”¨ï¼Œå› ä¸ºä¸åŒçš„ç¡¬ä»¶å¯ä»¥å¯¹æ‰€ä½¿ç”¨çš„å„ç§ç»„ä»¶çš„æœ€é«˜æ¸©åº¦æœ‰ä¸åŒçš„å…¬å·®ã€‚</p></li><li><p>**ä½è½¬é€ŸåŠŸç‡ä¿æŠ¤ï¼š**å¯ä»¥å¯ç”¨æˆ–ç¦ç”¨ä½è½¬é€Ÿçš„åŠŸç‡é™åˆ¶ã€‚ç¦ç”¨å®ƒå¯èƒ½æ˜¯å¿…è¦çš„ï¼Œä»¥å®ç°åœ¨ä½ç”µæºç”µå‹ä¸‹è¿è¡Œçš„ä¸€äº›ä½kVç”µæœºçš„å…¨åŠŸç‡ã€‚ä½†æ˜¯ï¼Œç¦ç”¨å®ƒä¼šå¢åŠ åŒæ­¥ä¸¢å¤±çš„é£é™©ï¼Œå¹¶å¯èƒ½å¯¼è‡´ç”µæœºæˆ–ç”µå­ç¨³å®šæ§åˆ¶ç³»ç»Ÿè¿‡çƒ­ã€‚</p></li><li><p>**åœæ­¢æ—¶åˆ¶åŠ¨ï¼š**å¯ä»¥å¯ç”¨æˆ–ç¦ç”¨åˆ¶åŠ¨åœæ­¢ã€‚å¯ç”¨æ—¶ï¼Œæ²¹é—¨ä¸ºé›¶æ—¶å°†åº”ç”¨åˆ¶åŠ¨å™¨ã€‚å¯¹äºéé›¶æ²¹é—¨ï¼Œæ­¤è®¾ç½®æ— æ•ˆã€‚</p></li><li><p>**LEDæ§åˆ¶ï¼š**LEDå¯ä»¥åœ¨æ”¯æŒå®ƒçš„ESCä¸Šæ§åˆ¶ã€‚æœ€å¤šå¯ä»¥æ‰“å¼€æˆ–å…³é—­4ä¸ªLEDã€‚</p></li></ul><h3 id="blhelièœ‚é¸£å™¨å«ä¹‰">BLHelièœ‚é¸£å™¨å«ä¹‰</h3><p>å¯¹äºBLHeliç”µè°ƒï¼Œä¸Šç”µçš„æ—¶å€™ä¼šå‘å‡ºä¸€äº›å£°éŸ³ï¼Œå®é™…ä¸Šæ¯ä¸ªå£°éŸ³éƒ½æœ‰è‡ªå·±çš„æ„æ€ï¼Œå¦‚ä¸‹ï¼š</p><ul><li>100%ä¸Šç”µæ—¶ï¼Œç”µå­ç¨³å®šæ§åˆ¶ç³»ç»Ÿé¸£å«3æ¬¡ã€‚</li><li>å½“æ£€æµ‹åˆ°æ²¹é—¨ä¿¡å·æ—¶ï¼Œå®ƒä¼šå‘å‡ºä¸€å£°ä½æ²‰çš„å“”å“”å£°ã€‚è¿™è¡¨ç¤ºå¼€å§‹è­¦æˆ’åºåˆ—ã€‚</li><li>ç„¶åï¼Œå½“æˆ–å¦‚æœæ²¹é—¨ä¸ºé›¶ï¼Œå®ƒä¼šå‘å‡ºä¸€å£°é«˜éŸ³å“”å“”å£°ã€‚è¿™æ ‡å¿—ç€è­¦æˆ’åºåˆ—çš„ç»“æŸã€‚</li><li>æ­¤å¤–ï¼Œå¦‚æœåœ¨å¯ç”¨é¡ºåºæœŸé—´æ£€æµ‹åˆ°100%æ²¹é—¨ï¼Œç”µå­æ‚¬æ¶æ§åˆ¶ç³»ç»Ÿå°†å¼€å§‹æ²¹é—¨æ ¡å‡†ã€‚</li><li>å¦‚æœç”µå­ç¨³å®šæ§åˆ¶ç³»ç»Ÿå¤„äºå¾…å‘½çŠ¶æ€ï¼Œå¹¶åœ¨ç»™å®šæ—¶é—´å†…çœ‹åˆ°é›¶æ²¹é—¨ï¼Œå®ƒä¼šå‘å‡ºä¿¡æ ‡å“”å“”å£°ï¼Œå¤§çº¦æ¯ä¸‰ç§’å‘å‡ºä¸€å£°å“”å“”å£°ã€‚</li></ul><h3 id="blheliçš„çƒ­ä¿æŠ¤ï¼š">BLHeliçš„çƒ­ä¿æŠ¤ï¼š</h3><p>ESCæµ‹é‡MCUå†…çš„æ¸©åº¦ï¼Œå¦‚æœæ¸©åº¦è¿‡é«˜ï¼Œåˆ™é™åˆ¶ç”µæœºåŠŸç‡ã€‚ç”µæœºåŠŸç‡åˆ†å››æ­¥é™åˆ¶ï¼š</p><p>-  å¦‚æœæ¸©åº¦é«˜äºä¸´ç•Œå€¼ï¼Œç”µæœºåŠŸç‡é™åˆ¶åœ¨75%ã€‚</p><p>-  å¦‚æœæ¸©åº¦é«˜äºé˜ˆå€¼åŠ ä¸Š50æ‘„æ°åº¦ï¼Œç”µæœºåŠŸç‡é™åˆ¶åœ¨50%ã€‚</p><p>-  å¦‚æœæ¸©åº¦é«˜äºé˜ˆå€¼åŠ ä¸Š100æ‘„æ°åº¦ï¼Œç”µæœºåŠŸç‡é™åˆ¶åœ¨25%ã€‚</p><p>-  å¦‚æœæ¸©åº¦é«˜äºé˜ˆå€¼+150â„ƒï¼Œåˆ™ç”µæœºåŠŸç‡é™åˆ¶ä¸º0%ã€‚</p><h3 id="blheliä¸Šä½æœº-blheli-suite">BLheliä¸Šä½æœºâ€”â€”BLheli suite</h3><p>ä¼ ç»Ÿæ”¹å˜å›ºä»¶å‚æ•°çš„æ–¹æ³•æ˜¯ç¼–è¯‘ä¸€ä¸ªå›ºä»¶ä¹‹åé€šè¿‡arduino nanoçƒ§å½•åˆ°ç”µè°ƒé‡Œé¢æ¥è®¾ç½®å¦‚ä¸Šä¸€å †å€¼ã€‚</p><p>ä½†æ˜¯ç°åœ¨æœ‰äº†BLheliï¼Œå¯ä»¥é€šè¿‡ä¸Šä½æœºå¯¹ç”µè°ƒè¿›è¡Œå‚æ•°ä¿®æ”¹ï¼Œå…·ä½“æ–¹æ³•æ˜¯ç”¨ä¸€ä¸ªbetaflightçš„é£æ§æ¿è¿æ¥ä¸Šç”µè°ƒï¼Œç”¨ç”µè°ƒæ¥æ”¹ã€‚</p><h3 id="blheliå›ºä»¶çƒ§å½•">BLheliå›ºä»¶çƒ§å½•</h3><p>æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯éœ€è¦arduino unoï¼ŒCH340ï¼ŒBLheli Suiteï¼Œå¯ä»¥æœä¸€ä¸‹æ•™ç¨‹ï¼Œéœ€è¦æŠŠå‡ ä¸ªç„Šç‚¹å’Œarduinoè¿æ¥ï¼Œæˆ–è€…ç›´æ¥ç”¨Betaflightçš„é£æ§æ¿è²Œä¼¼ä¹Ÿèƒ½çƒ§å½•ã€‚</p><p><a href="https://www.elvinplay.com/how-to-flash-esc-with-blheli-without-soldering/">æ‡’äººå…ç„Šæ¥å‚»ç“œåŒ…ä¼šä»é›¶å¼€å§‹ç»™ç”µè°ƒåˆ·BLHELIå›ºä»¶ â€“ Elvin Play</a></p><h2 id="ç”µè°ƒåè®®">ç”µè°ƒåè®®</h2><p>ç”µè°ƒåè®®æ˜¯é£è¡Œæ§åˆ¶å™¨å’Œç”µè°ƒç”¨äºé€šä¿¡çš„<em>è¯­è¨€</em>ï¼Œå†³å®šäº†ä¿¡å·ä»é£æ§åˆ°ç”µè°ƒçš„å‘é€é€Ÿåº¦ã€‚å››è½´é£è¡Œå™¨ä½¿ç”¨çš„ç”µè°ƒåè®®åŠä¿¡å·å®½åº¦å¦‚ä¸‹ï¼Œä»ä¸Šè€Œä¸‹ä¾æ¬¡é«˜çº§</p><ul><li>æœ€ä¼ ç»ŸPWM ï¼š1000us â€“ 2000us</li><li><a href="https://oscarliang.com/oneshot125-esc-quadcopter-fpv/">Oneshot125æ¨¡æ‹Ÿåè®®</a>ï¼š125us â€“ 250us</li><li><a href="http://intofpv.com/t-oneshot42-explained-kiss-esc-fc-protocol">Oneshot 42æ¨¡æ‹Ÿåè®®</a>ï¼š2us â€“ 84us</li><li><a href="https://oscarliang.com/raceflight-multishot/">Multishotæ¨¡æ‹Ÿåè®®</a>ï¼š5us â€“ 25us</li><li>Dshotæ•°å­—åè®®<ul><li>Dshot150 ï¼š106.8us</li><li>Dshot300 ï¼š53.4us</li><li>Dshot600 ï¼š26.7us</li><li><a href="https://oscarliang.com/dshot1200-esc-protocol/">DShot1200</a>ï¼š13.4us</li></ul></li><li>ProShot</li></ul><h3 id="æ¨¡æ‹Ÿç”µè°ƒå’Œæ•°å­—ç”µè°ƒåŒºåˆ«">æ¨¡æ‹Ÿç”µè°ƒå’Œæ•°å­—ç”µè°ƒåŒºåˆ«</h3><p>æ¨¡æ‹Ÿç”µè°ƒåè®®æ¯éš”å‡ å¾®ç§’å°±å°†ç”µè„‰å†²ä»é£æ§å‘é€åˆ°ç”µè°ƒã€‚è„‰å†²æŒç»­æ—¶é—´çš„é•¿çŸ­ï¼ˆæ²¹é—¨å¤§å°ï¼‰å†³å®šäº†ç”µæœºçš„åŠŸç‡ã€‚è¿™ç§æ§åˆ¶æ–¹æ¡ˆå—åˆ°ç”µå™ªå£°å’Œç”µè„‰å†²å®šæ—¶ç²¾åº¦çš„é™åˆ¶ã€‚</p><p>ä½¿ç”¨ DShot æ•°å­—ç”µè°ƒæ„å‘³ç€é£æ§å°†ä»¥æ•°å­—ç¼–å·çš„å½¢å¼å‘ç”µè°ƒå‘é€ç²¾ç¡®çš„æ²¹é—¨å€¼ã€‚è¿™ä¸ªæ•°å­—å°†æœ‰ä¸€ä¸ªæ ¡éªŒå€¼ï¼Œä»¥ä¾¿ä»é£æ§å‘é€åˆ°ç”µè°ƒçš„æ²¹é—¨å€¼æ°¸è¿œä¸ä¼šè¢«è¯†åˆ«é”™è¯¯ã€‚</p><p>ä¸Oneshotå’ŒMultishotç›¸æ¯”ï¼ŒDShotæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼š</p><ul><li>æ— éœ€è¿›è¡Œç”µè°ƒè¡Œç¨‹æ ¡å‡†</li><li>æ›´ç²¾ç¡®çš„ä¼ è¾“ä¿¡å·ï¼Œæ›´å¼ºå¤§çš„æŠ—å¹²æ‰°èƒ½åŠ›</li><li>åˆ†è¾¨ç‡ä¸º2048ï¼Œè€Œå…¶ä»–åè®®åˆ†è¾¨ç‡ä¸º1000</li><li>æ¯”Oneshotåè®®æ›´å¿«</li><li>æ›´å®‰å…¨ï¼Œæ¯ä¸ªä¿¡å· ç”µè°ƒéƒ½å¯ä»¥æ£€æµ‹yifanæŸåçš„æ•°æ®</li><li>DSHOTå¹¶ä¸æ˜¯æ•ˆç‡æœ€é«˜çš„åè®®</li></ul><h2 id="pwm">PWM</h2><p>PWM ESC é€šå¸¸ç”¨äºå›ºå®šç¿¼è½¦è¾†å’Œåœ°é¢èˆªæ¨¡ï¼Œå¯¹äºFPVé€šå¸¸ä½¿ç”¨ oneshot æˆ– dshot ESCï¼Œä½†è¿™æ˜¯æœ€ä¼ ç»Ÿçš„ç”µè°ƒé€šè®¯åè®®ã€‚PWM ESC ä½¿ç”¨å‘¨æœŸæ€§è„‰å†²è¿›è¡Œé€šä¿¡ï¼Œå…¶ä¸­è„‰å†²çš„å®½åº¦è¡¨ç¤ºæ‰€éœ€çš„åŠŸç‡æ°´å¹³ã€‚è„‰å†²å¸¦å®½é€šå¸¸ä»‹äº 1000uS ï¼ˆé›¶åŠŸç‡ï¼‰ å’Œ 2000uS ï¼ˆå…¨åŠŸç‡ï¼‰ ä¹‹é—´ã€‚ä¿¡å·çš„å‘¨æœŸæ€§å¸§é€Ÿç‡å–å†³äº ESC çš„èƒ½åŠ›ï¼Œé€šå¸¸åœ¨ 50Hz å’Œ 490 Hz ä¹‹é—´ç†è®ºæœ€å¤§å€¼ä¸º 500Hzï¼Œé€Ÿç‡è¶Šé«˜ï¼ŒESC è¶Šå¥½ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦å¿«é€Ÿå“åº”è®¾å®šå€¼å˜åŒ–çš„æƒ…å†µä¸‹ã€‚å¯¹äº PWM ä¼ºæœç³»ç»Ÿï¼Œ50Hz é€šå¸¸å°±è¶³å¤Ÿäº†ï¼Œè®¸å¤šä¸æ”¯æŒæ›´é«˜çš„é€Ÿç‡ã€‚</p><h2 id="oneshot">Oneshot</h2><p>OneShot 125 ç”µè°ƒé€šå¸¸æ¯” PWM ç”µè°ƒå¿«å¾—å¤šï¼Œå› æ­¤å“åº”æ›´å¿«ï¼Œæ›´å®¹æ˜“è°ƒæ•´ã€‚å¯¹äºå¤šæ—‹ç¿¼é£è¡Œå™¨ï¼Œå®ƒä»¬æ¯” PWM æ›´å—æ¬¢è¿ï¼Œä½†ä¸å¦‚ DShot ESCï¼Œå› ä¸ºDshotä¸éœ€è¦æ ¡å‡†ï¼Œå¹¶ä¸”å¯ä»¥æä¾›é¥æµ‹åé¦ˆã€‚OneShot åè®®æœ‰è®¸å¤šå˜ä½“ï¼Œå®ƒä»¬æ”¯æŒä¸åŒçš„é€Ÿç‡ï¼Œæ¯”å¦‚oneshot42,oneshot125ã€‚</p><p>OneShot 125 ä¸ PWM ç›¸åŒï¼Œä½†ä½¿ç”¨çš„è„‰å†²å®½åº¦çŸ­ 8 å€ï¼ˆä» 125us åˆ° 250usï¼Œä»é›¶åŠŸç‡åˆ°å…¨åŠŸç‡ï¼‰ã€‚è¿™ä½¿å¾— OneShot 125  ESC å…·æœ‰æ›´çŸ­çš„å ç©ºæ¯”/æ›´é«˜çš„é€Ÿç‡ã€‚å¯¹äº PWMï¼Œç†è®ºæœ€å¤§å€¼æ¥è¿‘ 500 Hzï¼Œè€Œå¯¹äº OneShotï¼Œåˆ™æ¥è¿‘ 4  kHzã€‚å®é™…æ”¯æŒçš„é€Ÿç‡å–å†³äºæ‰€ä½¿ç”¨çš„ ESCã€‚</p><h2 id="dshot">Dshot</h2><p>DShotï¼ˆDigital Shotï¼Œæ˜¯æ•°å­—åè®®ï¼‰ï¼ˆç›¸å¯¹äºoneshotï¼Œoneshot125ï¼Œoneshot42ï¼Œmultishotç­‰æ¨¡æ‹Ÿåè®®ï¼‰ã€‚å®ƒæœ€åˆæ˜¯ç”±Felixåœ¨KISSæå‡ºçš„ï¼Œåæ¥è¢«Betaflightå’ŒBLHeli_Så¼€å‘å›¢é˜Ÿé‡‡ç”¨ã€‚<strong>æ˜¯ç”¨æ¥å’Œåˆ·æœ‰BLheliå›ºä»¶çš„ç”µè°ƒé€šè®¯çš„åè®®ã€‚</strong></p><ul><li>BLHeliå›ºä»¶å¼€æºåœ°å€ï¼š<a href="https://github.com/bitdump/BLHeli.git">https://github.com/bitdump/BLHeli.git</a></li><li>BLHeliä¸Šä½æœºï¼š<a href="https://github.com/blheli-configurator/blheli-configurator.git">https://github.com/blheli-configurator/blheli-configurator.git</a></li></ul><h3 id="dshotçš„é€Ÿåº¦">DShotçš„é€Ÿåº¦</h3><p>ç›®å‰å¸¸ç”¨çš„DShotåè®®æœ‰ï¼šDShot600ï¼ŒDShot300ï¼ŒDShot150 ï¼ˆDShot1200å·²ç»åœ¨æœ€æ–°çš„betaflight4.11å›ºä»¶å–æ¶ˆäº†ï¼‰ï¼Œå…¶ä¼ è¾“é€Ÿç‡ï¼š</p><ul><li><p>DShot600 â€“ 600,000 bits/Sec</p></li><li><p>DShot300 â€“ 300,000 bits/Sec</p></li><li><p>DShot150 â€“ 150,000 bits/Sec</p></li></ul><p>å¼•å…¥ DSHOT300 å’Œ DSHOT150 æ˜¯ä¸ºäº†ç¡®ä¿æ”¯æŒåŠŸèƒ½è¾ƒå¼±çš„æ—§ESCç”µè°ƒï¼ŒDSHOT1200æ˜¯è¾ƒæ–°çš„åä»ªï¼Œæœ‰äº›ç”µè°ƒå¯èƒ½è¿˜ä¸æ”¯æŒã€‚</p><p>ä¾‹å¦‚ï¼ŒDShot600çš„é¢‘ç‡ä¸º600,000 / 1637500hz= 37.5 KHzï¼Œè¿™æ„å‘³ç€å°†ä¸€ä¸ªæ²¹é—¨å€¼ä»é£æ§å‘é€åˆ°ç”µè°ƒéœ€è¦å¤§çº¦26.7 uSã€‚å„ç§ç”µè°ƒä¼ è¾“åè®®é€Ÿåº¦å¯¹æ¯”ä¸ Oneshot125ã€ Oneshot42å’Œ Multishot çš„é€Ÿåº¦ç›¸æ¯”(å‡è®¾ä¿¡å·æ˜¯100% æ²¹é—¨)</p><ul><li><p>Oneshot125 â€“ 250 uS</p></li><li><p>DShot150 â€“ 106.7 uS</p></li><li><p>Oneshot42 â€“ 84 uS</p></li><li><p>DShot300 â€“ 53.3 uS</p></li><li><p>DShot600 â€“ 26.7 uS</p></li><li><p>Multishot â€“ 25 uS</p></li></ul><p>å¿«é€Ÿä¼ è¾“é€Ÿåº¦çš„ DShot ç†è®ºä¸Šå°†å…è®¸é«˜è¾¾33KHzçš„é£æ§è¿è¡Œé¢‘ç‡ã€‚ä½†æ˜¯ä¸è¦é«˜è¾¾37.5 KHzï¼Œå› ä¸ºéœ€è¦ç•™æœ‰ä¸€äº›ç©ºé—´ã€‚è™½ç„¶ DShot600æ²¡æœ‰ Multishot é‚£ä¹ˆå¿«ï¼Œä½†æ˜¯åªè¦å®ƒæ¯”é£æ§è¿è¡Œé¢‘ç‡å¿«å°±è¶³å¤Ÿäº†ã€‚</p><h3 id="dshot600æ•°æ®å¸§">Dshot600æ•°æ®å¸§</h3><p>ä¸€ä¸ª DShot æ•°æ®åŒ…ç”±16ä½ç»„æˆ</p><ul><li>11ä½è¡¨ç¤ºæ²¹é—¨å€¼(2^10= 2048åˆ†è¾¨ç‡)</li><li>1ä½è¡¨ç¤ºé¥æµ‹è¯·æ±‚æ˜¯telemetryè¯·æ±‚æ ‡å¿—ï¼Œtlméœ€è¦ç”µè°ƒç¡¬ä»¶æ”¯æŒ</li><li>4ä½è¡¨ç¤º CRC æ ¡éªŒ(å¾ªç¯å†—ä½™æ ¡éªŒ)</li><li>é€Ÿåº¦600kbits/sï¼Œä¸€å¸§ä¿¡å·çš„é•¿åº¦ä¸º26.7usã€‚</li><li>å¯¹äºDSHOT600ï¼Œæ•´ä¸ªæ¯”ç‰¹ä½çš„é•¿åº¦ä¸º1.67usï¼ˆT0H+T0Læˆ–T1H+T1Lï¼‰ï¼Œ0çš„é«˜ç”µå¹³æ—¶é—´ä¸º625nsï¼Œ1çš„é«˜ç”µå¹³æ—¶é—´æ˜¯1250nsã€‚</li><li>å¸§ä¸å¸§ä¹‹é—´éœ€è¦ä¸€ç‚¹é—´éš”ï¼ˆ2-3usï¼‰ï¼Œä»¥åŒºåˆ«ä¸åŒçš„å¸§ä¿¡å· <img src="https://i-blog.csdnimg.cn/blog_migrate/0d6a8f70ce815666c70810aeb6ee1ada.png" alt="æœ€è¯¦ç»†çš„DSHOTåè®®ä»‹ç»"></li><li>11ä½æ²¹é—¨å€¼å¯ä»¥è¾¾åˆ°2048çš„åˆ†è¾¨ç‡ï¼Œå®é™…ä½¿ç”¨48-2047è¡¨ç¤ºæ²¹é—¨å€¼ï¼Œæ‰€ä»¥æ²¹é—¨ä¿¡å·æ˜¯2000çš„åˆ†è¾¨ç‡ï¼Œ0æ˜¯ä¸Šç”µåçš„é»˜è®¤å€¼ï¼ˆé”å®šå€¼ï¼‰ï¼Œ1-47è¡¨ç¤ºä¸€äº›å‘½ä»¤å’Œè®¾ç½®ï¼Œä¸€äº›å€¼çš„æ„ä¹‰å¦‚ä¸‹ï¼š<ul><li>1-5ï¼šbeepï¼ˆ1= low freq. 5 = high freq</li><li>escä¿¡æ¯è¯·æ±‚ï¼ˆfwç‰ˆæœ¬å’Œé€šè¿‡tlmçº¿å‘é€çš„SNï¼‰</li><li>7ï¼šä¸€ä¸ªæ–¹å‘æ—‹è½¬</li><li>8ï¼šå¦ä¸€ä¸ªæ–¹å‘æ—‹è½¬</li><li>9ï¼š3dæ¨¡å¼å…³é—­</li><li>10ï¼š3dæ¨¡å¼æ‰“å¼€</li><li>11ï¼šescè®¾ç½®è¯·æ±‚ï¼ˆsaved settings over the TLM wireï¼‰</li><li>12ï¼šä¿å­˜è®¾ç½®</li></ul></li></ul><h3 id="åŒå‘dshot">åŒå‘dshot</h3><p>Joe Lucidæ›´è¿›ä¸€æ­¥å¼•å…¥äº†åŒå‘ DSHOTåè®®ã€‚æ”¯æŒåŒå‘dshotçš„ç”µå­è°ƒé€Ÿå™¨ESCèƒ½å¤Ÿå‘é£è¡Œæ§åˆ¶å™¨å‘é€é¥æµ‹æ•°æ®ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>æ¸©åº¦</li><li>ç”µå‹</li><li>å½“å‰</li><li>ç´¯ç§¯ç”µæµæ¶ˆè€—</li><li>è½¬é€Ÿå€¼</li></ul><p><strong>è¿™äº› DShot ESC å°†æœ‰ä¸€æ¡é¢å¤–çš„é¥æµ‹çº¿ã€‚</strong></p><p>è¦å¯ç”¨æ­¤åŠŸèƒ½ï¼ˆåœ¨æ”¯æŒæ­¤åŠŸèƒ½çš„ç”µè°ƒä¸Šä½¿ç”¨ï¼‰ï¼šå°†æ‰€æœ‰ç”µè°ƒçš„é¥æµ‹çº¿è¿æ¥åœ¨ä¸€èµ·ï¼Œç„¶åå°†å®ƒä»¬è¿æ¥åˆ°æœªä½¿ç”¨çš„é£è¡Œæ§åˆ¶å™¨ä¸²è¡Œç«¯å£ä¸Šçš„ä¸€ä¸ª RX å¼•è„šã€‚</p><p>åœ¨é€šè®¯æ–¹å¼ä¸Šï¼ŒåŒå‘DSHOTä¿¡å·ä½¿ç”¨åè½¬ç”µå¹³ï¼ˆç©ºé—²ä¸º 1ï¼‰ã€‚ FC åˆ° ESC ä½¿ç”¨ DSHOT å¸§ï¼Œä½†æœ€ä½ 4 ä½æ˜¯å…¶ä»–åŠå­—èŠ‚å¼‚æˆ–åçš„åç ï¼ˆæ­£å¸¸DSHOTçš„æ ¡éªŒæ˜¯ä¸åç çš„ï¼‰ã€‚</p><h2 id="ä¸€å¥—dshoté€šè®¯å‚è€ƒä»£ç 1">ä¸€å¥—Dshoté€šè®¯å‚è€ƒä»£ç 1</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> ESC_BIT_0     11</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESC_BIT_1     22</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESC_CMD_BUF_LEN 18</span></span><br><span class="line"><span class="type">uint16_t</span> ESC_CMD[ESC_CMD_BUF_LEN]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">uint16_t</span> <span class="title function_">prepareDshotPacket</span><span class="params">(<span class="type">const</span> <span class="type">uint16_t</span> value, <span class="type">int8_t</span> requestTelemetry)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// æ²¹é—¨å¤§å°ä¸º11ä½  æ‰€ä»¥è¿™é‡Œå…ˆå·¦ç§»ä¸€ä½ æ·»åŠ ä¸Šè¯·æ±‚å›ä¼ æ ‡å¿—å…±12ä½</span></span><br><span class="line">    <span class="type">uint16_t</span> packet = (value &lt;&lt; <span class="number">1</span>) | (requestTelemetry ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line"><span class="comment">// å°†12ä½æ•°æ®åˆ†ä¸º3ç»„ æ¯ç»„4ä½, è¿›è¡Œå¼‚æˆ–</span></span><br><span class="line"><span class="comment">// compute checksum</span></span><br><span class="line"><span class="type">int</span> csum = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> csum_data = packet;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">    csum ^=  csum_data;   <span class="comment">// xor data by nibbles</span></span><br><span class="line">    csum_data &gt;&gt;= <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å–æœ€åå››ä½ å…¶ä»–çš„ä¸è¦</span></span><br><span class="line">csum &amp;= <span class="number">0xf</span>;</span><br><span class="line"><span class="comment">// append checksum å°†CRCæ·»åŠ åˆ°åå››ä½</span></span><br><span class="line">packet = (packet &lt;&lt; <span class="number">4</span>) | csum;</span><br><span class="line"><span class="keyword">return</span> packet;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">pwmWriteDigital</span><span class="params">(<span class="type">uint16_t</span> *esc_cmd, <span class="type">uint16_t</span> value)</span></span><br><span class="line">&#123;</span><br><span class="line">value = ( (value &gt; <span class="number">2047</span>) ? <span class="number">2047</span> : value );</span><br><span class="line">value = prepareDshotPacket(value, <span class="number">0</span>);</span><br><span class="line">    esc_cmd[<span class="number">0</span>]  = (value &amp; <span class="number">0x8000</span>) ? ESC_BIT_1 : ESC_BIT_0;</span><br><span class="line">    esc_cmd[<span class="number">1</span>]  = (value &amp; <span class="number">0x4000</span>) ? ESC_BIT_1 : ESC_BIT_0;</span><br><span class="line">    esc_cmd[<span class="number">2</span>]  = (value &amp; <span class="number">0x2000</span>) ? ESC_BIT_1 : ESC_BIT_0;</span><br><span class="line">    esc_cmd[<span class="number">3</span>]  = (value &amp; <span class="number">0x1000</span>) ? ESC_BIT_1 : ESC_BIT_0;</span><br><span class="line">    esc_cmd[<span class="number">4</span>]  = (value &amp; <span class="number">0x0800</span>) ? ESC_BIT_1 : ESC_BIT_0;</span><br><span class="line">    esc_cmd[<span class="number">5</span>]  = (value &amp; <span class="number">0x0400</span>) ? ESC_BIT_1 : ESC_BIT_0;</span><br><span class="line">    esc_cmd[<span class="number">6</span>]  = (value &amp; <span class="number">0x0200</span>) ? ESC_BIT_1 : ESC_BIT_0;</span><br><span class="line">    esc_cmd[<span class="number">7</span>]  = (value &amp; <span class="number">0x0100</span>) ? ESC_BIT_1 : ESC_BIT_0;</span><br><span class="line">    esc_cmd[<span class="number">8</span>]  = (value &amp; <span class="number">0x0080</span>) ? ESC_BIT_1 : ESC_BIT_0;</span><br><span class="line">    esc_cmd[<span class="number">9</span>]  = (value &amp; <span class="number">0x0040</span>) ? ESC_BIT_1 : ESC_BIT_0;</span><br><span class="line">    esc_cmd[<span class="number">10</span>] = (value &amp; <span class="number">0x0020</span>) ? ESC_BIT_1 : ESC_BIT_0;</span><br><span class="line">    esc_cmd[<span class="number">11</span>] = (value &amp; <span class="number">0x0010</span>) ? ESC_BIT_1 : ESC_BIT_0;</span><br><span class="line">    esc_cmd[<span class="number">12</span>] = (value &amp; <span class="number">0x8</span>) ? ESC_BIT_1 : ESC_BIT_0;</span><br><span class="line">    esc_cmd[<span class="number">13</span>] = (value &amp; <span class="number">0x4</span>) ? ESC_BIT_1 : ESC_BIT_0;</span><br><span class="line">    esc_cmd[<span class="number">14</span>] = (value &amp; <span class="number">0x2</span>) ? ESC_BIT_1 : ESC_BIT_0;</span><br><span class="line">    esc_cmd[<span class="number">15</span>] = (value &amp; <span class="number">0x1</span>) ? ESC_BIT_1 : ESC_BIT_0;</span><br><span class="line">    HAL_TIM_PWM_Start_DMA(&amp;htim1,TIM_CHANNEL_1,(<span class="type">uint32_t</span> *)esc_cmd,ESC_CMD_BUF_LEN);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;BLheliç”µè°ƒä¸Dshoté€šè®¯&lt;/h1&gt;
&lt;p&gt;è¿™é‡Œé¦–å…ˆä»‹ç»ä¸€ä¸‹åŸºæœ¬æ¦‚å¿µ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç”µè°ƒESCï¼šå…¨ç§°ç”µå­é€Ÿåº¦æ§åˆ¶å™¨ï¼Œä¸€ä¸ªç”µæœºéœ€è¦æ§åˆ¶è½¬åŠ¨ï¼Œéœ€è¦ç”µè°ƒESCï¼Œç”µè°ƒè´Ÿè´£æŠŠè¾“å…¥çš„ç›´æµç”µè½¬åŒ–ä¸ºä¸‰ç›¸ç”µç­‰è¾“å…¥ï¼Œæ ¹æ®é£è¡Œæ§åˆ¶å™¨çš„è¾“å…¥æŒ‡ä»¤ï¼ˆFCï¼‰è°ƒèŠ‚ç”µæœºçš„é€Ÿåº¦ï¼ˆå’Œ</summary>
      
    
    
    
    <category term="åµŒå…¥å¼" scheme="http://outbreak-sen.github.io/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    
  </entry>
  
  <entry>
    <title>LLVM tablegen</title>
    <link href="http://outbreak-sen.github.io/2025/02/11/LLVM-tablegen/"/>
    <id>http://outbreak-sen.github.io/2025/02/11/LLVM-tablegen/</id>
    <published>2025-02-11T02:19:57.000Z</published>
    <updated>2025-03-19T09:12:54.058Z</updated>
    
    <content type="html"><![CDATA[<h1>LLVMå’ŒLLVM tablegenå­¦ä¹ ç¬”è®°</h1><h2 id="llvmä»‹ç»">LLVMä»‹ç»</h2><p>LLVM æ˜¯ä¸€ä¸ªè·¨å¹³å°ï¼ˆå¯åœ¨ Linuxã€Windows å’Œ Mac ä¸Šä½¿ç”¨ï¼‰C/C++ ç¼–è¯‘å™¨å·¥å…·é›†ï¼Œåƒ GCCä¸€æ ·ã€‚ LLVM å¯ä»¥ç¼–è¯‘ç”¨  Cã€C++ å’Œ Objective-C ç¼–å†™çš„ä»£ç ã€‚  LLVM é€šè¿‡ libc++ å’Œ libc++ ABI é¡¹ç›®æ”¯æŒ C++11ã€C++14 å’Œ C++17ã€‚ LLVM è¿˜éƒ¨åˆ†æ”¯æŒæœ€æ–°çš„ C++20 å’Œ C++2b æ ‡å‡†ã€‚LLVMä¹‹æ‰€ä»¥ä¼˜ç§€ï¼Œåœ¨äºä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>LLVMçš„ä¸­é—´è¡¨è¾¾ï¼ˆIRï¼‰æ˜¯å¯ä»¥é˜…è¯»çš„æ–‡æœ¬å½¢å¼çš„ï¼Œå…¶ä»–å¾ˆå¤šç¼–è¯‘å™¨å´åªæœ‰å†…å­˜ä¸­çš„æ•°æ®ç»“æ„ï¼Œä½¿å¾—å­¦ä¹ è°ƒè¯•éš¾åº¦å¤§å¢ã€‚</li><li>LLVM å·¥å…·é›†æä¾›çš„ Clang å¯ä»¥æ¯” GCC æ›´å¿«åœ°ç¼–è¯‘ C å’Œ C++ ä»£ç ã€‚ä¸  GCC ç›¸æ¯”ï¼ŒLLVM è°ƒè¯•å™¨ LLDB çš„å†…å­˜æ•ˆç‡æ›´é«˜ï¼ŒåŠ è½½ç¬¦å·çš„é€Ÿåº¦æ›´å¿«ã€‚</li><li>å§‹äºå­¦æœ¯é¡¹ç›®ä¸€ä¸ªåšå£«çš„é¡¹ç›®ï¼Œä½†LLVMä¸€ç›´å—åˆ°å·¥ä¸šç•ŒAppleçš„æ”¯æŒï¼Œclangï¼ˆæ˜¯llvmçš„å‰ç«¯ï¼‰å’ŒLLVMéƒ½æ˜¯appleæå‡ºæ¥çš„ï¼Œå› ä¸ºgccä»–ä»¬ä¸æ»¡æ„ï¼Œåæ¥appleç ”å‘çš„swiftä¹Ÿæ˜¯åŸºäºllvmä½œä¸ºç¼–è¯‘å™¨ï¼Œåæ¥ç ”å‘llvmçš„è¿™ä¸ªäººå»äº†Teslaï¼Œgoogleï¼Œtensorflowã€‚LLVMä¸ä»…å¥½ç”¨ï¼Œè€Œä¸”å¼€æºå¯å®šåˆ¶ã€‚é¿å…äº†åœ¨Javaä¸­ç±»ä¼¼é¢ä¸´é€‰æ‹©HotSpotå’Œjikesçš„å›°å¢ƒã€‚</li></ul><p>**ä½ å¯ä»¥åŸºäºLLVMæä¾›çš„åŠŸèƒ½å¼€å‘è‡ªå·±çš„æ¨¡å—ï¼Œå¹¶é›†æˆåœ¨LLVMç³»ç»Ÿä¸Šï¼Œå¢åŠ å®ƒçš„åŠŸèƒ½ï¼Œæˆ–è€…å°±å•çº¯è‡ªå·±å¼€å‘è½¯ä»¶å·¥å…·ï¼Œè€Œåˆ©ç”¨LLVMæ¥æ”¯æ’‘åº•å±‚å®ç°ã€‚**LLVMæ˜¯ä¸€ä¸ªç¼–è¯‘å™¨æ¡†æ¶ã€‚LLVMä½œä¸ºç¼–è¯‘å™¨æ¡†æ¶ï¼Œæ˜¯éœ€è¦å„ç§åŠŸèƒ½æ¨¡å—æ”¯æ’‘èµ·æ¥çš„ï¼Œä½ å¯ä»¥å°†clangå’Œlldéƒ½çœ‹åšæ˜¯LLVMçš„ç»„æˆéƒ¨åˆ†</p><h2 id="llvmå¦‚ä½•å·¥ä½œ">LLVMå¦‚ä½•å·¥ä½œ</h2><p><img src="./LLVM-tablegen/image-20250211153154584.png" alt="image-20250211153154584"></p><p>çœ‹èµ·æ¥å°±æ˜¯ä¸‰ä¸ªæ­¥éª¤ï¼š</p><ul><li>å‰ç«¯ï¼šè·å–æºä»£ç å¹¶å°†å…¶è½¬æ¢ä¸º<em>ä¸­é—´è¡¨ç¤º</em>æˆ– IRã€‚è¿™ç§ç¿»è¯‘ç®€åŒ–äº†ç¼–è¯‘å™¨å…¶ä½™éƒ¨åˆ†çš„å·¥ä½œï¼Œå®ƒä¸æƒ³å¤„ç† C++ æºä»£ç çš„å…¨éƒ¨å¤æ‚æ€§ã€‚æ¯”å¦‚Clangã€‚LLVM IRæ˜¯LLVMçš„ä¸­é—´è¡¨ç¤ºï¼Œè¿™æ˜¯LLVMä¸­å¾ˆé‡è¦çš„ä¸€ä¸ªä¸œè¥¿ï¼Œä»‹ç»å®ƒçš„æ–‡æ¡£å°±ä¸€ä¸ªï¼ŒLLVM Language Reference Manual</li><li>å°†IR è½¬æ¢ä¸º IRçš„Passï¼šåœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œpass é€šå¸¸ä¼šä¼˜åŒ–ä»£ç ï¼šç”Ÿæˆå¦ä¸€ä¸ª IR ç¨‹åºä½œä¸ºè¾“å‡ºã€‚æ–°ç”Ÿæˆçš„IRä¸ä¸Šä¸€ä¸ªIRæ•ˆæœç›¸åŒï¼Œåªæ˜¯å®ƒæ›´å¿«æ›´ä¼˜ã€‚å¦‚æœè¯´è¦æŠŠä¸€ä¸ªè¯­è¨€ç¼–è¯‘å¥½çš„**æ•´ä¸ªç¼–è¯‘è¿‡ç¨‹ä¸­ä½¿ç”¨ç›¸åŒçš„ IR <em>ã€‚<em>åœ¨å…¶ä»–ç¼–è¯‘å™¨ä¸­ï¼Œæ¯æ¬¡ä¼ é€’éƒ½å¯èƒ½ä»¥ç‹¬ç‰¹çš„å½¢å¼ç”Ÿæˆä»£ç ã€‚</em></em></li><li>åç«¯ï¼šç”Ÿæˆå®é™…çš„æœºå™¨ç ã€‚å¾ˆå¤šæ—¶å€™ä¸éœ€è¦æ¥è§¦è¿™éƒ¨åˆ†ã€‚</li></ul><h3 id="æˆ‘è¦åšä»€ä¹ˆï¼Ÿ">æˆ‘è¦åšä»€ä¹ˆï¼Ÿ</h3><p>æˆ‘éœ€è¦ç»™mindsporeæ·»åŠ ä¸€ä¸ªç®—å­ï¼Œè¿™ä¸ªç®—å­æ˜¯æ·±åº¦å­¦ä¹ é‡Œé¢çš„ä¸€ä¸ªè®¡ç®—æ–¹æ³•addlayernormï¼Œæˆ‘è¦æŠŠè¿™ä¸ªè®¡ç®—æ–¹æ³•å˜æˆmindsporeé‡Œé¢çš„ä¸€ä¸ªè¿ç®—ç¬¦ï¼Œå°±åƒmindsporeçš„ç¼–è¯‘å™¨å·²ç»æœ‰+ã€-ã€*ï¼Œæˆ‘è¦åŸºäºå·²æœ‰çš„è¿ç®—ç¬¦ç¼–å†™ä¸€ä¸ªæ–°çš„è¿ç®—ç¬¦ã€‚è¿™æ ·ä¹‹åçš„äººç”¨åˆ°addlayernormå¯ä»¥ç›´æ¥ç”¨æˆ‘å†™çš„ï¼Œç„¶åç¼–è¯‘å™¨è‡ªåŠ¨ç¼–è¯‘å¥½ï¼Œè€Œä¸æ˜¯è¿˜éœ€è¦å…ˆaddå†layernorm</p><h2 id="llvmå®‰è£…">LLVMå®‰è£…</h2><h3 id="aptå®‰è£…">aptå®‰è£…</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™æ˜¯ä¸€ä¸ªmindsporeæ¨èçš„å¿«é€Ÿå®‰è£…æ–¹å¼</span></span><br><span class="line">wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key | <span class="built_in">sudo</span> apt-key add -</span><br><span class="line"><span class="built_in">sudo</span> add-apt-repository <span class="string">&quot;deb http://apt.llvm.org/bionic/ llvm-toolchain-bionic-12 main&quot;</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get update</span><br><span class="line"><span class="built_in">sudo</span> apt-get install llvm-12-dev -y <span class="comment">#ä½†æ˜¯è¿™æ ·ç³»ç»Ÿæ‰¾ä¸åˆ°llvmï¼Œcmakeä¹Ÿæ‰¾ä¸åˆ°</span></span><br><span class="line"><span class="comment"># æ³¨æ„llvm-config --versionæ‰¾ä¸åˆ°ï¼Œå› ä¸ºç¯å¢ƒä¸­å¯èƒ½æœ‰llvm-config-12å’Œllvm-config-14,ä½†æ²¡è®¾ç½®é»˜è®¤çš„</span></span><br><span class="line">llvm-config-12 --version</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥ä¸‹æ˜¯å¦ä¸€ä¸ªå®˜æ–¹çš„å®‰è£…æ–¹æ³•</span></span><br><span class="line"><span class="comment"># clang å’Œ clang++ ç¨‹åºæ˜¯ LLVM å·¥å…·é›†çš„ä¸€éƒ¨åˆ†ã€‚ clangç”¨äºç¼–è¯‘Cç¨‹åºï¼Œclang++ç”¨äºç¼–è¯‘C++ç¨‹åºã€‚</span></span><br><span class="line"><span class="built_in">sudo</span> apt install clang lldb lld</span><br><span class="line">clang --version <span class="comment">#å®‰è£…å·ä¹‹åå°±å¯ä»¥clang hello.c -o hello_c ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶hello_c</span></span><br><span class="line">clang++ --version <span class="comment">#å®‰è£…å·ä¹‹åå°±å¯ä»¥clang++ hello.cpp -o hello_cppç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶hello_cpp</span></span><br><span class="line"><span class="comment"># å®‰è£…llvm é»˜è®¤æƒ…å†µä¸‹ä¸ä¼šè‡ªåŠ¨å®‰è£…Clang</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get install llvm-12</span><br><span class="line"><span class="comment"># æŸ¥çœ‹llvmç‰ˆæœ¬</span></span><br><span class="line">llvm-config-12 --version</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½†æ˜¯llvmå’Œclangéƒ½æœ‰ç‰ˆæœ¬çš„é—®é¢˜ï¼Œæœ‰æ—¶å€™éœ€è¦åˆ¶å®šç‰ˆæœ¬ï¼Œæ¯”å¦‚gcc9ä¹Ÿæ˜¯è¿™æ ·çš„</span></span><br><span class="line"><span class="comment"># é¦–å…ˆï¼Œæ·»åŠ æ‰€æœ‰å¯ç”¨çš„ llvm-config ç‰ˆæœ¬åˆ° update-alternativesï¼šä¸€èˆ¬å°±12å’Œ14ä¸¤ä¸ª</span></span><br><span class="line"><span class="built_in">sudo</span> update-alternatives --install /usr/bin/llvm-config llvm-config /usr/bin/llvm-config-12 20</span><br><span class="line"><span class="built_in">sudo</span> update-alternatives --install /usr/bin/llvm-config llvm-config /usr/bin/llvm-config-14 10</span><br><span class="line"><span class="comment"># é€‰æ‹©é»˜è®¤ç‰ˆæœ¬</span></span><br><span class="line"><span class="built_in">sudo</span> update-alternatives --config llvm-config</span><br><span class="line"><span class="comment"># è¿™æ ·å°±å¯ä»¥æ‰¾åˆ°llvm-config --versionå‘½ä»¤äº†ï¼Œè€Œä¸æ˜¯éå†™llvm-config-12</span></span><br><span class="line">llvm-config --version</span><br><span class="line"><span class="comment"># æ·»åŠ æ‰€æœ‰å¯ç”¨çš„ clang ç‰ˆæœ¬åˆ° update-alternatives</span></span><br><span class="line"><span class="built_in">sudo</span> update-alternatives --install /usr/bin/clang clang /usr/bin/clang-12 20</span><br><span class="line"><span class="built_in">sudo</span> update-alternatives --install /usr/bin/clang clang /usr/bin/clang-14 10</span><br><span class="line"><span class="built_in">sudo</span> update-alternatives --install /usr/bin/clang++ clang++ /usr/bin/clang++-12 20</span><br><span class="line"><span class="built_in">sudo</span> update-alternatives --install /usr/bin/clang++ clang++ /usr/bin/clang++-14 10</span><br><span class="line"><span class="comment"># é€‰æ‹©é»˜è®¤ç‰ˆæœ¬</span></span><br><span class="line"><span class="built_in">sudo</span> update-alternatives --config clang</span><br><span class="line"><span class="built_in">sudo</span> update-alternatives --config clang++</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½†æ˜¯è¿™æ ·cmakeè¿˜æ˜¯æ‰¾ä¸åˆ°</span></span><br><span class="line"><span class="comment">#llvmCMake Error at CMakeLists.txt:13 (include):</span></span><br><span class="line"><span class="comment">#  include could not find requested file: AddLLVM</span></span><br><span class="line"><span class="comment"># è¦æ‰¾åˆ°llvmçš„å®‰è£…ä½ç½®ï¼Œç„¶åexportäº†</span></span><br><span class="line"><span class="built_in">which</span> llvm-config</span><br><span class="line">/usr/bin/llvm-config <span class="comment">#å‘ç°å¯æ‰§è¡Œæ–‡ä»¶åœ¨biné‡Œ</span></span><br><span class="line"><span class="comment">#å¤´æ–‡ä»¶/usr/include/llvm-12/</span></span><br><span class="line"><span class="comment">#åº“æ–‡ä»¶/usr/lib/llvm-&lt;version&gt;/</span></span><br><span class="line"><span class="comment">#åˆ™cmakeé“¾æ¥åˆ°åº“æ–‡ä»¶/usr/lib/llvm-&lt;version&gt;/lib/cmake/llvm/è¿™æ˜¯ CMake æŸ¥æ‰¾ LLVMConfig.cmake å’Œ AddLLVM.cmake çš„å…³é”®è·¯å¾„ã€‚</span></span><br><span class="line"><span class="built_in">export</span> LLVM_DIR=/usr/lib/llvm-12/lib/cmake/llvm/</span><br><span class="line"><span class="comment"># ä½†æ˜¯æˆ‘å¾ˆå¥‡æ€ª12ç‰ˆæœ¬çš„æ‰¾ä¸åˆ°è·¯å¾„ï¼Œaddllvmæ­»æ´»æ‰¾ä¸åˆ°ï¼Œï¼Œæ‰€ä»¥æ”¹æˆ14äº†</span></span><br><span class="line"><span class="built_in">export</span> LLVM_DIR=/usr/lib/llvm-14/lib/cmake/llvm/</span><br><span class="line"><span class="comment"># set(LLVM_DIR &quot;/usr/lib/llvm-14/lib/cmake/llvm/&quot;) #åœ¨cmakeé‡Œé¢å¯ä»¥åŠ </span></span><br></pre></td></tr></table></figure><h3 id="cmakeç¼–è¯‘å®‰è£…-è¿˜æ²¡å¿…è¦">Cmakeç¼–è¯‘å®‰è£…ï¼ˆè¿˜æ²¡å¿…è¦ï¼‰</h3><h2 id="llvmè¯­è¨€çš„ä¸€ä¸ªå¿«é€Ÿå…¥é—¨">LLVMè¯­è¨€çš„ä¸€ä¸ªå¿«é€Ÿå…¥é—¨</h2><p><a href="https://llvm.org/doxygen/">LLVMçš„doxygen</a></p><p><a href="https://llvm.org/docs/LangRef.html">ä¸­é—´è¡¨ç¤ºIRçš„è¯­æ³•ä¹¦</a></p><p><a href="https://llvm.org/docs/ProgrammersManual.html">å¼€å‘è€…æ‰‹å†Œ</a></p><p><a href="https://llvm.gnu.ac.cn/docs/TableGen/index.html">å¼€å‘è€…æ‰‹å†Œä¸­æ–‡ï¼Œä½†æ˜¯è¿˜æ˜¯è¦çœ‹è‹±æ–‡çš„ï¼Œæ¯”å¦‚é‡Œé¢æŠŠclassç›´æ¥ç¿»è¯‘æˆç±»ï¼Œè€Œclassæˆ‘è§‰å¾—åœ¨è¿™é‡Œé¢ä¸èƒ½ç¿»è¯‘</a></p><p><a href="https://www.cnblogs.com/Five100Miles/p/11025680.html">è¿™ä¸ªäººçš„ç¬”è®°å¾ˆä¸é”™</a></p><ul><li><p>passï¼šç¼–å†™ä¸€ä¸ªLLVMçš„è§„åˆ™ï¼Œæ¯”å¦‚æŠŠä¸€ä¸ªå‡½æ•°é‡Œé¢çš„æ‰€æœ‰+æ³•å˜æˆ*æ³•ï¼Œè¢«ç§°ä¸ºä¸€ä¸ªpassã€‚åœ¨LLVMä¸­ä¼˜åŒ–ä»¥passå½¢å¼å®ç°, æ¯ä¸€ä¸ªpassä»£è¡¨ä¸€ç§ä¼˜åŒ–. passåˆ†ä¸ºä¸¤ç±»,</p><ul><li>ä¸€ç±»æ˜¯åˆ†æ(analysis)pass,  ç®—ç›¸å…³IRå•å…ƒçš„é«˜å±‚ä¿¡æ¯ï¼Œä½†ä¸å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚è¿™äº›ä¿¡æ¯å¯ä»¥è¢«å…¶ä»–Passä½¿ç”¨ï¼Œæˆ–ç”¨äºè°ƒè¯•å’Œç¨‹åºå¯è§†åŒ–ã€‚æ¢è¨€ä¹‹ï¼ŒAnalysis Passä¼šä»å¯¹åº”çš„IRå•å…ƒä¸­æŒ–æ˜å‡ºéœ€è¦çš„ä¿¡æ¯ï¼Œç„¶åè¿›è¡Œå­˜å‚¨ï¼Œå¹¶æä¾›æŸ¥è¯¢çš„æ¥å£ï¼Œè®©å…¶å®ƒPasså»è®¿é—®å…¶æ‰€å­˜å‚¨çš„ä¿¡æ¯ã€‚</li><li>å¦ä¸€ç±»æ˜¯å˜æ¢(transform)pass, å¯ä»¥ä½¿ç”¨Analysis Passçš„åˆ†æç»“æœï¼Œç„¶åä»¥æŸç§æ–¹å¼æ”¹å˜å’Œä¼˜åŒ–IRã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ç±»Passæ˜¯ä¼šæ”¹å˜IRçš„å†…å®¹çš„ï¼Œå¯èƒ½ä¼šæ”¹å˜IRä¸­çš„æŒ‡ä»¤ï¼Œä¹Ÿå¯èƒ½ä¼šæ”¹å˜IRä¸­çš„æ§åˆ¶æµã€‚</li></ul><p>è¿˜æœ‰ä¸€ç§Utility Passä¸ç®—è¿›å»äº†ï¼ŒLLVMä¸­å®ç°äº†å‡ åç§ä¼˜åŒ–pass, å…¶ä¸­è®¸å¤špassè¿è¡Œä¸æ­¢ä¸€æ¬¡. analysis  passå­˜æ”¾åœ¨lib/Analysisä¸‹, transform passå­˜æ”¾åœ¨lib/Transformsä¸‹</p></li><li><p>dumpï¼šä¸€ç§è¯­è¨€ç¼–è¯‘æˆå…¶ä»–è¯­è¨€çš„è¿‡ç¨‹ï¼Œåœ¨llvmæŒ‡çš„æ˜¯ä¸€ç§è¯­è¨€å˜æˆIRï¼ˆä¸­é—´è¡¨ç¤ºï¼‰çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªä¹Ÿæ˜¯llvmçš„ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥å®ç°è¾“å‡ºIR</p></li></ul><h3 id="è¯»å–å¹¶æ‰“å°å‡½æ•°åç§°">è¯»å–å¹¶æ‰“å°å‡½æ•°åç§°</h3><p>é¦–å…ˆLLVMç”¨C++ç¼–å†™ï¼Œç„¶åç”¨cmakeè¿›è¡Œç¼–è¯‘ï¼Œå˜æˆæˆä¸€ä¸ªpass</p><p>è¿™é‡Œæ˜¯ä»“åº“ git clone <a href="mailto:git@github.com">git@github.com</a>:sampsyo/llvm-pass-skeleton.git</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># Skeleton.cppä¸­</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;llvm/Pass.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;llvm/Passes/PassBuilder.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;llvm/Passes/PassPlugin.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;llvm/Support/raw_ostream.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> llvm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SkeletonPass</span> : <span class="keyword">public</span> PassInfoMixin&lt;SkeletonPass&gt; &#123;</span><br><span class="line">    <span class="function">PreservedAnalyses <span class="title">run</span><span class="params">(Module &amp;M, ModuleAnalysisManager &amp;AM)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;F : M) &#123;</span><br><span class="line">            <span class="meta"># errs()æ˜¯ä¸€ä¸ªLLVMæä¾›çš„C++è¾“å‡ºæµï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥è¾“å‡ºåˆ°æ§åˆ¶å°</span></span><br><span class="line">            # è¿™ä¸ªç¨‹åºçš„æ„ä¹‰æ˜¯åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­æŠŠæ¯ä¸ªå‡½æ•°çš„åç§°æ‰“å°å‡ºæ¥</span><br><span class="line">            <span class="built_in">errs</span>() &lt;&lt; <span class="string">&quot;I saw a function called &quot;</span> &lt;&lt; F.<span class="built_in">getName</span>() &lt;&lt; <span class="string">&quot;!\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> PreservedAnalyses::<span class="built_in">all</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> LLVM_ATTRIBUTE_WEAK ::<span class="function">llvm::PassPluginLibraryInfo</span></span><br><span class="line"><span class="function"><span class="title">llvmGetPassPluginInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        .APIVersion = LLVM_PLUGIN_API_VERSION,</span><br><span class="line">        .PluginName = <span class="string">&quot;Skeleton pass&quot;</span>,</span><br><span class="line">        .PluginVersion = <span class="string">&quot;v0.1&quot;</span>,</span><br><span class="line">        .RegisterPassBuilderCallbacks = [](PassBuilder &amp;PB) &#123;</span><br><span class="line">            PB.<span class="built_in">registerPipelineStartEPCallback</span>(</span><br><span class="line">                [](ModulePassManager &amp;MPM, OptimizationLevel Level) &#123;</span><br><span class="line">                    MPM.<span class="built_in">addPass</span>(<span class="built_in">SkeletonPass</span>());</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cmakelistsé‡Œé¢ç¼–å†™ç”Ÿæˆä¸€ä¸ªpassï¼Œæœ€ç»ˆä¼šè·å¾—build/skeleton/SkeletonPass.so</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Load LLVMConfig.cmake. If this fails, consider setting `LLVM_DIR` to point</span></span><br><span class="line"><span class="comment"># to your LLVM installation&#x27;s `lib/cmake/llvm` directory.</span></span><br><span class="line"><span class="comment"># set(LLVM_DIR &quot;/usr/lib/llvm-14/lib/cmake/llvm/&quot;) #æ‰¾ä¸åˆ°å¯ä»¥åŠ </span></span><br><span class="line"><span class="keyword">find_package</span>(LLVM REQUIRED CONFIG)</span><br><span class="line"><span class="comment"># Include the part of LLVM&#x27;s CMake libraries that defines</span></span><br><span class="line"><span class="comment"># `add_llvm_pass_plugin`.</span></span><br><span class="line"><span class="keyword">include</span>(AddLLVM)</span><br><span class="line"><span class="comment"># Use LLVM&#x27;s preprocessor definitions, include directories, and library search</span></span><br><span class="line"><span class="comment"># paths.</span></span><br><span class="line"><span class="keyword">add_definitions</span>(<span class="variable">$&#123;LLVM_DEFINITIONS&#125;</span>)</span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;LLVM_INCLUDE_DIRS&#125;</span>)</span><br><span class="line"><span class="keyword">link_directories</span>(<span class="variable">$&#123;LLVM_LIBRARY_DIRS&#125;</span>)</span><br><span class="line"><span class="comment"># è¦includeaddllvmæ‰èƒ½ç”¨ä¸‹é¢è¿™ä¸ªå‘½ä»¤</span></span><br><span class="line">add_llvm_pass_plugin(SkeletonPass</span><br><span class="line">    <span class="comment"># List your source files here.</span></span><br><span class="line">    Skeleton.cpp</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>è·å¾—äº†è¿™ä¸ªbuild/skeleton/SkeletonPass.soï¼Œå°±å¯ä»¥åœ¨clangçš„æ—¶å€™æ°¸ä¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">clang -Xclang -load -Xclang build/skeleton/libSkeletonPass.* æŸä¸ªcç¨‹åº.c</span> </span><br><span class="line">I saw a function called main!# è¿™é‡Œå°±ä¼šæ‰“å°å‡½æ•°åç§°</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-Xclang -load -Xclang path/to/lib.soè¿™æ˜¯ä½ åœ¨Clangä¸­è½½å…¥å¹¶æ¿€æ´»ä½ çš„æµç¨‹æ‰€ç”¨çš„æ‰€æœ‰ä»£ç ã€‚</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ‰€ä»¥å½“ä½ å¤„ç†è¾ƒå¤§çš„é¡¹ç›®çš„æ—¶å€™ï¼Œä½ å¯ä»¥ç›´æ¥æŠŠè¿™äº›å‚æ•°åŠ åˆ°Makefileçš„CFLAGSé‡Œæˆ–è€…ä½ æ„å»ºç³»ç»Ÿçš„å¯¹åº”çš„åœ°æ–¹ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="å¦‚ä½•æŸ¥çœ‹ir">å¦‚ä½•æŸ¥çœ‹IR</h3><p>LLVM IRæœ‰ä¸‰ç§è¡¨ç°å½¢å¼:</p><ul><li>åœ¨ç¼–è¯‘å™¨å†…éƒ¨çš„IR</li><li>åœ¨ç£ç›˜ä¸­å­˜å‚¨çš„bitcode(ç”¨äºJITç¼–è¯‘å™¨)</li><li>æœ€å¸¸è§çš„æ˜“äºé˜…è¯»çš„LLVM IRæ±‡ç¼–. ä¸‰ç§æ ¼å¼çš„IRæ˜¯ç­‰ä»·çš„(å¯äº’ç›¸è½¬åŒ–), å› æ­¤LLVM IRæä¾›äº†é«˜æ•ˆçš„ç¼–è¯‘å™¨ä¼˜åŒ–æ‰‹æ®µçš„åŒæ—¶åˆä¿è¯äº†æ–¹ä¾¿è°ƒè¯•ä¸å®šä½é—®é¢˜.</li></ul><p>ä½¿ç”¨IRçš„ä¼˜ç‚¹.</p><ol><li>é€šç”¨, ä»»æ„è¯­è¨€éƒ½èƒ½è½¬æ¢ä¸ºIR, åŒä¸€IRèƒ½è½¬æ¢ä¸ºä»»æ„æ¶æ„æ±‡ç¼–.</li><li>å¯ç§»æ¤æ€§å¥½, å®¹æ˜“å®šä½é—®é¢˜,  åªè¦ä¿è¯IRæ­£ç¡®æ€§å°±èƒ½ç¡®å®šé—®é¢˜èŒƒå›´(å‰ç«¯è¿˜æ˜¯åç«¯è¿˜æ˜¯æŸä¸ªä¼˜åŒ–pass).</li><li>æ”¯æŒLTO(link time optimization).LLVMç¼–è¯‘çš„æ—¶å€™ä¼šé¡ºåºè¯»å–ç¨‹åºçš„æ¯ä¸ªæŒ‡ä»¤ï¼Œä¸€å¥—ç¨‹åºå¯ä»¥è¿™æ ·ç»„æˆ</li></ol><p><img src="./LLVM-tablegen/image-20250212112813600.png" alt="image-20250212112813600"></p><ul><li>æ¨¡å—è¡¨ç¤ºäº†ä¸€ä¸ªæºæ–‡ä»¶</li><li>æºæ–‡ä»¶é‡Œé¢éƒ½æ˜¯å‡½æ•°</li><li>å‡½æ•°ä¸»è¦ä¼šåšä¸ºä»£ç å—çš„å®¹å™¨</li><li>æŒ‡ä»¤å°±æ˜¯ä¸€æ¡å•ç‹¬çš„ä»£ç å‘½ä»¤</li></ul><h4 id="å¦‚ä½•ç”Ÿæˆir">å¦‚ä½•ç”ŸæˆIR</h4><p>åœ¨ç¼–è¯‘æ—¶æ·»åŠ é€‰é¡¹-emit-llvmå³å¯ç”ŸæˆIR, æ­¤æ—¶çš„IRä¸ºbitcodeæ ¼å¼(é»˜è®¤æ–‡ä»¶ååç¼€ä¸ºbc), è‹¥è¦ç”Ÿæˆæ±‡ç¼–æ ¼å¼è¿˜éœ€æ·»åŠ -Sé€‰é¡¹(é»˜è®¤æ–‡ä»¶ååç¼€ä¸ºll).</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">clang -emit-llvm -S -o - æŸä¸ªcç¨‹åº.c <span class="comment">#è¿™ä¸ªå°±å¯ä»¥æŠŠcç¨‹åºå˜æˆIRè¿›è¡Œé˜…è¯»ï¼Œ-emit-llvm</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> ~/test.c</span><br><span class="line"> 2 int <span class="built_in">test</span>(int a, int b)</span><br><span class="line"> 3 &#123;</span><br><span class="line"> 4   int c = 0;</span><br><span class="line"> 5   <span class="keyword">if</span> (a) &#123;</span><br><span class="line"> 6     c = b;</span><br><span class="line"> 7     a = c;</span><br><span class="line"> 8   &#125;</span><br><span class="line"> 9   <span class="built_in">return</span> c;</span><br><span class="line">10 &#125;</span><br><span class="line">../llvm_build/bin/clang ~/test.c -O0 -emit-llvm -S -o ~/test.ll</span><br><span class="line"><span class="built_in">cat</span> ~/test.ll <span class="comment">#æŸ¥çœ‹llè¿™ä¸ªIRè¯­è¨€çš„ </span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%5 = add i32 %4, 2 #è¿™ä¸ªæŒ‡ä»¤å°†ä¸¤ä¸ª32ä½æ•´æ•°ç›¸åŠ ï¼ˆå¯ä»¥é€šè¿‡ç±»å‹i32æ¨æ–­å‡ºæ¥ï¼‰ã€‚å®ƒå°†4å·å¯„å­˜å™¨ï¼ˆå†™ä½œ%4ï¼‰ä¸­çš„æ•°å’Œå­—é¢å€¼2ï¼ˆå†™ä½œ2ï¼‰æ±‚å’Œï¼Œç„¶åæ”¾åˆ°5å·å¯„å­˜å™¨ä¸­ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// dump()ã€‚å®ƒä¼šæ‰“å°å‡ºäººå¯è¯»çš„IRå¯¹è±¡çš„è¡¨ç¤ºã€‚</span></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SkeletonPass</span> : <span class="keyword">public</span> PassInfoMixin&lt;SkeletonPass&gt; &#123;</span><br><span class="line">    <span class="function">PreservedAnalyses <span class="title">run</span><span class="params">(Module &amp;M, ModuleAnalysisManager &amp;AM)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;F : M.<span class="built_in">functions</span>()) &#123;</span><br><span class="line">            <span class="built_in">errs</span>() &lt;&lt; <span class="string">&quot;In a function called &quot;</span> &lt;&lt; F.<span class="built_in">getName</span>() &lt;&lt; <span class="string">&quot;!\n&quot;</span>;</span><br><span class="line">            <span class="built_in">errs</span>() &lt;&lt; <span class="string">&quot;Function body:\n&quot;</span>;</span><br><span class="line">            F.<span class="built_in">print</span>(<span class="built_in">errs</span>());</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;B : F) &#123;</span><br><span class="line">              <span class="built_in">errs</span>() &lt;&lt; <span class="string">&quot;Basic block:\n&quot;</span>;</span><br><span class="line">              B.<span class="built_in">print</span>(<span class="built_in">errs</span>());</span><br><span class="line">              <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;I : B) &#123;</span><br><span class="line">                <span class="built_in">errs</span>() &lt;&lt; <span class="string">&quot;Instruction: \n&quot;</span>;</span><br><span class="line">                I.<span class="built_in">print</span>(<span class="built_in">errs</span>(), <span class="literal">true</span>);</span><br><span class="line">                <span class="built_in">errs</span>() &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">errs</span>() &lt;&lt; <span class="string">&quot;I saw a function called &quot;</span> &lt;&lt; F.<span class="built_in">getName</span>() &lt;&lt; <span class="string">&quot;!\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> PreservedAnalyses::<span class="built_in">all</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> LLVM_ATTRIBUTE_WEAK ::<span class="function">llvm::PassPluginLibraryInfo</span></span><br><span class="line"><span class="function"><span class="title">llvmGetPassPluginInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        .APIVersion = LLVM_PLUGIN_API_VERSION,</span><br><span class="line">        .PluginName = <span class="string">&quot;Skeleton pass&quot;</span>,</span><br><span class="line">        .PluginVersion = <span class="string">&quot;v0.1&quot;</span>,</span><br><span class="line">        .RegisterPassBuilderCallbacks = [](PassBuilder &amp;PB) &#123;</span><br><span class="line">            PB.<span class="built_in">registerPipelineStartEPCallback</span>(</span><br><span class="line">                [](ModulePassManager &amp;MPM, OptimizationLevel Level) &#123;</span><br><span class="line">                    MPM.<span class="built_in">addPass</span>(<span class="built_in">SkeletonPass</span>());</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å¯¹ä¸€ä¸ªè¿ç®—ç¬¦è¿›è¡Œé‡æ–°ç¼–å†™">å¯¹ä¸€ä¸ªè¿ç®—ç¬¦è¿›è¡Œé‡æ–°ç¼–å†™</h3><p>æŠŠå‡½æ•°é‡Œç¬¬ä¸€ä¸ªäºŒå…ƒæ“ä½œç¬¦ï¼ˆæ¯”å¦‚+ï¼Œ-ï¼‰æ”¹æˆä¹˜å·ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SkeletonPass</span> : <span class="keyword">public</span> PassInfoMixin&lt;SkeletonPass&gt; &#123;</span><br><span class="line">    <span class="function">PreservedAnalyses <span class="title">run</span><span class="params">(Module &amp;M, ModuleAnalysisManager &amp;AM)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;F : M.<span class="built_in">functions</span>()) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;B : F) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;I : B) &#123;</span><br><span class="line">                    <span class="comment">// dyn_cast&lt;T&gt;(p)æ„é€ å‡½æ•°æ˜¯LLVMç±»å‹æ£€æŸ¥å·¥å…·çš„åº”ç”¨ã€‚å¦‚æœIä¸æ˜¯â€œäºŒå…ƒæ“ä½œç¬¦â€ï¼Œè¿™ä¸ªæ„é€ å‡½æ•°è¿”å›ä¸€ä¸ªç©ºæŒ‡é’ˆã€‚</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">auto</span> *op = <span class="built_in">dyn_cast</span>&lt;BinaryOperator&gt;(&amp;I)) &#123;</span><br><span class="line">                        <span class="comment">// Insert at the point where the instruction `op`</span></span><br><span class="line">                        <span class="comment">// appears.</span></span><br><span class="line">                        <span class="comment">// IRBuilderç”¨äºæ„é€ ä»£ç ã€‚</span></span><br><span class="line">                        IRBuilder&lt;&gt; <span class="built_in">builder</span>(op);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// Make a multiply with the same operands as `op`.</span></span><br><span class="line">                        Value *lhs = op-&gt;<span class="built_in">getOperand</span>(<span class="number">0</span>);</span><br><span class="line">                        Value *rhs = op-&gt;<span class="built_in">getOperand</span>(<span class="number">1</span>);</span><br><span class="line">                        Value *mul = builder.<span class="built_in">CreateMul</span>(lhs, rhs);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// Everywhere the old instruction was used as an</span></span><br><span class="line">                        <span class="comment">// operand, use our new multiply instruction instead.</span></span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;U : op-&gt;<span class="built_in">uses</span>()) &#123;</span><br><span class="line">                          <span class="comment">// A User is anything with operands.</span></span><br><span class="line">                          User *user = U.<span class="built_in">getUser</span>();</span><br><span class="line">                          user-&gt;<span class="built_in">setOperand</span>(U.<span class="built_in">getOperandNo</span>(), mul);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// We modified the code.</span></span><br><span class="line">                        <span class="keyword">return</span> PreservedAnalyses::<span class="built_in">none</span>();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> PreservedAnalyses::<span class="built_in">all</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> LLVM_ATTRIBUTE_WEAK ::<span class="function">llvm::PassPluginLibraryInfo</span></span><br><span class="line"><span class="function"><span class="title">llvmGetPassPluginInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        .APIVersion = LLVM_PLUGIN_API_VERSION,</span><br><span class="line">        .PluginName = <span class="string">&quot;Skeleton pass&quot;</span>,</span><br><span class="line">        .PluginVersion = <span class="string">&quot;v0.1&quot;</span>,</span><br><span class="line">        .RegisterPassBuilderCallbacks = [](PassBuilder &amp;PB) &#123;</span><br><span class="line">            PB.<span class="built_in">registerPipelineStartEPCallback</span>(</span><br><span class="line">                [](ModulePassManager &amp;MPM, OptimizationLevel Level) &#123;</span><br><span class="line">                    MPM.<span class="built_in">addPass</span>(<span class="built_in">SkeletonPass</span>());</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span>** argv)</span> &#123;</span><br><span class="line">  <span class="type">int</span> num;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%i&quot;</span>, &amp;num);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%i\n&quot;</span>, num + <span class="number">2</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line"> </span><br><span class="line">   $ cc example.c</span><br><span class="line">    $ ./a.out</span><br><span class="line">    <span class="number">10</span></span><br><span class="line">    <span class="number">12</span></span><br><span class="line">    $ clang -Xclang -load -Xclang build/skeleton/libSkeletonPass.so example.c</span><br><span class="line">    $ ./a.out</span><br><span class="line">    <span class="number">10</span></span><br><span class="line">    <span class="number">20</span></span><br></pre></td></tr></table></figure><h2 id="llvm-tablegen-çš„å…¥é—¨">LLVM tablegen çš„å…¥é—¨</h2><p>ä½¿ç”¨ LLVM æ—¶ï¼Œä½ ä¼šé€‰æ‹©ä¸€ä¸ªâ€œç›®æ ‡â€ï¼Œå³ä½ æƒ³è¦ä¸ºå…¶ç”ŸæˆæŒ‡ä»¤çš„å¤„ç†å™¨ä½“ç³»ç»“æ„ã€‚TableGen çš„ç­‰æ•ˆé¡¹æ˜¯â€œåç«¯â€ã€‚è¿™äº›åç«¯ä¸ç”ŸæˆæŒ‡ä»¤ï¼Œè€Œæ˜¯è¾“å‡ºç‰¹å®šäºè¯¥åç«¯ç”¨ä¾‹çš„æ ¼å¼ã€‚ tablegenæ˜¯llvmç”¨äºå¼€å‘å’Œç»´æŠ¤ç¼–è¯‘å™¨ä¸­å…¬å…±ç‰¹æ€§çš„æ¡ç›®(e.g. æŒ‡ä»¤æè¿°, å¯„å­˜å™¨æè¿°)çš„ä»£ç , ï¼Œå…¶æœ¬è´¨æ˜¯ä¸€ä¸ªparser, **è¯´ç™½äº†å°±æ˜¯æŠŠä¸€å¥—å…¬ç”¨çš„æŒ‡ä»¤ç¿»è¯‘æˆä¸åŒæ¶æ„çš„è¯­è¨€ï¼Œæ¯”å¦‚ä¸€ä¸ªåŠ æ³•åˆ†åˆ«ç¿»è¯‘æˆx86ã€armçš„ï¼Œ**<strong>å°†è¾“å…¥çš„tdæ–‡ä»¶è½¬åŒ–ä¸ºç‰¹å®šçš„æ•°æ®ç»“æ„åå†è¾“å‡ºä¸ºæ˜“äºé˜…è¯»çš„cppä»£ç ï¼Œå®ç°tdæ–‡ä»¶åˆ°cppä»£ç </strong></p><p><img src="./LLVM-tablegen/0d726f2066052217c46a74cecf86b90f.png" alt="img"></p><h3 id="ä½¿ç”¨æ–¹å¼">ä½¿ç”¨æ–¹å¼</h3><p>åœ¨llvmä¸‹è½½ç›®å½•é‡Œ/bin/å¯æ‰§è¡Œæ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªllvm-tblgenå·¥å…·ï¼Œè¯»å…¥ä¸€ä¸ªtdæ–‡ä»¶, å¹¶å°†ç»“æœè¾“å‡ºè‡³ä¸€ä¸ªincæ–‡ä»¶ä¸­ï¼Œç”Ÿæˆçš„incæ–‡ä»¶å®è´¨ä¸ºcppä»£ç ,</p><p>tablegenä»£ç åŒ…å«ä¸¤å—:</p><ul><li>å¯¹tdæ–‡ä»¶çš„å¤„ç†, åœ¨lib/TableGen/ç›®å½•ä¸‹, åŒ…å«lexerä¸parser,  è´Ÿè´£è§£ætablegençš„è¯­æ³•å¹¶è½¬æ¢ä¸ºå†…éƒ¨æ•°æ®ç»“æ„;</li><li>è¾“å‡ºcppä»£ç , åœ¨utils/TableGen/ç›®å½•ä¸‹, ç”¨äºç”Ÿæˆæˆ‘ä»¬éœ€è¦çš„cppä»£ç , è¿™å—ä¸llvmä»£ç é€»è¾‘å¼ºç›¸å…³, åŸºæœ¬ä¸Šä¸€ä¸ªcppæ–‡ä»¶å¯¹åº”ä¸€ç±»ä¿¡æ¯.</li></ul><h3 id="tdæ–‡ä»¶çš„è¯­æ³•">tdæ–‡ä»¶çš„è¯­æ³•</h3><p>TableGençš„è¯­æ³•ä¸C++ç›¸ä¼¼ï¼Œå…·æœ‰å†…ç½®ç±»å‹å’Œè§„èŒƒã€‚æ­¤å¤–ï¼ŒTableGençš„è¯­æ³•è¿˜å¼•å…¥äº†ä¸€äº›è‡ªåŠ¨åŒ–æ¦‚å¿µï¼Œå¦‚multiclassã€foreachã€letç­‰åœ¨tdä¸­ä½¿ç”¨ä¸¤ä¸ªå…³é”®å­—å®šä¹‰æ•°æ®ç»“æ„ï¼š</p><p>classä¸defï¼Œè¿™ä¸¤ä¸ªåœ¨llvmä¸­è¢«ç§°ä¸ºrecordsï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç»</p><ul><li>classesç±»ä¼¼äºæ¨¡æ¿, ç”¨äºæè¿°ä¸€ç±»æŠ½è±¡çš„recordsï¼Œ<strong>è¯´ç™½äº†å°±æ˜¯é‚£ä¸ªå…¬ç”¨çš„æŒ‡ä»¤æ˜¯ä»€ä¹ˆ</strong></li><li>definitionsç”¨äºè¡¨è¾¾ä¸€ä¸ªå…·ä½“çš„records(å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªç‰¹å®šçš„ç±»)ï¼Œ<strong>è¯´ç™½äº†å°±æ˜¯è¿™ä¸ªå…¬ç”¨çš„æŒ‡ä»¤åœ¨ç‰¹å®šå¹³å°æ˜¯æ€ä¹ˆå†™çš„</strong><ul><li>æ¯ä¸ªrecordsåŒ…å«è‹¥å¹²æ•°æ®æˆå‘˜, è¿™äº›æˆå‘˜çš„ç±»å‹æœ‰bit(å¸ƒå°”é‡), int(æ•´å‹), string(å­—ç¬¦ä¸²), code(ä»£ç æ®µ,  åŒ…å«ä¸€è¡Œæˆ–å¤šè¡Œçš„å­—ç¬¦ä¸²), bit(ä½æ®µ)ç­‰ç±»å‹.</li><li>æ•°æ®æˆå‘˜ä½¿ç”¨letå…³é”®å­—è¿›è¡Œèµ‹å€¼,</li><li>å¯¹äºtablegenä¸­è§£æçš„æˆå‘˜å¿…é¡»éƒ½åˆå§‹åŒ–(ä¸ºå®šä¹‰çš„å€¼å¯ä»¥ä½¿ç”¨?åˆå§‹åŒ–ä¸ºâ€™æœªåˆå§‹åŒ–å€¼â€™), å¦åˆ™ä¼šå¯¼è‡´ç¼–è¯‘å¤±è´¥. è‹¥ä¸€ä¸ªdefinition  recordåŒ…å«ä¸€ä¸ªæœªåˆå§‹åŒ–æˆå‘˜, å…¶å€¼å°†ä»è¯¥definitionçš„superclassä¸­è·å–.  è‹¥tablegenä¸­æœªè§£æè¯¥æˆå‘˜åˆ™ä¸èµ‹å€¼ä¹Ÿä¸ä¼šæŠ¥é”™.</li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// ä»¥ä¸‹æ˜¯classï¼Œæ˜¯ä¸€ä¸ªæ¯”å¦‚åœ¨x86,armï¼Œacendéƒ½ä¼šç”¨åˆ°çš„ä¸€ä¸ªæŒ‡ä»¤</span><br><span class="line">class AsmParser &#123;</span><br><span class="line">  string AsmParserClassName  = &quot;AsmParser&quot;;</span><br><span class="line">  string AsmParserInstCleanup  = &quot;&quot;;</span><br><span class="line">  bit ShouldEmitMatchRegisterName = 1;</span><br><span class="line">  bit ShouldEmitMatchRegisterAltName = 0;</span><br><span class="line">  bit AllowDuplicateRegisterNames = 0;</span><br><span class="line">  bit HasMnemonicFirst = 1;</span><br><span class="line">  bit ReportMultipleNearMisses = 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Hexagonæ¶æ„çš„Asmarserï¼Œç„¶ååœ¨é«˜é€šæ¶æ„ä¸‹å¯¹ä¸Šé¢çš„classé‡æ–°å†™ï¼Œå› ä¸ºåœ¨ä¸åŒçš„åç«¯æ¯”å¦‚x86,armï¼Œacendï¼Œä»–ä»¬çš„æŒ‡ä»¤æ“ä½œç ä¸ä¸€æ ·</span><br><span class="line">// Hexagonæ¶æ„çš„Asmarserå¦‚ä¸‹(defined in lib/Target/Hexagon/Hexagon.td):</span><br><span class="line">def HexagonAsmParser : AsmParser &#123;</span><br><span class="line">  // ä½¿ç”¨`let`ä½œä¸ºèµ‹å€¼è¯­å¥ã€‚</span><br><span class="line">  let ShouldEmitMatchRegisterAltName = 1;</span><br><span class="line">  bit HasMnemonicFirst = 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">llvm-tblgen test.td # å‘½ä»¤è¡Œä¸­è¿è¡Œ,åœ¨é»˜è®¤å‚æ•°ä¸‹ä¼šè¾“å‡ºæ‰€æœ‰çš„classå’Œdefsã€‚åœ¨æ¯æ¡è®°å½•å®šä¹‰åçš„æ³¨é‡Šè¡¨æ˜äº†ADDæ‰€æœ‰çš„ç±»åˆ«ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å†ä¸¾ä¸€ä¸ªä¾‹å­</span></span><br><span class="line"><span class="comment">// cat register.td</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Register</span>&lt;<span class="type">int</span> _size, string _alias=<span class="string">&quot;&quot;</span>&gt; &#123;</span><br><span class="line">  <span class="type">int</span> size = _size;</span><br><span class="line">  string alias = _alias;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 64 bit general purpose registers are X&lt;N&gt;.</span></span><br><span class="line">def X0: Register&lt;<span class="number">8</span>&gt; &#123;&#125;</span><br><span class="line"><span class="comment">// Some have special alternate names.</span></span><br><span class="line">def X29: Register&lt;<span class="number">8</span>, <span class="string">&quot;frame pointer&quot;</span>&gt; &#123;&#125;</span><br><span class="line"><span class="comment">// Some registers omitted...</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">æ‰§è¡Œtablegenå‘½ä»¤./bin/llvm-tblgen register.td</span><br><span class="line"></span><br><span class="line">------------- Classes -----------------</span><br><span class="line">class Register&lt;int Register:_size = ?, string Register:_alias = <span class="string">&quot;&quot;</span>&gt; &#123;</span><br><span class="line"> int size = Register:_size;</span><br><span class="line"> string <span class="built_in">alias</span> = Register:_alias;</span><br><span class="line">&#125;</span><br><span class="line">------------- Defs -----------------</span><br><span class="line">def X0 &#123;        // Register</span><br><span class="line"> int size = 8;</span><br><span class="line"> string <span class="built_in">alias</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">def X29 &#123;       // Register</span><br><span class="line"> int size = 8;</span><br><span class="line"> string <span class="built_in">alias</span> = <span class="string">&quot;frame pointer&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;LLVMå’ŒLLVM tablegenå­¦ä¹ ç¬”è®°&lt;/h1&gt;
&lt;h2 id=&quot;llvmä»‹ç»&quot;&gt;LLVMä»‹ç»&lt;/h2&gt;
&lt;p&gt;LLVM æ˜¯ä¸€ä¸ªè·¨å¹³å°ï¼ˆå¯åœ¨ Linuxã€Windows å’Œ Mac ä¸Šä½¿ç”¨ï¼‰C/C++ ç¼–è¯‘å™¨å·¥å…·é›†ï¼Œåƒ GCCä¸€æ ·ã€‚ LLVM å¯ä»¥ç¼–è¯‘ç”¨  Cã€C+</summary>
      
    
    
    
    <category term="ç¼–è¯‘" scheme="http://outbreak-sen.github.io/categories/%E7%BC%96%E8%AF%91/"/>
    
    
    <category term="LLVM" scheme="http://outbreak-sen.github.io/tags/LLVM/"/>
    
  </entry>
  
  <entry>
    <title>å¤§æ’ç›¸æœºç¡¬è§¦å‘</title>
    <link href="http://outbreak-sen.github.io/2025/02/11/%E5%A4%A7%E6%81%92%E7%9B%B8%E6%9C%BA%E7%A1%AC%E8%A7%A6%E5%8F%91/"/>
    <id>http://outbreak-sen.github.io/2025/02/11/%E5%A4%A7%E6%81%92%E7%9B%B8%E6%9C%BA%E7%A1%AC%E8%A7%A6%E5%8F%91/</id>
    <published>2025-02-11T01:51:43.000Z</published>
    <updated>2025-02-11T02:17:00.136Z</updated>
    
    <content type="html"><![CDATA[<h1>å¤§æ’ç›¸æœºç¡¬è§¦å‘è¯´æ˜æ–‡æ¡£</h1><p>ç›¸æœºç¡¬è§¦å‘æ˜¯åŒºåˆ«äºè½¯è§¦å‘ï¼Œåˆ©ç”¨IOæˆ–è€…å…‰è€¦ç­‰å¤–éƒ¨æ§åˆ¶ä¿¡å·è§¦å‘ç›¸æœºå¿«é—¨çš„æŠ€æœ¯ã€‚</p><p>å¤§æ’ç›¸æœºæœ‰IOè§¦å‘å’Œå…‰è€¦è§¦å‘ä¸¤ç§ç¡¬è§¦å‘æ–¹å¼ï¼Œå…¶ä¸­å…‰è€¦è§¦å‘éš”ç¦»äº†å…‰ç”µå›è·¯ï¼Œå¯¹äºç›¸æœºæ›´åŠ å®‰å…¨ï¼Œä½†æ˜¯ç”±äºå­˜åœ¨å…‰ç”µè½¬æ¢è¿‡ç¨‹æ‰€ä»¥è§¦å‘æ—¶é—´å»¶è¿Ÿäº†30uså·¦å³ã€‚ç¡¬è§¦å‘æ–¹å¼åªæœ‰å•æ¬¡è§¦å‘ï¼Œä¹Ÿå°±æ˜¯è¯´æƒ³è¦è¿ç»­è·å¾—å›¾ç‰‡å¿…é¡»å‘ç›¸æœºå‘å°„å¤šæ¬¡å‘å°„æ–¹æ³¢ä¿¡å·ã€‚</p><p><strong>ç¡¬è§¦å‘åªèƒ½é€šè¿‡å›è°ƒå‡½æ•°è·å¾—å›¾ç‰‡ï¼Œå¯¹äºå¤§æ’ç›¸æœºåªèƒ½é€šè¿‡å·²ç»å®šä¹‰çš„å›è°ƒå‡½æ•°è·å¾—å›¾ç‰‡ï¼Œå›è°ƒçš„æ•°æ®ç±»å‹å·²ç»ç¡®å®šã€‚</strong></p><h2 id="åˆ©ç”¨ioä¿¡å·æ§åˆ¶ç›¸æœºç¡¬è§¦å‘">åˆ©ç”¨IOä¿¡å·æ§åˆ¶ç›¸æœºç¡¬è§¦å‘</h2><p>åœ¨IOæ§åˆ¶çº¿ä¸­æœ‰line0ï¼Œline1ï¼Œline2ï¼Œline3ä¸‰æ ¹çº¿ï¼Œå‰ä¸¤æ ¹æ˜¯å…‰è€¦è§¦å‘çº¿ï¼Œåä¸¤æ ¹æ˜¯IOè¾“å…¥/è¾“å‡ºçº¿ã€‚æ³¨æ„ä½¿ç”¨IOæ§åˆ¶æ—¶è¿˜åº”è¿æ¥IOåœ°çº¿GNDã€‚</p><p><img src="./%E5%A4%A7%E6%81%92%E7%9B%B8%E6%9C%BA%E7%A1%AC%E8%A7%A6%E5%8F%91/1.png" alt=""></p><p><strong>è¿™é‡Œæˆ‘æ¥äº†line2ï¼ˆ5ï¼‰å’ŒGNDï¼ˆ2ï¼‰ç„¶åline2æ¥åˆ°ä¸€ä¸ªå•ç‰‡æœºä¸Šçš„GPIOå£ä¸Šï¼Œæ¨æŒ½è¾“å‡ºï¼Œè¾“å‡ºç”µå‹ä¸º5Vï¼Œç„¶åå®Œæˆä»¥ä¸‹è®¾ç½®ä¹‹åï¼Œåªè¦å•ç‰‡æœºçš„IOå£è¾“å‡ºä¸€ä¸ªé«˜ç”µå¹³ï¼Œç›¸æœºå°±ä¼šé‡‡é›†ä¸€å¼ å›¾ç‰‡ã€‚</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">````</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;time.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/opencv.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;GxIAPI.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰å…¨å±€å˜é‡ï¼Œç”¨æ¥å­˜å›¾å’Œè®¡æ—¶</span></span><br><span class="line"><span class="function">cv::Mat <span class="title">empty</span><span class="params">(<span class="number">1024</span>, <span class="number">1280</span>, CV_8UC3, cv::Scalar::all(<span class="number">0</span>))</span></span>;</span><br><span class="line">timeval tv;</span><br><span class="line"><span class="type">long</span> time_end;</span><br><span class="line"><span class="type">long</span> time_start;</span><br><span class="line"><span class="comment">//å›¾ åƒ å› è°ƒ å¤„ ç† å‡½ æ•°</span></span><br><span class="line"><span class="comment">//ä¼ å›æ¥çš„GX_FRAME_CALLBACK_PARAM *pFrameåŒ…å«äº†å›¾åƒæ‰€åœ¨æŒ‡é’ˆï¼Œå¤§å°ï¼Œé•¿åº¦ç­‰ä¸€ç³»åˆ—ä¿¡æ¯ï¼Œéœ€è¦è§£ç ä¹‹åå˜æˆRGBå›¾ç‰‡</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> GX_STDC <span class="title">OnFrameCallbackFun</span><span class="params">(GX_FRAME_CALLBACK_PARAM *pFrame)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (pFrame-&gt;status == <span class="number">0</span>)</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="built_in">gettimeofday</span>(&amp;tv, <span class="literal">NULL</span>);</span><br><span class="line">      time_end = tv.tv_sec * <span class="number">1000000</span> + tv.tv_usec;</span><br><span class="line">      std::cout &lt;&lt; <span class="number">1000000</span> / (time_end - time_start) &lt;&lt; <span class="string">&quot;fps&quot;</span></span><br><span class="line">                &lt;&lt; <span class="string">&quot;get an image&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">      time_start = time_end;</span><br><span class="line">      <span class="type">void</span> *rgb_buffer = <span class="built_in">malloc</span>(<span class="number">3</span> * pFrame-&gt;nImgSize);</span><br><span class="line">      <span class="built_in">DxRaw8toRGB24</span>((<span class="type">void</span> *)pFrame-&gt;pImgBuf, rgb_buffer, pFrame-&gt;nWidth, pFrame-&gt;nHeight, RAW2RGB_NEIGHBOUR, BAYERRG, <span class="literal">false</span>);</span><br><span class="line">      cv::Mat result = cv::<span class="built_in">Mat</span>(pFrame-&gt;nHeight, pFrame-&gt;nWidth, CV_8UC3, rgb_buffer);</span><br><span class="line">      result.<span class="built_in">copyTo</span>(empty);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">   &#123;</span><br><span class="line">      std::cout &lt;&lt; <span class="string">&quot;fuck,trigger is failed&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰“å¼€è®¾å¤‡å’Œæ‰“å¼€åº“æ–¹å¼ç›¸åŒï¼Œå…³é”®åœ¨äºè®¾ç½®è§¦å‘</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   GX_STATUS status = GX_STATUS_SUCCESS;</span><br><span class="line">   GX_DEV_HANDLE hDevice = <span class="literal">NULL</span>;</span><br><span class="line">   GX_OPEN_PARAM stOpenParam;</span><br><span class="line">   <span class="type">uint32_t</span> nDeviceNum = <span class="number">0</span>;</span><br><span class="line">   <span class="built_in">gettimeofday</span>(&amp;tv, <span class="literal">NULL</span>);</span><br><span class="line">   time_end = tv.tv_sec * <span class="number">1000000</span> + tv.tv_usec;</span><br><span class="line">   time_start = tv.tv_sec * <span class="number">1000000</span> + tv.tv_usec;</span><br><span class="line">   <span class="comment">//åˆ å§‹ åŒ– åº“</span></span><br><span class="line">   status = <span class="built_in">GXInitLib</span>();</span><br><span class="line">   <span class="comment">//æš ä¸¾ è®¾ å¤‡ åˆ— è¡¨</span></span><br><span class="line">   status = <span class="built_in">GXUpdateDeviceList</span>(&amp;nDeviceNum, <span class="number">1000</span>);</span><br><span class="line">   <span class="keyword">if</span> ((status != GX_STATUS_SUCCESS) || (nDeviceNum &lt;= <span class="number">0</span>))</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//æ‰“ å¼€ è®¾ å¤‡</span></span><br><span class="line">   stOpenParam.accessMode = GX_ACCESS_EXCLUSIVE;</span><br><span class="line">   stOpenParam.openMode = GX_OPEN_INDEX;</span><br><span class="line">   stOpenParam.pszContent = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">   status = <span class="built_in">GXOpenDevice</span>(&amp;stOpenParam, &amp;hDevice);</span><br><span class="line">   <span class="keyword">if</span> (status == GX_STATUS_SUCCESS)</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="comment">//è®¾ ç½® è§¦ å‘ æ¨¡ å¼ ä¸º ON</span></span><br><span class="line">      status = <span class="built_in">GXSetEnum</span>(hDevice, GX_ENUM_TRIGGER_MODE, GX_TRIGGER_MODE_ON);</span><br><span class="line">      <span class="comment">//è®¾ ç½® è§¦ å‘ æ¿€ æ´» æ–¹ å¼ ä¸º ä¸Š å‡ æ²¿ï¼Œè¿˜å¯ä»¥è®¾ç½®ä¸‹é™æ²¿è§¦å‘ï¼ŒæŒ‡ç”µå¹³ä¸Šå‡æˆ–ä¸‹é™æ—¶ä¸ºä¸€æ¬¡è§¦å‘</span></span><br><span class="line">      status = <span class="built_in">GXSetEnum</span>(hDevice, GX_ENUM_TRIGGER_ACTIVATION, GX_TRIGGER_ACTIVATION_RISINGEDGE);</span><br><span class="line">      <span class="comment">//è®¾ç½®è§¦å‘å¼€å…³ä¸ºline2</span></span><br><span class="line">      status = <span class="built_in">GXSetEnum</span>(hDevice, GX_ENUM_TRIGGER_SOURCE, GX_TRIGGER_SOURCE_LINE2);</span><br><span class="line">      <span class="comment">//Selects the physical line (or pin) of the external device connector to configureï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“æ˜¯å•¥åæ­£åŠ å»äº†</span></span><br><span class="line">      status = <span class="built_in">GXSetEnum</span>(hDevice, GX_ENUM_LINE_SELECTOR, GX_ENUM_LINE_SELECTOR_LINE2);</span><br><span class="line">      <span class="comment">//è®¾ç½®line2æ¨¡å¼ä¸ºinputï¼ŒåŒæ ·å¯ä»¥è®¾ç½®ä¸ºoutpotï¼Œåˆ™å¯ä»¥é€šè¿‡ç›¸æœºæ§åˆ¶å¤–éƒ¨è®¾å¤‡</span></span><br><span class="line">      status = <span class="built_in">GXSetEnum</span>(hDevice, GX_ENUM_LINE_MODE, GX_ENUM_LINE_MODE_INPUT);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">// GX_ENUM_TRIGGER_MODE: è§¦å‘æ¨¡å¼, æšä¸¾å€¼å‚è€ƒ GX_TRIGGER_MODE_ENTRY </span></span><br><span class="line">      <span class="comment">// GX_COMMAND_TRIGGER_SOFTWARE : è½¯è§¦å‘å‘½ä»¤ </span></span><br><span class="line">      <span class="comment">// GX_ENUM_TRIGGER_ACTIVATION : è§¦å‘ææ€§, æšä¸¾å€¼å‚è€ƒ </span></span><br><span class="line">      <span class="comment">// GX_TRIGGER_ACTIVATION_ENTRY GX_ENUM_TRIGGER_SWITCH : å¤–è§¦å‘å¼€å…³, å‚è€ƒ </span></span><br><span class="line">      <span class="comment">// GX_TRIGGER_SWITCH_ENTRY GX_ENUM_TRIGGER_SOURCE : è§¦å‘æº, æšä¸¾å€¼å‚è€ƒ </span></span><br><span class="line">      <span class="comment">// GX_TRIGGER_SOURCE_ENTRY GX_ENUM_TRIGGER_SELECTOR : è§¦å‘ç±»å‹é€‰æ‹©, å‚è€ƒ </span></span><br><span class="line">      <span class="comment">// GX_TRIGGER_SELECTOR_ENTRY GX_FLOAT_TRIGGER_DELAY : è§¦å‘å»¶è¿Ÿ</span></span><br><span class="line">      <span class="comment">//è®¾ç½®æ›å…‰å’Œå¢ç›Šç­‰å‚æ•°å’ŒåŸå…ˆåœ¨ä¸€è‡´</span></span><br><span class="line">      status = <span class="built_in">GXSetFloat</span>(hDevice, GX_FLOAT_EXPOSURE_TIME, (<span class="type">float</span>)<span class="number">3000</span>);</span><br><span class="line">      status = <span class="built_in">GXSetEnum</span>(hDevice, GX_ENUM_BALANCE_RATIO_SELECTOR, GX_BALANCE_RATIO_SELECTOR_RED);</span><br><span class="line">      status = <span class="built_in">GXSetFloat</span>(hDevice, GX_FLOAT_BALANCE_RATIO, <span class="number">1.6484</span>);</span><br><span class="line">      status = <span class="built_in">GXSetEnum</span>(hDevice, GX_ENUM_BALANCE_RATIO_SELECTOR, GX_BALANCE_RATIO_SELECTOR_BLUE);</span><br><span class="line">      status = <span class="built_in">GXSetFloat</span>(hDevice, GX_FLOAT_BALANCE_RATIO, <span class="number">1.5664</span>);</span><br><span class="line">      status = <span class="built_in">GXSetEnum</span>(hDevice, GX_ENUM_BALANCE_RATIO_SELECTOR, GX_BALANCE_RATIO_SELECTOR_GREEN);</span><br><span class="line">      status = <span class="built_in">GXSetFloat</span>(hDevice, GX_FLOAT_BALANCE_RATIO, <span class="number">1.000</span>);</span><br><span class="line">      status = <span class="built_in">GXSetEnum</span>(hDevice, GX_ENUM_GAIN_SELECTOR, GX_GAIN_SELECTOR_ALL);</span><br><span class="line">      status = <span class="built_in">GXSetFloat</span>(hDevice, GX_FLOAT_GAIN, <span class="number">10.0</span>);</span><br><span class="line">  <span class="comment">//æ³¨ å†Œ å›¾ åƒ å¤„ ç† å› è°ƒ å‡½ æ•°ï¼Œæ¯æ¬¡æ¥å—åˆ°ä¸€ä¸ªç”µå¹³å˜åŒ–å°±ä¼šå›è°ƒ</span></span><br><span class="line">      status = <span class="built_in">GXRegisterCaptureCallback</span>(hDevice, <span class="literal">NULL</span>, OnFrameCallbackFun);   </span><br><span class="line">      <span class="comment">//å‘ é€ å¼€ é‡‡ å‘½ ä»¤</span></span><br><span class="line">      status = <span class="built_in">GXSendCommand</span>(hDevice, GX_COMMAND_ACQUISITION_START);</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">//æ‰€æœ‰å¼•è„šçŠ¶æ€</span></span><br><span class="line">   <span class="type">int64_t</span> nAllLineStatus = <span class="number">0</span>; </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">      cv::<span class="built_in">imshow</span>(<span class="string">&quot;test&quot;</span>, empty);</span><br><span class="line">      <span class="keyword">if</span> (cv::<span class="built_in">waitKey</span>(<span class="number">1</span>) == <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (cv::<span class="built_in">waitKey</span>(<span class="number">1</span>) == <span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="comment">//è¾“å‡ºæ‰€æœ‰å¼•è„šçš„ç”µå¹³ï¼Œ0xcé»˜è®¤æ˜¯æœªè§¦å‘çŠ¶æ€ï¼Œä½†æ˜¯å®é™…ä¸Š0xeæ˜¯æœªè§¦å‘</span></span><br><span class="line">         GX_STATUS Status = <span class="built_in">GXGetInt</span>(hDevice, GX_INT_LINE_STATUS_ALL, &amp;nAllLineStatus);</span><br><span class="line">         std::cout</span><br><span class="line">             &lt;&lt; <span class="string">&quot;line status:&quot;</span> &lt;&lt; nAllLineStatus &lt;&lt; std::endl; </span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (cv::<span class="built_in">waitKey</span>(<span class="number">1</span>) == <span class="string">&#x27;q&#x27;</span>)</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="comment">//</span></span><br><span class="line">         <span class="comment">//åœ¨ å‘ é€ åœ é‡‡ å‘½ ä»¤ å‰ å¦‚ æœ äº§ ç”Ÿ äº† æœ‰ æ•ˆ è§¦ å‘ , é‚£ ä¹ˆ å›¾ åƒ</span></span><br><span class="line">         <span class="comment">//ä¼š é€š è¿‡ OnFrameCallbackFun æ¥ å£ è¿” ç»™ ç”¨ æˆ·</span></span><br><span class="line">         <span class="comment">//---------------------</span></span><br><span class="line">         <span class="comment">//å‘ é€ åœ é‡‡ å‘½ ä»¤</span></span><br><span class="line">         status = <span class="built_in">GXSendCommand</span>(hDevice, GX_COMMAND_ACQUISITION_STOP);</span><br><span class="line">         <span class="comment">//æ³¨ é”€ é‡‡ é›† å› è°ƒ</span></span><br><span class="line">         status = <span class="built_in">GXUnregisterCaptureCallback</span>(hDevice);</span><br><span class="line">         status = <span class="built_in">GXCloseDevice</span>(hDevice);</span><br><span class="line">         hDevice = <span class="literal">NULL</span>;</span><br><span class="line">         status = <span class="built_in">GXCloseLib</span>();</span><br><span class="line">         std::cout &lt;&lt; <span class="string">&quot;end captrue&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">         <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ioæ§åˆ¶çš„ç”µæ§ä»£ç ">IOæ§åˆ¶çš„ç”µæ§ä»£ç </h2><p>æˆ‘è®¾è®¡çš„ç”µæ§æ–¹æ¡ˆæ˜¯æ‘ä¸€ä¸‹æ‘å»ºå°±ä¼šæœ‰å›è°ƒå‡½æ•°è§¦å‘ï¼Œå›è°ƒå‡½æ•°å°±ä¼šå±•ç¤ºè¿™å¼ ç…§ç‰‡ï¼Œå¦‚æœæ²¡æœ‰æ‘æ‘å»ºå°±ä¸ä¼šæœ‰å›¾ç‰‡ï¼Œä¸ä¼šè§¦å‘ã€‚å¦‚æœ‰éœ€è¦å¯ä»¥è”ç³»æˆ‘</p><p>è®¾ç½®æ›å…‰ä¸º3000usï¼ŒæŸ¥çœ‹å¤§æ’çš„å›¾åƒä¼ è¾“è¿‡ç¨‹å¤§æ¦‚æ˜¯300usï¼Œå–ä¸€æ¬¡ä¼ å›¾çš„å‘¨æœŸä¸º5000usï¼Œå³200hzï¼Œåˆ™ä¹Ÿåº”è®¾ç½®ç”µæ§å‘é€200hzçš„IOå˜åŒ–ç”µå¹³ï¼Œå®é™…åœ¨è§†è§‰æ”¶åˆ°çš„å›¾ç‰‡é€Ÿç‡ä¹Ÿåœ¨200hzä½œæœ‰ï¼Œæœ‰ä¸åˆ°10hzçš„å˜åŒ–ï¼Œè¿™ä¸ªæŒºç®€å•çš„ï¼Œæˆ‘å°±ä¸åˆ‡ç³»ç»Ÿå¤åˆ¶ç”µæ§çš„ä»£ç äº†ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;å¤§æ’ç›¸æœºç¡¬è§¦å‘è¯´æ˜æ–‡æ¡£&lt;/h1&gt;
&lt;p&gt;ç›¸æœºç¡¬è§¦å‘æ˜¯åŒºåˆ«äºè½¯è§¦å‘ï¼Œåˆ©ç”¨IOæˆ–è€…å…‰è€¦ç­‰å¤–éƒ¨æ§åˆ¶ä¿¡å·è§¦å‘ç›¸æœºå¿«é—¨çš„æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;p&gt;å¤§æ’ç›¸æœºæœ‰IOè§¦å‘å’Œå…‰è€¦è§¦å‘ä¸¤ç§ç¡¬è§¦å‘æ–¹å¼ï¼Œå…¶ä¸­å…‰è€¦è§¦å‘éš”ç¦»äº†å…‰ç”µå›è·¯ï¼Œå¯¹äºç›¸æœºæ›´åŠ å®‰å…¨ï¼Œä½†æ˜¯ç”±äºå­˜åœ¨å…‰ç”µè½¬æ¢è¿‡ç¨‹æ‰€ä»¥è§¦å‘æ—¶é—´å»¶è¿Ÿäº†30us</summary>
      
    
    
    
    <category term="ç›¸æœºé©±åŠ¨å¼€å‘" scheme="http://outbreak-sen.github.io/categories/%E7%9B%B8%E6%9C%BA%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="å¤§æ’" scheme="http://outbreak-sen.github.io/tags/%E5%A4%A7%E6%81%92/"/>
    
    <category term="ç¡¬è§¦å‘" scheme="http://outbreak-sen.github.io/tags/%E7%A1%AC%E8%A7%A6%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>mindspore.mintæ¥å£æµ‹è¯•ä»»åŠ¡</title>
    <link href="http://outbreak-sen.github.io/2025/02/11/%E6%98%93%E7%94%A8%E6%80%A7mint%E7%AE%97%E5%AD%90%E6%B5%8B%E8%AF%95%E6%97%A5%E8%AE%B0/"/>
    <id>http://outbreak-sen.github.io/2025/02/11/%E6%98%93%E7%94%A8%E6%80%A7mint%E7%AE%97%E5%AD%90%E6%B5%8B%E8%AF%95%E6%97%A5%E8%AE%B0/</id>
    <published>2025-02-11T01:51:43.000Z</published>
    <updated>2025-03-19T09:11:03.981Z</updated>
    
    <content type="html"><![CDATA[<h1>mindspore.mintæ¥å£æµ‹è¯•ä»»åŠ¡</h1><h2 id="ä»»åŠ¡">ä»»åŠ¡</h2><h3 id="ä»»åŠ¡èƒŒæ™¯">ä»»åŠ¡èƒŒæ™¯</h3><p>mindspore.mintæä¾›äº†å¤§é‡çš„functionalã€nnã€ä¼˜åŒ–å™¨æ¥å£ï¼ŒAPIç”¨æ³•åŠåŠŸèƒ½ç­‰ä¸ä¸šç•Œä¸»æµç”¨æ³•ä¸€è‡´ï¼Œæ–¹ä¾¿ç”¨æˆ·å‚è€ƒä½¿ç”¨ã€‚ mintæ¥å£å½“å‰æ˜¯å®éªŒæ€§æ¥å£ï¼Œåœ¨å›¾ç¼–è¯‘æ¨¡å¼ä¸ºO0å’ŒPyNativeæ¨¡å¼ä¸‹æ€§èƒ½æ¯”opsæ›´ä¼˜ã€‚å½“å‰æš‚ä¸æ”¯æŒå›¾ä¸‹æ²‰æ¨¡å¼åŠCPUã€GPUåç«¯ï¼Œåç»­ä¼šé€æ­¥å®Œå–„ã€‚</p><p>mindspore.mint.divé€å…ƒç´ è®¡ç®— input é™¤ä»¥ other çš„å•†ã€‚</p><p>mindspore.mint.divide</p><p>mindspore.mint.erf</p><p>mindspore.mint.erfc</p><p>mindspore.mint.erfinv</p><h3 id="éœ€æ±‚æè¿°">éœ€æ±‚æè¿°</h3><ol><li>å¯¹åº”Pytorch çš„ç›¸åº”æ¥å£è¿›è¡Œæµ‹è¯•ï¼š<br>a) æµ‹è¯•randomè¾“å…¥ä¸åŒdtypeï¼Œå¯¹æ¯”ä¸¤ä¸ªæ¡†æ¶çš„æ”¯æŒåº¦<br>b) æµ‹è¯•å›ºå®šdtypeï¼Œrandomè¾“å…¥å€¼ï¼Œå¯¹æ¯”ä¸¤ä¸ªæ¡†æ¶è¾“å‡ºæ˜¯å¦ç›¸ç­‰ï¼ˆè¯¯å·®èŒƒå›´ä¸ºå°äº1e-3ï¼‰<br>c) æµ‹è¯•å›ºå®šshapeï¼Œå›ºå®šè¾“å…¥å€¼ï¼Œä¸åŒè¾“å…¥å‚æ•°ï¼ˆstring\boolç­‰ç±»å‹ï¼‰ï¼Œä¸¤ä¸ªæ¡†æ¶çš„æ”¯æŒåº¦<br>d) æµ‹è¯•éšæœºæ··ä¹±è¾“å…¥ï¼ŒæŠ¥é”™ä¿¡æ¯çš„å‡†ç¡®æ€§</li><li>æµ‹è¯•ä½¿ç”¨æ¥å£æ„é€ å‡½æ•°/ç¥ç»ç½‘ç»œçš„å‡†ç¡®æ€§<br>a) Githubæœç´¢å¸¦æœ‰è¯¥æ¥å£çš„ä»£ç ç‰‡æ®µ/ç¥ç»ç½‘ç»œ<br>b) ä½¿ç”¨Pytorchå’ŒMindSporeï¼Œå›ºå®šè¾“å…¥å’Œæƒé‡ï¼Œæµ‹è¯•æ­£å‘æ¨ç†ç»“æœï¼ˆè¯¯å·®èŒƒå›´å°äº1e-3ï¼Œè‹¥æŠ¥é”™åˆ™è®°å½•æŠ¥é”™ä¿¡æ¯ï¼‰<br>c) æµ‹è¯•è¯¥ç¥ç»ç½‘ç»œ/å‡½æ•°åå‘ï¼Œå¦‚æœæ˜¯ç¥ç»ç½‘ç»œï¼Œåˆ™æµ‹è¯•Parameterçš„æ¢¯åº¦ï¼Œå¦‚æœæ˜¯å‡½æ•°ï¼Œåˆ™æµ‹è¯•å‡½æ•°è¾“å…¥çš„æ¢¯åº¦</li></ol><h3 id="éªŒæ”¶æ ‡å‡†">éªŒæ”¶æ ‡å‡†</h3><p>æµ‹è¯•è¿‡ç¨‹ä¸­é‡åˆ°çš„å…¶ä»–é—®é¢˜è®°å½•ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š<br>a) ç¯å¢ƒå®‰è£…<br>b) æ¡†æ¶è¿è¡Œæ—¶æŠ¥é”™ï¼ˆå¦‚memcpyã€ CANNæŠ¥é”™ç­‰ç­‰ï¼‰<br>c) æ„Ÿè§‰ä¸å¥½ç”¨æˆ–è€…å’ŒPytorchæ— æ³•å¯¹é½çš„åœ°æ–¹<br>å°†æµ‹è¯•ä»£ç å†™æˆæµ‹è¯•ç”¨ä¾‹å½¢å¼ï¼Œæäº¤æ‰“åŒ…ï¼š<br>a) æ–‡ä»¶åå‘½åä¸ºtest_xxx.pyï¼Œxxxä¸ºæµ‹è¯•çš„æ¥å£å<br>b) æ¯ä¸ªæµ‹è¯•ç‚¹æ„é€ ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°åä¸ºtest_xxxï¼Œéœ€è¦åœ¨å‡½æ•°åä½“ç°æ¸…æ™°çš„æµ‹è¯•å†…å®¹ä¿¡æ¯ï¼Œå¦‚ï¼štest_linear_random_shape</p><h2 id="èƒŒæ™¯çŸ¥è¯†-åˆ«ä¸Šä¼ è¿™ä¸€éƒ¨åˆ†">èƒŒæ™¯çŸ¥è¯†ï¼ˆåˆ«ä¸Šä¼ è¿™ä¸€éƒ¨åˆ†ï¼‰</h2><ul><li><p>numpy.allclose</p><p>Returns True if two arrays are element-wise equal within a tolerance.</p></li><li><p>MindSporeæ”¯æŒä¸¤ç§è¿è¡Œæ¨¡å¼ï¼š<a href="https://www.mindspore.cn/tutorials/zh-CN/r1.3/intermediate/pynative_mode_and_graph_mode.html">å‚è€ƒæ–‡çŒ®</a></p><ul><li>Graphæ¨¡å¼ï¼šé™æ€å›¾æ¨¡å¼æˆ–è€…å›¾æ¨¡å¼ï¼Œå°†ç¥ç»ç½‘ç»œæ¨¡å‹ç¼–è¯‘æˆä¸€æ•´å¼ å›¾ï¼Œç„¶åä¸‹å‘æ‰§è¡Œã€‚è¯¥æ¨¡å¼åˆ©ç”¨å›¾ä¼˜åŒ–ç­‰æŠ€æœ¯æé«˜è¿è¡Œæ€§èƒ½ï¼ŒåŒæ—¶æœ‰åŠ©äºè§„æ¨¡éƒ¨ç½²å’Œè·¨å¹³å°è¿è¡Œã€‚</li><li>PyNativeæ¨¡å¼ï¼šåŠ¨æ€å›¾æ¨¡å¼ï¼Œå°†ç¥ç»ç½‘ç»œä¸­çš„å„ä¸ªç®—å­é€ä¸€ä¸‹å‘æ‰§è¡Œï¼Œæ–¹ä¾¿ç”¨æˆ·ç¼–å†™å’Œè°ƒè¯•ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚</li></ul><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMindSporeå¤„äºGraphæ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡<code>context.set_context(mode=context.PYNATIVE_MODE)</code>åˆ‡æ¢ä¸ºPyNativeæ¨¡å¼ï¼›åŒæ ·åœ°ï¼ŒMindSporeå¤„äºPyNativeæ¨¡å¼æ—¶ï¼Œå¯ä»¥é€šè¿‡ <code>context.set_context(mode=context.GRAPH_MODE)</code>åˆ‡æ¢ä¸ºGraphæ¨¡å¼ã€‚</p><p>Graphå’ŒPyNativeä¸¤ç§æ¨¡å¼çš„åŒºåˆ«ä¸»è¦æœ‰ï¼š</p><ul><li>ä½¿ç”¨åœºæ™¯ï¼šGraphæ¨¡å¼éœ€è¦ä¸€å¼€å§‹å°±æ„å»ºå¥½ç½‘ç»œç»“æ„ï¼Œç„¶åæ¡†æ¶åšæ•´å›¾ä¼˜åŒ–å’Œæ‰§è¡Œï¼Œæ¯”è¾ƒé€‚åˆç½‘ç»œå›ºå®šæ²¡æœ‰å˜åŒ–ï¼Œä¸”éœ€è¦é«˜æ€§èƒ½çš„åœºæ™¯ã€‚è€ŒPyNativeæ¨¡å¼é€è¡Œæ‰§è¡Œç®—å­ï¼Œæ”¯æŒå•ç‹¬æ±‚æ¢¯åº¦ã€‚</li><li>ç½‘ç»œæ‰§è¡Œï¼šGraphæ¨¡å¼å’ŒPyNativeæ¨¡å¼åœ¨æ‰§è¡Œç›¸åŒçš„ç½‘ç»œå’Œç®—å­æ—¶ï¼Œç²¾åº¦æ•ˆæœæ˜¯ä¸€è‡´çš„ã€‚ç”±äºGraphæ¨¡å¼è¿ç”¨äº†å›¾ä¼˜åŒ–ã€è®¡ç®—å›¾æ•´å›¾ä¸‹æ²‰ç­‰æŠ€æœ¯ï¼ŒGraphæ¨¡å¼æ‰§è¡Œç½‘ç»œçš„æ€§èƒ½å’Œæ•ˆç‡æ›´é«˜ã€‚</li><li>ä»£ç è°ƒè¯•ï¼šåœ¨è„šæœ¬å¼€å‘å’Œç½‘ç»œæµç¨‹è°ƒè¯•ä¸­ï¼Œæ¨èä½¿ç”¨PyNativeæ¨¡å¼è¿›è¡Œè°ƒè¯•ã€‚åœ¨PyNativeæ¨¡å¼ä¸‹ï¼Œå¯ä»¥æ–¹ä¾¿åœ°è®¾ç½®æ–­ç‚¹ï¼Œè·å–ç½‘ç»œæ‰§è¡Œçš„ä¸­é—´ç»“æœï¼Œä¹Ÿå¯ä»¥é€šè¿‡pdbçš„æ–¹å¼å¯¹ç½‘ç»œè¿›è¡Œè°ƒè¯•ã€‚è€ŒGraphæ¨¡å¼æ— æ³•è®¾ç½®æ–­ç‚¹ï¼Œåªèƒ½å…ˆæŒ‡å®šç®—å­è¿›è¡Œæ‰“å°ï¼Œç„¶ååœ¨ç½‘ç»œæ‰§è¡Œå®ŒæˆåæŸ¥çœ‹è¾“å‡ºç»“æœã€‚</li></ul><p>ä¸‹é¢ä»¥Graphæ¨¡å¼ä¸ºä¾‹ï¼Œæ¼”ç¤ºMindSporeå•ç®—å­ã€æ™®é€šå‡½æ•°ã€æ¨¡å‹çš„æ‰§è¡Œæ–¹å¼ï¼Œå¹¶è¿›ä¸€æ­¥è¯´æ˜å¦‚ä½•åœ¨PyNativeæ¨¡å¼ä¸‹è¿›è¡Œæ€§èƒ½æ”¹è¿›åŠæ¢¯åº¦æ±‚å–ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> mindspore.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">from</span> mindspore <span class="keyword">import</span> context, Tensor, ParameterTuple, ms_function</span><br><span class="line"><span class="keyword">import</span> mindspore.ops <span class="keyword">as</span> ops</span><br><span class="line"><span class="keyword">from</span> mindspore <span class="keyword">import</span> dtype <span class="keyword">as</span> mstype</span><br><span class="line"><span class="keyword">from</span> mindspore.common.initializer <span class="keyword">import</span> Normal</span><br><span class="line"><span class="keyword">from</span> mindspore.nn <span class="keyword">import</span> Dense, WithLossCell, SoftmaxCrossEntropyWithLogits, Momentum</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾å®šä¸ºGraphæ¨¡å¼ï¼Œä¹Ÿå¯æ›¿æ¢ä¸ºPYNATIVE_MODE</span></span><br><span class="line"><span class="comment"># MindSporeçš„é»˜è®¤æ–¹å¼GRAPH_MODE</span></span><br><span class="line">context.set_context(mode=context.GRAPH_MODE, device_target=<span class="string">&quot;Ascend&quot;</span>)</span><br><span class="line">conv = nn.Conv2d(<span class="number">3</span>, <span class="number">4</span>, <span class="number">3</span>, bias_init=<span class="string">&#x27;zeros&#x27;</span>)</span><br><span class="line">input_data = Tensor(np.ones([<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">5</span>]).astype(np.float32))</span><br><span class="line">output = conv(input_data)</span><br><span class="line"><span class="built_in">print</span>(output.asnumpy())</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>CANNé”™è¯¯åˆ†æï¼Œå‚è€ƒæ–‡çŒ®æ¥è‡ª<a href="https://www.mindspore.cn/tutorials/experts/zh-CN/r2.0/debug/error_analyze.html?highlight=cann">é”™è¯¯åˆ†æ</a></p><p>åªé€‚ç”¨äºAscendå¹³å°ã€‚CANNï¼ˆCompute Architecture for Neural Networksï¼‰æ˜¯åä¸ºé’ˆå¯¹AIåœºæ™¯æ¨å‡ºçš„å¼‚æ„è®¡ç®—æ¶æ„ï¼ŒAscendå¹³å°çš„MindSporeè¿è¡Œåœ¨CANNä¹‹ä¸Šã€‚è¿™ç±»æŠ¥é”™ä¸€èˆ¬åœ¨æ—¥å¿—ä¸­ä¼šæœ‰<code>Ascend error occurred</code>å…³é”®å­—ï¼ŒæŠ¥é”™æ¶ˆæ¯ç”±é”™è¯¯ç å’Œé”™è¯¯å†…å®¹ç»„æˆ</p></li></ul><h3 id="pytest">pytest</h3><p>pytestæ˜¯ä¸€ä¸ªç”¨äº Python çš„<a href="https://so.csdn.net/so/search?q=%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6&amp;spm=1001.2101.3001.7020">æµ‹è¯•æ¡†æ¶</a>ï¼Œæ”¯æŒç®€å•çš„å•å…ƒæµ‹è¯•å’Œå¤æ‚çš„åŠŸèƒ½æµ‹è¯•ã€‚å®ƒä»¥å…¶<strong>ç®€å•</strong>ã€<strong>æ˜“ç”¨</strong>ã€<strong>çµæ´»</strong>çš„ç‰¹ç‚¹ï¼Œå—åˆ°äº†è®¸å¤šå¼€å‘è€…çš„é’çã€‚<strong>å¼ºå¤§çš„æ–­è¨€</strong>ï¼šå†…ç½®ä¸°å¯Œçš„æ–­è¨€æ–¹æ³•ï¼Œæä¾›è¯¦ç»†çš„å¤±è´¥ä¿¡æ¯ã€‚<strong>è‡ªåŠ¨å‘ç°</strong>ï¼šè‡ªåŠ¨å‘ç°æµ‹è¯•æ–‡ä»¶å’Œæµ‹è¯•å‡½æ•°ï¼Œæ— éœ€æ˜¾å¼åœ°æ³¨å†Œæµ‹è¯•ã€‚</p><p>â€‹æŠŠå‡½æ•°å’Œç±»ç”¨@pytestä¿®é¥°ä¹‹åï¼Œè¿è¡Œpytest+æ–‡ä»¶åç§°ï¼Œå³å¯æµ‹è¯•æ‰€æœ‰å¸¦ä¿®é¥°çš„å‡½æ•°å’Œç±»ã€‚</p><h4 id="ç¼–å†™è¦æ±‚">ç¼–å†™è¦æ±‚</h4><ul><li><p>é»˜è®¤æµ‹è¯•ç”¨ä¾‹çš„æ ¼å¼ï¼š</p><ul><li><p>æ¨¡å—åï¼šæ¨¡å—åï¼ˆæ–‡ä»¶åï¼‰é€šå¸¸è¢«ç»Ÿä¸€æ”¾åœ¨ä¸€ä¸ªtestcasesæ–‡ä»¶å¤¹ä¸­ï¼Œç„¶åéœ€è¦ä¿è¯æ¨¡å—åä»¥test_å¼€å¤´æˆ–_testç»“å°¾ï¼Œä¾‹å¦‚test_demo1æˆ–demo2_test</p></li><li><p>ç±»åï¼šæµ‹è¯•ç±»ç±»åå¿…é¡»ä»¥Testå¼€å¤´ï¼Œå¹¶ä¸”ä¸èƒ½å¸¦æœ‰initæ–¹æ³•</p></li><li><p>æ–¹æ³•åï¼šæµ‹è¯•æ–¹æ³•åï¼ˆCase åï¼‰å¿…é¡»ä»¥test_å¼€å¤´ï¼Œä¾‹å¦‚test_demo1(self)ã€test_demo2(self)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># test_demo1.py</span><br><span class="line">class TestDemo:</span><br><span class="line">    def test_demo1(self):</span><br><span class="line">        print(&quot;æµ‹è¯•ç”¨ä¾‹1&quot;)</span><br><span class="line"></span><br><span class="line">    def test_demo2(self):</span><br><span class="line">        print(&quot;æµ‹è¯•ç”¨ä¾‹2&quot;)</span><br><span class="line">    workage2 = 5</span><br><span class="line">    workage3 = 20</span><br><span class="line">    </span><br><span class="line">    # åªéœ€é‡‡ç”¨ skip æˆ– skipif æ–¹æ³•æ¥æŒ‡å®šå‚æ•°å¹¶è´´åœ¨æ–¹æ³•ä¸Šå³å¯è·³è¿‡ã€‚æ»¡è¶³æ¡ä»¶å°±ä¸ä¼šæµ‹è¯•</span><br><span class="line">    @pytest.mark.skip(reason=&quot;æ— ç†ç”±è·³è¿‡&quot;)</span><br><span class="line">    def test_demo1(self):</span><br><span class="line">        print(&quot;æˆ‘è¢«è·³è¿‡äº†&quot;)</span><br><span class="line">    @pytest.mark.skipif(workage2&lt;10,reason=&quot;å·¥ä½œç»éªŒå°‘äº10å¹´è·³è¿‡&quot;)    </span><br><span class="line">    def test_demo2(self):</span><br><span class="line">        print(&quot;ç”±äºç»éªŒä¸è¶³ï¼Œæˆ‘è¢«è·³è¿‡äº†&quot;)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    # æˆ‘ä»¬åœ¨Caseä¸Šé‡‡ç”¨@pytest.mark. + åˆ†ç»„åç§°ï¼Œå°±ç›¸å½“äºè¯¥æ–¹æ³•è¢«åˆ’åˆ†ä¸ºè¯¥åˆ†ç»„ä¸­</span><br><span class="line">    # æ³¨æ„ï¼šä¸€ä¸ªåˆ†ç»„å¯ä»¥æœ‰å¤šä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ–¹æ³•ä¹Ÿå¯ä»¥è¢«åˆ’åˆ†åˆ°å¤šä¸ªåˆ†ç»„ä¸­ï¼Œè¿è¡Œæ—¶å€™pytest -vs -m user_manageæŒ‡å®šåˆ†ç»„</span><br><span class="line">    @pytest.mark.user_manage</span><br><span class="line">    def test_demo1(self):</span><br><span class="line">        print(&quot;user_manage_test1&quot;)</span><br><span class="line"></span><br><span class="line">    @pytest.mark.product_manage</span><br><span class="line">    def test_demo2(self):</span><br><span class="line">        print(&quot;product_manage_test1&quot;)</span><br><span class="line">   </span><br></pre></td></tr></table></figure></li></ul></li><li><p>å¦‚æœä¸æƒ³ç”¨é»˜è®¤çš„æ ¼å¼ï¼Œå¯åœ¨æ ¹ç›®å½•ä¸‹è‡ªå·±å†™ä¸€ä¸ªpytest.ini</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[pytest]</span><br><span class="line">#å‚æ•°</span><br><span class="line">addopts = â€vs</span><br><span class="line"># é»˜è®¤çš„æ‰§è¡Œè·¯å¾„ï¼Œå®ƒä¼šé»˜è®¤æ‰§è¡Œè¯¥æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰çš„æ»¡è¶³æ¡ä»¶çš„æµ‹è¯•case</span><br><span class="line">testpaths = ./testcases</span><br><span class="line"># æ–‡ä»¶å‘½åè§„åˆ™</span><br><span class="line">python_files = test_*.py</span><br><span class="line"># ç±»åå‘½åè§„åˆ™</span><br><span class="line">python_classes = Test*</span><br><span class="line"># Caseå‘½åè§„åˆ™</span><br><span class="line">python_functions = test_*</span><br><span class="line"></span><br><span class="line"># æ ‡è®°</span><br><span class="line">markers =</span><br><span class="line"># å†’çƒŸè§„åˆ™</span><br><span class="line">smoke:å†’çƒŸç”¨ä¾‹ </span><br><span class="line">product_manage:å•†å“ç®¡ç†</span><br></pre></td></tr></table></figure></li></ul><h4 id="æŒ‡å®šæ‰§è¡Œé¡ºåº">æŒ‡å®šæ‰§è¡Œé¡ºåº</h4><ol><li>é»˜è®¤æ–¹æ³•ï¼ˆå›ºä»¶æ–¹æ³•ï¼‰ï¼šå¦‚æœè¯´æœ‰äº›å‡½æ•°éœ€è¦æŒ‡å®šåœ¨æŸä¸ªæ—¶é—´æ‰èƒ½è¿è¡Œï¼Œåˆ™éœ€è¦<strong>åŠ ä¿®é¥°è¯å’Œä½¿ç”¨æŒ‡å®šçš„å‡½æ•°å</strong></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import unittest</span><br><span class="line"></span><br><span class="line">class TestLogin(unittest.TestCase):</span><br><span class="line"></span><br><span class="line">    # ä»¥ä¸‹æ˜¯ç”¨è¿‡ä¿®é¥°è¯ä½¿è¿™ä¸¤ä¸ªå‡½æ•°å¿…é¡»åœ¨ç±»å†…æ‰€æœ‰æ–¹æ³•çš„å‰åå»æ‰§è¡Œè¯¥æ“ä½œï¼Œæ— è®ºç±»çš„æ–¹æ³•æ‰§è¡Œå¤šå°‘æ¬¡ï¼Œå®ƒåªä¼šè°ƒç”¨ä¸€æ¬¡</span><br><span class="line">    # åœ¨æ‰§è¡Œè¯¥ç±»å‰æ‰€éœ€è¦è°ƒç”¨çš„æ–¹æ³•ï¼Œå‡½æ•°åç§°å¿…é¡»è¿™ä¹ˆå†™</span><br><span class="line">    @classmethod</span><br><span class="line">    def setUpClass(cls) -&gt; None:</span><br><span class="line">    print(&#x27;------æ‰“å¼€æµè§ˆå™¨&#x27;)</span><br><span class="line">    </span><br><span class="line">    # åœ¨æ‰§è¡Œè¯¥ç±»åæ‰€éœ€è¦è°ƒç”¨çš„æ–¹æ³•</span><br><span class="line">    @classmethod</span><br><span class="line">    def tearDownClass(cls) -&gt; None:</span><br><span class="line">    print(&#x27;------å…³é—­æµè§ˆå™¨&#x27;)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    # ä»¥ä¸‹æ˜¯ä½¿è¿™ä¸¤ä¸ªå‡½æ•°å¿…é¡»åœ¨æµ‹è¯•å‡½æ•°Case1å’ŒCaseçš„æŒ‡å®šæ—¶é—´è¿è¡Œï¼Œå®ƒä¼šåœ¨æ¯ä¸ªæ–¹æ³•æ‰§è¡Œå‰åå»æ‰§è¡Œè¯¥æ“ä½œ</span><br><span class="line">    # æ¯ä¸ªæµ‹è¯•æ–¹æ³•æ‰§è¡Œä¹‹å‰éƒ½ä¼šå…ˆè°ƒç”¨çš„æ–¹æ³•ï¼Œå‡½æ•°åç§°å¿…é¡»è¿™ä¹ˆå†™</span><br><span class="line">    def setUp(self):</span><br><span class="line">    print(&#x27;è¾“å…¥ç½‘å€......&#x27;)</span><br><span class="line">    # æ¯ä¸ªæµ‹è¯•æ–¹æ³•æ‰§è¡Œä¹‹åéƒ½ä¼šè°ƒç”¨çš„æ–¹æ³•</span><br><span class="line">    def tearDown(self) -&gt; None:</span><br><span class="line">    print(&#x27;å…³é—­å½“å‰é¡µé¢......&#x27;)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    # ä»¥ä¸‹æ˜¯ä¸¤ä¸ªæµ‹è¯•çš„ä¾‹å­</span><br><span class="line">    # æµ‹è¯•Case1</span><br><span class="line">    def test_1(self):</span><br><span class="line">    print(&#x27;è¾“å…¥æ­£ç¡®ç”¨æˆ·åå¯†ç éªŒè¯ç ,ç‚¹å‡»ç™»å½• 1&#x27;)</span><br><span class="line"># æµ‹è¯•Case2</span><br><span class="line">    def test_2(self):</span><br><span class="line">    print(&#x27;è¾“å…¥é”™è¯¯ç”¨æˆ·åå¯†ç éªŒè¯ç ,ç‚¹å‡»ç™»å½• 2&#x27;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li><p>Fixtrueè‡ªå®šä¹‰æ–¹æ³•</p><p><a href="https://blog.csdn.net/qq_45609369/article/details/140007322%EF%BC%8C%E5%94%89%EF%BC%8C%E4%B8%8D%E6%83%B3%E7%9C%8B%E4%BA%86%EF%BC%8C%E5%9B%9E%E5%AE%B6">https://blog.csdn.net/qq_45609369/article/details/140007322ï¼Œå”‰ï¼Œä¸æƒ³çœ‹äº†ï¼Œå›å®¶</a></p></li></ol><h4 id="æ‰§è¡Œ">æ‰§è¡Œ</h4><p>åªéœ€é‡‡ç”¨ skip æˆ– skipif æ–¹æ³•æ¥æŒ‡å®šå‚æ•°å¹¶è´´åœ¨æ–¹æ³•ä¸Šå³å¯è·³è¿‡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># -vsï¼š -vè¾“å‡ºè¯¦ç»†ä¿¡æ¯ -sè¾“å‡ºè°ƒè¯•ä¿¡æ¯</span><br><span class="line">pytest -vs</span><br><span class="line"></span><br><span class="line"># -nï¼š å¤šçº¿ç¨‹è¿è¡Œï¼ˆå‰æå®‰è£…æ’ä»¶ï¼špytest-xdistï¼‰</span><br><span class="line">pytest -vs -n=2</span><br><span class="line"></span><br><span class="line"># --reruns num: å¤±è´¥é‡è·‘ï¼ˆå‰æå®‰è£…æ’ä»¶ï¼špytest-rerunfailresï¼‰</span><br><span class="line">pytest -vs --reruns=2</span><br><span class="line"></span><br><span class="line"># -x: å‡ºç°ä¸€ä¸ªç”¨ä¾‹å¤±è´¥åˆ™åœæ­¢æµ‹è¯•</span><br><span class="line">pytest -vs -x</span><br><span class="line"></span><br><span class="line"># --maxfail: å‡ºç°å‡ ä¸ªå¤±è´¥æ‰ç»ˆæ­¢</span><br><span class="line">pytest -vs --maxfail=2</span><br><span class="line"></span><br><span class="line"># --html: ç”Ÿæˆhtmlçš„æµ‹è¯•æŠ¥å‘Š,åé¢ éœ€è¦è·Ÿä¸Šæ‰€åˆ›å»ºçš„æ–‡ä»¶ä½ç½®åŠæ–‡ä»¶åç§°ï¼ˆå‰æå®‰è£…æ’ä»¶ï¼špytest-htmlï¼‰</span><br><span class="line">pytest -vs --html ./reports/result.html</span><br><span class="line"></span><br><span class="line"># -kï¼š è¿è¡Œæµ‹è¯•ç”¨ä¾‹åç§°ä¸­åŒ…å«æŸä¸ªå­—ç¬¦ä¸²çš„æµ‹è¯•ç”¨ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨orè¡¨ç¤ºæˆ–è€…ï¼Œé‡‡ç”¨andè¡¨ç¤ºéƒ½</span><br><span class="line">pytest -vs -k &quot;qiuluo&quot;</span><br><span class="line">pytest -vs -k &quot;qiuluo or weiliang&quot;</span><br><span class="line">pytest -vs -k &quot;qiuluo and weiliang&quot;</span><br><span class="line"></span><br><span class="line"># -mï¼šå†’çƒŸç”¨ä¾‹æ‰§è¡Œï¼Œåé¢éœ€è¦è·Ÿä¸€ä¸ªå†’çƒŸåç§°ï¼Œæ‰§è¡Œuser_manageè¿™ä¸ªåˆ†ç»„</span><br><span class="line">pytest -vs -m user_manage</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="pytest-mark-parametrize">@pytest.mark.parametrize</h4><p>Pytestå‚æ•°åŒ–æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ol><li>@pytest.fixture(<a href="https://so.csdn.net/so/search?q=params&amp;spm=1001.2101.3001.7020">params</a>=[])</li><li>@pytest.mark.parametrize()ï¼Œ@pytest.mark.parametrize()ä½¿ç”¨æ–¹æ³•æ›´ä¸°å¯Œä¸€äº›</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@pytest.mark.parametrize(self,argnames, argvalues, indirect=False, ids=None, scope=None))ï¼š</span><br><span class="line">argnames å¿…ä¼ ï¼Œå‚æ•°å, ä»¥é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²,è¡¨ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°åç§°(key),æˆ–å‚æ•°å­—ç¬¦ä¸²çš„åˆ—è¡¨/å…ƒç»„</span><br><span class="line">argvalues å¿…ä¼ ï¼Œå‚æ•°å€¼ï¼Œè‹¥argnamesæœ‰ä¸€ä¸ªåˆšå•å€¼åˆ—è¡¨ä¼ å…¥ï¼Œè‹¥argnamesæœ‰å¤šä¸ªï¼Œä»¥å¥—ç”¨å…ƒç»„çš„åˆ—è¡¨å±•ç¤ºï¼Œæ— ç»„å†…ä¸å‚æ•°åä¸€ä¸€å¯¹åº”</span><br><span class="line">indirect ä¸ºtrueæ—¶ï¼Œé‚£argnamesä¸€å®šæ˜¯ä¸€ä¸ªfixtureå‡½æ•°åç§°ï¼Œargvalueså€¼å°†ä¼ å…¥å¯¹åº”çš„fixtureå†…ï¼Œç›¸å½“äº@pytest.fixture(params=)çš„ç”¨æ³•ï¼Œé»˜è®¤False</span><br><span class="line">ids æ ‡è®°å­ç”¨ä¾‹æ‰§è¡Œåç§°ï¼Œä¸argvaluesæ•°é‡ä¸€è‡´ï¼ŒæœªæŒ‡å®šè‡ªåŠ¨ç”Ÿæˆ,é»˜è®¤None</span><br><span class="line">scope å¦‚æœæŒ‡å®šï¼Œåˆ™è¡¨ç¤ºå‚æ•°çš„èŒƒå›´ã€‚èŒƒå›´ç”¨äºæŒ‰å‚æ•°å®ä¾‹å¯¹æµ‹è¯•è¿›è¡Œåˆ†ç»„</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¿«é€Ÿå…¥é—¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1ã€å•ä¸ªå‚æ•°ã€æµ‹è¯•æ–¹æ³•å…¥å‚åªæœ‰ä¸€ä¸ªå‚æ•°ã€‘</span></span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;a&quot;</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span>)    </span><span class="comment"># å‚æ•°aè¢«èµ‹äºˆ3ä¸ªå€¼ï¼Œtest_aå°†ä¼šè¿è¡Œ3é</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_a</span>(<span class="params">self, a</span>):    <span class="comment"># å‚æ•°å¿…é¡»å’Œparametrizeé‡Œé¢çš„å‚æ•°ä¸€è‡´</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n------------------&gt; test_a has ran, and a = &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(a))</span><br><span class="line">    <span class="keyword">assert</span> <span class="number">1</span> == a <span class="comment"># ä¸æ˜¯1å°±ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pytest.main([<span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;test_parametrize.py&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2ã€å¤šä¸ªå‚æ•°ã€æµ‹è¯•æ–¹æ³•å…¥å‚æœ‰å¤šä¸ªå‚æ•°ã€‘</span></span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test_D</span>:</span><br><span class="line"><span class="meta">    @pytest.mark.parametrize(<span class="params"><span class="string">&quot;a,b&quot;</span>, [(<span class="params"><span class="number">1</span>, <span class="number">2</span></span>), (<span class="params"><span class="number">2</span>, <span class="number">3</span></span>), (<span class="params"><span class="number">3</span>, <span class="number">4</span></span>)]</span>)    </span><span class="comment"># å‚æ•°a,bå‡è¢«èµ‹äºˆä¸‰ä¸ªå€¼ï¼Œå‡½æ•°ä¼šè¿è¡Œä¸‰é</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_b</span>(<span class="params">self, a, b</span>):    <span class="comment"># å‚æ•°å¿…é¡»å’Œparametrizeé‡Œé¢çš„å‚æ•°ä¸€è‡´</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;\n------------------&gt; test_b has ran, and a = &#123;&#125;, b = &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(a, b))</span><br><span class="line">        <span class="keyword">assert</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pytest.main([<span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;test_parametrize.py&#x27;</span>])       </span><br><span class="line"></span><br><span class="line"><span class="comment"># 3ã€åˆ©ç”¨å‡½æ•°çš„è¿”å›å€¼è¿›è¡Œç”¨ä¾‹å‚æ•°åŒ–file_name: test_parametrize.py</span></span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">return_test_data</span>():<span class="comment"># å®šä¹‰è¿”å›å‚æ•°å€¼çš„å‡½æ•°</span></span><br><span class="line">    <span class="keyword">return</span> [(<span class="number">1</span>, <span class="number">2</span>), (<span class="number">2</span>, <span class="number">3</span>), (<span class="number">3</span>, <span class="number">4</span>)]</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test_D</span>:</span><br><span class="line"><span class="meta">    @pytest.mark.parametrize(<span class="params"><span class="string">&quot;a,b&quot;</span>, return_test_data(<span class="params"></span>)</span>)    </span><span class="comment"># ä½¿ç”¨å‡½æ•°è¿”å›å€¼çš„æ–¹å¼ä¼ å…¥å‚æ•°å€¼</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_c</span>(<span class="params">self, a, b</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;\n------------------&gt; test_c has ran, and a = &#123;&#125;, b = &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(a, b))</span><br><span class="line">        <span class="keyword">assert</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pytest.main([<span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;test_parametrize.py&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4ã€å †å ä½¿ç”¨å‚æ•°åŒ–è£…é¥°å™¨ file_name: test_parametrize.py</span></span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test_D</span>:</span><br><span class="line"><span class="meta">    @pytest.mark.parametrize(<span class="params"><span class="string">&quot;x&quot;</span>, [<span class="number">1</span>, <span class="number">2</span>]</span>)</span></span><br><span class="line"><span class="meta">    @pytest.mark.parametrize(<span class="params"><span class="string">&quot;y&quot;</span>, [<span class="number">3</span>, <span class="number">4</span>]</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_d</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n------------------&gt; test_d has ran, and x=&#123;&#125;, y=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(x, y))</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pytest.main([<span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;test_parametrize.py&#x27;</span>])</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ç¨‹åº">ç¨‹åº</h2><p>æŸ¥é˜…<a href="https://www.mindspore.cn/docs/zh-CN/master/note/api_mapping/pytorch_api_mapping.html">APIå¯¹åº”è¡¨</a></p><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td>mindspore.mint.div</td><td><a href="https://pytorch.org/docs/2.1/generated/torch.div.html">torch.div</a></td><td>é€å…ƒç´ è®¡ç®— input é™¤ä»¥ other çš„å•†ã€‚</td></tr><tr><td>mindspore.mint.divide</td><td><a href="https://pytorch.org/docs/2.1/generated/torch.divide.html">torch.divide</a></td><td><a href="https://www.mindspore.cn/docs/zh-CN/master/api_python/mint/mindspore.mint.div.html#mindspore.mint.div"><code>mindspore.mint.div()</code></a> çš„åˆ«åã€‚é‚£å°±åªéœ€è¦å†™ä¸€ä¸ª</td></tr><tr><td>mindspore.mint.erf</td><td><a href="https://pytorch.org/docs/2.1/generated/torch.erf.html">torch.erf</a></td><td>é€å…ƒç´ è®¡ç®— input çš„é«˜æ–¯è¯¯å·®</td></tr><tr><td>mindspore.mint.erfc</td><td><a href="https://pytorch.org/docs/2.1/generated/torch.erfc.html">torch.erfc</a></td><td>é€å…ƒç´ è®¡ç®— input çš„äº’è¡¥è¯¯å·®å‡½æ•°</td></tr><tr><td>mindspore.mint.erfinv</td><td><a href="https://pytorch.org/docs/2.1/generated/torch.erfinv.html">torch.erfinv</a></td><td>è®¡ç®—è¾“å…¥çš„é€†è¯¯å·®å‡½æ•°ã€‚</td></tr></tbody></table><p>æ³¨æ„ï¼šä»»åŠ¡bå®é™…ä¸Šæµ‹è¯•çš„æ˜¯é™¤äº†è®¡ç®—å‚æ•°ä¹‹å¤–çš„è®¾å®šï¼Œæ¯”å¦‚divå‡½æ•°çš„roundingå‚æ•°ï¼Œå¦‚æœæ²¡æœ‰å¤šä½™å‚æ•°å¯ä»¥ä¸æµ‹è¯•</p><h3 id="ä»»åŠ¡a">ä»»åŠ¡a</h3><ol><li>æŸ¥APIæ”¯æŒçš„æ•°æ®ç±»å‹ï¼Œå¦‚mindspore.mint.erfæ ‡æ³¨æ”¯æŒæ•°æ®ç±»å‹ï¼šAscendï¼š float16ã€float32ã€float64ã€int64ã€boolã€bfloat16ã€‚åˆ™è®¾ç½®åœ¨ä¸¤ç§æ¨¡å¼ä¸‹åˆ†åˆ«è¿›è¡Œè®¡ç®—ã€‚</li><li>å¦‚æœæ”¯æŒè¿™ä¸ªå‚æ•°åˆ™è·³è¿‡ï¼Œä¸æ”¯æŒåˆ™æ‰“å°</li><li>å¦‚æœä¸¤ä¸ªæ¡†æ¶éƒ½æ”¯æŒè¿™ä¸ªç±»å‹çš„å‚æ•°åˆ™æ¯”è¾ƒä¸¤ä¸ªè®¡ç®—ç»“æœæ˜¯å¦ç›¸åŒ</li></ol><h3 id="ä»»åŠ¡b">ä»»åŠ¡b</h3><ol><li>è®¾ç½®ç±»å‹ä¸ºå¸¸è§çš„float32ï¼Œä½†æ˜¯è¾“å…¥çš„tensorå¤§å°ç»™å‡ºå¤šç§ï¼Œç„¶ååˆ›å»ºéšæœºtensorï¼Œæ³¨æ„erfinvçš„æ•°æ®è¦åœ¨-1åˆ°1ä¹‹é—´ï¼Œåœ¨ä¸¤ç§æ¨¡å¼ä¸‹åˆ†åˆ«è¿›è¡Œè®¡ç®—ã€‚</li><li>å¦‚æœè¯¥æ¨¡å¼ä¸‹çš„è®¡ç®—ç»“æœå’Œtorchçš„ç›¸åŒåˆ™è·³è¿‡ï¼Œä¸ç›¸åŒåˆ™æ‰“å°</li></ol><h3 id="ä»»åŠ¡c">ä»»åŠ¡c</h3><ol><li>é’ˆå¯¹æ¯”å¦‚divå‡½æ•°éœ€è¦roundingå‚æ•°ï¼Œ    parameters = [None, â€œtruncâ€, â€œfloorâ€]ï¼Œåˆ†åˆ«ä¼ å…¥è¿™ä¸ªå‚æ•°ï¼Œç„¶åå’Œä»»åŠ¡bä¸€æ ·è¿›è¡Œè®¡ç®—ã€‚</li><li>å¦‚æœè¯¥æ¨¡å¼ä¸‹çš„è®¡ç®—ç»“æœå’Œtorchçš„ç›¸åŒåˆ™è·³è¿‡ï¼Œä¸ç›¸åŒåˆ™æ‰“å°</li></ol><h3 id="ä»»åŠ¡d">ä»»åŠ¡d</h3><ol><li>åœ¨APIé¡µé¢å«æœ‰æŠ¥é”™æŠ›å‡ºä¿¡æ¯ï¼Œè¿›è¡Œæµ‹è¯•æ¯”å¦‚mindspore.mint.erfï¼Œå¼‚å¸¸ä¸º<ul><li><strong>TypeError</strong> - input ä¸æ˜¯Tensorã€‚</li><li><strong>TypeError</strong> -Ascend: å¦‚æœ input çš„æ•°æ®ç±»å‹ä¸æ˜¯float16ã€float32ã€float64ã€int64ã€boolã€bfloat16ã€‚</li></ul></li></ol><h3 id="ä»»åŠ¡2">ä»»åŠ¡2</h3><p>å›ºå®šä¸€ä¸ªå°ºå¯¸å›ºå®šæ•°æ®çš„tensorï¼Œè®¡ç®—æ­£å‘ä¼ æ’­å’Œæ¢¯åº¦ï¼Œè¿›è¡Œå¯¹æ¯”</p><h2 id="æœåŠ¡å™¨ä½¿ç”¨">æœåŠ¡å™¨ä½¿ç”¨</h2><p>å¯æ™ºç¤¾åŒºæ³¨å†Œè´¦å·ï¼Œå»ºç«‹é¡¹ç›®ï¼Œç„¶åå»ºç«‹ä¸€ä¸ªç¯å¢ƒï¼Œç¯å¢ƒé€‰æ‹©Acend910bï¼Œé•œåƒé€‰æ‹©ä¸ºmindtorch0.3_mindspore2.3.0_torchnpu2.2.0_cann8.0ï¼Œä¸Šä¼ ä»£ç ï¼Œä»£ç ä¼šé»˜è®¤å‹ç¼©å®‰æ”¾åœ¨/tmp/code/master.zipï¼Œé¦–å…ˆéœ€è¦è§£å‹ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">unzip master.zip</span><br><span class="line"><span class="comment"># æ¯æ¬¡æ‰“å¼€ç»ˆç«¯å®‰è£…ç¯å¢ƒ</span></span><br><span class="line">pip install pytest</span><br><span class="line">pip install torch==2.6</span><br><span class="line">pip install mindspore==2.4</span><br><span class="line"><span class="comment"># ç„¶åéœ€è¦è§£å†³ä¸€ä¸ªæŠ¥é”™ï¼Œæ³¨æ„è¿™ä¸ªlibgompæ¯æ¬¡æ‰“å¼€ç»ˆç«¯åé¢çš„ç‰ˆæœ¬å·å¯èƒ½ä¸åŒ</span></span><br><span class="line"><span class="built_in">export</span> LD_PRELOAD=<span class="variable">$LD_PRELOAD</span>:/home/ma-user/anaconda3/envs/MindSpore/lib/python3.9/site-packages/torch.libs/libgomp-74ff64e9.so.1.0.0 </span><br><span class="line"><span class="comment"># æ³¨æ„æ¯æ¬¡åˆ›å»ºä¸€ä¸ªç»ˆç«¯éƒ½éœ€å®‰è£…ç¯å¢ƒ</span></span><br><span class="line"><span class="comment"># ç„¶åè¿è¡Œè„šæœ¬ï¼Œä¿å­˜æ—¥å¿—</span></span><br><span class="line">pytest -vs test_div.py&gt;test_div.txt</span><br><span class="line"><span class="comment"># æŠŠæ—¥å¿—dowloadä¸‹æ¥çœ‹ï¼Œå› ä¸ºè¿™ä¸ªå¯æ™ºç¤¾åŒºçš„ç½‘ç»œè¿æ¥æ˜¯çœŸçš„çƒ‚</span></span><br></pre></td></tr></table></figure><h2 id="ç»“æœ">ç»“æœ</h2><h3 id="div">div</h3><p>ç¯å¢ƒä¿¡æ¯ï¼š</p><p>ç¡¬ä»¶ï¼š æ–°ç–†å¤§å­¦æ™ºç®—ä¸­å¿ƒNPU: 1*Ascend-D910B(æ˜¾å­˜: 32GB), CPU: 20, å†…å­˜: 60GB</p><p>é•œåƒï¼šmindtorch0.3_mindspore2.3.0_torchnpu2.2.0_cann8.0</p><p>å‘½ä»¤è¡Œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¯æ¬¡æ‰“å¼€ç»ˆç«¯å®‰è£…ç¯å¢ƒ</span></span><br><span class="line">pip install pytest</span><br><span class="line">pip install torch==2.6</span><br><span class="line">pip install mindspore==2.4</span><br><span class="line"><span class="comment"># ç„¶åéœ€è¦è§£å†³ä¸€ä¸ªæŠ¥é”™ï¼Œæ³¨æ„è¿™ä¸ªlibgompæ¯æ¬¡æ‰“å¼€ç»ˆç«¯åé¢çš„ç‰ˆæœ¬å·å¯èƒ½ä¸åŒ</span></span><br><span class="line"><span class="built_in">export</span> LD_PRELOAD=<span class="variable">$LD_PRELOAD</span>:/home/ma-user/anaconda3/envs/MindSpore/lib/python3.9/site-packages/torch.libs/libgomp-74ff64e9.so.1.0.0 </span><br></pre></td></tr></table></figure><ol><li>ç±»å‹æ”¯æŒæµ‹è¯•ï¼ŒAPIæœªç¼–å†™æ”¯æŒç±»å‹ï¼Œä½†æ˜¯ä¸æ”¯æŒUInt16ï¼ŒUInt32ï¼ŒUInt64ï¼ŒBFloat16</li></ol><table><thead><tr><th>ç¯å¢ƒ</th><th>ä¸æ”¯æŒçš„æ•°æ®ç±»å‹</th><th>æ”¯æŒçš„æ•°æ®ç±»å‹</th><th>é”™è¯¯</th></tr></thead><tbody><tr><td>mindspore (GRAPH_MODE)</td><td>UInt16<br/>UInt32<br/>UInt64<br/>BFloat16</td><td>ms.int8, ms.int16, ms.int32, ms.int64, ms.uint8,ms.float16, ms.float32, ms.float64, ms.bool_</td><td></td></tr><tr><td>mindspore(PYNATIVE_MODE)</td><td>UInt16<br/>UInt32<br/>UInt64<br/>BFloat16</td><td>ms.int8, ms.int16, ms.int32, ms.int64, ms.uint8,ms.float16, ms.float32, ms.float64, ms.bool_</td><td></td></tr><tr><td>torch</td><td>torch.bfloat16</td><td>torch.int8, torch.int16, torch.int32, torch.int64, torch.uint8, torch.uint16, torch.uint32, torch.uint64, torch.float16, torch.float32, torch.float64, torch.bool</td><td></td></tr></tbody></table><ol start="2"><li>è®¡ç®—æµ‹è¯•ï¼Œé€šè¿‡</li></ol><p>test_div.py::test_div_random_input_fixed_dtype[0] PASSED<br>test_div.py::test_div_random_input_fixed_dtype[1] PASSED</p><ol start="3"><li><p>å‚æ•°è¾“å…¥</p><table><thead><tr><th>æ¨¡å¼</th><th>å‚æ•°</th><th>è®¡ç®—ç»“æœæ˜¯å¦é€šè¿‡</th></tr></thead><tbody><tr><td>GRAPH_MODE</td><td>None</td><td>é€šè¿‡</td></tr><tr><td></td><td>trunc</td><td>é€šè¿‡</td></tr><tr><td></td><td>floor</td><td>é€šè¿‡</td></tr><tr><td>GRAPH_MODE</td><td>None</td><td>é€šè¿‡</td></tr><tr><td></td><td>trunc</td><td>é€šè¿‡</td></tr><tr><td></td><td>floor</td><td>é€šè¿‡</td></tr></tbody></table></li><li><p>æŠ¥é”™æµ‹è¯•</p><p>å‡é€šè¿‡</p></li><li><p>æ¢¯åº¦æµ‹è¯•</p><p>å‡é€šè¿‡</p></li></ol><h3 id="divide">divide</h3><p>ç¯å¢ƒä¿¡æ¯ï¼š</p><p>ç¡¬ä»¶ï¼š æ–°ç–†å¤§å­¦æ™ºç®—ä¸­å¿ƒNPU: 1*Ascend-D910B(æ˜¾å­˜: 32GB), CPU: 20, å†…å­˜: 60GB</p><p>é•œåƒï¼šmindtorch0.3_mindspore2.3.0_torchnpu2.2.0_cann8.0</p><p>å‘½ä»¤è¡Œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¯æ¬¡æ‰“å¼€ç»ˆç«¯å®‰è£…ç¯å¢ƒ</span></span><br><span class="line">pip install pytest</span><br><span class="line">pip install torch==2.6</span><br><span class="line">pip install mindspore==2.4</span><br><span class="line"><span class="comment"># ç„¶åéœ€è¦è§£å†³ä¸€ä¸ªæŠ¥é”™ï¼Œæ³¨æ„è¿™ä¸ªlibgompæ¯æ¬¡æ‰“å¼€ç»ˆç«¯åé¢çš„ç‰ˆæœ¬å·å¯èƒ½ä¸åŒ</span></span><br><span class="line"><span class="built_in">export</span> LD_PRELOAD=<span class="variable">$LD_PRELOAD</span>:/home/ma-user/anaconda3/envs/MindSpore/lib/python3.9/site-packages/torch.libs/libgomp-74ff64e9.so.1.0.0 </span><br></pre></td></tr></table></figure><ol><li>ç±»å‹æ”¯æŒæµ‹è¯•ï¼ŒAPIæœªç¼–å†™æ”¯æŒç±»å‹ï¼Œä½†æ˜¯ä¸æ”¯æŒUInt16ï¼ŒUInt32ï¼ŒUInt64ï¼ŒBFloat16</li></ol><table><thead><tr><th>ç¯å¢ƒ</th><th>ä¸æ”¯æŒçš„æ•°æ®ç±»å‹</th><th>æ”¯æŒçš„æ•°æ®ç±»å‹</th><th>é”™è¯¯</th></tr></thead><tbody><tr><td>mindspore (GRAPH_MODE)</td><td>UInt16<br/>UInt32<br/>UInt64<br/>BFloat16</td><td>ms.int8, ms.int16, ms.int32, ms.int64, ms.uint8,ms.float16, ms.float32, ms.float64, ms.bool_</td><td></td></tr><tr><td>mindspore(PYNATIVE_MODE)</td><td>UInt16<br/>UInt32<br/>UInt64<br/>BFloat16</td><td>ms.int8, ms.int16, ms.int32, ms.int64, ms.uint8,ms.float16, ms.float32, ms.float64, ms.bool_</td><td></td></tr><tr><td>torch</td><td>torch.bfloat16</td><td>torch.int8, torch.int16, torch.int32, torch.int64, torch.uint8, torch.uint16, torch.uint32, torch.uint64, torch.float16, torch.float32, torch.float64, torch.bool</td><td></td></tr></tbody></table><ol start="2"><li>è®¡ç®—æµ‹è¯•ï¼Œé€šè¿‡</li></ol><p>test_div.py::test_divide_random_input_fixed_dtype[0] PASSED<br>test_div.py::test_divide_random_input_fixed_dtype[1] PASSED</p><ol start="3"><li><p>å‚æ•°è¾“å…¥</p><table><thead><tr><th>æ¨¡å¼</th><th>å‚æ•°</th><th>è®¡ç®—ç»“æœæ˜¯å¦é€šè¿‡</th></tr></thead><tbody><tr><td>GRAPH_MODE</td><td>None</td><td>é€šè¿‡</td></tr><tr><td></td><td>trunc</td><td>é€šè¿‡</td></tr><tr><td></td><td>floor</td><td>é€šè¿‡</td></tr><tr><td>GRAPH_MODE</td><td>None</td><td>é€šè¿‡</td></tr><tr><td></td><td>trunc</td><td>é€šè¿‡</td></tr><tr><td></td><td>floor</td><td>é€šè¿‡</td></tr></tbody></table></li><li><p>æŠ¥é”™æµ‹è¯•</p><p>å‡é€šè¿‡</p></li><li><p>æ¢¯åº¦æµ‹è¯•</p><p>å‡é€šè¿‡</p></li></ol><h3 id="erf">erf</h3><p>ç¯å¢ƒä¿¡æ¯ï¼š</p><p>ç¡¬ä»¶ï¼š æ–°ç–†å¤§å­¦æ™ºç®—ä¸­å¿ƒNPU: 1*Ascend-D910B(æ˜¾å­˜: 32GB), CPU: 20, å†…å­˜: 60GB</p><p>é•œåƒï¼šmindtorch0.3_mindspore2.3.0_torchnpu2.2.0_cann8.0</p><p>å‘½ä»¤è¡Œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¯æ¬¡æ‰“å¼€ç»ˆç«¯å®‰è£…ç¯å¢ƒ</span></span><br><span class="line">pip install pytest</span><br><span class="line">pip install torch==2.6</span><br><span class="line">pip install mindspore==2.4</span><br><span class="line"><span class="comment"># ç„¶åéœ€è¦è§£å†³ä¸€ä¸ªæŠ¥é”™ï¼Œæ³¨æ„è¿™ä¸ªlibgompæ¯æ¬¡æ‰“å¼€ç»ˆç«¯åé¢çš„ç‰ˆæœ¬å·å¯èƒ½ä¸åŒ</span></span><br><span class="line"><span class="built_in">export</span> LD_PRELOAD=<span class="variable">$LD_PRELOAD</span>:/home/ma-user/anaconda3/envs/MindSpore/lib/python3.9/site-packages/torch.libs/libgomp-74ff64e9.so.1.0.0 </span><br></pre></td></tr></table></figure><ol><li>ç±»å‹æ”¯æŒæµ‹è¯•ï¼Œä¸é€šè¿‡ï¼Œéœ€è¦æ”¯æŒ BFloat16</li></ol><table><thead><tr><th>ç¯å¢ƒ</th><th>ä¸æ”¯æŒçš„æ•°æ®ç±»å‹</th><th>æ”¯æŒçš„æ•°æ®ç±»å‹</th><th>é”™è¯¯</th></tr></thead><tbody><tr><td>mindspore (GRAPH_MODE)</td><td>BFloat16</td><td>ms.float16, ms.float32, ms.float64, ms.int64, ms.bool_, ms.bfloat16</td><td>Float32,Int64,Boolå’Œtorchçš„è®¡ç®—ç»“æœä¸åŒ</td></tr><tr><td>mindspore(PYNATIVE_MODE)</td><td>BFloat16</td><td>ms.float16, ms.float32, ms.float64, ms.int64, ms.bool_, ms.bfloat16</td><td>Float32,Int64,Boolå’Œtorchçš„è®¡ç®—ç»“æœä¸åŒ</td></tr><tr><td>torch</td><td>torch.bfloat16</td><td>torch.float16, torch.float32, torch.float64, torch.int64, torch.bool, torch.bfloat16</td><td></td></tr></tbody></table><ol start="2"><li><p>è®¡ç®—æµ‹è¯•</p><ol><li><p>æµ‹è¯•ç»„ï¼Œå°æ•°ç‚¹å5ä½ä¸åŒï¼Œä¸çŸ¥é“æ˜¯å¦ç®—æµ‹è¯•é€šè¿‡</p><p>input_data: [-0.37975368 -0.34422294 -1.42222966 -1.04481118  0.95105012]<br>ms_result: [-0.4087475  -0.37358218 -0.9556926  -0.860494    0.8213899 ]<br>torch_result: [-0.408769   -0.37360325 -0.95571023 -0.8604813   0.8213707 ]</p></li><li><p>æµ‹è¯•ç»„ï¼Œå°æ•°ç‚¹å5ä½ä¸åŒ<br>input_data: [ 2.22057531 -1.10386126 -0.54387706  0.14834316  1.51924453]<br>ms_result: [ 0.99830514 -0.8815062  -0.5581943   0.16617936  0.96830803]<br>torch_result: [ 0.99831253 -0.88149875 -0.5582007   0.16616759  0.96832895]</p></li></ol></li><li><p>å‚æ•°è¾“å…¥</p><p>æ— å‚æ•°è®¾ç½®ï¼Œå‡é€šè¿‡</p></li><li><p>æŠ¥é”™æµ‹è¯•</p><p>å‡é€šè¿‡</p></li><li><p>æ¢¯åº¦æµ‹è¯•</p><p>å‡é€šè¿‡</p></li></ol><h3 id="erfc">erfc</h3><p>ç¯å¢ƒä¿¡æ¯ï¼š</p><p>ç¡¬ä»¶ï¼š æ–°ç–†å¤§å­¦æ™ºç®—ä¸­å¿ƒNPU: 1*Ascend-D910B(æ˜¾å­˜: 32GB), CPU: 20, å†…å­˜: 60GB</p><p>é•œåƒï¼šmindtorch0.3_mindspore2.3.0_torchnpu2.2.0_cann8.0</p><p>å‘½ä»¤è¡Œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¯æ¬¡æ‰“å¼€ç»ˆç«¯å®‰è£…ç¯å¢ƒ</span></span><br><span class="line">pip install pytest</span><br><span class="line">pip install torch==2.6</span><br><span class="line">pip install mindspore==2.4</span><br><span class="line"><span class="comment"># ç„¶åéœ€è¦è§£å†³ä¸€ä¸ªæŠ¥é”™ï¼Œæ³¨æ„è¿™ä¸ªlibgompæ¯æ¬¡æ‰“å¼€ç»ˆç«¯åé¢çš„ç‰ˆæœ¬å·å¯èƒ½ä¸åŒ</span></span><br><span class="line"><span class="built_in">export</span> LD_PRELOAD=<span class="variable">$LD_PRELOAD</span>:/home/ma-user/anaconda3/envs/MindSpore/lib/python3.9/site-packages/torch.libs/libgomp-74ff64e9.so.1.0.0 </span><br></pre></td></tr></table></figure><ol><li>ç±»å‹æ”¯æŒæµ‹è¯•ï¼Œä¸é€šè¿‡ï¼Œéœ€è¦æ”¯æŒ BFloat16</li></ol><table><thead><tr><th>ç¯å¢ƒ</th><th>ä¸æ”¯æŒçš„æ•°æ®ç±»å‹</th><th>æ”¯æŒçš„æ•°æ®ç±»å‹</th><th>é”™è¯¯</th></tr></thead><tbody><tr><td>mindspore (GRAPH_MODE)</td><td>BFloat16</td><td>ms.float16, ms.float32, ms.float64, ms.int64, ms.bool_, ms.bfloat16</td><td>Float32,Int64,Boolå’Œtorchçš„è®¡ç®—ç»“æœä¸åŒ</td></tr><tr><td>mindspore(PYNATIVE_MODE)</td><td>BFloat16</td><td>ms.float16, ms.float32, ms.float64, ms.int64, ms.bool_, ms.bfloat16</td><td>Float32,Int64,Boolå’Œtorchçš„è®¡ç®—ç»“æœä¸åŒ</td></tr><tr><td>torch</td><td>torch.bfloat16</td><td>torch.float16, torch.float32, torch.float64, torch.int64, torch.bool, torch.bfloat16</td><td></td></tr></tbody></table><ol start="2"><li><p>è®¡ç®—æµ‹è¯•</p><ol><li><p>æµ‹è¯•ç»„ï¼Œå°æ•°ç‚¹å5ä½ä¸åŒï¼Œä¸çŸ¥é“æ˜¯å¦ç®—æµ‹è¯•é€šè¿‡</p><p>input_data: [ 0.55593791  0.44808426 -2.71790637 -0.53732477 -0.45158543]<br>ms_result: [0.43174636 0.5263032  1.9998777  1.5526736  1.4769242 ]<br>torch_result: [0.4317416  0.52628523 1.9998788  1.5526809  1.4769417 ]</p></li><li><p>æµ‹è¯•ç»„ï¼Œå°æ•°ç‚¹å5ä½ä¸åŒ</p><p>input_data: [ 0.53237093 -0.99921068  0.81374149  0.05919775 -0.15359628]<br>ms_result: [0.45152628 1.8423889  0.24979174 0.93325967 1.1719722 ]<br>torch_result: [0.4515183  1.8423729  0.24981277 0.93328047 1.1719615 ]</p></li></ol></li><li><p>å‚æ•°è¾“å…¥</p><p>æ— å‚æ•°è®¾ç½®ï¼Œå‡é€šè¿‡</p></li><li><p>æŠ¥é”™æµ‹è¯•</p><p>å‡é€šè¿‡</p></li><li><p>æ¢¯åº¦æµ‹è¯•</p><p>å‡é€šè¿‡</p></li></ol><h3 id="erfinv">erfinv</h3><p>ç¯å¢ƒä¿¡æ¯ï¼š</p><p>ç¡¬ä»¶ï¼š æ–°ç–†å¤§å­¦æ™ºç®—ä¸­å¿ƒNPU: 1*Ascend-D910B(æ˜¾å­˜: 32GB), CPU: 20, å†…å­˜: 60GB</p><p>é•œåƒï¼šmindtorch0.3_mindspore2.3.0_torchnpu2.2.0_cann8.0</p><p>å‘½ä»¤è¡Œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¯æ¬¡æ‰“å¼€ç»ˆç«¯å®‰è£…ç¯å¢ƒ</span></span><br><span class="line">pip install pytest</span><br><span class="line">pip install torch==2.6</span><br><span class="line">pip install mindspore==2.4</span><br><span class="line"><span class="comment"># ç„¶åéœ€è¦è§£å†³ä¸€ä¸ªæŠ¥é”™ï¼Œæ³¨æ„è¿™ä¸ªlibgompæ¯æ¬¡æ‰“å¼€ç»ˆç«¯åé¢çš„ç‰ˆæœ¬å·å¯èƒ½ä¸åŒ</span></span><br><span class="line"><span class="built_in">export</span> LD_PRELOAD=<span class="variable">$LD_PRELOAD</span>:/home/ma-user/anaconda3/envs/MindSpore/lib/python3.9/site-packages/torch.libs/libgomp-74ff64e9.so.1.0.0 </span><br></pre></td></tr></table></figure><ol><li>ç±»å‹æ”¯æŒæµ‹è¯•ï¼Œé€šè¿‡</li></ol><table><thead><tr><th>ç¯å¢ƒ</th><th>ä¸æ”¯æŒçš„æ•°æ®ç±»å‹</th><th>æ”¯æŒçš„æ•°æ®ç±»å‹</th><th>é”™è¯¯</th></tr></thead><tbody><tr><td>mindspore (GRAPH_MODE)</td><td></td><td>ms.float16, ms.float32, ms.int8, ms.int16,ms.int32, ms.int64, ms.uint8, ms.bool_</td><td></td></tr><tr><td>mindspore(PYNATIVE_MODE)</td><td></td><td>ms.float16, ms.float32, ms.float64, ms.int64, ms.bool_, ms.bfloat16</td><td></td></tr><tr><td>torch</td><td></td><td>torch.float16, torch.float32, torch.int8, torch.int16,torch.int32, torch.int64, torch.uint8, torch.bool</td><td></td></tr></tbody></table><ol start="2"><li><p>è®¡ç®—æµ‹è¯•ï¼Œé€šè¿‡</p><p>åœ¨GRAPHæ¨¡å¼ä¸‹ï¼Œtensorå¤§å°åœ¨ä¸º[4, 6, 7, 8] æ—¶è®¡ç®—ç»“æœä¸torchä¸åŒï¼Œä½†æ˜¯å·®è·å¾ˆå°</p><p>åœ¨PYNATIVEæ¨¡å¼ä¸‹ï¼Œtensorå¤§å°åœ¨[5ï¼Œ4, 3]æ—¶ä¸torchä¸åŒï¼Œä½†æ˜¯å·®è·å¾ˆå°</p><p>input_data: [[[-0.16848439 -0.2019851   0.36715633]<br>[ 0.3096696  -0.11560675  0.91190031]<br>[ 0.94261078  0.95440446 -0.5036123 ]<br>[ 0.95595146 -0.54710461 -0.42151996]]</p><p>[[ 0.69609619  0.33447626 -0.91189684]<br>[-0.44852735  0.45557708  0.03501383]<br>[ 0.2079667   0.10272845 -0.29821255]<br>[-0.17657432  0.57332459  0.78557388]]</p><p>[[-0.92765529  0.46980589 -0.54225893]<br>[ 0.46168587 -0.29652803  0.94215718]<br>[ 0.34109872  0.2191107   0.21868642]<br>[-0.54319334 -0.30351475 -0.53197152]]</p><p>[[ 0.19239459 -0.52627742 -0.80364875]<br>[ 0.8073855   0.70755351  0.08547598]<br>[ 0.3102941  -0.44570836 -0.50435729]<br>[-0.63445313 -0.98493728 -0.24300708]]</p><p>[[-0.57635299 -0.52763846 -0.63903526]<br>[-0.2464637  -0.30461796 -0.35513484]<br>[ 0.66277941  0.006608    0.56438567]<br>[ 0.94051533 -0.03502053 -0.54777088]]]<br>ms_result: [[[-0.15044294 -0.18096098  0.33780497]<br>[ 0.28171614 -0.10281489  1.2059761 ]<br>[ 1.3437392   1.4135892  -0.48096272]<br>[ 1.4238497  -0.53075176 -0.39287293]]</p><p>[[ 0.72697484  0.3056821  -1.205963  ]<br>[-0.42112073  0.4286044   0.03104022]<br>[ 0.18644391  0.09129365 -0.27075744]<br>[-0.15778473  0.5620745   0.8778638 ]]</p><p>[[-1.2706298   0.44385767 -0.5250773 ]<br>[ 0.43512827 -0.26915175  1.3413013 ]<br>[ 0.3121386   0.19668916  0.1962984 ]<br>[-0.52616894 -0.27582082 -0.5131406 ]]</p><p>[[ 0.17219217 -0.50659615 -0.9135943 ]<br>[ 0.92127806  0.74442077  0.07589649]<br>[ 0.28231534 -0.4181416  -0.48179516]<br>[-0.6398228  -1.7188823  -0.21880175]]</p><p>[[-0.56576306 -0.5081564  -0.645962  ]<br>[-0.22201757 -0.2768761  -0.3259106 ]<br>[ 0.67859024  0.00585618  0.55127466]<br>[ 1.3326088  -0.03104615 -0.5315348 ]]]<br>torch_result: [[[-0.15044273 -0.18096067  0.33780485]<br>[ 0.2817161  -0.10281495  1.2059764 ]<br>[ 1.3437395   1.4135904  -0.48096296]<br>[ 1.4238504  -0.530752   -0.39287296]]</p><p>[[ 0.7269749   0.3056819  -1.2059633 ]<br>[-0.42112085  0.42860448  0.03104016]<br>[ 0.18644369  0.09129371 -0.27075735]<br>[-0.1577846   0.5620746   0.87786347]]</p><p>[[-1.2706304   0.44385782 -0.5250774 ]<br>[ 0.4351283  -0.26915163  1.3413019 ]<br>[ 0.3121386   0.19668904  0.19629823]<br>[-0.52616906 -0.2758207  -0.51314074]]</p><p>[[ 0.17219207 -0.50659627 -0.91359407]<br>[ 0.9212778   0.74442065  0.07589659]<br>[ 0.28231534 -0.41814157 -0.48179537]<br>[-0.6398229  -1.7188824  -0.21880147]]</p><p>[[-0.5657633  -0.5081566  -0.6459621 ]<br>[-0.22201732 -0.276876   -0.32591063]<br>[ 0.6785902   0.00585625  0.5512749 ]<br>[ 1.332609   -0.03104611 -0.5315349 ]]]</p></li><li><p>æ— å‚æ•°è®¾ç½®ï¼Œå‡é€šè¿‡</p></li><li><p>æŠ¥é”™æµ‹è¯•</p><p>å‡é€šè¿‡</p></li><li><p>æ¢¯åº¦æµ‹è¯•</p><p>å‡é€šè¿‡</p></li></ol><h2 id="å¦‚ä½•è¿›è¡Œä»»åŠ¡æäº¤">å¦‚ä½•è¿›è¡Œä»»åŠ¡æäº¤</h2><ul><li><p>å“ªé‡Œæœ‰é—®é¢˜ï¼Œå°±åœ¨mindsporeçš„giteeä»“åº“æäº¤issueï¼Œé‡Œé¢æœ‰æ¨¡æ¿ï¼Œéœ€è¦å¡«å†™ç¡¬ä»¶å’Œè½¯ä»¶ä»¥åŠæŠ¥é”™æˆªå›¾ã€‚åŸºæœ¬ä¸Šæ¯ä¸ªå‡½æ•°éƒ½è¦æäº¤ä¸€ä¸ªissue</p></li><li><p>ç„¶ååœ¨mindsporeçš„giteeä»“åº“mindspore-testä»“åº“æäº¤ä¸€ä¸ªpullreuqustï¼Œå†…å®¹å°±æ˜¯æŠŠissueåˆ—è¿›å»ï¼Œç„¶åæŠŠtestæ–‡ä»¶è´´è¿›å»</p><ol><li><p>åœ¨giteeæˆ–è€…githubï¼ŒforkåŸä»“åº“Aåˆ°æˆ‘çš„ä»“åº“Bï¼ˆBæ˜¯Açš„forkç‰ˆæœ¬ï¼‰</p></li><li><p>å°†ä»“åº“B cloneåˆ°æˆ‘æœ¬åœ°ç”µè„‘<br>git clone XXX</p><ol><li><p>kex_exchange_identification: Connection closed by remote host<br>Connection closed by 20.205.243.166 port 22<br>fatal: æ— æ³•è¯»å–è¿œç¨‹ä»“åº“ã€‚</p><p>è¯·ç¡®è®¤æ‚¨æœ‰æ­£ç¡®çš„è®¿é—®æƒé™å¹¶ä¸”ä»“åº“å­˜åœ¨ã€‚</p><ol><li>ä¸´æ—¶å…³é—­ä»£ç†</li></ol><p>è™½ç„¶å…³é—­ä»£ç†æœ€ç®€å•ï¼Œä½†æ˜¯å¯èƒ½ä¼šå¯¼è‡´ä¸‹è½½é€Ÿåº¦è¿‡æ…¢<br>2. ä¿®æ”¹ä»£ç†è½¯ä»¶é…ç½®ï¼Œ22 ç«¯å£èµ°ç›´è¿</p><p>æœ€å®‰å…¨çš„åŠæ³•æ˜¯ä¿®æ”¹ä»£ç†è½¯ä»¶çš„é…ç½®ï¼Œå°† 22 ç«¯å£èµ°ç›´è¿ï¼Œä¸åŒçš„ä»£ç†è½¯ä»¶é…ç½®æ–¹å¼ä¸åŒï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†<br>3. æ”¹ç”¨ HTTPS åè®®ï¼Œèµ° 443 ç«¯å£</p><p>ä¸ªäººæœ€æ¨èçš„åŠæ³•æ˜¯æ”¹ç”¨ HTTPS åè®®ï¼Œèµ° 443 ç«¯å£ï¼Œå› ä¸ºè¿™æ ·ä¸ä»…å¯ä»¥è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œè¿˜å¯ä»¥é€šè¿‡ä»£ç†æé«˜ä¸‹è½½é€Ÿåº¦</p></li></ol></li><li><p>åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œå¦‚bugfix/issue-12ï¼Œè¯¥åˆ†æ”¯ç”¨äºå­˜æ”¾æˆ‘çš„ä»£ç ä¿®æ”¹ã€‚åŒæ—¶åœ¨æˆ‘çš„githubä¸Šçš„ä»“åº“Bä¹Ÿåˆ›å»ºä¸€ä¸ªåŒåçš„è¯¥åˆ†æ”¯</p></li><li><p>åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯bugfix/issue-12ï¼Œä¿®æ”¹ä»£ç <br>git checkout -b bugfix/issue-12</p></li><li><p>ä¿®æ”¹å¥½äº†ï¼Œaddï¼Œcommitï¼Œç„¶åpushåˆ°æˆ‘è¿œç¨‹çš„ä»“åº“Bçš„bugfix/issue-12åˆ†æ”¯<br>git push -u origin bugfix/issue-12</p></li><li><p>åœ¨æˆ‘çš„githubçš„ä»“åº“Bä¸­åˆ›å»ºpull requestã€‚é€‰æ‹©ä»“åº“Bçš„è¯¥åˆ†æ”¯ï¼Œæ¨é€åˆ°åŸä»“åº“Açš„æŸä¸€ä¸ªåˆ†æ”¯ã€‚å…·ä½“æ˜¯å“ªä¸ªåˆ†æ”¯ï¼Œå‚è€ƒä»“åº“Açš„contributingè¯´æ˜ï¼Œä¸€èˆ¬æ˜¯devåˆ†æ”¯ï¼›å¦‚æœæ²¡è¯´ï¼Œå°±åªèƒ½é€‰æ‹©masteråˆ†æ”¯å’¯</p></li></ol></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;mindspore.mintæ¥å£æµ‹è¯•ä»»åŠ¡&lt;/h1&gt;
&lt;h2 id=&quot;ä»»åŠ¡&quot;&gt;ä»»åŠ¡&lt;/h2&gt;
&lt;h3 id=&quot;ä»»åŠ¡èƒŒæ™¯&quot;&gt;ä»»åŠ¡èƒŒæ™¯&lt;/h3&gt;
&lt;p&gt;mindspore.mintæä¾›äº†å¤§é‡çš„functionalã€nnã€ä¼˜åŒ–å™¨æ¥å£ï¼ŒAPIç”¨æ³•åŠåŠŸèƒ½ç­‰ä¸ä¸šç•Œä¸»æµç”¨æ³•ä¸€è‡´ï¼Œæ–¹ä¾¿ç”¨æˆ·</summary>
      
    
    
    
    <category term="æ·±åº¦å­¦ä¹ " scheme="http://outbreak-sen.github.io/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="mindsporeå®ä¹ " scheme="http://outbreak-sen.github.io/tags/mindspore%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="æ·±åº¦å­¦ä¹ " scheme="http://outbreak-sen.github.io/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>æ·±å…¥ç†è§£ BigBird çš„å—ç¨€ç–æ³¨æ„åŠ›</title>
    <link href="http://outbreak-sen.github.io/2025/02/11/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-BigBird-%E7%9A%84%E5%9D%97%E7%A8%80%E7%96%8F%E6%B3%A8%E6%84%8F%E5%8A%9B/"/>
    <id>http://outbreak-sen.github.io/2025/02/11/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-BigBird-%E7%9A%84%E5%9D%97%E7%A8%80%E7%96%8F%E6%B3%A8%E6%84%8F%E5%8A%9B/</id>
    <published>2025-02-11T01:51:43.000Z</published>
    <updated>2025-03-19T09:10:27.313Z</updated>
    
    <content type="html"><![CDATA[<h1>æ·±å…¥ç†è§£ BigBird çš„å—ç¨€ç–æ³¨æ„åŠ›</h1><p><a href="https://github.com/huggingface/blog/blob/main/zh/big-bird.md">æ–‡æ¡£æ¥è‡ª</a></p><h2 id="å¼•è¨€">å¼•è¨€</h2><p>åŸºäº transformer çš„æ¨¡å‹å·²è¢«è¯æ˜å¯¹å¾ˆå¤š NLP ä»»åŠ¡éƒ½éå¸¸æœ‰ç”¨ã€‚ç„¶è€Œï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> çš„æ—¶é—´å’Œå†…å­˜å¤æ‚åº¦ (å…¶ä¸­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> æ˜¯åºåˆ—é•¿åº¦) ä½¿å¾—åœ¨é•¿åºåˆ— (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>&gt;</mo><mn>512</mn></mrow><annotation encoding="application/x-tex">n &gt; 512</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span><span class="mord">1</span><span class="mord">2</span></span></span></span>) ä¸Šåº”ç”¨å®ƒä»¬å˜å¾—éå¸¸æ˜‚è´µï¼Œå› è€Œå¤§å¤§é™åˆ¶äº†å…¶åº”ç”¨ã€‚æœ€è¿‘çš„å‡ ç¯‡è®ºæ–‡ï¼Œå¦‚ <code>Longformer</code> ã€<code>Performer</code> ã€<code>Reformer</code> ã€<code>ç°‡çŠ¶æ³¨æ„åŠ›</code> éƒ½è¯•å›¾é€šè¿‡å¯¹å®Œæ•´æ³¨æ„åŠ›çŸ©é˜µè¿›è¡Œè¿‘ä¼¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¦‚æœä½ ä¸ç†Ÿæ‚‰è¿™äº›æ¨¡å‹ï¼Œå¯ä»¥æŸ¥çœ‹ ğŸ¤— ä¹‹å‰çš„ <a href="https://huggingface.co/blog/zh/long-range-transformers">åšæ–‡</a>ã€‚</p><p><code>BigBird</code> (ç”± <a href="https://arxiv.org/abs/2007.14062">è¯¥è®ºæ–‡</a> å¼•å…¥) æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„æœ€æ–°æ¨¡å‹ä¹‹ä¸€ã€‚ <code>BigBird</code> ä¾èµ–äº <strong>å—ç¨€ç–æ³¨æ„åŠ›</strong> è€Œä¸æ˜¯æ™®é€šæ³¨æ„åŠ› ( <em>å³</em> BERT çš„æ³¨æ„åŠ›)ï¼Œä¸ BERT ç›¸æ¯”ï¼Œè¿™ä¸€æ–°ç®—æ³•èƒ½ä»¥ä½å¾—å¤šçš„è®¡ç®—æˆæœ¬å¤„ç†é•¿è¾¾ <strong>4096</strong> çš„åºåˆ—ã€‚åœ¨æ¶‰åŠå¾ˆé•¿åºåˆ—çš„å„ç§ä»»åŠ¡ä¸Šï¼Œè¯¥æ¨¡å‹éƒ½å®ç°äº† SOTAï¼Œä¾‹å¦‚é•¿æ–‡æ¡£æ‘˜è¦ã€é•¿ä¸Šä¸‹æ–‡é—®ç­”ã€‚</p><p><strong>RoBERTa æ¶æ„çš„ BigBird</strong> æ¨¡å‹ç°å·²é›†æˆå…¥ ğŸ¤— transformers ä¸­ã€‚æœ¬æ–‡çš„ç›®çš„æ˜¯è®©è¯»è€… <strong>æ·±å…¥</strong> äº†è§£ BigBird çš„å®ç°ï¼Œå¹¶è®©è¯»è€…èƒ½åœ¨ ğŸ¤— transformers ä¸­è½»æ¾ä½¿ç”¨ BigBirdã€‚ä½†æ˜¯ï¼Œåœ¨æ›´æ·±å…¥ä¹‹å‰ï¼Œä¸€å®šè®°ä½ <code>BigBird</code> æ³¨æ„åŠ›åªæ˜¯ <code>BERT</code> å®Œå…¨æ³¨æ„åŠ›çš„ä¸€ä¸ªè¿‘ä¼¼ï¼Œå› æ­¤æˆ‘ä»¬å¹¶ä¸çº ç»“äºè®©å®ƒæ¯” <code>BERT</code> å®Œå…¨æ³¨æ„åŠ› <strong>æ›´å¥½</strong>ï¼Œè€Œæ˜¯è‡´åŠ›äºè®©å®ƒæ›´æœ‰æ•ˆç‡ã€‚æœ‰äº†å®ƒï¼Œtransformer æ¨¡å‹å°±å¯ä»¥ä½œç”¨äºæ›´é•¿çš„åºåˆ—ï¼Œå› ä¸º BERT çš„äºŒæ¬¡æ–¹å†…å­˜éœ€æ±‚å¾ˆå¿«ä¼šå˜å¾—éš¾ä»¥ä¸ºç»§ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">âˆ</mi></mrow><annotation encoding="application/x-tex">\infty</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord">âˆ</span></span></span></span> è®¡ç®—å’Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">âˆ</mi></mrow><annotation encoding="application/x-tex">\infty</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord">âˆ</span></span></span></span> æ—¶é—´ï¼Œé‚£ä¹ˆç”¨ BERT æ³¨æ„åŠ›å°±å¥½äº†ï¼Œå®Œå…¨æ²¡å¿…è¦ç”¨æœ¬æ–‡è®¨è®ºçš„å—ç¨€ç–æ³¨æ„åŠ›ã€‚</p><p>å¦‚æœä½ æƒ³çŸ¥é“ä¸ºä»€ä¹ˆåœ¨å¤„ç†è¾ƒé•¿åºåˆ—æ—¶éœ€è¦æ›´å¤šè®¡ç®—ï¼Œé‚£ä¹ˆæœ¬æ–‡æ­£åˆä½ æ„ï¼</p><hr><p>åœ¨ä½¿ç”¨æ ‡å‡†çš„ <code>BERT</code> ç±»æ³¨æ„åŠ›æ—¶å¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹å‡ ä¸ªä¸»è¦é—®é¢˜:</p><ul><li>æ¯ä¸ªè¯å…ƒçœŸçš„éƒ½å¿…é¡»å…³æ³¨æ‰€æœ‰å…¶ä»–è¯å…ƒå—ï¼Ÿ</li><li>ä¸ºä»€ä¹ˆä¸åªè®¡ç®—é‡è¦è¯å…ƒçš„æ³¨æ„åŠ›ï¼Ÿ</li><li>å¦‚ä½•å†³å®šå“ªäº›è¯å…ƒé‡è¦ï¼Ÿ</li><li>å¦‚ä½•ä»¥é«˜æ•ˆçš„æ–¹å¼å¤„ç†å°‘é‡è¯å…ƒï¼Ÿ</li></ul><hr><p>æœ¬æ–‡ï¼Œæˆ‘ä»¬å°†å°è¯•å›ç­”è¿™äº›é—®é¢˜ã€‚</p><h3 id="åº”è¯¥å…³æ³¨å“ªäº›è¯å…ƒï¼Ÿ">åº”è¯¥å…³æ³¨å“ªäº›è¯å…ƒï¼Ÿ</h3><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°†ä»¥å¥å­ <code>BigBird is now available in HuggingFace for extractive Question Answering</code> ä¸ºä¾‹æ¥è¯´æ˜æ³¨æ„åŠ›æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚åœ¨ <code>BERT</code> è¿™ç±»çš„æ³¨æ„åŠ›æœºåˆ¶ä¸­ï¼Œæ¯ä¸ªè¯å…ƒéƒ½ç®€å•ç²—æš´åœ°å…³æ³¨æ‰€æœ‰å…¶ä»–è¯å…ƒã€‚ä»æ•°å­¦ä¸Šæ¥è®²ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªæŸ¥è¯¢çš„è¯å…ƒ $ \text{query-token} \in {\text{BigBird},\text{is},\text{now},\text{available},\text{in},\text{HuggingFace},\text{for},\text{extractive},\text{question},\text{answering}} $,<br>å°†å…³æ³¨æ¯ä¸ªé”®è¯å…ƒ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>key-tokens</mtext><mo>=</mo><mrow><mo fence="true">[</mo><mtext>BigBird</mtext><mo separator="true">,</mo><mtext>is</mtext><mo separator="true">,</mo><mtext>now</mtext><mo separator="true">,</mo><mtext>available</mtext><mo separator="true">,</mo><mtext>in</mtext><mo separator="true">,</mo><mtext>HuggingFace</mtext><mo separator="true">,</mo><mtext>for</mtext><mo separator="true">,</mo><mtext>extractive</mtext><mo separator="true">,</mo><mtext>question</mtext><mo separator="true">,</mo><mtext>answering</mtext><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\text{key-tokens} = \left[\text{BigBird},\text{is},\text{now},\text{available},\text{in},\text{HuggingFace},\text{for},\text{extractive},\text{question},\text{answering} \right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">key-tokens</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">[</span><span class="mord text"><span class="mord">BigBird</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord text"><span class="mord">is</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord text"><span class="mord">now</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord text"><span class="mord">available</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord text"><span class="mord">in</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord text"><span class="mord">HuggingFace</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord text"><span class="mord">for</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord text"><span class="mord">extractive</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord text"><span class="mord">question</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord text"><span class="mord">answering</span></span><span class="mclose delimcenter" style="top:0em;">]</span></span></span></span></span>ã€‚</p><p>æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹ <code>æ¯ä¸ªæŸ¥è¯¢è¯å…ƒåº”å¦‚ä½•æ˜æ™ºåœ°é€‰æ‹©å®ƒå®é™…ä¸Šåº”è¯¥å…³æ³¨çš„é”®è¯å…ƒ</code> è¿™ä¸ªé—®é¢˜ï¼Œä¸‹é¢æˆ‘ä»¬é€šè¿‡ç¼–å†™ä¼ªä»£ç çš„æ–¹å¼æ¥æ•´ç†æ€è€ƒè¿‡ç¨‹ã€‚</p><p>å‡è®¾ <code>available</code> æ˜¯å½“å‰æŸ¥è¯¢è¯å…ƒï¼Œæˆ‘ä»¬æ¥æ„å»ºä¸€ä¸ªåˆç†çš„ã€éœ€è¦å…³æ³¨çš„é”®è¯å…ƒåˆ—è¡¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»¥ä¸‹é¢çš„å¥å­ä¸ºä¾‹</span></span><br><span class="line">example = [<span class="string">&#x27;BigBird&#x27;</span>, <span class="string">&#x27;is&#x27;</span>, <span class="string">&#x27;now&#x27;</span>, <span class="string">&#x27;available&#x27;</span>, <span class="string">&#x27;in&#x27;</span>, <span class="string">&#x27;HuggingFace&#x27;</span>, <span class="string">&#x27;for&#x27;</span>, <span class="string">&#x27;extractive&#x27;</span>, <span class="string">&#x27;question&#x27;</span>, <span class="string">&#x27;answering&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡è®¾å½“å‰éœ€è¦è®¡ç®— &#x27;available&#x27; è¿™ä¸ªè¯çš„è¡¨å¾</span></span><br><span class="line">query_token = <span class="string">&#x27;available&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–ä¸€ä¸ªç©ºé›†åˆï¼Œç”¨äºæ”¾ &#x27;available&#x27; è¿™ä¸ªè¯çš„é”®è¯å…ƒ</span></span><br><span class="line">key_tokens = [] <span class="comment"># =&gt; ç›®å‰ï¼Œ&#x27;available&#x27; è¯å…ƒä¸å…³æ³¨ä»»ä½•è¯å…ƒ</span></span><br></pre></td></tr></table></figure><p>é‚»è¿‘è¯å…ƒå½“ç„¶å¾ˆé‡è¦ï¼Œå› ä¸ºåœ¨ä¸€ä¸ªå¥å­ (å•è¯åºåˆ—) ä¸­ï¼Œå½“å‰è¯é«˜åº¦ä¾èµ–äºå‰åçš„é‚»è¿‘è¯ã€‚<code>æ»‘åŠ¨æ³¨æ„åŠ›</code> å³åŸºäºè¯¥ç›´è§‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è€ƒè™‘æ»‘åŠ¨çª—å¤§å°ä¸º 3, å³å°† &#x27;available&#x27; çš„å·¦è¾¹ä¸€ä¸ªè¯å’Œå³è¾¹ä¸€ä¸ªè¯çº³å…¥è€ƒé‡</span></span><br><span class="line"><span class="comment"># å·¦è¯: &#x27;now&#x27;; å³è¯: &#x27;in&#x27;</span></span><br><span class="line">sliding_tokens = [<span class="string">&quot;now&quot;</span>, <span class="string">&quot;available&quot;</span>, <span class="string">&quot;in&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨ä»¥ä¸Šè¯å…ƒæ›´æ–°é›†åˆ</span></span><br><span class="line">key_tokens.append(sliding_tokens)</span><br></pre></td></tr></table></figure><p><strong>é•¿ç¨‹ä¾èµ–å…³ç³»:</strong> å¯¹æŸäº›ä»»åŠ¡è€Œè¨€ï¼Œæ•è·è¯å…ƒé—´çš„é•¿ç¨‹å…³ç³»è‡³å…³é‡è¦ã€‚ <em>ä¾‹å¦‚</em> ï¼Œåœ¨é—®ç­”ç±»ä»»åŠ¡ä¸­ï¼Œæ¨¡å‹éœ€è¦å°†ä¸Šä¸‹æ–‡çš„æ¯ä¸ªè¯å…ƒä¸æ•´ä¸ªé—®é¢˜è¿›è¡Œæ¯”è¾ƒï¼Œä»¥ä¾¿èƒ½å¤Ÿæ‰¾å‡ºä¸Šä¸‹æ–‡çš„å“ªä¸€éƒ¨åˆ†å¯¹æ­£ç¡®ç­”æ¡ˆæœ‰ç”¨ã€‚å¦‚æœå¤§å¤šæ•°ä¸Šä¸‹æ–‡è¯å…ƒä»…å…³æ³¨å…¶ä»–ä¸Šä¸‹æ–‡è¯å…ƒï¼Œè€Œä¸å…³æ³¨é—®é¢˜ï¼Œé‚£ä¹ˆæ¨¡å‹ä»ä¸å¤ªé‡è¦çš„ä¸Šä¸‹æ–‡è¯å…ƒä¸­è¿‡æ»¤é‡è¦çš„ä¸Šä¸‹æ–‡è¯å…ƒå°±ä¼šå˜å¾—æ›´åŠ å›°éš¾ã€‚</p><p><code>BigBird</code> æå‡ºäº†ä¸¤ç§å…è®¸é•¿ç¨‹æ³¨æ„åŠ›ä¾èµ–çš„æ–¹æ³•ï¼Œè¿™ä¸¤ç§æ–¹æ³•éƒ½èƒ½ä¿è¯è®¡ç®—æ•ˆç‡ã€‚</p><ul><li><strong>å…¨å±€è¯å…ƒ:</strong> å¼•å…¥ä¸€äº›è¯å…ƒï¼Œè¿™äº›è¯å…ƒå°†å…³æ³¨æ¯ä¸ªè¯å…ƒå¹¶ä¸”è¢«æ¯ä¸ªè¯å…ƒå…³æ³¨ã€‚ä¾‹å¦‚ï¼Œå¯¹ <em>â€œHuggingFace is building nice libraries for easy NLPâ€</em> ï¼Œç°åœ¨å‡è®¾ <em>â€˜buildingâ€™</em> è¢«å®šä¹‰ä¸ºå…¨å±€è¯å…ƒï¼Œè€Œå¯¹æŸäº›ä»»åŠ¡è€Œè¨€ï¼Œæ¨¡å‹éœ€è¦çŸ¥é“ <em>â€˜NLPâ€™</em> å’Œ <em>â€˜HuggingFaceâ€™</em> ä¹‹é—´çš„å…³ç³» (æ³¨æ„: è¿™ 2 ä¸ªè¯å…ƒä½äºå¥å­çš„ä¸¤ç«¯); ç°åœ¨è®© <em>â€˜buildingâ€™</em> åœ¨å…¨å±€èŒƒå›´å†…å…³æ³¨æ‰€æœ‰å…¶ä»–è¯å…ƒï¼Œä¼šå¯¹æ¨¡å‹å°† <em>â€˜NLPâ€™</em> ä¸ <em>â€˜HuggingFaceâ€™</em> å…³è”èµ·æ¥æœ‰å¸®åŠ©ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æˆ‘ä»¬å‡è®¾ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªè¯å…ƒæ˜¯å…¨å±€çš„ï¼Œåˆ™æœ‰:</span></span><br><span class="line">global_tokens = [<span class="string">&quot;BigBird&quot;</span>, <span class="string">&quot;answering&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†å…¨å±€è¯å…ƒåŠ å…¥åˆ°é›†åˆä¸­</span></span><br><span class="line">key_tokens.append(global_tokens)</span><br></pre></td></tr></table></figure><ul><li><strong>éšæœºè¯å…ƒ:</strong> éšæœºé€‰æ‹©ä¸€äº›è¯å…ƒï¼Œè¿™äº›è¯å…ƒå°†é€šè¿‡å…³æ³¨å…¶ä»–è¯å…ƒæ¥ä¼ è¾“ä¿¡æ¯ï¼Œè€Œé‚£äº›è¯å…ƒåˆå¯ä»¥ä¼ è¾“ä¿¡æ¯åˆ°å…¶ä»–è¯å…ƒã€‚è¿™å¯ä»¥é™ä½ç›´æ¥ä»ä¸€ä¸ªè¯å…ƒåˆ°å¦ä¸€ä¸ªè¯å…ƒçš„ä¿¡æ¯ä¼ è¾“æˆæœ¬ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä»å¥å­ä¸­éšæœºé€‰æ‹© `r` ä¸ªè¯å…ƒã€‚è¿™é‡Œï¼Œå‡è®¾ `r` ä¸º 1ï¼Œ é€‰æ‹©äº† `is` è¿™ä¸ªè¯å…ƒ</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>random_tokens = [<span class="string">&quot;is&quot;</span>] <span class="comment"># æ³¨æ„: è¿™ä¸ªæ˜¯å®Œå…¨éšæœºé€‰æ‹©çš„ï¼Œå› æ­¤å¯ä»¥æ˜¯ä»»æ„è¯å…ƒã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†éšæœºè¯å…ƒåŠ å…¥åˆ°é›†åˆä¸­</span></span><br><span class="line">key_tokens.append(random_tokens)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç°åœ¨çœ‹ä¸‹ `key_tokens` é›†åˆä¸­æœ‰å“ªäº›è¯å…ƒ</span></span><br><span class="line">key_tokens</span><br><span class="line">&#123;<span class="string">&#x27;now&#x27;</span>, <span class="string">&#x27;is&#x27;</span>, <span class="string">&#x27;in&#x27;</span>, <span class="string">&#x27;answering&#x27;</span>, <span class="string">&#x27;available&#x27;</span>, <span class="string">&#x27;BigBird&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡³æ­¤ï¼ŒæŸ¥è¯¢è¯ &#x27;available&#x27; ä»…å…³æ³¨é›†åˆä¸­çš„è¿™äº›è¯å…ƒï¼Œè€Œä¸ç”¨å…³å¿ƒå…¨éƒ¨</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼ŒæŸ¥è¯¢è¯å…ƒä»…å…³æ³¨æ‰€æœ‰è¯å…ƒçš„ä¸€ä¸ªå­é›†ï¼Œè¯¥å­é›†èƒ½å¤Ÿäº§ç”Ÿå®Œå…¨æ³¨æ„åŠ›å€¼çš„ä¸€ä¸ªä¸é”™çš„è¿‘ä¼¼ã€‚ç›¸åŒçš„æ–¹æ³•å°†ç”¨äºæ‰€æœ‰å…¶ä»–æŸ¥è¯¢è¯å…ƒã€‚ä½†è¯·è®°ä½ï¼Œè¿™é‡Œçš„é‡ç‚¹æ˜¯å°½å¯èƒ½æœ‰æ•ˆåœ°æ¥è¿‘ <code>BERT</code> çš„å®Œå…¨æ³¨æ„åŠ›ã€‚BERT é‚£ç§ç®€å•åœ°è®©æ¯ä¸ªæŸ¥è¯¢è¯å…ƒå…³æ³¨æ‰€æœ‰é”®è¯å…ƒçš„åšæ³•å¯ä»¥å»ºæ¨¡ä¸ºä¸€ç³»åˆ—çŸ©é˜µä¹˜æ³•ï¼Œä»è€Œåœ¨ç°ä»£ç¡¬ä»¶ (å¦‚ GPU) ä¸Šè¿›è¡Œé«˜æ•ˆè®¡ç®—ã€‚ç„¶è€Œï¼Œæ»‘åŠ¨ã€å…¨å±€å’Œéšæœºæ³¨æ„åŠ›çš„ç»„åˆä¼¼ä¹æ„å‘³ç€ç¨€ç–çŸ©é˜µä¹˜æ³•ï¼Œè¿™åœ¨ç°ä»£ç¡¬ä»¶ä¸Šå¾ˆéš¾é«˜æ•ˆå®ç°ã€‚<code>BigBird</code> çš„ä¸»è¦è´¡çŒ®ä¹‹ä¸€æ˜¯æå‡ºäº† <code>å—ç¨€ç–</code> æ³¨æ„åŠ›æœºåˆ¶ï¼Œè¯¥æœºåˆ¶å¯ä»¥é«˜æ•ˆè®¡ç®—æ»‘åŠ¨ã€å…¨å±€å’Œéšæœºæ³¨æ„åŠ›ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹å§ï¼</p><h3 id="å›¾è§£å…¨å±€-æ»‘åŠ¨-éšæœºæ³¨æ„åŠ›çš„æ¦‚å¿µ">å›¾è§£å…¨å±€ã€æ»‘åŠ¨ã€éšæœºæ³¨æ„åŠ›çš„æ¦‚å¿µ</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬å€ŸåŠ©å›¾æ¥å¸®åŠ©ç†è§£â€œå…¨å±€â€ã€â€œæ»‘åŠ¨â€å’Œâ€œéšæœºâ€æ³¨æ„åŠ›ï¼Œå¹¶å°è¯•ç†è§£è¿™ä¸‰ç§æ³¨æ„åŠ›æœºåˆ¶çš„ç»„åˆæ˜¯å¦‚ä½•è¾ƒå¥½åœ°è¿‘ä¼¼æ ‡å‡† BERT ç±»æ³¨æ„åŠ›çš„ã€‚</p><img src="https://huggingface.co/blog/assets/18_big_bird/global.png" width=250 height=250><img src="https://huggingface.co/blog/assets/18_big_bird/sliding.png" width=250 height=250><img src="https://huggingface.co/blog/assets/18_big_bird/random.png" width=250 height=250> <br><p><em>ä¸Šå›¾åˆ†åˆ«æŠŠâ€œå…¨å±€â€(å·¦) ã€â€œæ»‘åŠ¨â€(ä¸­) å’Œâ€œéšæœºâ€(å³) è¿æ¥å»ºæ¨¡æˆä¸€ä¸ªå›¾ã€‚æ¯ä¸ªèŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªè¯å…ƒï¼Œæ¯æ¡è¾¹ä»£è¡¨ä¸€ä¸ªæ³¨æ„åŠ›åˆ†æ•°ã€‚å¦‚æœ 2 ä¸ªè¯å…ƒä¹‹é—´æ²¡æœ‰è¾¹è¿æ¥ï¼Œåˆ™å…¶æ³¨æ„åŠ›åˆ†æ•°ä¸º 0ã€‚</em></p><p><img src="https://huggingface.co/blog/assets/18_big_bird/graph.gif" alt=""></p><img src="https://huggingface.co/blog/assets/18_big_bird/full.png" width=230 height=230><p><strong>BigBird å—ç¨€ç–æ³¨æ„åŠ›</strong> æ˜¯æ»‘åŠ¨è¿æ¥ã€å…¨å±€è¿æ¥å’Œéšæœºè¿æ¥ (æ€»å…± 10 ä¸ªè¿æ¥) çš„ç»„åˆï¼Œå¦‚ä¸Šå›¾å·¦ä¾§åŠ¨å›¾æ‰€ç¤ºã€‚è€Œ <strong>å®Œå…¨æ³¨æ„åŠ›</strong> å›¾ (å³ä¾§) åˆ™æ˜¯æœ‰å…¨éƒ¨ 15 ä¸ªè¿æ¥ (æ³¨æ„: æ€»å…±æœ‰ 6 ä¸ªèŠ‚ç‚¹)ã€‚ä½ å¯ä»¥ç®€å•åœ°å°†å®Œå…¨æ³¨æ„åŠ›è§†ä¸ºæ‰€æœ‰è¯å…ƒéƒ½æ˜¯å…¨å±€è¯å…ƒ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mn>1</mn></msup></mrow><annotation encoding="application/x-tex">{}^1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord"></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span>ã€‚</p><p><strong>å®Œå…¨æ³¨æ„åŠ›:</strong> æ¨¡å‹å¯ä»¥ç›´æ¥åœ¨å•ä¸ªå±‚ä¸­å°†ä¿¡æ¯ä»ä¸€ä¸ªè¯å…ƒä¼ è¾“åˆ°å¦ä¸€ä¸ªè¯å…ƒï¼Œå› ä¸ºæ¯ä¸ªè¯å…ƒéƒ½ä¼šå¯¹æ¯ä¸ªå…¶ä»–è¯å…ƒè¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶ä¸”å—åˆ°å…¶ä»–æ¯ä¸ªè¯å…ƒçš„å…³æ³¨ã€‚æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªä¸ä¸Šå›¾ç±»ä¼¼çš„ä¾‹å­ï¼Œå¦‚æœæ¨¡å‹éœ€è¦å°† <em>â€˜goingâ€™</em> ä¸ <em>â€˜nowâ€™</em> å…³è”èµ·æ¥ï¼Œå®ƒå¯ä»¥ç®€å•åœ°åœ¨å•å±‚ä¸­æ‰§è¡Œæ­¤æ“ä½œï¼Œå› ä¸ºå®ƒä»¬ä¸¤ä¸ªæ˜¯æœ‰ç›´æ¥è¿æ¥çš„ã€‚</p><p><strong>å—ç¨€ç–æ³¨æ„åŠ›:</strong> å¦‚æœæ¨¡å‹éœ€è¦åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ (æˆ–è¯å…ƒ) ä¹‹é—´å…±äº«ä¿¡æ¯ï¼Œåˆ™å¯¹äºæŸäº›è¯å…ƒï¼Œä¿¡æ¯å°†å¿…é¡»ç»è¿‡è·¯å¾„ä¸­çš„å„ä¸ªå…¶ä»–èŠ‚ç‚¹; å› ä¸ºä¸æ˜¯æ‰€æœ‰èŠ‚ç‚¹éƒ½æœ‰ç›´æ¥è¿æ¥çš„ã€‚<br><em>ä¾‹å¦‚</em> ï¼Œå‡è®¾æ¨¡å‹éœ€è¦å°† <code>going</code> ä¸ <code>now</code> å…³è”èµ·æ¥ï¼Œé‚£ä¹ˆå¦‚æœä»…å­˜åœ¨æ»‘åŠ¨æ³¨æ„åŠ›ï¼Œåˆ™è¿™ä¸¤ä¸ªè¯å…ƒä¹‹é—´çš„ä¿¡æ¯æµç”±è·¯å¾„ <code>going -&gt; am -&gt; i -&gt; now</code> æ¥å®šä¹‰ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå¿…é¡»ç»è¿‡ 2 ä¸ªå…¶ä»–è¯å…ƒã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å¤šä¸ªå±‚æ¥æ•è·åºåˆ—çš„å…¨éƒ¨ä¿¡æ¯ï¼Œè€Œæ­£å¸¸çš„æ³¨æ„åŠ›å¯ä»¥åœ¨å•å±‚ä¸­æ•æ‰åˆ°è¿™ä¸€ç‚¹ã€‚åœ¨æç«¯æƒ…å†µä¸‹ï¼Œè¿™å¯èƒ½æ„å‘³ç€éœ€è¦ä¸è¾“å…¥è¯å…ƒä¸€æ ·å¤šçš„å±‚ã€‚ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬å¼•å…¥ä¸€äº›å…¨å±€è¯å…ƒï¼Œä¿¡æ¯å¯ä»¥é€šè¿‡ä»¥ä¸‹è·¯å¾„ä¼ æ’­ <code>going -&gt; i -&gt; now</code> ï¼Œè¿™å¯ä»¥å¸®åŠ©ç¼©çŸ­è·¯å¾„ã€‚å¦‚æœæˆ‘ä»¬å†å¦å¤–å¼•å…¥éšæœºè¿æ¥ï¼Œå®ƒå°±å¯ä»¥é€šè¿‡ <code>going -&gt; am -&gt; now</code> ä¼ æ’­ã€‚å€ŸåŠ©éšæœºè¿æ¥å’Œå…¨å±€è¿æ¥ï¼Œä¿¡æ¯å¯ä»¥éå¸¸å¿«é€Ÿåœ° (åªéœ€å‡ å±‚) ä»ä¸€ä¸ªè¯å…ƒä¼ è¾“åˆ°ä¸‹ä¸€ä¸ªè¯å…ƒã€‚</p><p>å¦‚æœæˆ‘ä»¬æœ‰å¾ˆå¤šå…¨å±€è¯å…ƒï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯èƒ½ä¸éœ€è¦éšæœºè¿æ¥ï¼Œå› ä¸ºä¿¡æ¯å¯ä»¥é€šè¿‡å¤šä¸ªçŸ­è·¯å¾„ä¼ æ’­ã€‚è¿™å°±æ˜¯åœ¨ä½¿ç”¨ BigBird çš„å˜ä½“ (ç§°ä¸º ETC) æ—¶è®¾ç½® <code>num_random_tokens = 0</code> çš„åŠ¨æœº (ç¨åéƒ¨åˆ†å°†ä¼šè¯¦ç»†ä»‹ç»)ã€‚</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mn>1</mn></msup></mrow><annotation encoding="application/x-tex">{}^1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord"></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span> åœ¨è¿™äº›å›¾ä¸­ï¼Œæˆ‘ä»¬å‡è®¾æ³¨æ„åŠ›çŸ©é˜µæ˜¯å¯¹ç§°çš„ <strong>å³</strong> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="bold">A</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mi mathvariant="bold">A</mi><mrow><mi>j</mi><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\mathbf{A} _{ij} = \mathbf{A}_ {ji}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.972218em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">A</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.972218em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">A</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> å› ä¸ºåœ¨å›¾ä¸­å¦‚æœæŸä¸ªè¯å…ƒ <strong>A</strong> å…³æ³¨ <strong>B</strong>ï¼Œé‚£ä¹ˆ <strong>B</strong> ä¹Ÿä¼šå…³æ³¨ <strong>A</strong>ã€‚ä»ä¸‹ä¸€èŠ‚æ‰€ç¤ºçš„æ³¨æ„åŠ›çŸ©é˜µå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªå‡è®¾å¯¹äº BigBird ä¸­çš„å¤§å¤šæ•°è¯å…ƒéƒ½æˆç«‹ã€‚</p><table><thead><tr><th>æ³¨æ„åŠ›ç±»å‹</th><th>å…¨å±€è¯å…ƒ</th><th>æ»‘åŠ¨è¯å…ƒ</th><th>éšæœºè¯å…ƒ</th></tr></thead><tbody><tr><td>åŸå§‹å®Œå…¨æ³¨æ„åŠ›</td><td><code>n</code></td><td>0</td><td>0</td></tr><tr><td>å—ç¨€ç–æ³¨æ„åŠ›</td><td>2 x <code>block_size</code></td><td>3 x <code>block_size</code></td><td><code>num_random_blocks</code> x <code>block_size</code></td></tr></tbody></table><p>åŸå§‹å®Œå…¨æ³¨æ„åŠ›å³ <code>BERT</code> çš„æ³¨æ„åŠ›ï¼Œè€Œå—ç¨€ç–æ³¨æ„åŠ›åˆ™æ˜¯ <code>BigBird</code> çš„æ³¨æ„åŠ›ã€‚æƒ³çŸ¥é“ <code>block_size</code> æ˜¯ä»€ä¹ˆï¼Ÿè¯·ç»§ç»­é˜…è¯»ä¸‹æ–‡ã€‚<em>ç°åœ¨ï¼Œä¸ºç®€å•èµ·è§ï¼Œå°†å…¶è§†ä¸º 1ã€‚</em></p><h2 id="bigbird-å—ç¨€ç–æ³¨æ„åŠ›">BigBird å—ç¨€ç–æ³¨æ„åŠ›</h2><p>BigBird å—ç¨€ç–æ³¨æ„åŠ›æ˜¯æˆ‘ä»¬ä¸Šæ–‡è®¨è®ºçš„å†…å®¹çš„é«˜æ•ˆå®ç°ã€‚æ¯ä¸ªè¯å…ƒéƒ½å…³æ³¨æŸäº› <strong>å…¨å±€è¯å…ƒ</strong> ã€ <strong>æ»‘åŠ¨è¯å…ƒ</strong> å’Œ <strong>éšæœºè¯å…ƒ</strong>ï¼Œè€Œä¸ç®¡å…¶ä»– <strong>æ‰€æœ‰</strong> è¯å…ƒã€‚ä½œè€…åˆ†åˆ«å®ç°äº†æ¯ç±»æŸ¥è¯¢æ³¨æ„åŠ›çŸ©é˜µï¼Œå¹¶ä½¿ç”¨äº†ä¸€ä¸ªå¾ˆé…·çš„æŠ€å·§æ¥åŠ é€Ÿ GPU å’Œ TPU ä¸Šçš„è®­ç»ƒ/æ¨ç†ã€‚</p><p><img src="https://huggingface.co/blog/assets/18_big_bird/attn.png" alt="BigBird å—ç¨€ç–æ³¨æ„åŠ›"></p><p><em>æ³¨æ„: åœ¨ä¸Šå›¾çš„é¡¶éƒ¨æœ‰ 2 ä¸ªé¢å¤–çš„å¥å­ã€‚æ­£å¦‚ä½ æ‰€æ³¨æ„åˆ°çš„ï¼Œä¸¤ä¸ªå¥å­ä¸­çš„æ¯ä¸ªè¯å…ƒéƒ½åªæ˜¯äº¤æ¢äº†ä¸€ä¸ªä½ç½®ã€‚è¿™å°±æ˜¯æ»‘åŠ¨æ³¨æ„åŠ›çš„å®ç°æ–¹å¼ã€‚å½“ <code>q[i]</code> ä¸ <code>k[i,0:3]</code> ç›¸ä¹˜æ—¶ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ° <code>q[i]</code> çš„æ»‘åŠ¨æ³¨æ„åŠ›åˆ†æ•° (å…¶ä¸­<code>i</code> æ˜¯åºåˆ—ä¸­å…ƒç´ çš„ç´¢å¼•)ã€‚</em></p><p>ä½ å¯ä»¥åœ¨ <a href="https://github.com/vasudevgupta7/transformers/blob/5f2d6a0c93ca2017961199aa04a344b9b779d454/src/transformers/models/big_bird/modeling_big_bird.py#L513">è¿™å„¿</a> æ‰¾åˆ° <code>block_sparse</code> æ³¨æ„åŠ›çš„å…·ä½“å®ç°ã€‚ç°åœ¨çœ‹èµ·æ¥å¯èƒ½éå¸¸å¯æ€•ğŸ˜¨ğŸ˜¨ï¼Œä½†è¿™ç¯‡æ–‡ç« è‚¯å®šä¼šè®©ä½ è½»æ¾ç†è§£å®ƒã€‚</p><h3 id="å…¨å±€æ³¨æ„åŠ›">å…¨å±€æ³¨æ„åŠ›</h3><p>å¯¹äºå…¨å±€æ³¨æ„åŠ›è€Œè¨€ï¼Œæ¯ä¸ªæŸ¥è¯¢è¯å…ƒå…³æ³¨åºåˆ—ä¸­çš„æ‰€æœ‰å…¶ä»–è¯å…ƒï¼Œå¹¶ä¸”è¢«å…¶ä»–æ¯ä¸ªè¯å…ƒå…³æ³¨ã€‚æˆ‘ä»¬å‡è®¾ <code>Vasudev</code> (ç¬¬ä¸€ä¸ªè¯å…ƒ) å’Œ <code>them</code> (æœ€åä¸€ä¸ªè¯å…ƒ) æ˜¯å…¨å±€çš„ (å¦‚ä¸Šå›¾æ‰€ç¤º)ã€‚ä½ å¯ä»¥çœ‹åˆ°è¿™äº›è¯å…ƒç›´æ¥è¿æ¥åˆ°æ‰€æœ‰å…¶ä»–è¯å…ƒ (è“è‰²æ¡†)ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¼ªä»£ç </span></span><br><span class="line"></span><br><span class="line">Q -&gt; Query martix (seq_length, head_dim)</span><br><span class="line">K -&gt; Key matrix (seq_length, head_dim)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªè¯å…ƒå…³æ³¨æ‰€æœ‰å…¶ä»–è¯å…ƒ</span></span><br><span class="line">Q[<span class="number">0</span>] x [K[<span class="number">0</span>], K[<span class="number">1</span>], K[<span class="number">2</span>], ......, K[n-<span class="number">1</span>]]</span><br><span class="line">Q[n-<span class="number">1</span>] x [K[<span class="number">0</span>], K[<span class="number">1</span>], K[<span class="number">2</span>], ......, K[n-<span class="number">1</span>]]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªè¯å…ƒä¹Ÿè¢«å…¶ä»–æ‰€æœ‰è¯å…ƒå…³æ³¨</span></span><br><span class="line">K[<span class="number">0</span>] x [Q[<span class="number">0</span>], Q[<span class="number">1</span>], Q[<span class="number">2</span>], ......, Q[n-<span class="number">1</span>]]</span><br><span class="line">K[n-<span class="number">1</span>] x [Q[<span class="number">0</span>], Q[<span class="number">1</span>], Q[<span class="number">2</span>], ......, Q[n-<span class="number">1</span>]]</span><br></pre></td></tr></table></figure><h3 id="æ»‘åŠ¨æ³¨æ„åŠ›">æ»‘åŠ¨æ³¨æ„åŠ›</h3><p>é”®è¯å…ƒåºåˆ—è¢«å¤åˆ¶ä¸¤æ¬¡ï¼Œå…¶ä¸­ä¸€ä»½æ¯ä¸ªè¯å…ƒå‘å³ç§»åŠ¨ä¸€æ­¥ï¼Œå¦ä¸€ä»½æ¯ä¸ªè¯å…ƒå‘å·¦ç§»åŠ¨ä¸€æ­¥ã€‚ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬å°†æŸ¥è¯¢åºåˆ—å‘é‡ä¹˜ä»¥è¿™ 3 ä¸ªåºåˆ—å‘é‡ï¼Œæˆ‘ä»¬å°†è¦†ç›–æ‰€æœ‰æ»‘åŠ¨è¯å…ƒã€‚è®¡ç®—å¤æ‚åº¦å°±æ˜¯ <code>O(3n) = O(n)</code> ã€‚å‚è€ƒä¸Šå›¾ï¼Œæ©™è‰²æ¡†ä»£è¡¨æ»‘åŠ¨æ³¨æ„åŠ›ã€‚ä½ å¯ä»¥åœ¨å›¾çš„é¡¶éƒ¨çœ‹åˆ° 3 ä¸ªåºåˆ—ï¼Œå…¶ä¸­ 2 ä¸ªåºåˆ—å„ç§»åŠ¨äº†ä¸€ä¸ªè¯å…ƒ (1 ä¸ªå‘å·¦ï¼Œ1 ä¸ªå‘å³)ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æˆ‘ä»¬æƒ³åšçš„</span></span><br><span class="line">Q[i] x [K[i-<span class="number">1</span>], K[i], K[i+<span class="number">1</span>]] <span class="keyword">for</span> i = <span class="number">1</span>:-<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é«˜æ•ˆçš„ä»£ç å®ç° (ğŸ‘‡ ä¹˜æ³•ä¸ºç‚¹ä¹˜)</span></span><br><span class="line">[Q[<span class="number">0</span>], Q[<span class="number">1</span>], Q[<span class="number">2</span>], ......, Q[n-<span class="number">2</span>], Q[n-<span class="number">1</span>]] x [K[<span class="number">1</span>], K[<span class="number">2</span>], K[<span class="number">3</span>], ......, K[n-<span class="number">1</span>], K[<span class="number">0</span>]]</span><br><span class="line">[Q[<span class="number">0</span>], Q[<span class="number">1</span>], Q[<span class="number">2</span>], ......, Q[n-<span class="number">1</span>]] x [K[n-<span class="number">1</span>], K[<span class="number">0</span>], K[<span class="number">1</span>], ......, K[n-<span class="number">2</span>]]</span><br><span class="line">[Q[<span class="number">0</span>], Q[<span class="number">1</span>], Q[<span class="number">2</span>], ......, Q[n-<span class="number">1</span>]] x [K[<span class="number">0</span>], K[<span class="number">1</span>], K[<span class="number">2</span>], ......, K[n-<span class="number">1</span>]]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯ä¸ªåºåˆ—è¢«ä¹˜ 3 è¯ï¼Œ å³ `window_size = 3`ã€‚ä¸ºç¤ºæ„ï¼Œä»…åˆ—å‡ºä¸»è¦è®¡ç®—ï¼Œçœç•¥äº†ä¸€äº›è®¡ç®—ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="éšæœºæ³¨æ„åŠ›">éšæœºæ³¨æ„åŠ›</h3><p>éšæœºæ³¨æ„åŠ›ç¡®ä¿æ¯ä¸ªæŸ¥è¯¢è¯å…ƒä¹Ÿä¼šå…³æ³¨ä¸€äº›éšæœºè¯å…ƒã€‚å¯¹å®ç°è€Œè¨€ï¼Œè¿™æ„å‘³ç€æ¨¡å‹éšæœºé€‰å–ä¸€äº›è¯å…ƒå¹¶è®¡ç®—å®ƒä»¬çš„æ³¨æ„åŠ›åˆ†æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># r1, r2, r ä¸ºéšæœºç´¢å¼•; æ³¨æ„ r1, r2, r æ¯è¡Œå–å€¼ä¸åŒ ğŸ‘‡</span></span><br><span class="line">Q[<span class="number">1</span>] x [Q[r1], Q[r2], ......, Q[r]]</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">Q[n-<span class="number">2</span>] x [Q[r1], Q[r2], ......, Q[r]]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ç”¨ç®¡ç¬¬ 0 ä¸ªå’Œç¬¬ n-1 ä¸ªè¯å…ƒï¼Œå› ä¸ºå®ƒä»¬å·²ç»æ˜¯å…¨å±€è¯å…ƒäº†ã€‚</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„:</strong> å½“å‰çš„å®ç°è¿›ä¸€æ­¥å°†åºåˆ—åˆ’åˆ†ä¸ºå—ï¼Œå¹¶ä¸”æ¯ä¸ªç¬¦å·éƒ½ä¾å—è€Œå®šä¹‰è€Œéä¾è¯å…ƒè€Œå®šä¹‰ã€‚æˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚ä¸­ä¼šæ›´è¯¦ç»†åœ°è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚</p><h3 id="å®ç°">å®ç°</h3><p><strong>å›é¡¾:</strong> åœ¨å¸¸è§„ BERT æ³¨æ„åŠ›ä¸­ï¼Œä¸€ç³»åˆ—è¯å…ƒï¼Œå³ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>â€¦</mo><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>x</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">X = x_1, x_2, â€¦., x_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> é€šè¿‡çº¿æ€§å±‚æŠ•å½±åˆ° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><mtext>ï¼Œ</mtext><mi>K</mi><mtext>ï¼Œ</mtext><mi>V</mi></mrow><annotation encoding="application/x-tex">Qï¼ŒKï¼ŒV</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">Q</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span></span></span></span>ï¼Œå¹¶åŸºäºå®ƒä»¬è®¡ç®—æ³¨æ„åŠ›åˆ†æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi></mrow><annotation encoding="application/x-tex">Z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span></span></span></span>ï¼Œå…¬å¼ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi><mo>=</mo><mi>S</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Z=Softmax(QK^T)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.0913309999999998em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">t</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mopen">(</span><span class="mord mathdefault">Q</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>ã€‚ä½¿ç”¨ BigBird å—ç¨€ç–æ³¨æ„åŠ›æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ç›¸åŒçš„ç®—æ³•ï¼Œä½†ä»…é’ˆå¯¹ä¸€äº›é€‰å®šçš„æŸ¥è¯¢å’Œé”®å‘é‡è¿›è¡Œè®¡ç®—ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹ BigBird å—ç¨€ç–æ³¨æ„åŠ›æ˜¯å¦‚ä½•å®ç°çš„ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ç”¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mtext>ã€</mtext><mi>r</mi><mtext>ã€</mtext><mi>s</mi><mtext>ã€</mtext><mi>g</mi></mrow><annotation encoding="application/x-tex">bã€rã€sã€g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">b</span><span class="mord cjk_fallback">ã€</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord cjk_fallback">ã€</span><span class="mord mathdefault">s</span><span class="mord cjk_fallback">ã€</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span></span></span> åˆ†åˆ«ä»£è¡¨ <code>block_size</code> ã€<code>num_random_blocks</code> ã€<code>num_sliding_blocks</code> ã€<code>num_global_blocks</code> ã€‚æˆ‘ä»¬ä»¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>=</mo><mn>4</mn><mtext>ï¼Œ</mtext><mi>r</mi><mo>=</mo><mn>1</mn><mtext>ï¼Œ</mtext><mi>g</mi><mo>=</mo><mn>2</mn><mtext>ï¼Œ</mtext><mi>s</mi><mo>=</mo><mn>3</mn><mtext>ï¼Œ</mtext><mi>d</mi><mo>=</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">b=4ï¼Œr=1ï¼Œg=2ï¼Œs=3ï¼Œd=5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">4</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span></span></span></span> ä¸ºä¾‹æ¥è¯´æ˜ BigBird å—ç¨€ç–æ³¨æ„åŠ›çš„æœºåˆ¶éƒ¨åˆ†ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><img src="https://huggingface.co/blog/assets/18_big_bird/intro.png" width=500 height=250><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mn>1</mn></msub><mtext>ã€</mtext><msub><mi>q</mi><mn>2</mn></msub><mtext>ã€</mtext><msub><mi>q</mi><mrow><mn>3</mn><mo>:</mo><mi>n</mi><mo>âˆ’</mo><mn>2</mn></mrow></msub><mtext>ã€</mtext><msub><mi>q</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mtext>ã€</mtext><msub><mi>q</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">{q} _{1}ã€{q}_ {2}ã€{q} _{3:n-2}ã€{q}_ {n-1}ã€{q}_{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord cjk_fallback">ã€</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord cjk_fallback">ã€</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mrel mtight">:</span><span class="mord mathdefault mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mord cjk_fallback">ã€</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mord cjk_fallback">ã€</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> çš„æ³¨æ„åŠ›åˆ†æ•°åˆ†åˆ«è®¡ç®—å¦‚ä¸‹:</p><hr><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="bold">q</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\mathbf{q}_{1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.63888em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">q</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> çš„æ³¨æ„åŠ›åˆ†æ•°ç”± <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">a_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºï¼Œå…¶ä¸­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><mo>=</mo><mi>S</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><msub><mi>q</mi><mn>1</mn></msub><mo>âˆ—</mo><msup><mi>K</mi><mi>T</mi></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">a_1=Softmax(q_1 * K^T)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">t</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0913309999999998em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>ï¼Œå³ä¸ºç¬¬ä¸€å—ä¸­çš„æ‰€æœ‰è¯å…ƒä¸åºåˆ—ä¸­çš„æ‰€æœ‰å…¶ä»–è¯å…ƒä¹‹é—´çš„æ³¨æ„åŠ›åˆ†æ•°ã€‚</p><p><img src="https://huggingface.co/blog/assets/18_big_bird/q1.png" alt="BigBird å—ç¨€ç–æ³¨æ„åŠ›"></p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">q_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºç¬¬ 1 å—ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>g</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">g_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºç¬¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> å—ã€‚æˆ‘ä»¬ä»…åœ¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">q_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> å’Œ  <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span></span></span> (å³æ‰€æœ‰é”®) ä¹‹é—´æ‰§è¡Œæ­£å¸¸çš„æ³¨æ„åŠ›æ“ä½œã€‚</p><hr><p>ä¸ºäº†è®¡ç®—ç¬¬äºŒå—ä¸­è¯å…ƒçš„æ³¨æ„åŠ›åˆ†æ•°ï¼Œæˆ‘ä»¬æ”¶é›†å‰ä¸‰å—ã€æœ€åä¸€å—å’Œç¬¬äº”å—ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥è®¡ç®— <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>2</mn></msub><mo>=</mo><mi>S</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><msub><mi>q</mi><mn>2</mn></msub><mo>âˆ—</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>a</mi><mi>t</mi><mo stretchy="false">(</mo><msub><mi>k</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>k</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>k</mi><mn>3</mn></msub><mo separator="true">,</mo><msub><mi>k</mi><mn>5</mn></msub><mo separator="true">,</mo><msub><mi>k</mi><mn>7</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">a_2 = Softmax(q_2 * concat(k_1, k_2, k_3, k_5, k_7))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">t</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">c</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span>ã€‚</p><p><img src="https://huggingface.co/blog/assets/18_big_bird/q2.png" alt="BigBird å—ç¨€ç–æ³¨æ„åŠ›"></p><p><em>è¿™é‡Œï¼Œæˆ‘ç”¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mtext>ï¼Œ</mtext><mi>r</mi><mtext>ï¼Œ</mtext><mi>s</mi></mrow><annotation encoding="application/x-tex">gï¼Œrï¼Œs</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord mathdefault">s</span></span></span></span> è¡¨ç¤ºè¯å…ƒåªæ˜¯ä¸ºäº†æ˜ç¡®åœ°è¡¨ç¤ºå®ƒä»¬çš„æ€§è´¨ (å³æ˜¯å…¨å±€ã€éšæœºè¿˜æ˜¯æ»‘åŠ¨è¯å…ƒ)ï¼Œåªç”¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> æ— æ³•è¡¨ç¤ºä»–ä»¬å„è‡ªçš„æ€§è´¨ã€‚</em></p><hr><p>ä¸ºäº†è®¡ç®— <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mrow><mn>3</mn><mo>:</mo><mi>n</mi><mo>âˆ’</mo><mn>2</mn></mrow></msub></mrow><annotation encoding="application/x-tex">{q} _{3:n-2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mrel mtight">:</span><span class="mord mathdefault mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span> çš„æ³¨æ„åŠ›åˆ†æ•°ï¼Œæˆ‘ä»¬å…ˆæ”¶é›†ç›¸åº”çš„å…¨å±€ã€æ»‘åŠ¨ã€éšæœºé”®å‘é‡ï¼Œå¹¶åŸºäºå®ƒä»¬æ­£å¸¸è®¡ç®— <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mrow><mn>3</mn><mo>:</mo><mi>n</mi><mo>âˆ’</mo><mn>2</mn></mrow></msub></mrow><annotation encoding="application/x-tex">{q}_ {3:n-2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mrel mtight">:</span><span class="mord mathdefault mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span> ä¸Šçš„æ³¨æ„åŠ›ã€‚è¯·æ³¨æ„ï¼Œæ­£å¦‚å‰é¢æ»‘åŠ¨æ³¨æ„åŠ›éƒ¨åˆ†æ‰€è®¨è®ºçš„ï¼Œæ»‘åŠ¨é”®æ˜¯ä½¿ç”¨ç‰¹æ®Šçš„ç§»ä½æŠ€å·§æ¥æ”¶é›†çš„ã€‚</p><p><img src="https://huggingface.co/blog/assets/18_big_bird/q_middle.png" alt="BigBird å—ç¨€ç–æ³¨æ„åŠ›"></p><hr><p>ä¸ºäº†è®¡ç®—å€’æ•°ç¬¬äºŒå— (å³ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">{q} _{n-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span>) ä¸­è¯å…ƒçš„æ³¨æ„åŠ›åˆ†æ•°ï¼Œæˆ‘ä»¬æ”¶é›†ç¬¬ä¸€å—ã€æœ€åä¸‰å—å’Œç¬¬ä¸‰å—çš„é”®å‘é‡ã€‚ç„¶åæˆ‘ä»¬ç”¨å…¬å¼ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>S</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><msub><mi>q</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>âˆ—</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>a</mi><mi>t</mi><mo stretchy="false">(</mo><msub><mi>k</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>k</mi><mn>3</mn></msub><mo separator="true">,</mo><msub><mi>k</mi><mn>5</mn></msub><mo separator="true">,</mo><msub><mi>k</mi><mn>6</mn></msub><mo separator="true">,</mo><msub><mi>k</mi><mn>7</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">{a}_ {n-1} = Softmax({q}_{n-1} * concat(k_1, k_3, k_5, k_6, k_7))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">t</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">c</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span> è¿›è¡Œè®¡ç®—ã€‚è¿™å’Œè®¡ç®— <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">q_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> éå¸¸ç›¸ä¼¼ã€‚</p><p><img src="https://huggingface.co/blog/assets/18_big_bird/qlast_sec.png" alt="BigBird å—ç¨€ç–æ³¨æ„åŠ›"></p><hr><p>æœ€åä¸€å— <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="bold">q</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">\mathbf{q}_{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.63888em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">q</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> çš„æ³¨æ„åŠ›åˆ†æ•°ç”± <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">a_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºï¼Œå…¶ä¸­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>n</mi></msub><mo>=</mo><mi>S</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><msub><mi>q</mi><mi>n</mi></msub><mo>âˆ—</mo><msup><mi>K</mi><mi>T</mi></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">a_n=Softmax(q_n * K^T)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">t</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0913309999999998em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>ï¼Œåªä¸è¿‡æ˜¯æœ€åä¸€å—ä¸­çš„æ‰€æœ‰è¯å…ƒä¸åºåˆ—ä¸­çš„æ‰€æœ‰å…¶ä»–è¯å…ƒä¹‹é—´çš„æ³¨æ„åŠ›åˆ†æ•°ã€‚è¿™ä¸æˆ‘ä»¬å¯¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">q_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> æ‰€åšçš„éå¸¸ç›¸ä¼¼ã€‚</p><p><img src="https://huggingface.co/blog/assets/18_big_bird/qlast.png" alt="BigBird å—ç¨€ç–æ³¨æ„åŠ›"></p><hr><p>æˆ‘ä»¬å°†ä¸Šé¢çš„çŸ©é˜µç»„åˆèµ·æ¥å¾—åˆ°æœ€ç»ˆçš„æ³¨æ„åŠ›çŸ©é˜µã€‚è¯¥æ³¨æ„åŠ›çŸ©é˜µå¯ç”¨äºè·å–æ‰€æœ‰è¯å…ƒçš„è¡¨å¾ã€‚</p><p><img src="https://huggingface.co/blog/assets/18_big_bird/block-sparse-attn.gif" alt="BigBird å—ç¨€ç–æ³¨æ„åŠ›"></p><p><em>ä¸Šå›¾ä¸­ <code>è“è‰² -&gt; å…¨å±€å—</code> ã€<code>çº¢è‰² -&gt; éšæœºå—</code> ã€<code>æ©™è‰² -&gt; æ»‘åŠ¨å—</code> ã€‚åœ¨å‰å‘ä¼ æ’­è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸å­˜å‚¨â€œç™½è‰²â€å—ï¼Œè€Œæ˜¯ç›´æ¥ä¸ºæ¯ä¸ªå•ç‹¬çš„éƒ¨åˆ†è®¡ç®—åŠ æƒå€¼çŸ©é˜µ (å³æ¯ä¸ªè¯å…ƒçš„è¡¨ç¤º)ï¼Œå¦‚ä¸Šæ‰€è¿°ã€‚</em></p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»ä»‹ç»äº†å—ç¨€ç–æ³¨æ„åŠ›æœ€éš¾çš„éƒ¨åˆ†ï¼Œå³å®ƒçš„å®ç°ã€‚å¸Œæœ›å¯¹ä½ æ›´å¥½åœ°ç†è§£å®é™…ä»£ç æœ‰å¸®åŠ©ã€‚ç°åœ¨ä½ å¯ä»¥æ·±å…¥ç ”ç©¶ä»£ç äº†ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­ä½ å¯ä»¥å°†ä»£ç çš„æ¯ä¸ªéƒ¨åˆ†ä¸ä¸Šé¢çš„æŸä¸ªéƒ¨åˆ†è”ç³»èµ·æ¥ä»¥åŠ©äºç†è§£ã€‚</p><h2 id="æ—¶é—´å’Œå†…å­˜å¤æ‚åº¦">æ—¶é—´å’Œå†…å­˜å¤æ‚åº¦</h2><table><thead><tr><th>æ³¨æ„åŠ›ç±»å‹</th><th>åºåˆ—é•¿åº¦</th><th>æ—¶é—´å’Œå†…å­˜å¤æ‚åº¦</th></tr></thead><tbody><tr><td>åŸå§‹å®Œå…¨æ³¨æ„åŠ›</td><td>512</td><td><code>T</code></td></tr><tr><td></td><td>1024</td><td>4 x <code>T</code></td></tr><tr><td></td><td>4096</td><td>64 x <code>T</code></td></tr><tr><td>å—ç¨€ç–æ³¨æ„åŠ›</td><td>1024</td><td>2 x <code>T</code></td></tr><tr><td></td><td>4096</td><td>8 x <code>T</code></td></tr></tbody></table><p><em>BERT æ³¨æ„åŠ›å’Œ BigBird å—ç¨€ç–æ³¨æ„åŠ›çš„æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦ä¹‹æ¯”è¾ƒã€‚</em></p><details><summary> å±•å¼€ä»¥äº†è§£å¤æ‚åº¦çš„è®¡ç®—è¿‡ç¨‹ã€‚</summary><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">BigBird æ—¶é—´å¤æ‚åº¦ = O(w x n + r x n + g x n)</span><br><span class="line">BERT æ—¶é—´å¤æ‚åº¦ = O(n^2)</span><br><span class="line"></span><br><span class="line">å‡è®¾:</span><br><span class="line"><span class="code">    w = 3 x 64</span></span><br><span class="line"><span class="code">    r = 3 x 64</span></span><br><span class="line"><span class="code">    g = 2 x 64</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">å½“åºåˆ—é•¿åº¦ä¸º 512 æ—¶</span><br><span class="line">=&gt; <span class="strong">**BERT æ—¶é—´å¤æ‚åº¦ = 512^2**</span></span><br><span class="line"></span><br><span class="line">å½“åºåˆ—é•¿åº¦ä¸º 1024 æ—¶</span><br><span class="line">=&gt; BERT æ—¶é—´å¤æ‚åº¦ = (2 x 512)^2</span><br><span class="line">=&gt; <span class="strong">**BERT æ—¶é—´å¤æ‚åº¦ = 4 x 512^2**</span></span><br><span class="line"></span><br><span class="line">=&gt; BigBird æ—¶é—´å¤æ‚åº¦ = (8 x 64) x (2 x 512)</span><br><span class="line">=&gt; <span class="strong">**BigBird æ—¶é—´å¤æ‚åº¦ = 2 x 512^2**</span></span><br><span class="line"></span><br><span class="line">å½“åºåˆ—é•¿åº¦ä¸º 4096 æ—¶</span><br><span class="line">=&gt; BERT æ—¶é—´å¤æ‚åº¦ = (8 x 512)^2</span><br><span class="line">=&gt; <span class="strong">**BERT æ—¶é—´å¤æ‚åº¦ = 64 x 512^2**</span></span><br><span class="line"></span><br><span class="line">=&gt; BigBird æ—¶é—´å¤æ‚åº¦ = (8 x 64) x (8 x 512)</span><br><span class="line">=&gt; BigBird æ—¶é—´å¤æ‚åº¦ = 8 x (512 x 512)</span><br><span class="line">=&gt; <span class="strong">**BigBird æ—¶é—´å¤æ‚åº¦ = 8 x 512^2**</span></span><br></pre></td></tr></table></figure></details><h2 id="itc-ä¸-etc">ITC ä¸ ETC</h2><p>BigBird æ¨¡å‹å¯ä»¥ä½¿ç”¨ 2 ç§ä¸åŒçš„ç­–ç•¥è¿›è¡Œè®­ç»ƒ: <strong>ITC</strong> å’Œ <strong>ETC</strong>ã€‚ ITC (internal transformer constructionï¼Œå†…éƒ¨ transformer æ„å»º) å°±æ˜¯æˆ‘ä»¬ä¸Šé¢è®¨è®ºçš„ã€‚åœ¨ ETC (extended transformer constructionï¼Œæ‰©å±• transformer æ„å»º) ä¸­ï¼Œä¼šæœ‰æ›´å¤šçš„å…¨å±€è¯å…ƒï¼Œä»¥ä¾¿å®ƒä»¬å…³æ³¨æ‰€æœ‰è¯å…ƒæˆ–è€…è¢«æ‰€æœ‰è¯å…ƒå…³æ³¨ã€‚</p><p>ITC éœ€è¦çš„è®¡ç®—é‡è¾ƒå°ï¼Œå› ä¸ºå¾ˆå°‘æœ‰è¯å…ƒæ˜¯å…¨å±€çš„ï¼ŒåŒæ—¶æ¨¡å‹å¯ä»¥æ•è·è¶³å¤Ÿçš„å…¨å±€ä¿¡æ¯ (ä¹Ÿå¯ä»¥å€ŸåŠ©éšæœºæ³¨æ„åŠ›)ã€‚è€Œ ETC å¯¹äºéœ€è¦å¤§é‡å…¨å±€è¯å…ƒçš„ä»»åŠ¡éå¸¸æœ‰å¸®åŠ©ï¼Œä¾‹å¦‚å¯¹ <strong>é—®ç­”</strong> ç±»ä»»åŠ¡è€Œè¨€ï¼Œæ•´ä¸ªé—®é¢˜åº”è¯¥è¢«æ‰€æœ‰ä¸Šä¸‹æ–‡å…³æ³¨ï¼Œä»¥ä¾¿èƒ½å¤Ÿå°†ä¸Šä¸‹æ–‡æ­£ç¡®åœ°ä¸é—®é¢˜ç›¸å…³è”ã€‚</p><p><em><strong>æ³¨æ„:</strong> BigBird è®ºæ–‡æ˜¾ç¤ºï¼Œåœ¨å¾ˆå¤š ETC å®éªŒä¸­ï¼Œéšæœºå—çš„æ•°é‡è®¾ç½®ä¸º 0ã€‚è€ƒè™‘åˆ°æˆ‘ä»¬ä¸Šæ–‡å›¾è§£éƒ¨åˆ†çš„è®¨è®ºï¼Œè¿™æ˜¯åˆç†çš„ã€‚</em></p><p>ä¸‹è¡¨æ€»ç»“äº† ITC å’Œ ETC:</p><table><thead><tr><th></th><th>ITC</th><th>ETC</th></tr></thead><tbody><tr><td>å…¨å±€æ³¨æ„åŠ›çš„æ³¨æ„åŠ›çŸ©é˜µ</td><td>\( A = \begin{bmatrix} 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 \ 1 &amp; &amp; &amp; &amp; &amp; &amp; 1 \ 1 &amp; &amp; &amp; &amp; &amp; &amp; 1 \ 1 &amp; &amp; &amp; &amp; &amp; &amp; 1 \ 1 &amp; &amp; &amp; &amp; &amp; &amp; 1 \ 1 &amp; &amp; &amp; &amp; &amp; &amp; 1 \ 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 \end{bmatrix} \)</td><td>\( B = \begin{bmatrix} 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 \ 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 \ 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 \ 1 &amp; 1 &amp; 1 &amp; &amp; &amp; &amp; &amp; &amp; 1 \ 1 &amp; 1 &amp; 1 &amp; &amp; &amp; &amp; &amp; &amp; 1 \ 1 &amp; 1 &amp; 1 &amp; &amp; &amp; &amp; &amp; &amp; 1 \ 1 &amp; 1 &amp; 1 &amp; &amp; &amp; &amp; &amp; &amp; 1 \ 1 &amp; 1 &amp; 1 &amp; &amp; &amp; &amp; &amp; &amp; 1 \ 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 \end{bmatrix} \)</td></tr><tr><td>å…¨å±€è¯å…ƒ</td><td>2 x <code>block_size</code></td><td><code>extra_tokens</code> + 2 x <code>block_size</code></td></tr><tr><td>éšæœºè¯å…ƒ</td><td><code>num_random_blocks</code> x <code>block_size</code></td><td><code>num_random_blocks</code> x <code>block_size</code></td></tr><tr><td>æ»‘åŠ¨è¯å…ƒ</td><td>3 x <code>block_size</code></td><td>3 x <code>block_size</code></td></tr></tbody></table><h2 id="åœ¨-ğŸ¤—transformers-ä¸­ä½¿ç”¨-bigbird">åœ¨  ğŸ¤—Transformers ä¸­ä½¿ç”¨ BigBird</h2><p>ä½ å¯ä»¥åƒä½¿ç”¨ä»»ä½•å…¶ä»– ğŸ¤— æ¨¡å‹ä¸€æ ·ä½¿ç”¨ <code>BigBirdModel</code> ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹ä»£ç :</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> BigBirdModel</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»é¢„è®­ç»ƒ checkpoint ä¸­åŠ è½½ bigbird æ¨¡å‹</span></span><br><span class="line">model = BigBirdModel.from_pretrained(<span class="string">&quot;google/bigbird-roberta-base&quot;</span>)</span><br><span class="line"><span class="comment"># ä½¿ç”¨é»˜è®¤é…ç½®åˆå§‹åŒ–æ¨¡å‹ï¼Œå¦‚ attention_type = &quot;block_sparse&quot;ï¼Œnum_random_blocks = 3ï¼Œblock_size = 64</span></span><br><span class="line"><span class="comment"># ä½ ä¹Ÿå¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€è¦æ”¹å˜è¿™äº›å‚æ•°ã€‚è¿™ 3 ä¸ªå‚æ•°åªæ”¹å˜æ¯ä¸ªæŸ¥è¯¢è¯å…ƒå…³æ³¨çš„è¯å…ƒæ•°ã€‚</span></span><br><span class="line">model = BigBirdModel.from_pretrained(<span class="string">&quot;google/bigbird-roberta-base&quot;</span>, num_random_blocks=<span class="number">2</span>, block_size=<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡æŠŠ attention_type è®¾æˆ `original_full`ï¼ŒBigBird å°±ä¼šç”¨å¤æ‚åº¦ä¸º n^2 çš„å®Œå…¨æ³¨æ„åŠ›ã€‚æ­¤æ—¶ï¼ŒBigBird ä¸ BERT ç›¸ä¼¼åº¦ä¸º 99.9%ã€‚</span></span><br><span class="line">model = BigBirdModel.from_pretrained(<span class="string">&quot;google/bigbird-roberta-base&quot;</span>, attention_type=<span class="string">&quot;original_full&quot;</span>)</span><br></pre></td></tr></table></figure><p>æˆªè‡³ç°åœ¨ï¼Œ <strong>ğŸ¤— Hub</strong> ä¸­æ€»å…±æœ‰ <strong>3 ä¸ª BigBird checkpoint</strong>: <a href="https://huggingface.co/google/bigbird-roberta-base"><code>bigbird-roberta-base</code></a>ï¼Œ<a href="https://huggingface.co/google/bigbird-roberta-large"><code>bigbird-roberta-large</code></a> ä»¥åŠ <a href="https://huggingface.co/google/bigbird-base-trivia-itc"><code>bigbird-base-trivia-itc</code></a>ã€‚å‰ä¸¤ä¸ªæ£€æŸ¥ç‚¹æ˜¯ä½¿ç”¨ <code>masked_lm æŸå¤±</code> é¢„è®­ç»ƒ <code>BigBirdForPretraining</code> è€Œå¾—; è€Œæœ€åä¸€ä¸ªæ˜¯åœ¨ <code>trivia-qa</code> æ•°æ®é›†ä¸Šå¾®è°ƒ <code>BigBirdForQuestionAnswering</code> è€Œå¾—ã€‚</p><p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚æœç”¨ä½ è‡ªå·±å–œæ¬¢çš„ PyTorch è®­ç»ƒå™¨ï¼Œæœ€å°‘éœ€è¦å¤šå°‘ä»£ç å°±å¯ä»¥ä½¿ç”¨ ğŸ¤— çš„ BigBird æ¨¡å‹æ¥å¾®è°ƒä½ è‡ªå·±çš„ä»»åŠ¡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»¥é—®ç­”ä»»åŠ¡ä¸ºä¾‹</span></span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> BigBirdForQuestionAnswering, BigBirdTokenizer</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">device = torch.device(<span class="string">&quot;cpu&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> torch.cuda.is_available():</span><br><span class="line">    device = torch.device(<span class="string">&quot;cuda&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ‘ä»¬ç”¨é¢„è®­ç»ƒæƒé‡åˆå§‹åŒ– bigbird æ¨¡å‹ï¼Œå¹¶éšæœºåˆå§‹åŒ–å…¶å¤´åˆ†ç±»å™¨</span></span><br><span class="line">model = BigBirdForQuestionAnswering.from_pretrained(<span class="string">&quot;google/bigbird-roberta-base&quot;</span>, block_size=<span class="number">64</span>, num_random_blocks=<span class="number">3</span>)</span><br><span class="line">tokenizer = BigBirdTokenizer.from_pretrained(<span class="string">&quot;google/bigbird-roberta-base&quot;</span>)</span><br><span class="line">model.to(device)</span><br><span class="line"></span><br><span class="line">dataset = <span class="string">&quot;torch.utils.data.DataLoader object&quot;</span></span><br><span class="line">optimizer = <span class="string">&quot;torch.optim object&quot;</span></span><br><span class="line">epochs = ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€ç®€è®­ç»ƒå¾ªç¯</span></span><br><span class="line"><span class="keyword">for</span> e <span class="keyword">in</span> <span class="built_in">range</span>(epochs):</span><br><span class="line">    <span class="keyword">for</span> batch <span class="keyword">in</span> dataset:</span><br><span class="line">        model.train()</span><br><span class="line">        batch = &#123;k: batch[k].to(device) <span class="keyword">for</span> k <span class="keyword">in</span> batch&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å‰å‘</span></span><br><span class="line">        output = model(**batch)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># åå‘</span></span><br><span class="line">        output[<span class="string">&quot;loss&quot;</span>].backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æœ€ç»ˆæƒé‡å­˜è‡³æœ¬åœ°ç›®å½•</span></span><br><span class="line">model.save_pretrained(<span class="string">&quot;&lt;YOUR-WEIGHTS-DIR&gt;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æƒé‡æ¨åˆ° ğŸ¤— Hub ä¸­</span></span><br><span class="line"><span class="keyword">from</span> huggingface_hub <span class="keyword">import</span> ModelHubMixin</span><br><span class="line">ModelHubMixin.push_to_hub(<span class="string">&quot;&lt;YOUR-WEIGHTS-DIR&gt;&quot;</span>, model_id=<span class="string">&quot;&lt;YOUR-FINETUNED-ID&gt;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨å¾®è°ƒåçš„æ¨¡å‹ï¼Œä»¥ç”¨äºæ¨ç†</span></span><br><span class="line">question = [<span class="string">&quot;How are you doing?&quot;</span>, <span class="string">&quot;How is life going?&quot;</span>]</span><br><span class="line">context = [<span class="string">&quot;&lt;some big context having ans-1&gt;&quot;</span>, <span class="string">&quot;&lt;some big context having ans-2&gt;&quot;</span>]</span><br><span class="line">batch = tokenizer(question, context, return_tensors=<span class="string">&quot;pt&quot;</span>)</span><br><span class="line">batch = &#123;k: batch[k].to(device) <span class="keyword">for</span> k <span class="keyword">in</span> batch&#125;</span><br><span class="line"></span><br><span class="line">model = BigBirdForQuestionAnswering.from_pretrained(<span class="string">&quot;&lt;YOUR-FINETUNED-ID&gt;&quot;</span>)</span><br><span class="line">model.to(device)</span><br><span class="line"><span class="keyword">with</span> torch.no_grad():</span><br><span class="line">    start_logits, end_logits = model(**batch).to_tuple()</span><br><span class="line">    <span class="comment"># è¿™é‡Œï¼Œä½ å¯ä»¥ä½¿ç”¨è‡ªå·±çš„ç­–ç•¥å¯¹ start_logitsï¼Œend_logits è¿›è¡Œè§£ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„:</span></span><br><span class="line"><span class="comment"># è¯¥ä»£ç æ®µä»…ç”¨äºå±•ç¤ºå³ä½¿ä½ æƒ³ç”¨è‡ªå·±çš„ PyTorch è®­ç»ƒå™¨å¾®è°ƒ BigBridï¼Œè¿™ä¹Ÿæ˜¯ç›¸å½“å®¹æ˜“çš„ã€‚</span></span><br><span class="line"><span class="comment"># æˆ‘ä¼šå»ºè®®ä½¿ç”¨ ğŸ¤— Trainerï¼Œå®ƒæ›´ç®€å•ï¼ŒåŠŸèƒ½ä¹Ÿæ›´å¤šã€‚</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ BigBird æ—¶ï¼Œéœ€è¦è®°ä½ä»¥ä¸‹å‡ ç‚¹:</p><ul><li>åºåˆ—é•¿åº¦å¿…é¡»æ˜¯å—å¤§å°çš„å€æ•°ï¼Œå³ <code>seqlen % block_size = 0</code> ã€‚ä½ ä¸å¿…æ‹…å¿ƒï¼Œå› ä¸ºå¦‚æœ batch çš„åºåˆ—é•¿åº¦ä¸æ˜¯ <code>block_size</code> çš„å€æ•°ï¼ŒğŸ¤— transformers ä¼šè‡ªåŠ¨å¡«å……è‡³æœ€è¿‘çš„æ•´æ•°å€ã€‚</li><li>ç›®å‰ï¼ŒHugging Face çš„å®ç° <strong>å°šä¸æ”¯æŒ ETC</strong>ï¼Œå› æ­¤åªæœ‰ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå—æ˜¯å…¨å±€çš„ã€‚</li><li>å½“å‰å®ç°ä¸æ”¯æŒ <code>num_random_blocks = 0</code> ã€‚</li><li>è®ºæ–‡ä½œè€…å»ºè®®å½“åºåˆ—é•¿åº¦ &lt; 1024 æ—¶è®¾ç½® <code>attention_type = &quot;original_full&quot;</code> ã€‚</li><li>å¿…é¡»æ»¡è¶³: <code>seq_length &gt; global_token + random_tokens + moving_tokens + buffer_tokens</code> ï¼Œå…¶ä¸­ <code>global_tokens = 2 x block_size</code> ã€ <code>sliding_tokens = 3 x block_size</code> ã€ <code>random_tokens = num_random_blocks x block_size</code> ä¸” <code>buffer_tokens = num_random_blocks x block_size</code> ã€‚å¦‚æœä½ ä¸èƒ½æ»¡è¶³è¿™ä¸€ç‚¹ï¼ŒğŸ¤— transformers ä¼šè‡ªåŠ¨å°† <code>attention_type</code> åˆ‡æ¢ä¸º <code>original_full</code> å¹¶å‘Šè­¦ã€‚</li><li>å½“ä½¿ç”¨ BigBird ä½œä¸ºè§£ç å™¨ (æˆ–ä½¿ç”¨ <code>BigBirdForCasualLM</code> ) æ—¶ï¼Œ <code>attention_type</code> åº”è¯¥æ˜¯ <code>original_full</code> ã€‚ä½†ä½ ä¸ç”¨æ‹…å¿ƒï¼ŒğŸ¤— transformers ä¼šè‡ªåŠ¨å°† <code>attention_type</code> åˆ‡æ¢ä¸º <code>original_full</code> ï¼Œä»¥é˜²ä½ å¿˜è®°è¿™æ ·åšã€‚</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;æ·±å…¥ç†è§£ BigBird çš„å—ç¨€ç–æ³¨æ„åŠ›&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/huggingface/blog/blob/main/zh/big-bird.md&quot;&gt;æ–‡æ¡£æ¥è‡ª&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;å¼•è¨€&quot;&gt;å¼•è¨€&lt;/h2&gt;
&lt;p&gt;</summary>
      
    
    
    
    <category term="ç›¸æœºé©±åŠ¨å¼€å‘" scheme="http://outbreak-sen.github.io/categories/%E7%9B%B8%E6%9C%BA%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="mindsporeå®ä¹ " scheme="http://outbreak-sen.github.io/tags/mindspore%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="æ·±åº¦å­¦ä¹ " scheme="http://outbreak-sen.github.io/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>Mindsporeå®ä¹ -AKG SIGç®—å­addlayernormç¼–è¾‘å’Œåˆå¹¶</title>
    <link href="http://outbreak-sen.github.io/2025/02/10/Mindspore%E5%AE%9E%E4%B9%A0-AKG%20SIG%E7%AE%97%E5%AD%90addlayernorm%E7%BC%96%E8%BE%91%E5%92%8C%E5%90%88%E5%B9%B6/"/>
    <id>http://outbreak-sen.github.io/2025/02/10/Mindspore%E5%AE%9E%E4%B9%A0-AKG%20SIG%E7%AE%97%E5%AD%90addlayernorm%E7%BC%96%E8%BE%91%E5%92%8C%E5%90%88%E5%B9%B6/</id>
    <published>2025-02-10T04:53:11.000Z</published>
    <updated>2025-03-19T09:14:51.132Z</updated>
    
    <content type="html"><![CDATA[<h1>Mindsporeå®ä¹ -AKG SIGç®—å­addlayernormç¼–è¾‘å’Œåˆå¹¶</h1><h2 id="ä»€ä¹ˆæ˜¯ç®—å­">ä»€ä¹ˆæ˜¯ç®—å­</h2><p>è®¡ç®—å›¾å’Œç®—å­åœ¨è®¡ç®—æœ¬è´¨ä¸Šæ˜¯ä¸€è‡´çš„ã€‚<strong>ç®—å­æ˜¯æ‰“åŒ…åçš„è®¡ç®—å›¾ï¼Œè®¡ç®—å›¾æ˜¯æ‹†åŒ…åçš„ç®—å­</strong></p><p>æ¯”å¦‚sigmodå¤åˆç®—å­å¯ä»¥çœ‹ä½œä¸€ä¸ªè®¡ç®—å›¾ï¼Œç”±åŸºç¡€ç®—å­Expï¼ŒAddï¼ŒReciprocalç­‰åŸºç¡€ç®—å­ç»„æˆï¼Œç”¨å°è§„æ¨¡çš„â€œåŸºæœ¬ç®—å­â€é›†åˆå°±å¯ä»¥è¡¨è¾¾ä»»æ„ç°æœ‰è®¡ç®—å›¾ã€‚</p><p>è®¡ç®—å›¾å¯ä»¥å®Œå…¨ç”±åŸºç¡€ç®—å­ç»„æˆï¼Œä½†æ˜¯è¿˜æ˜¯å¾—å®šä¹‰å¤åˆç®—å­ï¼Œæ¯”å¦‚sigmodè¿™ç§ï¼Œå› ä¸ºå¯¹äºåŸºæœ¬ç®—å­è®¡ç®—å›¾æ¥è¯´ï¼Œç›¸é‚»ç®—å­ä¹‹é—´åªèƒ½é€šè¿‡å…¨å±€å†…å­˜ï¼ˆæˆ–æ˜¾å­˜ï¼‰è¿›è¡Œæ•°æ®ä¼ é€’ã€‚è€Œå¯¹äºå¤åˆç®—å­æ¥è¯´ï¼Œç›¸é‚»çš„åŸºæœ¬è®¡ç®—ä¹‹é—´åˆ™å¯ä»¥é€šè¿‡å±€éƒ¨å†…å­˜æˆ–è€…å¯„å­˜å™¨è¿›è¡Œæ•°æ®ä¼ é€’ã€‚é™¤äº†æ€§èƒ½ä¹‹å¤–ï¼Œåœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œé€šè¿‡ç®—å­èåˆä¹Ÿèƒ½æœ‰æ•ˆå‡å°‘å¯¹å…¨å±€å†…å­˜çš„çš„å®é™…å ç”¨ã€‚</p><h1>mindsporeçš„ç®—å­èåˆæ–¹æ¡ˆæ˜¯ä»€ä¹ˆ</h1><p>åœ¨TVMã€XLAç­‰è‡ªåŠ¨ç®—å­ç¼–è¯‘æŠ€æœ¯å‡ºç°ä¹‹å‰ï¼ŒAIæ¡†æ¶ä¸»æµé‡‡ç”¨æ‰‹å·¥èåˆçš„æ–¹å¼è§£å†³å¦‚ä¸Šé—®é¢˜ã€‚ä¸»è¦æ€è·¯æ˜¯ï¼š</p><ul><li><p>æ‰‹å·¥èåˆ: 1ï¼‰è¯†åˆ«å¸¸è§çš„çƒ­ç‚¹ç®—å­ç»„åˆå­å›¾ï¼Œæ¯”å¦‚ï¼š Add(Mul(x, y))ã€‚ç„¶åé’ˆå¯¹è¯¥ç®—å­å­å›¾æ‰‹å·¥å®ç°å¯¹åº”èåˆç®—å­ï¼› 2ï¼‰å°†èåˆç®—å­æ³¨å†Œåˆ°AIæ¡†æ¶ï¼Œå¹¶åœ¨AIæ¡†æ¶ä¸­å¢åŠ å¯¹åº”çš„ä¼˜åŒ–passï¼Œå°†åŒ¹é…çš„ç®—å­å­å›¾æ›¿æ¢ä¸ºèåˆç®—å­èŠ‚ç‚¹ã€‚ è¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚å› ä¸ºå®ƒåªèƒ½é’ˆå¯¹è‹¥å¹²çƒ­ç‚¹åœºæ™¯è¿›è¡Œèåˆï¼Œæ‰€ä»¥æ˜¯æ— æ³•åšåˆ°é€šç”¨å’Œæ³›åŒ–çš„ã€‚</p></li><li><p>XLAï¼šXLAæœ€æ—©åŸºäºTensorFlowå¼€å‘ã€‚ä¸è¿‡å®ƒé‡‡ç”¨äº†ä¸TensorFlowä¸åŒçš„è®¡ç®—å›¾IRè¡¨ç¤ºã€‚æ‰€ä»¥åœ¨TensorFlowä¸­ï¼Œéœ€è¦å°†TensorFlowçš„è®¡ç®—å›¾IRé¦–å…ˆè½¬æ¢ä¸ºXLAçš„è®¡ç®—å›¾IRï¼ˆHLOï¼‰ã€‚ç„¶åXLAåŸºäºHLOè¿›è¡Œèåˆä¼˜åŒ–ç­‰ï¼Œæœ€åé€šè¿‡LLVMç­‰åç«¯ç¼–è¯‘ç”Ÿæˆç›¸åº”èåˆç®—å­ã€‚ç”±äºé‡‡ç”¨ç‹¬ç«‹çš„IRï¼ŒXLAå…·æœ‰è¾ƒå¥½çš„å¯ç§»æ¤æ€§ï¼Œç›®å‰åœ¨PyTorchã€JAXç­‰éTensorFlowæ¡†æ¶ä¸­ä¹Ÿæœ‰ä¸é”™çš„è¡¨ç°ã€‚</p></li><li><p>TVMï¼šTVMä¸»è¦ç”¨äºæ¨ç†åœºæ™¯ã€‚åœ¨æ¶æ„ä¸Šï¼Œä¸»è¦åŒ…æ‹¬relayå’Œtirä¸¤å±‚ã€‚å…¶é€šè¿‡relayå¯¼å…¥æ¨ç†æ¨¡å‹ï¼Œç„¶åè¿›è¡Œèåˆä¼˜åŒ–ï¼Œæœ€åé€šè¿‡tirç”Ÿæˆèåˆç®—å­ã€‚TVMåœ¨ç®—å­ç¼–è¯‘æ–¹é¢é‡‡ç”¨computeå’Œscheduleåˆ†ç¦»çš„æŠ€æœ¯ï¼Œå¹¶ä¸”ä¸åŒç®—å­computeæ‰€éœ€è¦çš„scheduleé€šå¸¸æ˜¯ä¸åŒçš„ã€‚ä¸ºäº†æ›´å¥½æ”¯æŒä¸åŒèåˆç®—å­åœºæ™¯ï¼ŒTVMæ”¯æŒå¯¹ç®—å­è¿›è¡Œè‡ªåŠ¨tuningï¼Œæ¥ç”Ÿæˆè¾ƒä¼˜çš„åˆ‡åˆ†å‚æ•°ç”šè‡³scheduleã€‚ç”±äºtuningç©ºé—´è¾ƒå¤§ï¼Œç›®å‰tuningæ—¶é—´ç›¸å¯¹è¿˜æ˜¯æ¯”è¾ƒé•¿çš„ã€‚</p></li></ul><p>åŸºäºä»¥ä¸Šé—®é¢˜èƒŒæ™¯ï¼Œå¹¶ç»“åˆMindSporeè‡ªèº«éœ€æ±‚ï¼Œæˆ‘ä»¬æå‡ºå›¾ç®—èåˆè§£å†³æ–¹æ¡ˆã€‚å…¶ä¸»è¦æ€è·¯æ˜¯ï¼š</p><ul><li>å›¾ç®—èåˆè§£å†³æ–¹æ¡ˆ: 1ï¼‰3.9ä»¥é€šç”¨çš„patternè¯†åˆ«è®¡ç®—å›¾ä¸­çš„èåˆåœºæ™¯ï¼Œå¹¶ç”Ÿæˆèåˆç®—å­å­å›¾ï¼›2ï¼‰å°†ç”Ÿæˆçš„èåˆç®—å­å­å›¾é€šè¿‡è‡ªåŠ¨ç®—å­ç¼–è¯‘æŠ€æœ¯ï¼ˆAKGï¼‰ç”Ÿæˆå¯¹åº”çš„èåˆç®—å­ã€‚</li></ul><h2 id="ä»€ä¹ˆæ˜¯å›¾ç®—èåˆç¼–è¯‘æŠ€æœ¯">ä»€ä¹ˆæ˜¯å›¾ç®—èåˆç¼–è¯‘æŠ€æœ¯</h2><p>æˆ‘ä»¬å¦‚æœéœ€è¦æŠŠæ¨¡å‹éƒ¨ç½²åˆ°CPUç”šè‡³æ‰‹æœºä¸Šå»ï¼Œæ­¤æ—¶éœ€è¦å…¶ä»–ç¡¬ä»¶åŠå…¶æ¶æ„çš„æ”¯æŒã€‚å¼€å‘è€…ä»¬å¾€å¾€ä¼šæ ¹æ®å®é™…æƒ…å†µé€‰æ‹©å„ç§å„æ ·çš„æ·±åº¦å­¦ä¹ é¡¶å±‚æ¡†æ¶è®­ç»ƒæ¨¡å‹ï¼Œä¾‹å¦‚æ˜‡æ€MindSporeç­‰ï¼Œå†æŠŠè®­ç»ƒå¥½çš„æ¨¡å‹éƒ¨ç½²åˆ°å„ç§å„æ ·çš„è®¾å¤‡åç«¯åŒ…æ‹¬GPUã€CPUã€FPGAã€æ˜‡è…¾AIå¤„ç†å™¨åŠå…¶å®ƒæ–°å‹çš„AIåŠ é€Ÿå™¨ä¸Šã€‚</p><p>è€ƒè™‘åˆ°ä¸åŒç¡¬ä»¶è®¾å¤‡çš„ç‰¹æ€§åƒå·®ä¸‡åˆ«ã€ç°æœ‰ç®—å­åº“ä¸­ç®—å­åŒ…å«èŒƒå›´ä¸åŒã€æ–°å‹åŠ é€Ÿå™¨ç®—å­åº“æ”¯æŒä¸è¶³ã€éå¸¸è§„çš„ç¥ç»ç½‘ç»œä¸­å­˜åœ¨ä¸å¸¸è§çš„layerç­‰ç­‰æƒ…å†µï¼Œå¼€å‘è€…è¦å®Œæˆæ‰‹å†™ç®—å­å¹¶ä¿è¯æ€§èƒ½ï¼Œå­¦ä¹ æˆæœ¬å’Œæ—¶é—´æˆæœ¬éƒ½å˜å¾—å¾ˆé«˜ï¼Œæ‰€ä»¥å›¾ç®—èåˆç¼–è¯‘æŠ€æœ¯çš„å‡ºç°å˜å¾—éå¸¸æœ‰å¿…è¦ã€‚</p><p><a href="https://www.mindspore.cn/docs/programming_guide/zh-CN/r1.6/graph_kernel_fusion.html">è¿™é‡Œæœ‰ä¸€ä¸ªä»‹ç»</a></p><h2 id="ä»€ä¹ˆæ˜¯è‡ªåŠ¨ç®—å­ç¼–è¯‘æŠ€æœ¯akg">ä»€ä¹ˆæ˜¯è‡ªåŠ¨ç®—å­ç¼–è¯‘æŠ€æœ¯AKG</h2><p>AKGæ˜¯Auto Kernel Generatorçš„ç®€ç§°ï¼Œ&quot;SIG&quot;æ˜¯ä¸€ä¸ªå¸¸è§çš„ç¼©å†™ï¼Œå…¨ç§°ä¸º â€œSpecial Interest Groupâ€ï¼Œä¸­æ–‡ç›´è¯‘ä¸ºâ€œç‰¹æ®Šå…´è¶£å°ç»„â€æˆ–è€…â€ç‰¹æ®Šåˆ©ç›Šé›†å›¢â€œã€‚</p><p>AKG(Auto Kernel Generator)å¯¹æ·±åº¦ç¥ç»ç½‘ç»œä¸­çš„ç®—å­è¿›è¡Œä¼˜åŒ–ï¼Œå¹¶æä¾›ç‰¹å®šæ¨¡å¼ä¸‹çš„ç®—å­è‡ªåŠ¨èåˆåŠŸèƒ½ã€‚AKGä¸MindSporeçš„å›¾ç®—èåˆåŠŸèƒ½ååŒå·¥ä½œï¼Œå¯æå‡åœ¨ä¸åŒç¡¬ä»¶åç«¯ä¸Šè¿è¡Œç½‘ç»œçš„æ€§èƒ½ã€‚AKGåŸºäºpolyhedralæŠ€æœ¯ï¼Œå¤šé¢ä½“ã€‚</p><h1>ä»»åŠ¡-addlayernorm</h1><p>ã€ä»»åŠ¡èƒŒæ™¯ã€‘<br>AKG-MLIR å·²ç»åœ¨ MindSpore Dialect å†…æä¾›äº†åŸºç¡€ç®—å­çš„å®šä¹‰å’Œå¯¹åº”çš„Loweræµç¨‹ã€‚ä½†æ˜¯ï¼Œå½“å‰MindSpore  Dialectç®—å­é›†æ˜¯åŸºäºä¼ ç»Ÿçš„Bert/Transformerç±»ç½‘ç»œçš„éœ€æ±‚æ¢³ç†å’Œç»Ÿè®¡çš„ã€‚éšç€ç½‘ç»œçš„å˜åŒ–ï¼Œæˆ‘ä»¬æœ‰æ›´å¤šç®—å­çš„éœ€æ±‚å¸Œæœ›æ·»åŠ åœ¨  MindSpore Dialect ä¹‹ä¸­ã€‚</p><p>ã€éœ€æ±‚æè¿°ã€‘</p><ol><li>åœ¨MindSporeOps.tdä¸­æ·»åŠ å¯¹åº”ç®—å­çš„å®ç°</li><li>æ‰“é€šç®—å­çš„Loweræµç¨‹(ç›´æ¥loweråˆ°Linalgæˆ–è€…loweråˆ°TOSA)ï¼Œç›¸å…³Dialectçš„ä»£ç ï¼ˆå¦‚MindSporeToTosa.cppæˆ–è€…MindSporeToLinalg.cppï¼‰</li><li>æä¾›å¯¹åº”çš„æµ‹è¯•ç”¨ä¾‹ï¼ˆç®—å­çš„infoæ–‡ä»¶å’Œå¯¹åº”çš„op_dslï¼‰</li></ol><p>ã€å‚è€ƒèµ„æ–™ã€‘</p><ol><li>æ ·ä¾‹ä»£ç ä»“:<a href="https://gitee.com/mindspore/akg/pulls/989">https://gitee.com/mindspore/akg/pulls/989</a></li><li>ä»£ç æ·»åŠ æ•™ç¨‹wiki:<a href="https://gitee.com/monkeykingd/akg/wikis/AKG-MLIR%E7%AE%97%E5%AD%90%E6%B7%BB%E5%8A%A0%E7%94%A8%E4%BE%8B">https://gitee.com/monkeykingd/akg/wikis/AKG-MLIRç®—å­æ·»åŠ ç”¨ä¾‹</a></li><li>æµ‹è¯•ç”¨ä¾‹æ•™ç¨‹wiki:<a href="https://gitee.com/monkeykingd/akg/wikis/AKG-MLIR%E5%8D%95%E7%AE%97%E5%AD%90%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%E6%9E%84%E5%BB%BA">https://gitee.com/monkeykingd/akg/wikis/AKG-MLIRå•ç®—å­æµ‹è¯•ç”¨ä¾‹æ„å»º</a></li></ol><p>ã€éªŒæ”¶æ ‡å‡†ã€‘<br>æ ¹æ®å‚è€ƒèµ„æ–™ä¸­çš„å‚è€ƒæµ‹è¯•æ–‡ä»¶(<a href="http://demo.info">demo.info</a>)æ„å»ºæµ‹è¯•ç”¨ä¾‹ï¼Œä½¿ç”¨python  ${path_to_py_benchmark}/py_benchmark.py -e cpu -f <a href="http://mul.info">mul.info</a> --dump_ir  1è¿è¡Œå‘½ä»¤ï¼Œå’Œnumpyæ¨¡æ‹Ÿçš„ç®—å­ç»“æœä¸€è‡´</p><p>ã€ä»»åŠ¡æŠ€æœ¯è¦æ±‚ã€‘<br>Python, MindSpore &gt; 2.3</p><p>æˆ‘è¦åšä»€ä¹ˆï¼Ÿ<br>æŠŠmindsporeçš„AKGå®‰è£…èµ·æ¥ç„¶åæ ¹æ®å‚è€ƒèµ„æ–™é‡Œçš„ï¼Œåˆ©ç”¨åŸºç¡€ç®—å­å†™addlayernormè¿™ä¸ªç®—å­çš„å®ç°ç„¶åæ·»åŠ loweræµç¨‹ç„¶åå†å†™ä¸€ä¸ªæµ‹è¯•ç¤ºä¾‹ï¼ŒæŠŠæ•´ä¸ªä»£ç pushä¸Šå»ï¼Œè®©å¯¼å¸ˆé€šè¿‡ã€‚</p><h1>AKGå®‰è£…</h1><p>å®˜æ–¹æ–‡æ¡£é‡Œå†™äº†ä»MindSporeä¾§æ„å»ºè¿è¡ŒAKGä»£ç ä½†æ˜¯è¯¦ç»†ç»†èŠ‚å†™äº†ä¸ªå¯‚å¯ï¼Œç„¶åå…¨æ˜¯ç‹¬ç«‹æ„å»ºæ–¹æ³•</p><p><a href="https://gitee.com/mindspore/akg#%E7%8B%AC%E7%AB%8B%E6%9E%84%E5%BB%BA">AKGå®‰è£…è¿‡ç¨‹</a></p><h2 id="ä»mindsporeçš„whlå®‰è£…-å¤±è´¥-ä½†æ˜¯åé¢è¿˜æ˜¯è¿™ä¹ˆåšäº†">ä»mindsporeçš„whlå®‰è£…ï¼Œå¤±è´¥ï¼Œä½†æ˜¯åé¢è¿˜æ˜¯è¿™ä¹ˆåšäº†</h2><p>ç‹¬ç«‹æ„å»ºæ–¹æ³•ç½‘ä¸Šæœ‰ï¼Œæˆ‘åä¸ç”¨ï¼Œçœ‹çœ‹è¿™ä¸ªä»MindSporeä¾§æ€ä¹ˆå®‰è£…ï¼Œç†è®ºä¸ŠAKGæ˜¯mindsporeçš„å­ä»“åº“åº”è¯¥æ˜¯è‡ªåŠ¨å®‰è£…äº†ã€‚</p><ul><li><s>é¦–å…ˆæˆ‘åˆ›å»ºä¸€ä¸ªä¸€ä¸ªpython3.9 condaç¯å¢ƒç„¶åå®‰è£…Mindspore2.3å®‰è£…æ–¹æ³•æ˜¯ä¸‹è½½whlåŒ…</s>ï¼Œè¿™ä¸ªæ²¡æœ‰å‡ºç°é—®é¢˜æ—¥</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install mindspore-2.3.1-cp39-cp39-linux_x86_64.whl</span><br></pre></td></tr></table></figure><p>ä¸è¿‡å¦‚æœæ˜¯å®ä¹ çš„è¯ï¼Œéœ€è¦æ¨è‡ªå·±çš„æ”¹åŠ¨ï¼Œé‚£æˆ‘å²‚ä¸æ˜¯æœ€å¥½gitä¸‹è½½ç„¶åsourceå®‰è£…mindsporeï¼Œç®—äº†ã€‚<strong>åæ¥å‘ç°ç¡®å®æ˜¯è¿™æ ·ï¼Œå› ä¸ºè¿™æ ·æ‰¾ä¸åˆ°testsæ–‡ä»¶å¤¹ï¼Œå°±æ— æ³•è¿è¡Œå®˜æ–¹æ–‡æ¡£é‡Œé¢çš„è®¾ç½®ç¯å¢ƒå˜é‡å’Œè¿è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œæƒ³äº†ä¸€ä¸‹è¿˜æ˜¯è¿›è¡Œæºç å®‰è£…ï¼Œå› ä¸ºåˆå¯ä»¥çœ‹æºç åˆå¯ä»¥å®‰è£…ç¯å¢ƒ</strong>ä½†æ˜¯åæ¥</p><h2 id="ä»mindsporeçš„æºç å®‰è£…">ä»mindsporeçš„æºç å®‰è£…</h2><p>æˆ‘é€‰æ‹©å®‰è£…çš„æ˜¯CPUçš„ubuntu x86æ¶æ„çš„æºç ï¼Œå‚è€ƒmindsporeçš„ä»“åº“ä¸»é¡µ<a href="https://gitee.com/mindspore/docs/blob/master/install/mindspore_cpu_install_source.md">CPUå®‰è£…æºç </a></p><p>é¦–å…ˆå®‰è£…ä»¥ä¸‹ä¾èµ–è½¯ä»¶ï¼Œæˆ‘çš„éº»</p><table><thead><tr><th>è½¯ä»¶åç§°</th><th>ç‰ˆæœ¬</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>Ubuntu</td><td>18.04</td><td>ç¼–è¯‘å’Œè¿è¡ŒMindSporeçš„æ“ä½œç³»ç»Ÿ</td></tr><tr><td><a href="https://gitee.com/mindspore/docs/blob/master/install/mindspore_cpu_install_source.md#%E5%AE%89%E8%A3%85python">Python</a></td><td>3.9-3.11</td><td>MindSporeçš„ä½¿ç”¨ä¾èµ–Pythonç¯å¢ƒ</td></tr><tr><td><a href="https://gitee.com/mindspore/docs/blob/master/install/mindspore_cpu_install_source.md#%E5%AE%89%E8%A3%85wheel-setuptools-pyyaml%E5%92%8Cnumpy">wheel</a></td><td>0.32.0åŠä»¥ä¸Š</td><td>MindSporeä½¿ç”¨çš„Pythonæ‰“åŒ…å·¥å…·</td></tr><tr><td><a href="https://gitee.com/mindspore/docs/blob/master/install/mindspore_cpu_install_source.md#%E5%AE%89%E8%A3%85wheel-setuptools-pyyaml%E5%92%8Cnumpy">setuptools</a></td><td>44.0åŠä»¥ä¸Š</td><td>MindSporeä½¿ç”¨çš„PythonåŒ…ç®¡ç†å·¥å…·</td></tr><tr><td><a href="https://gitee.com/mindspore/docs/blob/master/install/mindspore_cpu_install_source.md#%E5%AE%89%E8%A3%85wheel-setuptools-pyyaml%E5%92%8Cnumpy">PyYAML</a></td><td>6.0-6.0.2</td><td>MindSporeé‡Œçš„ç®—å­ç¼–è¯‘åŠŸèƒ½ä¾èµ–PyYAMLæ¨¡å—</td></tr><tr><td><a href="https://gitee.com/mindspore/docs/blob/master/install/mindspore_cpu_install_source.md#%E5%AE%89%E8%A3%85wheel-setuptools-pyyaml%E5%92%8Cnumpy">Numpy</a></td><td>1.19.3-1.26.4</td><td>MindSporeé‡Œçš„Numpyç›¸å…³åŠŸèƒ½ä¾èµ–Numpyæ¨¡å—</td></tr><tr><td><a href="https://gitee.com/mindspore/docs/blob/master/install/mindspore_cpu_install_source.md#%E5%AE%89%E8%A3%85gcc-git-tclsh-patch%E5%92%8Cnuma">GCC</a></td><td>7.3.0åˆ°9.4.0ä¹‹é—´</td><td>ç”¨äºç¼–è¯‘MindSporeçš„C++ç¼–è¯‘å™¨</td></tr><tr><td><a href="https://gitee.com/mindspore/docs/blob/master/install/mindspore_cpu_install_source.md#%E5%AE%89%E8%A3%85gcc-git-tclsh-patch%E5%92%8Cnuma">git</a></td><td>-</td><td>MindSporeä½¿ç”¨çš„æºä»£ç ç®¡ç†å·¥å…·</td></tr><tr><td><a href="https://gitee.com/mindspore/docs/blob/master/install/mindspore_cpu_install_source.md#%E5%AE%89%E8%A3%85cmake">CMake</a></td><td>3.22.2åŠä»¥ä¸Š</td><td>ç¼–è¯‘æ„å»ºMindSporeçš„å·¥å…·</td></tr><tr><td><a href="https://gitee.com/mindspore/docs/blob/master/install/mindspore_cpu_install_source.md#%E5%AE%89%E8%A3%85gcc-git-tclsh-patch%E5%92%8Cnuma">tclsh</a></td><td>-</td><td>MindSpore sqliteç¼–è¯‘ä¾èµ–</td></tr><tr><td><a href="https://gitee.com/mindspore/docs/blob/master/install/mindspore_cpu_install_source.md#%E5%AE%89%E8%A3%85gcc-git-tclsh-patch%E5%92%8Cnuma">patch</a></td><td>2.5åŠä»¥ä¸Š</td><td>MindSporeä½¿ç”¨çš„æºä»£ç è¡¥ä¸å·¥å…·</td></tr><tr><td><a href="https://gitee.com/mindspore/docs/blob/master/install/mindspore_cpu_install_source.md#%E5%AE%89%E8%A3%85gcc-git-tclsh-patch%E5%92%8Cnuma">NUMA</a></td><td>2.0.11åŠä»¥ä¸Š</td><td>MindSporeä½¿ç”¨çš„éä¸€è‡´æ€§å†…å­˜è®¿é—®åº“</td></tr><tr><td><a href="https://gitee.com/mindspore/docs/blob/master/install/mindspore_cpu_install_source.md#%E5%AE%89%E8%A3%85llvm-%E5%8F%AF%E9%80%89">LLVM</a></td><td>12.0.1</td><td>MindSporeä½¿ç”¨çš„ç¼–è¯‘å™¨æ¡†æ¶ï¼ˆå¯é€‰ï¼Œå›¾ç®—èåˆä»¥åŠç¨€ç–è®¡ç®—éœ€è¦ï¼‰</td></tr></tbody></table><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»¥ä¸Šä¾èµ–çš„å®‰è£…è¿‡ç¨‹</span></span><br><span class="line">conda create -n mindspore39AKGSource python=3.9</span><br><span class="line">pip install wheel</span><br><span class="line">pip install -U setuptools</span><br><span class="line">pip install pyyaml</span><br><span class="line">pip install <span class="string">&quot;numpy&gt;=1.19.3,&lt;=1.26.4&quot;</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get install gcc-7 git tcl patch libnuma-dev -y <span class="comment"># å‘ç°éƒ½å®‰è£…äº†</span></span><br><span class="line"><span class="comment"># cmakeå·²ç»å®‰è£…äº†ï¼Œä½†æ˜¯å‘ç°äº†ä¸€ä¸ªaptå®‰è£…cmakeçš„æ–¹æ³•å¦‚ä¸‹</span></span><br><span class="line">wget -O - https://apt.kitware.com/keys/kitware-archive-latest.asc 2&gt;/dev/null | <span class="built_in">sudo</span> apt-key add -</span><br><span class="line"><span class="built_in">sudo</span> apt-add-repository <span class="string">&quot;deb https://apt.kitware.com/ubuntu/ <span class="subst">$(lsb_release -cs)</span> main&quot;</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get install cmake -y</span><br><span class="line"><span class="comment"># # ä»¥ä¸Šä¾èµ–ä¸­çš„LLVMçš„å®‰è£…è¿‡ç¨‹ï¼Œå®‰è£…LLVMæ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯æˆ‘ä¸çŸ¥é“å“ªé‡Œå¯é€‰</span></span><br><span class="line">wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key | <span class="built_in">sudo</span> apt-key add -</span><br><span class="line"><span class="built_in">sudo</span> add-apt-repository <span class="string">&quot;deb http://apt.llvm.org/bionic/ llvm-toolchain-bionic-12 main&quot;</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get update</span><br><span class="line"><span class="built_in">sudo</span> apt-get install llvm-12-dev -y</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–è¯‘å®‰è£…mindspore 2.3.1 </span></span><br><span class="line">git <span class="built_in">clone</span> https://gitee.com/mindspore/mindspore.git</span><br><span class="line">git checkout  v2.3.1 <span class="comment">#è¦æ›´æ¢ç‰ˆæœ¬ï¼Œä½†æ˜¯åæ¥æƒ³äº†ä¸€ä¸‹å¥½åƒä¹Ÿæ²¡å¿…è¦</span></span><br><span class="line">bash build.sh -e cpu -j4 -S on <span class="comment"># é»˜è®¤ä»githubä¸‹è½½ä¾èµ–æºç ï¼Œå½“-Sé€‰é¡¹è®¾ç½®ä¸ºonæ—¶ï¼Œä»å¯¹åº”çš„giteeé•œåƒä¸‹è½½ã€‚è¿™ä¸€æ­¥åªæ˜¯ç¼–è¯‘æˆwhlï¼Œè¦å®‰è£…è¿˜å¾—install</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŠ¥é”™äº†configure: WARNING: *** Could not find Flex on your system</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get install flex </span><br><span class="line"><span class="built_in">sudo</span> apt-get install bison </span><br><span class="line"><span class="comment">#åˆæŠ¥é”™äº†PYTHON_INCLUDE_DIRS = /usr/include/python3.10 PYTHON_LIBRARIES = /usr/lib/x86_64-linux-gnu/libpython3.10.so MS LIBS CACHE PATH:  /home/outbreak/mindspore/AKG/mindspore/build/mindspore/.mslib</span></span><br><span class="line"><span class="comment">#CMake Error at cmake/gencode.cmake:13 (message):Generate operator python/c++ definitions FAILED.</span></span><br><span class="line"><span class="comment"># ç„¶åè¿™ä¸ªæŠ¥é”™æˆ‘è§£å†³ä¸äº†ï¼Œè‰˜ä¸åˆ°ä¹Ÿçœ‹ä¸æ‡‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½†æ˜¯æˆ‘çªç„¶æƒ³åˆ°ï¼Œè¿™ä¸€æ­¥ä¸å°±æ˜¯ç”Ÿæˆwhlçš„å—ï¼Œæ‰€ä»¥æˆ‘å¹²è„†åªä¸‹è½½æºç ä½†æ˜¯ç”¨ç½‘ä¸Šç¼–è¯‘å¥½çš„whlç®—äº†ï¼Œç„¶åç»“åˆåŒä¸€ä¸ªç‰ˆæœ¬çš„mindsporeä»“åº“è¿›è¡Œç¼–è¾‘æµ‹è¯•ã€‚åç»è¿‡äº†æµ‹è¯•ï¼Œå‘ç°è¿™æ ·å¹¶ä¸è¡Œï¼Œå› ä¸ºè¿è¡Œakg/testæ–‡ä»¶çš„æ—¶å€™å¹¶æ²¡æœ‰æ‰¾åˆ°test_add.pyï¼ŒæŠ¥é”™ERROR test_abs.py - RuntimeError: Cannot find the files.</span></span><br><span class="line"><span class="comment">#æˆ‘è§‰å¾—æ˜¯æˆ‘çš„whlå®‰è£…è¿‡ç¨‹å¹¶æ²¡æœ‰é“¾æ¥è¿™ä¸ªæºç ä¸­çš„AKGçš„æ–‡ä»¶å¤¹ï¼Œæˆ‘çš„çŒœæµ‹æ˜¯è¿™æ ·çš„ã€‚æ‰€ä»¥æœ€ç»ˆæ€ä¹ˆå®‰è£…è¯·çœ‹ä¸‹é¢çš„æœ€ç»ˆè§£å†³æ–¹æ¡ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœbash build.sh -e cpu -j4 -S onæˆåŠŸçš„è¯è¯·ç»§ç»­</span></span><br><span class="line">pip install output/mindspore-*.whl -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line"><span class="comment"># è¿™ä¸€æ­¥åœ¨è”ç½‘çŠ¶æ€ä¸‹ï¼Œå®‰è£…whlåŒ…æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½mindsporeå®‰è£…åŒ…çš„ä¾èµ–é¡¹ï¼ˆä¾èµ–é¡¹è¯¦æƒ…å‚è§setup.pyä¸­çš„required_packageï¼‰ï¼Œå…¶ä½™æƒ…å†µéœ€è‡ªè¡Œå®‰è£…ã€‚è¿è¡Œæ¨¡å‹æ—¶ï¼Œéœ€è¦æ ¹æ®ModelZooä¸­ä¸åŒæ¨¡å‹æŒ‡å®šçš„requirements.txtå®‰è£…é¢å¤–ä¾èµ–ï¼Œå¸¸è§ä¾èµ–å¯ä»¥å‚è€ƒrequirements.txtã€‚</span></span><br><span class="line"><span class="comment"># éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">python -c <span class="string">&quot;import mindspore;mindspore.set_device(device_target=&#x27;CPU&#x27;);mindspore.run_check()&quot;</span></span><br><span class="line"><span class="comment"># è¿™ä¸€æ­¥åº”è¯¥ä¼šè¾“å‡ºMindSpore version: ç‰ˆæœ¬å·</span></span><br><span class="line">The result of multiplication calculation is correct, MindSpore has been installed on platform [CPU] successfully!</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æœ€ç»ˆçš„è§£å†³æ–¹æ¡ˆmindsporeçš„whlå®‰è£…-akgæºç å®‰è£…">æœ€ç»ˆçš„è§£å†³æ–¹æ¡ˆmindsporeçš„whlå®‰è£…+AKGæºç å®‰è£…</h2><p>ok fine ,æœ€åç»ˆäºæˆåŠŸäº†ï¼Œæ•´ç†ä¸€ä¸‹æ€è·¯ï¼Œå°±æ˜¯è¯´ä»å®˜ç½‘åªä¸‹è½½AKGçš„æºç ï¼Œå½“ç„¶mindsporeçš„ä»“åº“é‡Œæœ‰AKGè¿™ä¸ªå­ä»“åº“ï¼Œç„¶åæˆ‘ç”¨å®˜æ–¹ç¼–è¯‘å¥½çš„whlè¿›è¡Œå®‰è£…ï¼Œå®‰è£…ç‰ˆæœ¬ä¸º2.3.1ï¼Œè¿™ä¸ªå®‰è£…æ²¡æœ‰å‡ºç°é—®é¢˜</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">conda create -n mindspore39NLP python=3.9</span><br><span class="line">pip install mindspore-2.3.1-cp39-cp39-linux_x86_64.whl <span class="comment">#è¿™å°±å®‰è£…å®Œæˆäº†</span></span><br><span class="line"><span class="comment"># ä»¥ä¸‹ä¸ºAKGçš„ç‹¬ç«‹æ„å»ºæ–¹å¼ï¼Œé’ˆå¯¹CPU</span></span><br><span class="line">git <span class="built_in">clone</span> https://gitee.com/mindspore/akg.git </span><br><span class="line"><span class="built_in">cd</span> akg</span><br><span class="line">bash build.sh -e cpu -j8</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸­é€”æŠ¥é”™ModuleNotFoundError: No module named &#x27;decorator&#x27;</span></span><br><span class="line">pip install decorator</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸­é€”æŠ¥é”™OSError: /home/outbreak/anaconda3/envs/mindspore39NLP/bin/../lib/libstdc++.so.6: version `GLIBCXX_3.4.30&#x27; not found (required by /home/outbreak/mindspore/AKG/akg/build/libakg.so)</span></span><br><span class="line">strings /home/outbreak/anaconda3/envs/mindspore39NLP/lib/libstdc++.so.6  | grep GLIBC <span class="comment">#è¿™ä¸ªæ˜¯æŸ¥è¯¢å½“å‰çš„condaç¯å¢ƒé‡Œæœ‰å“ªäº›stdc++ï¼Œå…¶ä¸­å‘ç°åªæœ‰GLIBCXX_3.4.29ï¼Œå¹¶æ²¡æœ‰GLIBCXX_3.4.30</span></span><br><span class="line">strings /usr/lib/x86_64-linux-gnu/libstdc++.so.6 | grep GLIBCXX <span class="comment">#è¿™ä¸ªæ˜¯æŸ¥è¯¢æœ¬åœ°ç¯å¢ƒä¸­æœ‰å“ªäº›stdc++ï¼Œcondaç¯å¢ƒé‡ŒæŸäº›åŒ…éœ€è¦æŸä¸ªç‰ˆæœ¬çš„c++ï¼Œä¸€èˆ¬ä¼šä»æœ¬åœ°ç¯å¢ƒä¸­å¤åˆ¶è¿›condaç¯å¢ƒä¸­ï¼Œå¦‚æœæ²¡æœ‰åˆ™æŠ¥é”™ï¼Œè§£å†³æ–¹æ³•æ˜¯é“¾æ¥è¿›condaç¯å¢ƒé‡Œ</span></span><br><span class="line"><span class="built_in">ln</span> -sf /usr/lib/x86_64-linux-gnu/libstdc++.so.6 /home/outbreak/anaconda3/envs/mindspore39NLP/bin/../lib/libstdc++.so.6</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> tests</span><br><span class="line"><span class="comment"># è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œè¿™é‡Œæœ‰å¾ˆå¤§çš„ä½œç”¨ï¼Œsourceçš„ä½ç½®ä¸€å®šè¦å¯¹ï¼Œè¦ä¸ç„¶æ‰¾ä¸åˆ°æµ‹è¯•æ–‡ä»¶ï¼Œå¡bug</span></span><br><span class="line"><span class="built_in">source</span> ./test_env.sh cpu</span><br><span class="line"><span class="comment"># AKGæµ‹è¯•</span></span><br><span class="line"><span class="built_in">cd</span> tests/st</span><br><span class="line">python run.py -e cpu -o add -l level0  <span class="comment"># æ‰§è¡ŒCPU Addç®—å­çš„level0ç”¨ä¾‹ï¼ŒåŒ…å«äº†ä¸‹é¢çš„test_abs</span></span><br><span class="line"><span class="built_in">cd</span> tests/st/ops/</span><br><span class="line">pytest -s test_abs.py -m <span class="string">&quot;level0 and platform_x86_cpu&quot;</span> <span class="comment"># è¿è¡ŒCPU level0æµ‹è¯•ç”¨ä¾‹</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1>AddLayerNormç®—å­çš„å®šä¹‰</h1><p>é¦–å…ˆaddlayernormçš„å…¬å¼æ˜¯æ€æ ·çš„ï¼Œçœ‹ä¸€ä¸‹pytorchæ²¡æ‰¾åˆ°ï¼Œä½†æ˜¯æ‰¾åˆ°äº†<a href="https://www.hiascend.com/document/detail/zh/canncommercial/80RC1/apiref/appdevgapi/context/aclnnAddLayerNorm.md">å‡è…¾çš„ä¸€ä¸ªæ–¹æ¡ˆ</a>ã€‚æ–‡çŒ®æ²¡æœ‰æ‰¾åˆ°ï¼Œä½†æ˜¯åœ¨ Transformer æ¶æ„ä¸­ï¼Œæ®‹å·®è¿æ¥ï¼ˆAddï¼‰ä¸å±‚å½’ä¸€åŒ–ï¼ˆLayerNormï¼‰å¸¸è¢«ç»“åˆä½¿ç”¨ï¼Œæ˜¯å°†è¾“å…¥çš„X1å’ŒX2è¿›è¡Œé€å…ƒç´ ç›¸åŠ ï¼Œç„¶åå¯¹ç»“æœè¿›è¡Œlayernormã€‚LayerNorm æœ€åˆç”± Jimmy Lei Ba ç­‰äººåœ¨ 2016 å¹´çš„è®ºæ–‡ <strong>ã€ŠLayer Normalizationã€‹</strong></p><p>![image-20250210193652012](./Mindsporeå®ä¹ -AKG SIGç®—å­addlayernormç¼–è¾‘å’Œåˆå¹¶/2.png)</p><h1>ä»»åŠ¡1åœ¨MindSporeOps.tdä¸­æ·»åŠ å¯¹åº”ç®—å­çš„å®ç°</h1><p>å¼€å¤´å·²ç»äº†è§£äº†mindspore AKGæ˜¯ä»€ä¹ˆäº†ï¼Œé‡Œé¢æä¾›äº†åŸºæœ¬ç®—å­çš„å®šä¹‰å’ŒLoweræµç¨‹ï¼Œä½†ç°åœ¨éœ€è¦æ·»åŠ æ–°çš„å¤åˆç®—å­AddLayerNormåˆ°MindSpore Dialectä¸­ã€‚</p><p>è¿™é‡Œéœ€è¦ä¼šLLVMç¼–è¯‘å™¨çš„ç›¸å…³æ“ä½œï¼Œæ‰€è°“tdæ–‡ä»¶å°±æ˜¯å…¶ä¸­çš„ç¼–è¾‘æ–‡ä»¶</p><ul><li><strong>TableGen</strong>æ˜¯LLVMç”Ÿæ€ä¸­ç”¨äºç”Ÿæˆä»£ç çš„å£°æ˜å¼è¯­è¨€ï¼Œé€šè¿‡<code>.td</code>æ–‡ä»¶å®šä¹‰æ•°æ®æ¨¡å‹ï¼ˆå¦‚æ“ä½œã€æŒ‡ä»¤ã€å¯„å­˜å™¨ï¼‰ã€‚</li><li><strong>åœ¨MLIRä¸­</strong>ï¼štdæ–‡ä»¶ç”¨äºå®šä¹‰Dialectä¸­çš„ç®—å­ï¼ˆOpï¼‰ã€ç±»å‹ï¼ˆTypeï¼‰ã€å±æ€§ï¼ˆAttributeï¼‰ç­‰ï¼Œç”ŸæˆC++ä»£ç æ¡†æ¶ã€‚</li></ul><p>å¦‚æœè¦å†™ä¸€ä¸ªaddLaynormï¼Œå¯èƒ½å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//æœ‰ä¸‰ä¸ªè¾“å…¥ï¼Œä¸€ä¸ªè¾“å‡ºï¼Œæ‰€ä»¥åœ¨è¿™é‡Œå®šä¹‰äº†å››ä¸ªMindSpore_Tensorç±»å‹çš„tensorï¼Œå¯¹åº”äº”ä¸ªè¾“å…¥X1ã€X2ã€gammaã€betaå’Œä¸€ä¸ªè¾“å‡ºyã€‚ä½†æ˜¯å‡è…¾çš„æ–¹æ¡ˆå†™çš„å¾ˆå¤æ‚ï¼Œè¿˜åŒ…æ‹¬äº†æ˜¯å¦è¦è¾“å‡ºä¸­é—´çš„ç›¸åŠ ç»“æœ</span><br><span class="line">// argumentsï¼šè¾“å…¥å¼ é‡å’Œå±æ€§ï¼ˆå¦‚epsilonï¼‰ã€‚</span><br><span class="line">// resultsï¼šè¾“å‡ºå¼ é‡ã€‚</span><br><span class="line">// assemblyFormatï¼šå®šä¹‰æ–‡æœ¬æ ¼å¼çš„è¯­æ³•ï¼Œç”¨äºè°ƒè¯•å’Œåºåˆ—åŒ–ã€‚</span><br><span class="line">// MindSporeOps.tdä¸­</span><br><span class="line">//===----------------------------------------------------------------------===//</span><br><span class="line">// MindSpore Operator: addlayernorm</span><br><span class="line">//===----------------------------------------------------------------------===//</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">MindSpore_AddLayerNormOp</span> : MindSpore_Op&lt;<span class="string">&quot;addlayernorm&quot;</span>, [Pure]&gt; &#123;</span><br><span class="line">  let summary = <span class="string">&quot;Add followed by Layer Normalization&quot;</span>;</span><br><span class="line">  let arguments = (ins</span><br><span class="line">    MindSpore_Tensor:$input_a,</span><br><span class="line">    MindSpore_Tensor:$input_b,</span><br><span class="line">    MindSpore_Tensor:$input_gamma,</span><br><span class="line">    MindSpore_Tensor:$input_beta               </span><br><span class="line">  );</span><br><span class="line">  let results = (outs </span><br><span class="line">    MindSpore_Tensor:$output</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>insåæ¥è¾“å…¥å‚æ•°ï¼Œoutåæ¥è¾“å‡ºå‚æ•°ã€‚åœ¨ç¼–è¯‘åä¼šè‡ªåŠ¨ç”Ÿæˆgetæ–¹æ³•æ¥è·å–è¾“å…¥è¾“å‡ºï¼Œå¹¶å°†è›‡å½¢åç§°è½¬æ¢ä¸ºé©¼å³°å¼å‘½åæ³•ã€‚åœ¨<code>akg-mlir/build/include/akg/Dialect/MindSpore/IR/MindSporeOps.cpp.inc</code>å¯ä»¥æ‰¾åˆ°ç¼–è¯‘åçš„getæ–¹æ³•</p><p>æ¯”å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">::mlir::TypedValue&lt;::mlir::TensorType&gt; AccMulOp::getInputA() &#123;</span><br><span class="line">  return *getODSOperands(0).begin();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">::mlir::TypedValue&lt;::mlir::TensorType&gt; AccMulOp::getInputB() &#123;</span><br><span class="line">  return *getODSOperands(1).begin();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">::mlir::TypedValue&lt;::mlir::TensorType&gt; AccMulOp::getInputGamma() &#123;</span><br><span class="line">  return *getODSOperands(2).begin();</span><br><span class="line">&#125;</span><br><span class="line">::mlir::TypedValue&lt;::mlir::TensorType&gt; AccMulOp::getInputBeta() &#123;</span><br><span class="line">  return *getODSOperands(2).begin();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1>ä»»åŠ¡2æ‰“é€šç®—å­çš„Loweræµç¨‹</h1><h2 id="loweræµç¨‹è®²è§£">Loweræµç¨‹è®²è§£</h2><p>ç›´æ¥loweråˆ°Linalgæˆ–è€…loweråˆ°TOSAï¼Œç›¸å…³Dialectçš„ä»£ç ï¼ˆå¦‚MindSporeToTosa.cppæˆ–è€…MindSporeToLinalg.cppï¼‰</p><p>åœ¨MLIRï¼ˆMulti-Level Intermediate Representationï¼‰ç”Ÿæ€ä¸­ï¼Œ<strong>Dialect</strong>ã€<strong>Linalg</strong> å’Œ <strong>TOSA</strong> æ˜¯ä¸åŒå±‚æ¬¡çš„ä¸­é—´è¡¨ç¤ºï¼ˆIRï¼‰ï¼Œç”¨äºæè¿°å’Œä¼˜åŒ–è®¡ç®—ä»»åŠ¡ã€‚</p><ul><li><p>Dialectï¼šæ˜¯ MLIR ä¸­çš„ç”¨äºå®šä¹‰ç‰¹å®šé¢†åŸŸæˆ–æŠ½è±¡å±‚æ¬¡çš„ä¸­é—´è¡¨ç¤ºã€‚æ¯ä¸ª Dialect åŒ…å«ä¸€ç»„æ“ä½œï¼ˆOpï¼‰ã€ç±»å‹ï¼ˆTypeï¼‰å’Œå±æ€§ï¼ˆAttributeï¼‰ï¼Œç”¨äºæè¿°ç‰¹å®šé¢†åŸŸçš„è®¡ç®—ä»»åŠ¡ã€‚</p><p>ä¾‹å¦‚ï¼š</p><ul><li><strong>MindSpore Dialect</strong>ï¼šæè¿° MindSpore æ¡†æ¶ä¸­çš„ç®—å­ï¼ˆå¦‚ <code>Add</code>ã€<code>LayerNorm</code>ï¼‰ã€‚</li><li><strong>TOSA Dialect</strong>ï¼šæè¿°é¢å‘ç¡¬ä»¶åç«¯çš„å¼ é‡è¿ç®—æ“ä½œã€‚</li><li><strong>Linalg Dialect</strong>ï¼šæè¿°çº¿æ€§ä»£æ•°æ“ä½œï¼ˆå¦‚çŸ©é˜µä¹˜æ³•ã€å·ç§¯ï¼‰ã€‚</li></ul></li><li><p>Linalgï¼šæ˜¯ MLIR ä¸­çš„ä¸€ä¸ª Dialectï¼Œä¸“æ³¨äº<strong>çº¿æ€§ä»£æ•°æ“ä½œ</strong>ï¼ˆå¦‚çŸ©é˜µä¹˜æ³•ã€å·ç§¯ã€ç‚¹ç§¯ç­‰ï¼‰ã€‚é€‚åˆå¾ªç¯ä¼˜åŒ–å’Œé«˜å±‚æ¬¡ä¸­é—´è¡¨ç¤ºã€‚</p></li><li><p>TOSAï¼šå…¨ç§°<code>Tensor Operator Set Architecture</code>ã€‚é‡Œé¢éƒ½æ˜¯å¼ é‡è¿ç®—ï¼Œä¹Ÿå°±æ˜¯æ¯”Linalgé«˜äº†ä¸€ä¸ªç­‰çº§ï¼Œå®ƒå®šä¹‰äº†ä¸€ç»„ç¡¬ä»¶å‹å¥½çš„æ“ä½œï¼Œé€‚åˆåœ¨ AI åŠ é€Ÿå™¨ï¼ˆå¦‚ NPUã€GPUï¼‰ä¸Šæ‰§è¡Œã€‚é€‚åˆé¢å‘ç¡¬ä»¶åç«¯çš„æ ‡å‡†åŒ–æ“ä½œã€‚åœ¨<code>Tosa</code>ä¸­å·²ç»å®šä¹‰æœ‰çŸ©é˜µé€å…ƒç´ ä¹˜çš„å®ç°ï¼Œå¦‚ä¸‹</p><ul><li><a href="https://gitee.com/link?target=https%3A%2F%2Fmlir.llvm.org%2Fdocs%2FDialects%2FTOSA%2F%23tosamul-mlirtosamulop"><code>tosa.mul</code> (mlir::tosa::MulOp)</a></li><li><a href="https://gitee.com/link?target=https%3A%2F%2Fmlir.llvm.org%2Fdocs%2FDialects%2FTOSA%2F%23tosaadd-mlirtosaaddop"><code>tosa.add</code> (mlir::tosa::AddOp)</a></li><li><a href="https://gitee.com/link?target=https%3A%2F%2Fmlir.llvm.org%2Fdocs%2FDialects%2FTOSA%2F%23tosapow-mlirtosapowop"><code>tosa.pow</code> (mlir::tosa::PowOp)</a></li></ul></li><li><p>Loweræµç¨‹ï¼ˆLoweringï¼‰ï¼šæ˜¯å°†é«˜å±‚æŠ½è±¡çš„ Dialect é€æ­¥è½¬æ¢ä¸ºä½å±‚æŠ½è±¡çš„ Dialect çš„è¿‡ç¨‹ã€‚ï¼ˆå¦‚ä»MindSpore Dialectåˆ°Linalg/TOSAï¼‰ã€‚</p><ul><li><strong>MindSpore Dialect åˆ° Linalg</strong>ï¼šå°† MindSpore çš„ç®—å­ï¼ˆå¦‚ <code>AddLayerNorm</code>ï¼‰è½¬æ¢ä¸º Linalg çš„çº¿æ€§ä»£æ•°æ“ä½œã€‚å°† <code>AddLayerNorm</code> åˆ†è§£ä¸º <code>linalg.add</code>ã€<code>linalg.mul</code> ç­‰æ“ä½œã€‚</li><li><strong>MindSpore Dialect åˆ° TOSA</strong>ï¼šå°† MindSpore çš„ç®—å­è½¬æ¢ä¸º TOSA çš„æ ‡å‡†åŒ–æ“ä½œã€‚å°† <code>AddLayerNorm</code> åˆ†è§£ä¸º <code>tosa.add</code>ã€<code>tosa.mul</code> ç­‰æ“ä½œã€‚</li></ul><p><strong>MindSporeçš„Lowerè¿‡ç¨‹è¿™é‡Œæœ‰ä¸¤æ¡è·¯ï¼Œå¯ä»¥ä»MindSporeè½¬åˆ°Tosaå†è½¬åˆ°Linalgï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä»MindSporeè½¬åˆ°Linalg</strong></p></li></ul><h2 id="ç¼–å†™addlayernormçš„lowerè¿‡ç¨‹">ç¼–å†™AddLayerNormçš„Lowerè¿‡ç¨‹</h2><p>å‚è€ƒçš„ç®—å­ç¼–å†™ç¤ºä¾‹ä¸­è®²è§£ï¼Œæµ‹è¯•çš„æ—¶å€™ç»™ç®—å­è¾“å…¥çš„æ˜¯JSONæ ¼å¼çš„æ–‡ä»¶ï¼Œç„¶åå‘¢éœ€è¦é¦–å…ˆå°†JSONçš„æ ¼å¼è½¬åŒ–ä¸ºMindSpore Dialect ã€‚</p><p>ç„¶åæœ‰ä¸¤ä¸ªè·¯ï¼Œä¸€ä¸ªæ˜¯MindSpore Dialect è½¬åŒ–ä¸ºTosa  Dialect å†è½¬åŒ–ä¸ºLinalg Dialect ï¼Œå¦ä¸€ä¸ªæ˜¯MindSpore Dialect ç›´æ¥è½¬åŒ–ä¸ºLinalg  Dialectã€‚</p><h3 id="jsontomindspore">JSONtoMindSpore</h3><p>åœ¨<code>akg-mlir/compiler/lib/Target/MindsporeDialect/TranslateToMindsporeDialect.cpp</code>ä¸‹çš„<code>void MindBuilder::initMindOpFactory()</code>ä¸­ï¼Œcase by caseçš„æ³¨å†Œåˆšå†™å¥½çš„AddLayerNormOp</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">this-&gt;mindOpFactory[&quot;addlayernorm&quot;] = &amp;MindBuilder::convertTernaryOp&lt;mindspore::AddLayerNormOp&gt;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="mindsporetotosa">MindSporeToTosa</h3><p>é¦–å…ˆè¿™ä¸ªæ˜¯ä¸€ä¸ªAccMulOpçš„èŒƒä¾‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åœ¨MindSporeToTosa.cppä¸­</span></span><br><span class="line"><span class="comment">//è¿™é‡Œå†™ä¸€ä¸ªå‡½æ•°ç”¨æ¥è®¡ç®—ä¸­é—´è¿‡ç¨‹çš„è¾“å‡ºå°ºåº¦</span></span><br><span class="line"><span class="comment">//broadcast type</span></span><br><span class="line"><span class="function">SmallVector&lt;<span class="type">int64_t</span>&gt; <span class="title">broadcast</span><span class="params">(OpBuilder &amp;rewriter, Value M1, Value M2, Location loc)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  SmallVector&lt;<span class="type">int64_t</span>&gt; R1dim1;</span><br><span class="line">  <span class="comment">//shape</span></span><br><span class="line">  <span class="keyword">auto</span> M1Type = M<span class="number">1.</span><span class="built_in">getType</span>().<span class="built_in">dyn_cast</span>&lt;ShapedType&gt;();</span><br><span class="line">  <span class="keyword">auto</span> M2Type = M<span class="number">2.</span><span class="built_in">getType</span>().<span class="built_in">dyn_cast</span>&lt;ShapedType&gt;();</span><br><span class="line">  <span class="keyword">auto</span> shape1 = M1Type.<span class="built_in">getShape</span>();</span><br><span class="line">  <span class="keyword">auto</span> shape2 = M2Type.<span class="built_in">getShape</span>();</span><br><span class="line">  <span class="type">int64_t</span> R1dimi;</span><br><span class="line"><span class="comment">//broadcast</span></span><br><span class="line">  <span class="keyword">if</span> (shape<span class="number">1.</span><span class="built_in">size</span>() == shape<span class="number">2.</span><span class="built_in">size</span>())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="type">int</span> i = <span class="number">0</span>; i &lt; shape<span class="number">1.</span><span class="built_in">size</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (shape1[i] == shape2[i])</span><br><span class="line">      &#123;</span><br><span class="line">        R1dimi = shape1[i];</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (shape1[i] != <span class="number">1</span> &amp;&amp; shape2[i] != <span class="number">1</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">assert</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (shape1[i] == <span class="number">1</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        R1dimi = shape2[i];</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (shape2[i] == <span class="number">1</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        R1dimi = shape1[i];</span><br><span class="line">      &#125;</span><br><span class="line">      R1dim<span class="number">1.</span><span class="built_in">push_back</span>(R1dimi);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> R1dim1;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//AccMulOpâ€”â€”Result = Mul(Mul(Q, K), V)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AccMulOpConverter</span> : <span class="keyword">public</span> OpConversionPattern&lt;mindspore::AccMulOp&gt;</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="keyword">using</span> OpConversionPattern&lt;mindspore::AccMulOp&gt;::OpConversionPattern;</span><br><span class="line">  <span class="function">LogicalResult <span class="title">matchAndRewrite</span><span class="params">(mindspore::AccMulOp mindsporeOp, AccMulOp::Adaptor adaptor, ConversionPatternRewriter &amp;rewriter)</span> <span class="type">const</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="comment">//Location</span></span><br><span class="line">    Location loc = mindsporeOp.<span class="built_in">getLoc</span>();</span><br><span class="line">    <span class="comment">//resultTypes </span></span><br><span class="line">    Type resultTypes = mindsporeOp.<span class="built_in">getResult</span>().<span class="built_in">getType</span>();</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//Q = args[0], K = args[1], V = args[2]</span></span><br><span class="line">    ValueRange args = adaptor.<span class="built_in">getOperands</span>();</span><br><span class="line"></span><br><span class="line">    Type elemType = mindsporeOp.<span class="built_in">getResult</span>().<span class="built_in">getType</span>().<span class="built_in">cast</span>&lt;ShapedType&gt;().<span class="built_in">getElementType</span>();</span><br><span class="line"></span><br><span class="line">    SmallVector&lt;<span class="type">int64_t</span>&gt; result1 = <span class="built_in">broadcast</span>(rewriter, args[<span class="number">0</span>], args[<span class="number">1</span>], loc);</span><br><span class="line">    <span class="function">ArrayRef&lt;<span class="type">int64_t</span>&gt; <span class="title">newArrayRef</span><span class="params">(result1)</span></span>;</span><br><span class="line">    <span class="keyword">auto</span> Type1 = RankedTensorType::<span class="built_in">get</span>(newArrayRef, elemType);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Q = args[0], K = args[1], V = args[2]</span></span><br><span class="line">    <span class="comment">//mulOp11 = Mul(Qï¼ŒK)</span></span><br><span class="line">    Value mulOp11 = rewriter.<span class="built_in">create</span>&lt;mlir::tosa::MulOp&gt;(loc, Type1, args[<span class="number">0</span>], args[<span class="number">1</span>], <span class="number">0</span>)-&gt;<span class="built_in">getResult</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">//Mul(mulOp11ï¼ŒV)</span></span><br><span class="line">    <span class="keyword">auto</span> mulOp2 = rewriter.<span class="built_in">create</span>&lt;mlir::tosa::MulOp&gt;(loc, resultTypes, mulOp11, args[<span class="number">2</span>], <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    rewriter.<span class="built_in">replaceOp</span>(mindsporeOp, mulOp<span class="number">2.</span><span class="built_in">getResult</span>());</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">success</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å†åœ¨<code>struct ConvertMindSporeToTosaPass : public ConvertMindSporeToTosaBase&lt;ConvertMindSporeToTosaPass&gt;</code>ä¸­æ·»åŠ patterns-AccMulOpConverter</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ConvertMindSporeToTosaPass</span> : <span class="keyword">public</span> ConvertMindSporeToTosaBase&lt;ConvertMindSporeToTosaPass&gt;</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">     <span class="built_in">ConvertMindSporeToTosaPass</span>() = <span class="keyword">default</span>;</span><br><span class="line">...</span><br><span class="line">     <span class="function"><span class="type">void</span> <span class="title">runOnOperation</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">     </span>&#123;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// clang-format off</span></span><br><span class="line">         (<span class="type">void</span>)patterns.add&lt;</span><br><span class="line">        ...</span><br><span class="line">       <span class="comment">//AccMulOp</span></span><br><span class="line">        AccMulOpConverter,</span><br><span class="line">        ConvertMindSporePadOp&lt;mindspore::PadOp&gt;</span><br><span class="line">        &gt;(patterns.<span class="built_in">getContext</span>());</span><br><span class="line">        mlir::<span class="built_in">populateMindSporeLowerPattern</span>(patterns);</span><br><span class="line">    </span><br><span class="line">...</span><br><span class="line">      &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åŒæ—¶ï¼Œåœ¨<code>/akg-mlir/compiler/lib/Conversion/MindSporeToLinalg/MindSporeToLinalg.cpp</code>å’Œ<code>/akg-mlir/compiler/lib/Conversion/MindSporeFinalizingLower/MindSporeFinalizingLower.cpp</code>ä¸­å¯¹æ­¤ç®—å­æ·»åŠ äº†legal,é€šè¿‡æ‰‹åŠ¨æ·»åŠ legalï¼Œå¯ä»¥ä¿è¯AccMulç®—å­ä¸åœ¨è¿™é‡Œè¢«lowerï¼Œåœ¨æ­¤ç±»è½¬æ¢ä¸­è¢«ä¿ç•™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">void runOnOperation() override</span><br><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">//AccmulOp</span><br><span class="line">   target.addLegalOp&lt;mindspore::AccMulOp&gt;();</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯ä¸€ä¸ªdeepseekå†™çš„addlayernormçš„æ–¹æ¡ˆ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MindSporeToTosa.cpp</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ConvertAddLayerNormToTosa</span> : <span class="keyword">public</span> OpConversionPattern&lt;MindSpore::AddLayerNormOp&gt; &#123;</span><br><span class="line">  <span class="keyword">using</span> OpConversionPattern::OpConversionPattern;</span><br><span class="line">  </span><br><span class="line">  <span class="function">LogicalResult <span class="title">matchAndRewrite</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">      MindSpore::AddLayerNormOp op,</span></span></span><br><span class="line"><span class="params"><span class="function">      OpAdaptor adaptor,</span></span></span><br><span class="line"><span class="params"><span class="function">      ConversionPatternRewriter &amp;rewriter</span></span></span><br><span class="line"><span class="params"><span class="function">  )</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è·å–è¾“å…¥å’Œå±æ€§</span></span><br><span class="line">    Value input = adaptor.<span class="built_in">getInput</span>();</span><br><span class="line">    Value gamma = adaptor.<span class="built_in">getGamma</span>();</span><br><span class="line">    Value beta = adaptor.<span class="built_in">getBeta</span>();</span><br><span class="line">    <span class="type">float</span> epsilon = op.<span class="built_in">getEpsilon</span>().<span class="built_in">convertToFloat</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å°†AddLayerNormåˆ†è§£ä¸ºTOSAæ“ä½œï¼š</span></span><br><span class="line">    <span class="comment">// 1. è®¡ç®—è¾“å…¥å‡å€¼ï¼ˆmeanï¼‰</span></span><br><span class="line">    <span class="comment">// 2. è®¡ç®—æ–¹å·®ï¼ˆvarianceï¼‰</span></span><br><span class="line">    <span class="comment">// 3. æ‰§è¡Œå½’ä¸€åŒ–ï¼š(input - mean) / sqrt(variance + epsilon)</span></span><br><span class="line">    <span class="comment">// 4. åº”ç”¨gammaå’Œbeta</span></span><br><span class="line">    <span class="comment">// å…·ä½“å®ç°éœ€è°ƒç”¨TOSAçš„ç°æœ‰æ“ä½œï¼ˆå¦‚tosa.add, tosa.mulç­‰ï¼‰</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¼ªä»£ç ç¤ºä¾‹ï¼š</span></span><br><span class="line">    <span class="keyword">auto</span> mean = rewriter.<span class="built_in">create</span>&lt;tosa::ReduceMeanOp&gt;(...);</span><br><span class="line">    <span class="keyword">auto</span> variance = rewriter.<span class="built_in">create</span>&lt;tosa::SubOp&gt;(...);</span><br><span class="line">    <span class="keyword">auto</span> normalized = rewriter.<span class="built_in">create</span>&lt;tosa::DivOp&gt;(...);</span><br><span class="line">    <span class="keyword">auto</span> scaled = rewriter.<span class="built_in">create</span>&lt;tosa::MulOp&gt;(normalized, gamma);</span><br><span class="line">    <span class="keyword">auto</span> output = rewriter.<span class="built_in">create</span>&lt;tosa::AddOp&gt;(scaled, beta);</span><br><span class="line">    </span><br><span class="line">    rewriter.<span class="built_in">replaceOp</span>(op, output);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">success</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç„¶åè¦æ³¨å†Œè¿™ä¸ªå†™å¥½çš„pattern</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">populateMindSporeToTosaPatterns</span><span class="params">(MLIRContext *context, RewritePatternSet &amp;patterns)</span> </span>&#123;</span><br><span class="line">  patterns.<span class="built_in">add</span>&lt;ConvertAddLayerNormToTosa&gt;(context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ›´æ–°Loweræµç¨‹å…¥å£ç¡®ä¿åœ¨Loweræµç¨‹ä¸­è°ƒç”¨ä¸Šè¿°Patternï¼š</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">LowerMindSporeToTosa</span><span class="params">(ModuleOp <span class="keyword">module</span>)</span> </span>&#123;</span><br><span class="line">  <span class="function">ConversionTarget <span class="title">target</span><span class="params">(*<span class="keyword">module</span>.getContext())</span></span>;</span><br><span class="line">  target.<span class="built_in">addLegalDialect</span>&lt;Tosa::TosaDialect&gt;();</span><br><span class="line">  target.<span class="built_in">addIllegalDialect</span>&lt;MindSpore::MindSporeDialect&gt;();</span><br><span class="line">  </span><br><span class="line">  <span class="function">RewritePatternSet <span class="title">patterns</span><span class="params">(&amp;getContext())</span></span>;</span><br><span class="line">  <span class="built_in">populateMindSporeToTosaPatterns</span>(patterns);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">failed</span>(<span class="built_in">applyPartialConversion</span>(<span class="keyword">module</span>, target, std::<span class="built_in">move</span>(patterns)))) &#123;</span><br><span class="line">    <span class="built_in">signalPassFailure</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="mindsporetolinalg">MindsporetoLinalg</h3><p>åˆ©ç”¨Linalg <strong>åœ¨è¿™ä¸€å±‚å¹¶æ²¡æœ‰ç›´æ¥çš„çŸ©é˜µä¹˜åŠ æŒ‡ä»¤</strong>ã€‚ä½†åœ¨<br><code>akg/akg-mlir/compiler/lib/Conversion/MindSporeToLinalg/MindSporeToLinalg.cpp</code><br>ä¸­æœ‰å·²ç»æä¾›äº†å†™elementwiseè®¡ç®—çš„æ–¹æ³•ï¼Œæ‰€ä»¥ç›´æ¥åœ¨<br><code>static Value createLinalgBodyCalculationForElementwiseOp(Operation *op, ValueRange args, ArrayRef&lt;Type&gt; resultTypes, PatternRewriter &amp;rewriter)</code>ä¸­æ·»åŠ å¯¹åº”é€»è¾‘ï¼Œå…¶ä¸­<a href="https://gitee.com/link?target=https%3A%2F%2Fmlir.llvm.org%2Fdocs%2FDialects%2FArithOps%2F">arith</a>æ—¨åœ¨å®¹çº³åŸºæœ¬çš„æ•´æ•°å’Œæµ®ç‚¹æ•°å­¦è¿ç®—</p><p>åŒä¸Šçš„æµç¨‹</p><ol><li>ç¼–å†™MindsporetoLinalg</li><li>ç„¶åç¼–å†™ä¸€ä¸ªpattern</li><li>è¿˜è¦åœ¨<code>akg-mlir/compiler/lib/Conversion/MindSporeToTosa/MindSporeToTosa.cpp</code>å¯¹æ­¤ç®—å­æ‰‹åŠ¨æ·»åŠ egalï¼Œä¿è¯AccMulç®—å­ä¸åœ¨è¿™é‡Œè¢«lower</li></ol><p>ä½†æ˜¯æˆ‘å…·ä½“æ²¡æœ‰ææ˜ç™½</p><h1>ä»»åŠ¡3ç¼–å†™å¯¹åº”çš„æµ‹è¯•ç”¨ä¾‹ï¼ˆç®—å­çš„infoæ–‡ä»¶å’Œå¯¹åº”çš„op_dslï¼‰</h1><p><a href="https://gitee.com/monkeykingd/akg/wikis/AKG-MLIR%E5%8D%95%E7%AE%97%E5%AD%90%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%E6%9E%84%E5%BB%BA">ç¼–å†™æµ‹è¯•ç”¨ä¾‹çš„å‚è€ƒèµ„æ–™</a></p><p>è¿™é‡Œè€å¸ˆä¸ä»…è®²äº†æ€ä¹ˆå†™æµ‹è¯•ç”¨ä¾‹ï¼Œè¿˜è®²äº†æ€ä¹ˆæµ‹è¯•lowerè¿‡ç¨‹</p><p>æµ‹è¯•çš„æ—¶å€™é¦–å…ˆæœ‰ä¸€ä¸ªæ­£ç¡®ç»“æœbenchmarkï¼Œè¿˜æœ‰ä¸€ä¸ªæµ‹è¯•æ•°æ®é›†ï¼Œç„¶åè¿è¡Œæµ‹è¯•ç¨‹åºå°±å¯ä»¥æŠŠç®—å­è®¡ç®—ç»“æœå’Œæ­£ç¡®ç»“æœè¿›è¡Œå¯¹æ¯”</p><h3 id="benchmarkæ„å»º">Benchmarkæ„å»º</h3><p>ç”¨numpyéªŒè¯è®¡ç®—çš„æ­£ç¡®æ€§</p><p>å…³benchmarkè®°å½•åœ¨<code>akg-mlir/python/akg_v2/utils/op_dsl.py</code>ä¸­çš„<code>get_op_dsl()</code>å‡½æ•°ä¸­ï¼Œæ¯ä¸€ä¸ªç®—å­å¯¹åº”ä¸€ä¸ªlambdaå‡½æ•°ä½œä¸ºdslã€‚ä»¥AccMulä¸ºä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;AccMul&quot;: lambda inputs, output, attr: accmul_str(inputs, output, attr),</span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„dslä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def accmul_str(inputs, output, attr):</span><br><span class="line">    s=&quot;%s=np.multiply(np.multiply(%s,%s),%s)&quot;% ( output[0][&#x27;tensor_name&#x27;], get_input(inputs[0][0]),get_input(inputs[1][0]),get_input(inputs[2][0]))</span><br><span class="line">    return s</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒæŒ‡ç”¨npçš„multiplyå‡½æ•°åšè®¡ç®—ã€‚å¦‚æœç®—å­loweræˆåŠŸï¼ŒæœŸå¾…çš„è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Start running xxx</span><br><span class="line">xxxprecision correct</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•ç”¨ä¾‹æ€ä¹ˆå†™">æµ‹è¯•ç”¨ä¾‹æ€ä¹ˆå†™</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"># &quot;input_desc&quot;ä¸ºä¸€ä¸ªlistï¼Œé‡Œé¢åŒ…å«äº†æ¯ä¸ªinputçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬data_type, format, shapeå’Œtensor_nameï¼Œè¿™ä¸ªå†³å®šäº†èåˆç®—å­çš„è¾“å…¥</span><br><span class="line">    &quot;input_desc&quot;: [</span><br><span class="line">        [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;data_type&quot;: &quot;float32&quot;,</span><br><span class="line">                &quot;format&quot;: &quot;DefaultFormat&quot;,</span><br><span class="line">                &quot;shape&quot;: [</span><br><span class="line">                    4096,</span><br><span class="line">                    7680</span><br><span class="line">                ],</span><br><span class="line">                &quot;tensor_name&quot;: &quot;Query&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;data_type&quot;: &quot;float32&quot;,</span><br><span class="line">                &quot;format&quot;: &quot;DefaultFormat&quot;,</span><br><span class="line">                &quot;shape&quot;: [</span><br><span class="line">                    4096,</span><br><span class="line">                    7680</span><br><span class="line">                ],</span><br><span class="line">                &quot;tensor_name&quot;: &quot;Key&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;data_type&quot;: &quot;float32&quot;,</span><br><span class="line">                &quot;format&quot;: &quot;DefaultFormat&quot;,</span><br><span class="line">                &quot;shape&quot;: [</span><br><span class="line">                    4096,</span><br><span class="line">                    7680</span><br><span class="line">                ],</span><br><span class="line">                &quot;tensor_name&quot;: &quot;Value&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    ],</span><br><span class="line">    </span><br><span class="line">    # &quot;op&quot;ä¸ºæ•´ä¸ªèåˆç®—å­çš„åå­—ï¼Œå¯¹åº”åˆ°mliræ–‡ä»¶çš„funcçš„åå­—ã€‚</span><br><span class="line">    &quot;op&quot;: &quot;AccMulOp_fusion&quot;,</span><br><span class="line">    # &quot;output_desc&quot;ä¸ºä¸€ä¸ªlistï¼Œè¡¨ç¤ºèåˆç®—å­ä¸­æ¯ä¸ªå•ç®—å­çš„åå­—ï¼Œæ¯ä¸€é¡¹è¡¨ç¤ºæ¯ä¸ªç®—å­çš„ç‰¹ç‚¹ï¼š</span><br><span class="line">    # attrï¼šæ²¡æœ‰çš„æ—¶å€™è¦å†™æˆnull</span><br><span class="line">    # input_descï¼šç®—å­çš„è¾“å…¥ï¼Œè¦æ±‚åŒä¸Šï¼›</span><br><span class="line">    # nameï¼šç®—å­çš„åå­—ï¼Œå¿…é¡»å’Œmindspore tdå†…æ³¨å†Œçš„ç®—å­å¯¹åº”ï¼›</span><br><span class="line">    # output_descï¼šç®—å­çš„è¾“å…¥ï¼Œè¦æ±‚åŒè¾“å…¥ï¼›å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœèåˆç®—å­ä¸­ä¸€ä¸ªç®—å­çš„è¾“å…¥ä¸ºå‰åºç®—å­çš„è¾“å‡ºï¼Œtensor_nameå¿…é¡»ä¸€è‡´ä»¥è·å¾—å¯¹åº”å…³ç³»ï¼›</span><br><span class="line">    &quot;op_desc&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;attr&quot;: null,</span><br><span class="line">            &quot;input_desc&quot;: [</span><br><span class="line">                [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;data_type&quot;: &quot;float32&quot;,</span><br><span class="line">                        &quot;format&quot;: &quot;DefaultFormat&quot;,</span><br><span class="line">                        &quot;name&quot;: &quot;Query&quot;,</span><br><span class="line">                        &quot;shape&quot;: [</span><br><span class="line">                            4096,</span><br><span class="line">                            7680</span><br><span class="line">                        ],</span><br><span class="line">                        &quot;tensor_name&quot;: &quot;Query&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;data_type&quot;: &quot;float32&quot;,</span><br><span class="line">                        &quot;format&quot;: &quot;DefaultFormat&quot;,</span><br><span class="line">                        &quot;name&quot;: &quot;Key&quot;,</span><br><span class="line">                        &quot;shape&quot;: [</span><br><span class="line">                            4096,</span><br><span class="line">                            7680</span><br><span class="line">                        ],</span><br><span class="line">                        &quot;tensor_name&quot;: &quot;Key&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;data_type&quot;: &quot;float32&quot;,</span><br><span class="line">                        &quot;format&quot;: &quot;DefaultFormat&quot;,</span><br><span class="line">                        &quot;name&quot;: &quot;Value&quot;,</span><br><span class="line">                        &quot;shape&quot;: [</span><br><span class="line">                            4096,</span><br><span class="line">                            7680</span><br><span class="line">                        ],</span><br><span class="line">                        &quot;tensor_name&quot;: &quot;Value&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            ],</span><br><span class="line">            &quot;name&quot;: &quot;AccMul&quot;,</span><br><span class="line">            &quot;output_desc&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;data_type&quot;: &quot;float32&quot;,</span><br><span class="line">                    &quot;format&quot;: &quot;DefaultFormat&quot;,</span><br><span class="line">                    &quot;name&quot;: &quot;output&quot;,</span><br><span class="line">                    &quot;shape&quot;: [</span><br><span class="line">                            4096,</span><br><span class="line">                            7680</span><br><span class="line">                    ],</span><br><span class="line">                    &quot;tensor_name&quot;: &quot;output&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    # output_descï¼šæ•´ä¸ªèåˆç®—å­çš„è¾“å‡ºã€‚</span><br><span class="line">    &quot;output_desc&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;data_type&quot;: &quot;float32&quot;,</span><br><span class="line">            &quot;format&quot;: &quot;DefaultFormat&quot;,</span><br><span class="line">            &quot;shape&quot;: [</span><br><span class="line">                4096,</span><br><span class="line">                7680</span><br><span class="line">            ],</span><br><span class="line">            &quot;tensor_name&quot;: &quot;output&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    # åé¢çš„ä¸ç®¡</span><br><span class="line">    &quot;platform&quot;: &quot;AKG&quot;,</span><br><span class="line">    &quot;process&quot;: &quot;cpu&quot;,</span><br><span class="line">    &quot;target_info&quot;: &#123;</span><br><span class="line">        &quot;arch&quot;: &quot;aarch64&quot;,</span><br><span class="line">        &quot;feature&quot;: &quot;neon&quot;,</span><br><span class="line">        &quot;system&quot;: &quot;linux&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;version&quot;: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•æ–‡ä»¶æ„å»ºå®Œæˆä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨<code>python/akg_v2/exec_tools/</code>ç›®å½•ä¸‹<code>py_benchmark.py</code>è¿›è¡Œæµ‹è¯•ï¼ŒåŸºæœ¬æŒ‡ä»¤ä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python $&#123;path_to_py_benchmark&#125;/py_benchmark.py -e cpu -f mul.info --dump_ir 1</span><br></pre></td></tr></table></figure><p>å…¶ä¸­</p><ul><li><code>-e</code>å†³å®šäº†åç«¯ï¼Œè¿™é‡Œä½¿ç”¨cpu</li><li><code>-f</code>å†³å®šäº†æµ‹è¯•æ–‡ä»¶ï¼Œè¿™é‡Œä½¿ç”¨æ˜¯<code>mul.info</code></li><li><code>--dump_ir 1</code>è¡¨ç¤ºdumpä¸­é—´ç»“æœï¼Œç›¸å…³ç»“æœä¿å­˜åœ¨<code>py_benchmark.py</code>å¯¹åº”ç›®å½•ä¸‹</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;Mindsporeå®ä¹ -AKG SIGç®—å­addlayernormç¼–è¾‘å’Œåˆå¹¶&lt;/h1&gt;
&lt;h2 id=&quot;ä»€ä¹ˆæ˜¯ç®—å­&quot;&gt;ä»€ä¹ˆæ˜¯ç®—å­&lt;/h2&gt;
&lt;p&gt;è®¡ç®—å›¾å’Œç®—å­åœ¨è®¡ç®—æœ¬è´¨ä¸Šæ˜¯ä¸€è‡´çš„ã€‚&lt;strong&gt;ç®—å­æ˜¯æ‰“åŒ…åçš„è®¡ç®—å›¾ï¼Œè®¡ç®—å›¾æ˜¯æ‹†åŒ…åçš„ç®—å­&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;</summary>
      
    
    
    
    <category term="æ·±åº¦å­¦ä¹ " scheme="http://outbreak-sen.github.io/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="Mindspore" scheme="http://outbreak-sen.github.io/tags/Mindspore/"/>
    
    <category term="å®ä¹ " scheme="http://outbreak-sen.github.io/tags/%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="ç®—å­" scheme="http://outbreak-sen.github.io/tags/%E7%AE%97%E5%AD%90/"/>
    
  </entry>
  
  <entry>
    <title>EffiMVSå…¨æ–‡ç¿»è¯‘</title>
    <link href="http://outbreak-sen.github.io/2025/02/09/EffiMVS%E5%85%A8%E6%96%87%E7%BF%BB%E8%AF%91/"/>
    <id>http://outbreak-sen.github.io/2025/02/09/EffiMVS%E5%85%A8%E6%96%87%E7%BF%BB%E8%AF%91/</id>
    <published>2025-02-09T08:21:01.000Z</published>
    <updated>2025-02-09T08:21:48.232Z</updated>
    
    <content type="html"><![CDATA[<h1>Effi MVSç¿»è¯‘</h1><h2 id="æ‘˜è¦">æ‘˜è¦</h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§ç”¨äºå¤šè§†å›¾ç«‹ä½“çš„æ–°é¢–çš„è¿­ä»£åŠ¨æ€æˆæœ¬é‡ã€‚ ä¸å…¶ä»–ä½œå“ç›¸æ¯”ï¼Œæˆ‘ä»¬çš„æˆæœ¬é‡è¦è½»å¾—å¤šï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨åŸºäº 2D å·ç§¯çš„ GRU è¿›è¡Œå¤„ç†ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸€æ­¥GRU çš„è¾“å‡ºå¯è¿›ä¸€æ­¥ç”¨äºç”Ÿæˆæ–°çš„æˆæœ¬é‡ã€‚ è¿™æ ·ï¼Œå°±æ„å»ºäº†ä¸€ä¸ªåŸºäºGRUçš„è¿­ä»£ä¼˜åŒ–å™¨ã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§çº§è”å’Œåˆ†å±‚ç»†åŒ–æ¶æ„æ¥åˆ©ç”¨å¤šå°ºåº¦ä¿¡æ¯å¹¶åŠ é€Ÿæ”¶æ•›ã€‚ å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨è½»é‡çº§ 3D CNN ç”Ÿæˆæœ€ç²—ç³™çš„åˆå§‹æ·±åº¦å›¾ï¼Œè¿™å¯¹äºå¯åŠ¨ GRU å¹¶ä¿è¯å¿«é€Ÿæ”¶æ•›è‡³å…³é‡è¦ã€‚ ç„¶åï¼Œæ·±åº¦å›¾ç”±ä½œç”¨äºé‡‘å­—å¡”ç‰¹å¾å›¾çš„å¤šçº§ GRU è¿›è¡Œç»†åŒ–ã€‚ å¯¹ DTU å’Œ Tanks &amp; Temples åŸºå‡†æµ‹è¯•çš„å¤§é‡å®éªŒè¡¨æ˜ï¼Œæˆ‘ä»¬çš„æ–¹æ³•å¯ä»¥åœ¨å‡†ç¡®æ€§ã€é€Ÿåº¦å’Œå†…å­˜ä½¿ç”¨æ–¹é¢å®ç°æœ€å…ˆè¿›çš„ç»“æœã€‚</p><h2 id="ä»‹ç»">ä»‹ç»</h2><p>å¤šè§†å›¾ç«‹ä½“ (MVS) æ—¨åœ¨åŸºäºä¸€ç³»åˆ—å§¿åŠ¿å›¾åƒå’Œç›¸åº”çš„ç›¸æœºå‚æ•°é‡å»ºå¯†é›†çš„ 3D æ¨¡å‹ã€‚ é¢„æµ‹æ·±åº¦å›¾ï¼Œç„¶åå°†æ·±åº¦å›¾èåˆåˆ°ç‚¹äº‘æ¨¡å‹ä¸­æ˜¯ MVS æœ€å¸¸è§çš„æµç¨‹ã€‚ ä½œä¸ºä¸€ä¸ªåŸºæœ¬é—®é¢˜ï¼ŒMVS åœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸå·²ç»ç ”ç©¶äº†å‡ åå¹´ã€‚</p><p>æœ€è¿‘ï¼Œæˆ‘ä»¬è§è¯äº†åŸºäºæ·±åº¦å­¦ä¹ çš„ MVS æ–¹æ³•çš„å¿«é€Ÿå‘å±•ã€‚ ä¸€èˆ¬æ¥è¯´ï¼ŒMVSä»»åŠ¡æœ€å¸¸è§çš„åŸºæœ¬ç»“æ„æ˜¯åˆ©ç”¨å›¾åƒåºåˆ—çš„ç‰¹å¾æ¥æ„é€ 3Dæˆæœ¬ï¼ˆç›¸å…³ï¼‰ä½“ç§¯ï¼Œç„¶åç”¨3D CNNå¯¹å…¶è¿›è¡Œæ­£åˆ™åŒ–ï¼Œæœ€åå¯¹æ·±åº¦è¿›è¡Œå›å½’ã€‚ éšä¹‹è€Œæ¥çš„è¿˜æœ‰å¤§é‡ä½œå“ç®¡é“ï¼Œå¹¶ä¸”åœ¨ MVS åŸºå‡†çš„é‡å»ºç²¾åº¦æ–¹é¢ä¼˜äºå¤§å¤šæ•°ä¼ ç»Ÿæ–¹æ³•ã€‚ç„¶è€Œï¼Œç”±äºæ­£åˆ™åŒ–æ­¥éª¤å¯¹ GPU å†…å­˜å’Œå¤„ç†æ—¶é—´çš„è¦æ±‚è¾ƒé«˜ï¼Œç°æœ‰æ–¹æ³•CIDER, MVSNetåªèƒ½å¤„ç†ä½åˆ†è¾¨ç‡çš„å›¾åƒã€‚</p><p>æ˜¾ç„¶ï¼Œé™¤äº†æé«˜é‡å»ºè´¨é‡ä¹‹å¤–ï¼Œå‡å°‘è¿è¡Œæ—¶é—´å’ŒGPUå†…å­˜æ¶ˆè€—ä¹Ÿéå¸¸é‡è¦ï¼Œè¿™ä½¿å¾—åŸºäºå­¦ä¹ çš„MVSå·¥ä½œèƒ½å¤Ÿé€‚åº”å†…å­˜å’Œè®¡ç®—å—é™çš„è®¾å¤‡ã€‚ æœ€è¿‘ï¼Œæœ‰äººæå‡ºäº†ä¸€äº›å·¥ä½œæ¥æé«˜ MVS çš„æ•ˆç‡ã€‚ ç„¶è€Œï¼ŒåŒæ—¶æé«˜ç²¾åº¦å’Œé™ä½æ¶ˆè€—ä»ç„¶éå¸¸å…·æœ‰æŒ‘æˆ˜æ€§ã€‚ åœ¨è¿™é¡¹å·¥ä½œä¸­ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯æé«˜é«˜åˆ†è¾¨ç‡ MVS çš„è®¡ç®—é€Ÿåº¦å¹¶å‡å°‘å†…å­˜æ¶ˆè€—ï¼Œå¹¶ç¡®ä¿è‰¯å¥½çš„é‡å»ºè´¨é‡ã€‚</p><p>æˆ‘ä»¬æ–¹æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯æ„å»ºä¸€ä¸ªå¯ä»¥è¿­ä»£æ–¹å¼å¤„ç†çš„è½»é‡çº§åŠ¨æ€æˆæœ¬é‡ã€‚ è¿™ä¸€ç­–ç•¥å¯ä»¥å¸¦æ¥å¾ˆå¤šå¥½å¤„ã€‚ é¦–å…ˆï¼Œç”±äºä½¿ç”¨äº†è½»é‡çº§æˆæœ¬å·ï¼Œå¤§å¤§é™ä½äº†æ¨ç†é˜¶æ®µçš„å†…å­˜ä½¿ç”¨å³°å€¼ã€‚ å…¶æ¬¡ï¼Œè¿­ä»£å’ŒåŠ¨æ€å¤„ç†å¯ä»¥ä¿è¯å¤§çš„æœç´¢ç©ºé—´ï¼Œè¿™å¯¹å‡†ç¡®æ€§å¾ˆé‡è¦ã€‚ æœ€åï¼Œæˆ‘ä»¬çš„åŠ¨æ€æˆæœ¬é‡èƒ½å¤Ÿåœ¨å‡ ä¸ªè¿­ä»£æ­¥éª¤ä¸­æ”¶æ•›ï¼Œå› æ­¤æˆ‘ä»¬çš„æ–¹æ³•éå¸¸æœ‰æ•ˆã€‚</p><p>è€å®è¯´ï¼Œæˆ‘ä»¬çš„æ–¹æ³•éƒ¨åˆ†å—åˆ°[5,10,25,26]ä½œå“çš„å¯å‘ã€‚ åœ¨[5,10,25]çš„å·¥ä½œä¸­ï¼Œæå‡ºäº†çº§è”è‡ªé€‚åº”æˆæœ¬é‡ã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥ç¼©å°äº†æˆæœ¬é‡çš„å¤§å°ï¼Œå¹¶å°†è¿™ç§å¤šé˜¶æ®µç­–ç•¥æ‰©å±•åˆ°è¿­ä»£æ–¹å¼ã€‚ æˆ‘ä»¬çš„è¿­ä»£æƒ³æ³•ä¹Ÿå—åˆ°æœ€è¿‘çš„å…‰å­¦ä¼°è®¡å·¥ä½œçš„å¯å‘[26]ã€‚ ä¸[26]ç›¸æ¯”ï¼Œæˆ‘ä»¬æ”¾å¼ƒäº†å…¨å°ºå¯¸é™æ€ç›¸å…³å·ï¼Œå› ä¸ºå®ƒå¯¹å†…å­˜ä¸å‹å¥½ã€‚ æ›´é‡è¦çš„æ˜¯ï¼Œä¸å…‰æµä¼°è®¡ä¸åŒï¼Œæˆ‘ä»¬åˆ©ç”¨è½»é‡çº§ 3D CNN æ¥ä¼°è®¡ç²—ç•¥æ·±åº¦å›¾ä½œä¸º GRU çš„åˆå§‹åŒ–ï¼Œæˆ‘ä»¬å‘ç°è¿™å¯¹äº GRU åœ¨ MVS ä¸Šçš„å¿«é€Ÿæ”¶æ•›éå¸¸é‡è¦ã€‚ å¦å¤–ï¼Œç”±äº3D CNNéå¸¸è½»ï¼Œå¯¹æ•ˆç‡å½±å“è¾ƒå°ã€‚ æ€»ä¹‹ï¼Œæˆ‘ä»¬çš„è´¡çŒ®å¯ä»¥æ€»ç»“ä¸ºï¼š</p><ol><li>æˆ‘ä»¬æå‡ºäº†ä¸€ç§æ–°é¢–çš„åŠ¨æ€æˆæœ¬å·ï¼Œå®ƒéå¸¸è½»é‡çº§ï¼Œå¯ä»¥é€šè¿‡åŸºäº 2D å·ç§¯çš„ GRU è¿­ä»£å¤„ç†ã€‚ è¿™æ ·æˆ‘ä»¬å°±é¿å…äº†å¤§å°ºå¯¸é™æ€æˆæœ¬å·çš„å†…å­˜å’Œè€—æ—¶é—®é¢˜ã€‚</li><li>æˆ‘ä»¬æå‡ºäº†ä¸€ç§çº§è”å’Œåˆ†å±‚ç»†åŒ–æ¶æ„æ¥åˆ©ç”¨å¤šå°ºåº¦ä¿¡æ¯å¹¶åŠ é€Ÿæ”¶æ•›ã€‚ å…·ä½“æ¥è¯´ï¼Œé€šè¿‡è½»é‡çº§ 3DCNNï¼Œæˆ‘ä»¬ä¸º GRU æä¾›å¯é çš„åˆå§‹åŒ–ï¼Œè¿™å¯¹äºå¿«é€Ÿæ”¶æ•›å’Œæœ€ç»ˆæ€§èƒ½è‡³å…³é‡è¦ã€‚</li><li>æˆ‘ä»¬çš„æ–¹æ³•åœ¨å‡†ç¡®æ€§ã€æ¨ç†é€Ÿåº¦å’Œ GPU å†…å­˜æ¶ˆè€—æ–¹é¢å®ç°äº†æœ€å…ˆè¿›çš„æ€§èƒ½ï¼ˆå‚è§å›¾ 1ï¼‰ã€‚ è‡³äºå‡†ç¡®æ€§ï¼Œæˆ‘ä»¬çš„æ–¹æ³•åœ¨ DTU [1] å’Œ Tanks &amp; Temples æ•°æ®é›† [13] çš„é«˜çº§åºåˆ—ä¸Šå–å¾—äº†æœ€å¥½çš„ç»“æœã€‚ æ›´é‡è¦çš„æ˜¯ï¼Œç”±äºå†…å­˜æ¶ˆè€—è¾ƒå°‘ï¼Œæˆ‘ä»¬çš„æ–¹æ³•æ¯”äºšå†›å¿« 2 å€ã€‚</li></ol><h2 id="2-ç›¸å…³å·¥ä½œ">2.ç›¸å…³å·¥ä½œ</h2><h3 id="2-1-ä¼ ç»Ÿ-mvs-æ–¹æ³•">2.1. ä¼ ç»Ÿ MVS æ–¹æ³•</h3><p>ä¼ ç»Ÿçš„MVSæ–¹æ³•å¤§è‡´å¯åˆ†ä¸ºå››ç±»ï¼šåŸºäºä½“ç´ çš„æ–¹æ³•[24, 27]ã€åŸºäºè¡¨é¢çš„æ–¹æ³•[7, 14]ã€åŸºäºå—çš„æ–¹æ³•[8, 16]å’ŒåŸºäºæ·±åº¦å›¾çš„æ–¹æ³•[9, 21, 30]ã€‚ åœ¨è¿™äº›æ–¹æ³•ä¸­ï¼ŒåŸºäºæ·±åº¦å›¾çš„æ–¹æ³•å…·æœ‰æ›´å¥½çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚ Gipuma [9]æå‡ºäº†ä¸€ç§æ›´é€‚åˆå¹¶è¡Œè®¡ç®—çš„åŸºäºæ£‹ç›˜æ ¼çš„ä¼ æ’­æ–¹æ¡ˆï¼Œå¹¶å°†PatchMatch [2]ç«‹ä½“æ–¹æ³•æ‰©å±•åˆ°å¤šè§†å›¾ç«‹ä½“ã€‚ COLMAP [21]é€šè¿‡è”åˆä¼°è®¡åƒç´ çº§è§†å›¾é€‰æ‹©ã€æ·±åº¦å›¾å’Œè¡¨é¢æ³•çº¿æ¥å¢å¼ºç®—æ³•çš„é²æ£’æ€§ã€‚ ACMM [30]æå‡ºäº†ä¸€ç§å…·æœ‰è‡ªé€‚åº”æ£‹ç›˜ä¼ æ’­å’Œå¤šå‡è®¾è”åˆè§†å›¾é€‰æ‹©çš„å¤šå°ºåº¦ MVS æ¡†æ¶ã€‚ è™½ç„¶è¿™äº›æ–¹æ³•å¯ä»¥è·å¾—é²æ£’çš„3Dé‡å»ºç»“æœï¼Œä½†å®ƒä»¬å­˜åœ¨è®¡ç®—è¦æ±‚é«˜å’Œé‡å»ºè´¨é‡å·®çš„é—®é¢˜ã€‚</p><p>2.2. åŸºäºå­¦ä¹ çš„ MVS æ–¹æ³•<br>æœ€è¿‘ï¼Œå·²ç»æå‡ºäº†å¤§é‡åŸºäºæ·±åº¦å­¦ä¹ çš„å¤šè§†å›¾ç«‹ä½“å·¥ä½œ[5,10,12,28,34-36]ã€‚ SurfaceNet[12]æ˜¯æ—©æœŸçš„ä»£è¡¨ä½œå“ä¹‹ä¸€ï¼Œå®ƒæ„å»ºä½“ç´ ä½“æ¥èšåˆå¤šè§†å›¾ä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨3D CNNå¯¹å…¶è¿›è¡Œæ­£åˆ™åŒ–ã€‚ åŸºäºå¯å¾®å•åº”æ€§ [6]ï¼ŒYao ç­‰äººã€‚ [35]æå‡ºäº†ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„åŸºäºæ·±åº¦å­¦ä¹ çš„MVSç®¡é“ã€‚ å…·ä½“æ¥è¯´ï¼ŒMVSNet [35] é¦–å…ˆæå–æ¯ä¸ªè§†å›¾å›¾åƒçš„ç‰¹å¾å›¾ï¼Œç„¶åæ„å»ºä¸€ä¸ªæˆæœ¬å·ï¼Œè¯¥æˆæœ¬å·åŸºäºä¸€ç»„æ·±åº¦å‡è®¾èšåˆå‡ ä½•ä¿¡æ¯ã€‚ æ­¤å¤–ï¼Œé€šè¿‡ 3D CNN å¯¹æˆæœ¬é‡è¿›è¡Œæ­£åˆ™åŒ–ï¼Œå¹¶é€šè¿‡å›å½’ç­–ç•¥é¢„æµ‹æœ€ç»ˆæ·±åº¦ã€‚ ç„¶è€Œï¼Œç”±äºæ„å»ºå’Œæ­£åˆ™åŒ–æˆæœ¬å·çš„å†…å­˜ä½¿ç”¨é‡å’Œè®¡ç®—è¦æ±‚è¾ƒé«˜ï¼Œ<br>MVSNet åªèƒ½å¤„ç†ä½åˆ†è¾¨ç‡çš„å›¾åƒã€‚ ä¸ºäº†å‡å°‘å†…å­˜æ¶ˆè€—ï¼ŒR-MVSNet [36] é€šè¿‡æ²¿æ·±åº¦ç»´åº¦å¤„ç†æˆæœ¬é‡ï¼Œåˆ©ç”¨å¾ªç¯ç¥ç»ç½‘ç»œä»£æ›¿ 3D CNN æ­£åˆ™åŒ–ï¼Œè¿™å‡å°‘äº†å†…å­˜éœ€æ±‚ï¼Œä½†å¢åŠ äº†è¿è¡Œæ—¶é—´ã€‚ D2 HC-RMVSNet [33]æå‡ºäº†ä¸€ç§å…·æœ‰åŠ¨æ€ä¸€è‡´æ€§æ£€æŸ¥çš„é«˜æ•ˆä¸”æœ‰æ•ˆçš„å¯†é›†æ··åˆå¾ªç¯å¤šè§†å›¾ç«‹ä½“ç½‘ç»œã€‚ AttMVS [18]æå‡ºäº†ä¸€ç§æ–°é¢–çš„æ³¨æ„åŠ›å¢å¼ºåŒ¹é…ç½®ä¿¡åº¦å’Œæ³¨æ„åŠ›å¼•å¯¼æ­£åˆ™åŒ–æ¨¡å—æ¥æé«˜åŒ¹é…çš„é²æ£’æ€§ã€‚ Vis-MVSNet [38]é€šè¿‡åŒ¹é…ä¸ç¡®å®šæ€§ä¼°è®¡æ˜ç¡®æ¨æ–­å¹¶é›†æˆäº† MVS ç½‘ç»œä¸­çš„åƒç´ çº§é®æŒ¡ä¿¡æ¯ã€‚ AA-RMVSnet [29]æå‡ºäº†ä¸€ç§è‡ªé€‚åº”èšåˆæ¨¡å—ï¼Œå¹¶åˆ©ç”¨å…·æœ‰å¾ªç¯ç»“æ„çš„æ··åˆç½‘ç»œè¿›è¡Œæˆæœ¬é‡æ­£åˆ™åŒ–ã€‚</p><p>è¿‘å¹´æ¥ï¼ŒMVSçš„æ•ˆç‡è¶Šæ¥è¶Šå—åˆ°äººä»¬çš„å…³æ³¨ã€‚ Fast-MVSNet [37]æå‡ºäº†ä¸€ç§æ–°é¢–çš„ä»ç¨€ç–åˆ°å¯†é›†ä»ç²—åˆ°ç»†çš„æ¡†æ¶ï¼Œä»¥å®ç°å¿«é€Ÿå‡†ç¡®çš„æ·±åº¦<br>MVS ä¸­çš„ä¼°è®¡ã€‚ é€šå¸¸ï¼Œè®¸å¤šå·¥ä½œåˆ©ç”¨ä»ç²—åˆ°ç»†çš„ç­–ç•¥æ¥å‡å°‘å†…å­˜æ¶ˆè€—å¹¶æé«˜å‡†ç¡®æ€§å’Œé€Ÿåº¦[5,10,34]ã€‚ CVP-MVSNet [34]å’ŒCasMVSNet [10]åŸºäºé‡‘å­—å¡”ç‰¹å¾å›¾æ„å»ºäº†çº§è”æˆæœ¬å·ã€‚ UCS-Net [5]æå‡ºäº†ä¸€ç§åˆ©ç”¨ä¸ç¡®å®šæ€§ä¼°è®¡æ¥ä¼˜åŒ–æ·±åº¦å‡è®¾çš„ç­–ç•¥ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæœ€è¿‘ï¼ŒPatchmatch-Net [28]å°†ä¼ ç»Ÿçš„ PatchMatch ç®—æ³•å¼•å…¥æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œä»è€Œå¤§å¤§å‡å°‘äº†è¿è¡Œæ—¶é—´å’Œå†…å­˜æ¶ˆè€—ã€‚ ä¸ PatchmatchNet ç›¸æ¯”ï¼Œæˆ‘ä»¬çš„æ–¹æ³•å¯ä»¥ä»¥æ›´å°‘çš„è¿è¡Œæ—¶é—´å’Œå†…å­˜æ¶ˆè€—å®ç°æ›´å¥½çš„é‡å»ºè´¨é‡ã€‚</p><h2 id="æ–¹æ³•">æ–¹æ³•</h2><p>å¦‚å›¾ 2 æ‰€ç¤ºï¼Œæˆ‘ä»¬çš„æ–¹æ³•ç”±å¤šå°ºåº¦ç‰¹å¾æå–å™¨å’ŒåŸºäº GRU çš„ä¼˜åŒ–å™¨ç»„æˆã€‚ æ›´å…·ä½“åœ°è¯´ï¼ŒåŸºäº GRU çš„ä¼˜åŒ–å™¨åŒ…æ‹¬åŠ¨æ€æˆæœ¬é‡æ„é€ å™¨å’Œ GRU æ¨¡å—ã€‚ ä¸è®¸å¤šä»¥å‰çš„å·¥ä½œä¸åŒï¼Œæˆ‘ä»¬çš„åŠ¨æ€æˆæœ¬é‡ä¸ä»…å¯ä»¥èšåˆå‡ ä½•ä¿¡æ¯ï¼Œè¿˜å¯ä»¥èšåˆä¸Šä¸‹æ–‡å’Œæ·±åº¦ä¿¡æ¯ã€‚ æ›´é‡è¦çš„æ˜¯ï¼Œå®ƒå¯ä»¥ç”± GRU ä»¥è¿­ä»£æ–¹å¼è¿›è¡Œå¤„ç†ã€‚ å…·ä½“æ¥è¯´ï¼Œåœ¨æ¯ä¸ªæ›´æ–°æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆæ„å»ºä¸€ä¸ªå»ºè®®çš„åŠ¨æ€æˆæœ¬é‡ï¼Œç„¶åé€šè¿‡ GRU æ›´æ–°æ·±åº¦å›¾ã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§çº§è”å’Œåˆ†å±‚ç»†åŒ–æ¶æ„æ¥åˆ©ç”¨å¤šå°ºåº¦ä¿¡æ¯å¹¶åŠ é€Ÿæ”¶æ•›ã€‚ å…·ä½“æ¥è¯´ï¼Œåˆ©ç”¨è½»é‡çº§ 3D CNN ç”Ÿæˆæœ€ç²—ç³™çš„æ·±åº¦å›¾ï¼Œè¯¥æ·±åº¦å›¾å¯ç”¨ä½œä¸‹ä¸€ä¸ª GRU çš„å¯é åˆå§‹åŒ–ã€‚ ç„¶åï¼Œæ·±åº¦å›¾ç”±ä½œç”¨äºé‡‘å­—å¡”ç‰¹å¾å›¾çš„å¤šçº§ GRU è¿›è¡Œç»†åŒ–ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ¯ä¸ªé˜¶æ®µ kï¼Œç»™å®šåˆå§‹æ·±åº¦å›¾ Dk0ï¼Œæ‰€æå‡ºçš„åŸºäº GRU çš„ä¼˜åŒ–å™¨å¯ä»¥è¿­ä»£æ›´æ–°å¤šæ¬¡å¹¶è¾“å‡ºæœ€ç»ˆæ·±åº¦å›¾ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»™å‡ºæˆ‘ä»¬æ–¹æ³•çš„æ›´å¤šç»†èŠ‚ã€‚</p><h3 id="3-2-åŠ¨æ€æˆæœ¬é‡">3.2. åŠ¨æ€æˆæœ¬é‡</h3><p>æˆæœ¬é‡åœ¨ MVS é—®é¢˜ä¸­èµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚ å¦‚å›¾3æ‰€ç¤ºï¼Œä¸è®¸å¤šä»¥å‰çš„å·¥ä½œä¸­çš„é™æ€æˆæœ¬é‡ä¸åŒï¼Œæˆ‘ä»¬èšåˆäº†å‡ ä½•ç‰¹å¾ã€æ·±åº¦ç‰¹å¾å’Œä¸Šä¸‹æ–‡ç‰¹å¾æ¥æ„å»ºæˆ‘ä»¬çš„åŠ¨æ€æˆæœ¬é‡ã€‚ åˆ†åˆ«ä»å±€éƒ¨æˆæœ¬é‡ã€æ·±åº¦ç‰¹å¾å’Œå‚è€ƒå›¾åƒä¸­æå–å‡ ä½•ç‰¹å¾ã€æ·±åº¦ç‰¹å¾å’Œä¸Šä¸‹æ–‡ç‰¹å¾ã€‚ æ›´é‡è¦çš„æ˜¯ï¼Œå—ç›Šäºè¿­ä»£ç­–ç•¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç‹­çª„çš„é€†æ·±åº¦èŒƒå›´å†…æ›´æ–°æ·±åº¦å‡è®¾ï¼Œä»¥åœ¨æ¯æ¬¡è¿­ä»£ä¸­æ„é€ å±€éƒ¨æˆæœ¬é‡ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬çš„åŠ¨æ€æˆæœ¬é‡ä¸é™æ€æˆæœ¬é‡ç›¸æ¯”è¦è½»å¾—å¤šã€‚</p><h4 id="3-2-1å±€éƒ¨æˆæœ¬é‡">3.2.1å±€éƒ¨æˆæœ¬é‡</h4><p>ä¸ä¹‹å‰çš„ MVS å·¥ä½œ[19,28,29,31]ç±»ä¼¼ï¼Œç»™å®šå‚è€ƒè§†å›¾çš„ D æ·±åº¦å‡è®¾ {dj |j = 1, â€¦, D}ï¼Œæˆ‘ä»¬æ„é€ ä¸€ä¸ªå±€éƒ¨æˆæœ¬é‡æ¥è¡¨ç¤ºç›¸å…³æ€§ å‚è€ƒå’Œæºç‰¹å¾ä¹‹é—´ã€‚ å…·ä½“æ¥è¯´ï¼Œå¯¹äºå‚è€ƒè§†å›¾ä¸­çš„æ¯ä¸ªåƒç´  pï¼Œæˆ‘ä»¬åˆ©ç”¨å¯å¾®å•åº”æ€§é€šè¿‡å°†æºç‰¹å¾ Fi æ‰­æ›²ä¸ºç¬¬ j ä¸ªæ·±åº¦å‡è®¾ dj æ¥è®¡ç®—ç›¸åº”çš„åƒç´  p i,j ï¼š</p><p>è¿™é‡ŒKiè¡¨ç¤ºè§†å›¾içš„å†…åœ¨çŸ©é˜µã€‚ R0,i å’Œ t0,i è¡¨ç¤ºå‚è€ƒè§†å›¾å’Œæºè§†å›¾ i ä¹‹é—´çš„ç›¸å¯¹æ—‹è½¬å’Œå¹³ç§»å‚æ•°ã€‚ ç»™å®š p i,j å’Œæºç‰¹å¾å›¾ Fi ï¼Œæˆ‘ä»¬é€šè¿‡å¯å¾®åŒçº¿æ€§æ’å€¼é‡å»ºæ‰­æ›²çš„æºç‰¹å¾å›¾ Fi ã€‚ éµå¾ª MVSNet [35]ï¼Œæˆæœ¬å›¾æ˜¯ âˆ’1 N âˆ’ 1 æ‰­æ›²æºç‰¹å¾å›¾ {Fi }N i=1 çš„æ–¹å·®<br>ç„¶è€Œï¼Œè€ƒè™‘åˆ°åŸºäº GRU çš„ä¼˜åŒ–å™¨å¯ä»¥è¿­ä»£æ›´æ–°æ·±åº¦å›¾ï¼Œæˆ‘ä»¬åœ¨æ¯æ¬¡è¿­ä»£ä¸­ä»…åœ¨ç‹­çª„çš„é€†æ·±åº¦èŒƒå›´å†…é‡‡æ ·ä¸€äº›æ·±åº¦å‡è®¾ã€‚ å…·ä½“æ¥è¯´ï¼Œå¯¹äºé˜¶æ®µ k å’Œè¿­ä»£ t çš„æ¯ä¸ªåƒç´  pï¼Œæˆ‘ä»¬åœ¨é€†æ·±åº¦èŒƒå›´ Rk ä¸­å‡åŒ€é‡‡æ · Dk æ·±åº¦å‡è®¾ï¼š</p><p>è¿™é‡ŒImè¡¨ç¤ºæœ€å°æ·±åº¦å‡è®¾å¹³é¢é—´éš”ï¼Œåœ¨4.2èŠ‚ä¸­æœ‰è¯¦ç»†ä»‹ç»ã€‚ Dktâˆ’1 æ˜¯è¿­ä»£ t âˆ’ 1 ä¸­æ›´æ–°çš„æ·±åº¦å›¾ã€‚ä¸ºäº†ç”¨ 2D CNN å¤„ç†å±€éƒ¨æˆæœ¬é‡å¹¶å°†å…¶ä¸ä¸Šä¸‹æ–‡å’Œæ·±åº¦ä¿¡æ¯èåˆï¼Œæˆ‘ä»¬å–æ¶ˆæ·±åº¦ç»´åº¦å¹¶æ²¿é€šé“ç»´åº¦è¿æ¥æˆæœ¬å›¾ã€‚ å› æ­¤ï¼Œä¸ MVSNet [35] ä¸åŒï¼Œæˆ‘ä»¬çš„å±€éƒ¨æˆæœ¬é‡çš„å½¢çŠ¶æ˜¯ CL âˆˆ RW Ã—HÃ—(CÃ—D) ï¼Œå…¶ä¸­ C å’Œ D åˆ†åˆ«è¡¨ç¤ºé€šé“å’Œæ·±åº¦ç»´åº¦ã€‚</p><h4 id="3-2-2-ç‰¹å¾èšåˆ">3.2.2 ç‰¹å¾èšåˆ</h4><p>å¦‚å›¾ 3 æ‰€ç¤ºï¼Œåœ¨æ¯æ¬¡è¿­ä»£ t ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªè½»é‡çº§æå–å™¨ï¼ˆç”±ä¸¤ä¸ª 2D å·ç§¯å±‚ç»„æˆï¼‰ä»å±€éƒ¨æˆæœ¬é‡å’Œæ·±åº¦å›¾ Dktâˆ’1 ä¸­æå–å‡ ä½•ç‰¹å¾å’Œæ·±åº¦ç‰¹å¾ã€‚ ä¸Šä¸‹æ–‡ç‰¹å¾æ¥è‡ªå¤šå°ºåº¦ä¸Šä¸‹æ–‡ç‰¹å¾æå–å™¨ï¼Œæ¯ä¸ªé˜¶æ®µåªéœ€è¦æå–ä¸€æ¬¡ã€‚</p><p>ä¸ºäº†æ„é€ æœ€ç»ˆçš„åŠ¨æ€æˆæœ¬é‡ CD ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ©ç”¨ 2D å·ç§¯å±‚æ¥å¤„ç†å‡ ä½•ç‰¹å¾å’Œæ·±åº¦ç‰¹å¾çš„ä¸²è”ã€‚ ç„¶åï¼Œè¾“å‡ºä¸ä¸Šä¸‹æ–‡ç‰¹å¾è¿æ¥ä»¥å½¢æˆåŠ¨æ€æˆæœ¬é‡ã€‚ æ‰€æœ‰çš„çº§è”æ“ä½œéƒ½æ˜¯åœ¨é€šé“ç»´åº¦ä¸­æ‰§è¡Œçš„ã€‚</p><h3 id="3-3-å¤šçº§-gru">3.3. å¤šçº§ GRU</h3><p>æˆ‘ä»¬çš„åŠ¨æ€æˆæœ¬é‡ç”± GRU ä»¥è¿­ä»£æ–¹å¼å¤„ç†ã€‚ æ­¤å¤–ï¼Œä¸ºäº†åˆ©ç”¨å¤šå°ºåº¦ä¿¡æ¯å¹¶åŠ é€Ÿæ”¶æ•›ï¼Œæˆ‘ä»¬æ„å»ºäº†å¤šçº§ GRU æ¶æ„ã€‚ è¿™æ ·ï¼ŒåŠ¨æ€æˆæœ¬é‡å°±æ„å»ºåœ¨é‡‘å­—å¡”ç‰¹å¾å›¾ä¸Šï¼Œå¹¶åˆ†åˆ«ç”±å¤šå°ºåº¦ GRU è¿›è¡Œå¤„ç†ã€‚ æ›´å…·ä½“åœ°ï¼Œåœ¨æ¯ä¸ªé˜¶æ®µkï¼Œä¼˜åŒ–æ¨¡å—å°†æ·±åº¦å›¾æ›´æ–°T k æ¬¡ï¼Œå¹¶è¾“å‡ºä¸€ç»„æ›´æ–°é‡Î”dkt ï¼Œå…¶ä¸­tä»1åˆ°T k ã€‚ åœ¨æ¯æ¬¡è¿­ä»£ t ä¸­ï¼Œè¾“å…¥æ·±åº¦å›¾ Dktâˆ’1 å°†æ›´æ–°ä¸ºDkt = Dktâˆ’1 + Î”dkt ï¼Œç„¶åä½œä¸ºä¸‹ä¸€æ¬¡è¿­ä»£ t + 1 çš„è¾“å…¥ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œæ¯ä¸ªé˜¶æ®µæœ€åä¸€æ¬¡è¿­ä»£çš„æ·±åº¦å›¾ DkT k éƒ½ä¼šè¢«ä¸Šé‡‡æ ·ä¸º DkT k +1 ã€‚<br>ç„¶åï¼ŒDkT k+1 å°†ä½œä¸ºä¸‹ä¸€é˜¶æ®µçš„åˆå§‹æ·±åº¦å›¾Dk+1 0 ã€‚</p><p>å¦‚å›¾4æ‰€ç¤ºï¼Œæ·±åº¦å›¾çš„è´¨é‡å¯ä»¥æ˜¯æ¯æ¬¡è¿­ä»£åéƒ½æœ‰æ˜¾ç€æ”¹å–„ã€‚ ç‰¹åˆ«æ˜¯ï¼Œä»å›¾ 4 ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒåŸºäº GRU çš„ä¼˜åŒ–æ¨¡å—å¯ä»¥å¡«å……æ— çº¹ç†åŒºåŸŸä¸­çš„å­”æ´å¹¶é”åŒ–è¾¹ç•Œã€‚</p><h4 id="3-3-1åˆå§‹æ·±åº¦é¢„æµ‹">3.3.1åˆå§‹æ·±åº¦é¢„æµ‹</h4><p>åŸºäºGRUçš„ä¼˜åŒ–æ¨¡å—æ ¹æ®å±€éƒ¨ç©ºé—´ä¿¡æ¯æ›´æ–°æ·±åº¦å€¼ï¼Œè¿™ä½¿å¾—å®ƒå¯¹åˆå§‹æ·±åº¦å€¼æ•æ„Ÿã€‚ ç”±äºå¸¸è§çš„<br>é’ˆå¯¹MVSä¸­å¼±çº¹ç†åŒºåŸŸå’Œç›¸ä¼¼åŒºåŸŸçš„é—®é¢˜ï¼Œä¸å¯é çš„åˆå§‹æ·±åº¦å›¾å°†ä½¿åŸºäºGRUçš„ä¼˜åŒ–æ›´å®¹æ˜“è¾“å‡ºé”™è¯¯çš„æ·±åº¦å€¼ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§åˆå§‹æ·±åº¦å€¼é¢„æµ‹æ¨¡å—æ¥åœ¨æœ€ç²—é˜¶æ®µé¢„æµ‹å¯é çš„åˆå§‹æ·±åº¦å€¼ã€‚ å—å…¶ä»–åŸºäºå­¦ä¹ çš„ MVS æ–¹æ³• [19,28,29,31] çš„å¯å‘ï¼Œæˆ‘ä»¬é€šè¿‡ä¸‰ä¸ªæ¨¡å—é¢„æµ‹æ¦‚ç‡ä½“ç§¯ Pd å’Œç›¸åº”çš„æ·±åº¦å›¾ï¼šæˆæœ¬ä½“ç§¯æ„å»ºã€3D CNN æ­£åˆ™åŒ–å’Œå›å½’ã€‚ åˆå§‹æ·±åº¦é¢„æµ‹æ¨¡å—çš„æ¶æ„å¦‚å›¾ 5 æ‰€ç¤ºã€‚æŒ‰ç…§ MVSNet [35] çš„å·¥ä½œï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªå¾®å°çš„æˆæœ¬å·ï¼Œå®ƒç”±ç¨€ç–æ·±åº¦å‡è®¾ç»„æˆï¼Œä½†åŒ…æ‹¬è¶³å¤Ÿå¤§çš„é€†æ·±åº¦èŒƒå›´ã€‚ ç„¶åï¼Œæˆ‘ä»¬åˆ©ç”¨è½»é‡çº§ 3D CNN å¯¹æˆæœ¬é‡è¿›è¡Œæ­£åˆ™åŒ–ï¼Œå¾—åˆ°ä¸æ¯ä¸ªæ·±åº¦å‡è®¾ d å¯¹åº”çš„æ¦‚ç‡é‡ Pdã€‚ æœ€åï¼Œæˆ‘ä»¬ç”¨ sof targmin å›å½’åˆå§‹æ·±åº¦å›¾ Dinitï¼š</p><h4 id="3-3-2-gru">3.3.2 GRU</h4><p>å—[11,26]çš„å¯å‘ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªGRUæ¨¡å—æ¥æ›´æ–°æ·±åº¦å›¾ã€‚ æˆ‘ä»¬çš„GRUæ¨¡å—çš„è¯¦ç»†ä¿¡æ¯å¦‚ä¸‹ï¼š<br>è¿™é‡Œ Ïƒ æ˜¯ sigmoid æ¿€æ´»å‡½æ•°ï¼ŒW è¡¨ç¤ºå¯¹åº”çš„å·ç§¯ç½‘ç»œçš„å‚æ•°ï¼Œconv è¡¨ç¤ºä¸€ä¸ªå°çš„ 2D å·ç§¯æ¨¡å—ï¼Œç”± 1 Ã— 5 å·ç§¯å’Œ 5 Ã— 1 å·ç§¯ç»„æˆã€‚<br>æˆ‘ä»¬ GRU çš„è¾“å…¥æ˜¯åŠ¨æ€æˆæœ¬é‡ tâˆ’1 ã€‚ åŠ¨æ€ Ctâˆ’1 D ä»¥åŠæ½œåœ¨éšè—çŠ¶æ€ h tâˆ’1 æˆæœ¬é‡ CD å¯ä»¥ç”±å…ˆå‰çš„æ·±åº¦å›¾ Dktâˆ’1 åˆ·æ–°ã€‚ æ­¤å¤–ï¼Œåœ¨æ¯ä¸ªé˜¶æ®µï¼Œåˆå§‹éšè—çŠ¶æ€ h0 ç”±ä¸Šä¸‹æ–‡ç‰¹å¾ç½‘ç»œåˆå§‹åŒ–ã€‚<br>åŸºäºéšè—çŠ¶æ€ ht ï¼Œæˆ‘ä»¬åˆ©ç”¨æ·±åº¦å¤´æ¨¡å—æ¥é¢„æµ‹æ®‹å·®æ·±åº¦ Î”dt ã€‚ æ·±åº¦å¤´æ¨¡å—åŒ…å«ä¸¤ä¸ªå·ç§¯å±‚ï¼Œå¹¶ä½¿ç”¨ tanh æ¿€æ´»å‡½æ•°æ¥çº¦æŸè¾“å‡ºå€¼çš„èŒƒå›´ã€‚<br>åœ¨æ¯ä¸ªé˜¶æ®µ k çš„æœ€åä¸€æ¬¡è¿­ä»£ T k ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨æ©æ¨¡ä¸Šé‡‡æ ·æ¨¡å— [26] å¯¹å½“å‰æ·±åº¦ HWÃ— 23âˆ’k è¿›è¡Œä¸Šé‡‡æ ·ã€‚ æ›´å…·ä½“åœ°è¯´ï¼ŒåŸºäºæœ€åä¸€ä¸ª hidmap( 23âˆ’k k T den state h ï¼Œæˆ‘ä»¬åˆ©ç”¨ä¸¤ä¸ªå·ç§¯å±‚æ¥é¢„æµ‹ HWÃ— 23âˆ’kÃ— (2 Ã— 2 Ã— 9) æ©ç ï¼Œå®ƒè¡¨ç¤ºé‚»å±…çš„ a 23âˆ’k æƒé‡ ç„¶åå¯ä»¥æ ¹æ®é¢„æµ‹çš„æ©æ¨¡é€šè¿‡åŠ æƒç»„åˆå°†æ·±åº¦ HWÃ—22âˆ’k å›¾ä¸Šé‡‡æ ·åˆ° 22âˆ’k çš„åˆ†è¾¨ç‡ã€‚</p><h3 id="3-4-æŸå¤±å‡½æ•°">3.4. æŸå¤±å‡½æ•°</h3><p>åœ¨è®­ç»ƒé˜¶æ®µï¼Œæˆ‘ä»¬çš„æ–¹æ³•å¯ä»¥åœ¨ä¸åŒçš„è¿­ä»£æ­¥éª¤ä¸­ä»åˆå§‹æ·±åº¦é¢„æµ‹æ¨¡å—å’ŒåŸºäº GRU çš„å¤šé˜¶æ®µä¼˜åŒ–æ¨¡å—è¾“å‡ºå‡ ä¸ªæ·±åº¦å›¾ã€‚ æˆ‘ä»¬ä½¿ç”¨ç›¸åº”åˆ†è¾¨ç‡çš„åœ°é¢çœŸå®æ·±åº¦å›¾è®¡ç®—æ‰€æœ‰è¾“å‡ºæ·±åº¦å›¾ä¸Šçš„ L1 æŸå¤±ã€‚ å› æ­¤ï¼Œæœ€ç»ˆçš„æŸå¤±æ˜¯æ‰€æœ‰æŸå¤±çš„åŠ æƒå’Œï¼š</p><p>å…¶ä¸­Linitæ˜¯åˆå§‹æ·±åº¦é¢„æµ‹æ¨¡å—è·å¾—çš„åˆå§‹æ·±åº¦å›¾çš„æŸå¤±ã€‚ Tk æ˜¯é˜¶æ®µ k çš„ä¼˜åŒ–è¿­ä»£æ¬¡æ•°ã€‚ {Lki |i = 1â€¦Tk + 1} æ˜¯ Tk è¾“å‡ºæ·±åº¦å›¾å’Œé˜¶æ®µ k çš„ä¸Šé‡‡æ ·æ·±åº¦å›¾çš„æŸå¤±ï¼ŒÎ»ki æ˜¯ç›¸åº”çš„æƒé‡</p><h2 id="4-å®éªŒ">4.å®éªŒ</h2><p>æˆ‘ä»¬åœ¨ DTU [1] å’Œ Tanks &amp; Temples æ•°æ®é›† [13] ä¸Šè¯„ä¼°äº†æˆ‘ä»¬çš„æ–¹æ³•ã€‚ è¿›è¡Œäº†å¤§é‡çš„å®éªŒæ¥éªŒè¯æˆ‘ä»¬æ–¹æ³•çš„å‡†ç¡®æ€§å’Œæ•ˆç‡ã€‚</p><h3 id="4-1-æ•°æ®é›†">4.1. æ•°æ®é›†</h3><p>DTUæ•°æ®é›†DTUæ•°æ®é›†[1]æ˜¯ä¸€ä¸ªå¤§è§„æ¨¡çš„å®¤å†…MVSæ•°æ®é›†ï¼ŒåŒ…å«ä¸åŒå…‰ç…§æ¡ä»¶ä¸‹çš„128ä¸ªä¸åŒçš„æ‰«æå’Œ49ä¸ªè§†å›¾ã€‚ æ‰€æœ‰æ‰«æéƒ½æ˜¯åœ¨å®éªŒå®¤ç¯å¢ƒä¸‹ä»¥ç›¸åŒçš„ç›¸æœºè½¨è¿¹æ”¶é›†çš„ã€‚ DTU æä¾› 79 æ¬¡è®­ç»ƒæ‰«æçš„åœ°é¢çœŸå®æ·±åº¦å›¾å’Œ 22 æ¬¡è¯„ä¼°æ‰«æçš„ 3D ç‚¹äº‘ã€‚ éµå¾ªå¤§å¤šæ•° MVS å·¥ä½œ [19,28,29,31] ä¸­çš„é…ç½®ï¼Œæˆ‘ä»¬åº”ç”¨ DTU æ•°æ®é›†æ¥è®­ç»ƒå’Œè¯„ä¼°æˆ‘ä»¬çš„ç½‘ç»œã€‚</p><p>Tanks &amp; Temples æ•°æ®é›† Tanks &amp; Temples æ•°æ®é›†[13]æ˜¯ä¸€ä¸ªå¤§è§„æ¨¡çš„æˆ·å¤– MVS æ•°æ®é›†ï¼Œå®ƒä¸ºä¸åŒçš„æ‰«ææä¾›äº†ä¸€ç»„çœŸå®ç¯å¢ƒä¸­çš„è§†é¢‘åºåˆ—ã€‚ åˆ†ä¸ºä¸­çº§å’Œé«˜çº§ä¸¤å¥—ï¼Œå…±14ä¸ªåœºæ™¯ã€‚ æˆ‘ä»¬è¿˜ä½¿ç”¨åœ¨ DTU æ•°æ®é›† [1] ä¸Šè®­ç»ƒçš„æ¨¡å‹åœ¨ä¸­çº§å’Œé«˜çº§é›†ä¸Šè¯„ä¼°æˆ‘ä»¬çš„æ–¹æ³•ï¼Œæ— éœ€è¿›è¡Œå¾®è°ƒã€‚</p><h3 id="4-2-å®æ–½ç»†èŠ‚">4.2. å®æ–½ç»†èŠ‚</h3><p>è®­ç»ƒåœ¨DTUæ•°æ®é›†[1]ä¸Šè¿›è¡Œè®­ç»ƒæ—¶ï¼Œæˆ‘ä»¬å°†è¾“å…¥å›¾åƒçš„åˆ†è¾¨ç‡è®¾ç½®ä¸º640Ã—512ï¼Œè¾“å…¥å›¾åƒçš„æ•°é‡è®¾ç½®ä¸ºN = 5ã€‚å¯¹äºåˆå§‹æ·±åº¦é¢„æµ‹æ¨¡å—ï¼Œæˆ‘ä»¬å°†æ·±åº¦å‡è®¾çš„æ•°é‡è®¾ç½®ä¸º48ã€‚ å¯¹äºå±€éƒ¨æˆæœ¬é‡ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰é˜¶æ®µçš„æ·±åº¦å‡è®¾ Dk çš„æ•°é‡è®¾ç½®ä¸º 4ã€‚ æˆ‘ä»¬å®šä¹‰é€†æ·±åº¦çš„æœ€å°å‡è®¾å¹³é¢é—´éš” Imï¼š<br>æˆ‘ä»¬å°†Zè®¾ç½®ä¸º384ï¼Œå¹¶å°†é˜¶æ®µ0ã€1ã€2çš„æ·±åº¦å‡è®¾é—´éš”è®¾ç½®ä¸º4Imã€2Imã€Imï¼ˆé˜¶æ®µ0æ˜¯ç²—ç•¥é˜¶æ®µï¼Œåˆ†è¾¨ç‡ä¸ºWÃ—H=80Ã—64ï¼‰ã€‚ å¯¹äºæ¯ä¸ªé˜¶æ®µçš„ä¼˜åŒ–æ¨¡å—ï¼Œæˆ‘ä»¬åœ¨é˜¶æ®µ 0ã€1ã€2 åˆ° 3ã€3ã€3 è®¾ç½®è¿­ä»£æ¬¡æ•° T kã€‚æˆ‘ä»¬åœ¨ OneCycleLR è°ƒåº¦å™¨ä¸‹ä½¿ç”¨ AdamW è®­ç»ƒæ¨¡å‹ 48 ä¸ªå‘¨æœŸï¼Œå­¦ä¹ ç‡ä¸º 0.001ã€‚ æˆ‘ä»¬å°†æ‰¹é‡å¤§å°è®¾ç½®ä¸º 4ï¼Œå¹¶åœ¨ 1 ä¸ª NVIDIA GeForce RTX 3090 GPU ä¸Šè®­ç»ƒæˆ‘ä»¬çš„æ¨¡å‹ã€‚</p><p>è¯„ä¼°</p><p>æˆ‘ä»¬åœ¨ DTU è¯„ä¼°é›† [1] ä»¥åŠ Tanks &amp; Temples æ•°æ®é›† [13] çš„ä¸­çº§å’Œé«˜çº§æ•°æ®é›†ä¸Šè¯„ä¼°æˆ‘ä»¬æå‡ºçš„æ–¹æ³•ã€‚ å¯¹äº DTU çš„è¯„ä¼°ï¼Œæˆ‘ä»¬å°†è¾“å…¥å›¾åƒçš„æ•°é‡ N è®¾ç½®ä¸º 5ï¼Œè¾“å…¥å›¾åƒçš„å¤§å°ä¸º 1600 Ã— 1184ã€‚å¯¹äº Tanks &amp; Temples æ•°æ®é›†çš„è¯„ä¼°ï¼Œæˆ‘ä»¬ä½¿ç”¨åœ¨ DTU ä¸Šè®­ç»ƒçš„æ¨¡å‹ï¼Œæ— éœ€ä»»ä½•å¾®è°ƒã€‚ æˆ‘ä»¬å°†è§†å›¾æ•°é‡ N è®¾ç½®ä¸º 7ï¼Œè¾“å…¥å›¾åƒå¤§å°ä¸º 1920 Ã— 1056ï¼Œåˆå§‹æ·±åº¦é¢„æµ‹æ¨¡å—ä¸­çš„æ·±åº¦å‡è®¾æ•°é‡ä¸º 96ã€‚Tanks &amp; Temples æ•°æ®é›†çš„ç›¸æœºä½ç½®ã€ç¨€ç–ç‚¹äº‘å’Œæ·±åº¦èŒƒå›´ ç”±å¼€æº SfM è½¯ä»¶ OpenMVG æ¢å¤[20]ã€‚</p><p>è¿‡æ»¤ä¸èåˆ<br>ä¸å…¶ä»–åŸºäºå­¦ä¹ çš„ MVS æ–¹æ³•ç±»ä¼¼ï¼Œæˆ‘ä»¬æ ¹æ®å…‰åº¦å’Œå‡ ä½•ä¸€è‡´æ€§ã€‚ æˆ‘ä»¬å¯¹è¿‡æ»¤ç®—æ³•è¿›è¡Œäº†ä¸€äº›æ”¹è¿›[22]ï¼Œå…·ä½“ç»†èŠ‚åœ¨è¡¥å……ææ–™ä¸­ç»™å‡ºã€‚ åŒæ—¶ï¼Œæˆ‘ä»¬å¯¹ä»åˆå§‹æ·±åº¦é¢„æµ‹æ¨¡å—è·å¾—çš„æ¦‚ç‡ä½“ç§¯Pdè¿›è¡Œä¸Šé‡‡æ ·ï¼Œä½œä¸ºæ¯ä¸ªåƒç´ çš„ç½®ä¿¡åº¦æµ‹é‡ï¼Œå¹¶ä¸¢å¼ƒä¼°è®¡æ·±åº¦æ¦‚ç‡ä½äº0.3çš„åƒç´ ã€‚</p><h3 id="4-3-åŸºå‡†æ€§èƒ½benchmark-performance">4.3. åŸºå‡†æ€§èƒ½Benchmark Performance</h3><p>æˆ‘ä»¬å°†æˆ‘ä»¬çš„æ–¹æ³•ä¸æœ€è¿‘å‘å¸ƒçš„åŸºäºå­¦ä¹ çš„ MVS æ–¹æ³•åœ¨é‡å»ºè´¨é‡ã€è¿è¡Œæ—¶é—´å’Œ GPU å†…å­˜æ¶ˆè€—æ–¹é¢è¿›è¡Œäº†æ¯”è¾ƒã€‚ å¦‚è¡¨æ‰€ç¤ºã€‚ å¦‚å›¾ 1ã€3 æ‰€ç¤ºï¼Œæˆ‘ä»¬çš„æ–¹æ³•åœ¨ DTU æ•°æ®é›† [1] å’Œ Tanks &amp; Temples æ•°æ®é›† [13] çš„é«˜çº§åºåˆ—ä¸Šå®ç°äº†æœ€ä½³æ€§èƒ½ã€‚ è‡³äº Tanks &amp; Temples æ•°æ®é›†çš„ä¸­é—´åºåˆ—ï¼Œæˆ‘ä»¬ä¹Ÿå–å¾—äº†éå¸¸æœ‰ç«äº‰åŠ›çš„ç»“æœã€‚ æˆ‘ä»¬è¿›ä¸€æ­¥æ¯”è¾ƒæˆ‘ä»¬çš„<br>æ–¹æ³•ä¸æœ€è¿‘å‘è¡¨çš„åŸºäºå­¦ä¹ çš„ MVS æ–¹æ³•[5,10,28,34,37,38]ä¸€èµ·è‡´åŠ›äºæé«˜è¡¨ä¸­çš„æ•ˆç‡ã€‚ 2 åœ¨æ—¶é—´å’Œå†…å­˜æ¶ˆè€—æ–¹é¢ã€‚ æˆ‘ä»¬ä½¿ç”¨åŸå§‹å°ºå¯¸å›¾åƒä¸ºæ‰€æœ‰æ–¹æ³•è®¾ç½®ç›¸åŒçš„é…ç½®ï¼Œå¹¶åœ¨ DTU å’Œ Tanks &amp; Temples æ•°æ®é›†ä¸Šåˆ†åˆ«å°†è¾“å…¥è§†å›¾æ•°è®¾ç½®ä¸º 5 å’Œ 7ã€‚ å¦‚è¡¨æ‰€ç¤ºã€‚ 2ã€æˆ‘ä»¬çš„æ–¹æ³•åœ¨è¿è¡Œæ—¶é—´å’Œå†…å­˜æ¶ˆè€—æ–¹é¢æ›´åŠ é«˜æ•ˆã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬çš„å¿«é€Ÿç‰ˆæœ¬ï¼ˆItersï¼š1 11ï¼‰å‡ ä¹æ¯” PatchmatchNet [28] æœ€æ¥è¿‘çš„äºšå†›å¿« 2 å€ã€‚ æ›´ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œæˆ‘ä»¬çš„å¿«é€Ÿç‰ˆæœ¬ï¼ˆItersï¼š1 1 1ï¼‰ä»ç„¶å¯ä»¥å®ç°éå¸¸é«˜çš„é‡å»ºç²¾åº¦ï¼Œå¦‚è¡¨æ‰€ç¤ºã€‚ 1.è¿™äº›å®éªŒç»“æœæ˜æ˜¾è¡¨æ˜æˆ‘ä»¬çš„æ–¹æ³•ä¸ä»…å¯ä»¥æé«˜è®¡ç®—é€Ÿåº¦å¹¶å‡å°‘å†…å­˜æ¶ˆè€—ï¼Œè€Œä¸”å¯ä»¥ä¿è¯é«˜è´¨é‡çš„é‡å»ºã€‚</p><p>åœ¨å›¾ 6 ä¸­ï¼Œæˆ‘ä»¬åœ¨ DTU æ•°æ®é›†ä¸Šå¯¹æˆ‘ä»¬çš„æ–¹æ³•å’Œä¸€äº›æœ€å…ˆè¿›çš„æ–¹æ³•è¿›è¡Œäº†æ›´å¤šè´¨é‡æ¯”è¾ƒã€‚ ä»å›¾ 6 ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸ CVP-MVSNet [34] å’Œ PatchmatchNet [28] ç›¸æ¯”ï¼Œæˆ‘ä»¬çš„æ–¹æ³•æä¾›äº†æ›´å‡†ç¡®çš„è¾¹ç•Œï¼Œå¹¶ä¸”åœ¨ 3D ç‚¹äº‘çš„ç»“æ„ç»†èŠ‚ä¸Šè¡¨ç°å¾—æ›´å¥½ã€‚ æ­¤å¤–ï¼ŒTank &amp; Templesæ•°æ®é›†ä¸Šçš„ä¸€äº›3Dç‚¹äº‘é‡å»ºç»“æœå¦‚å›¾7æ‰€ç¤ºã€‚ä»å›¾7ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿å¯¹äºå…·æœ‰æŒ‘æˆ˜æ€§çš„é«˜çº§åºåˆ—ï¼Œè¯¥æ–¹æ³•çš„é‡å»ºç»“æœä¹Ÿæ˜¯é«˜è´¨é‡çš„ã€‚ æœ€åï¼Œè¡¨ä¸­åˆ—å‡ºäº†æ›´å…¨é¢çš„æ•°é‡ç»“æœã€‚ 3ã€æˆ‘ä»¬çš„æ–¹æ³•åœ¨å¤§å¤šæ•°è¯„ä»·æŒ‡æ ‡ä¸Šéƒ½å–å¾—äº†éå¸¸æœ‰ç«äº‰åŠ›çš„ç»“æœã€‚</p><h3 id="4-4-æ¶ˆèç ”ç©¶">4.4. æ¶ˆèç ”ç©¶</h3><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬æä¾›äº†å¹¿æ³›çš„æ¶ˆèå®éªŒæ¥åˆ†æè¿­ä»£æ¬¡æ•°ã€åˆå§‹æ·±åº¦é¢„æµ‹ã€åŠ¨æ€æˆæœ¬é‡çš„ç»„æˆéƒ¨åˆ†å’Œé˜¶æ®µæ•°çš„å½±å“ã€‚</p><h4 id="4-4-1-è¿­ä»£æ¬¡æ•°">4.4.1 è¿­ä»£æ¬¡æ•°</h4><p>æŒ‰ç…§ 4.2 èŠ‚ä¸­ä»‹ç»çš„ç›¸åŒå®éªŒé…ç½®ï¼Œæˆ‘ä»¬è¿›è¡Œä¸åŒè¿­ä»£æ¬¡æ•°çš„æ¶ˆèå®éªŒã€‚ è¿™æ ·æˆ‘ä»¬å°±æƒ³éªŒè¯ä¸€ä¸‹è¿­ä»£æ¬¡æ•°çš„æ•ˆæœã€‚<br>ç»“æœåˆ—äºè¡¨ä¸­ã€‚ 4. ä»è¡¨ä¸­ã€‚ ä»å›¾4å¯ä»¥çœ‹å‡ºï¼Œè¿­ä»£æ¬¡æ•°å¯¹äºç‚¹äº‘çš„å®Œæ•´æ€§å°¤ä¸ºé‡è¦ã€‚ è¿™å¹¶ä¸å¥‡æ€ªï¼Œå› ä¸ºæˆ‘ä»¬çš„åŠ¨æ€æˆæœ¬é‡å¯ä»¥èšåˆç‹¬ç‰¹çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ŒGRU å¯ä»¥è¿›ä¸€æ­¥åˆ©ç”¨è¿™äº›ä¿¡æ¯æ¥å¡«è¡¥æ¼æ´ã€‚ ç±»ä¼¼çš„ç»“è®ºä¹Ÿå¯ä»¥åœ¨å›¾4ä¸­å¾—åˆ°è¯æ˜ï¼Œå…¶ä¸­éšç€è¿­ä»£æ¬¡æ•°çš„å¢åŠ ï¼Œå­”è¢«å¡«å……ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¿˜æƒ³è¯´æˆ‘ä»¬çš„æ–¹æ³•ç›¸å½“çµæ´»ï¼Œå³æˆ‘ä»¬å¯ä»¥æ ¹æ®å®é™…ä»»åŠ¡éœ€æ±‚è°ƒæ•´æµ‹è¯•é˜¶æ®µçš„è¿­ä»£æ¬¡æ•°ä»¥å¹³è¡¡é‡å»ºè´¨é‡ã€é€Ÿåº¦å’Œå†…å­˜æ¶ˆè€—ã€‚</p><h4 id="4-4-2-åˆå§‹æ·±åº¦é¢„æµ‹">4.4.2 åˆå§‹æ·±åº¦é¢„æµ‹</h4><p>åœ¨è¿™ä¸ªå®éªŒä¸­ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªé¢å¤–çš„åŸºäº GRU çš„ä¼˜åŒ–æ¨¡å—ï¼Œè¿›è¡Œ 4 æ¬¡è¿­ä»£ï¼Œä»¥å–ä»£æœ€ç²—é˜¶æ®µçš„åˆå§‹æ·±åº¦é¢„æµ‹ (IDP) æ¨¡å—ã€‚ å¯¹äºè¿™ä¸ªä¼˜åŒ–æ¨¡å—ï¼Œæˆ‘ä»¬å°†æ·±åº¦å‡è®¾çš„æ•°é‡è®¾ç½®ä¸º8ï¼Œæ·±åº¦å‡è®¾çš„é—´éš”ä¸º16Imï¼Œé€†æ·±åº¦èŒƒå›´çš„ä¸­å€¼(dmin + dmax)/2ç”¨ä½œåˆå§‹è¾“å…¥æ·±åº¦å›¾ã€‚</p><p>å¦‚è¡¨æ‰€ç¤ºã€‚ å¦‚å›¾5æ‰€ç¤ºï¼Œæˆ‘ä»¬ä½¿ç”¨åˆå§‹æ·±åº¦é¢„æµ‹æ¨¡å—çš„æ–¹æ³•åœ¨é‡å»ºè´¨é‡æ–¹é¢æ˜¾ç„¶è¡¨ç°æ›´å¥½ã€‚ æˆ‘ä»¬åŸºäº3DCNNçš„åˆå§‹æ·±åº¦é¢„æµ‹æ¨¡å—å¯ä»¥è·å¾—ç›¸å½“å¯é çš„æ·±åº¦å›¾ï¼Œå¯ä»¥æœ‰æ•ˆé¿å…åŸºäºGRUçš„ä¼˜åŒ–å•å…ƒçš„å±€éƒ¨ä¼˜åŒ–é—®é¢˜ã€‚ ç‰¹åˆ«æ˜¯ï¼Œæˆ‘ä»¬çš„æ–¹æ³•åœ¨å®Œæ•´æ€§æ–¹é¢è¡¨ç°å¾—æ›´å¥½ï¼Œè¿™è¿›ä¸€æ­¥è¯æ˜äº†æ‰€æå‡ºçš„åˆå§‹æ·±åº¦é¢„æµ‹æ¨¡å—çš„é‡è¦æ€§ã€‚</p><h4 id="4-4-3-åŠ¨æ€æˆæœ¬é‡çš„ç»„æˆéƒ¨åˆ†">4.4.3 åŠ¨æ€æˆæœ¬é‡çš„ç»„æˆéƒ¨åˆ†</h4><p>åœ¨æœ¬å®éªŒä¸­ï¼Œæˆ‘ä»¬åœ¨DTUçš„è¯„ä¼°é›†ä¸Šè¯„ä¼°äº†æ·±åº¦ç‰¹å¾ï¼ˆDFï¼‰å’Œä¸Šä¸‹æ–‡ç‰¹å¾ï¼ˆCFï¼‰åœ¨åŠ¨æ€æˆæœ¬é‡æ„å»ºè¿‡ç¨‹ä¸­çš„æœ‰ç›Šæ•ˆæœ[1]ã€‚ å¦‚è¡¨æ‰€ç¤ºã€‚ 6ã€æ·±åº¦ç‰¹å¾å’Œä¸Šä¸‹æ–‡ç‰¹å¾å¯¹é‡å»ºç»“æœçš„å®Œæ•´æ€§å½±å“å¾ˆå¤§ï¼Œå¯ä»¥å°†å®Œæ•´æ€§è¯¯å·®ä»0.368é™ä½åˆ°0.313ã€‚ æ²¡æœ‰æ·±åº¦ç‰¹å¾å’Œä¸Šä¸‹æ–‡ç‰¹å¾ï¼ŒåŠ¨æ€æˆæœ¬é‡åªèƒ½æä¾›ä»å±€éƒ¨æˆæœ¬ä¸­æå–çš„å‡ ä½•ç‰¹å¾ä¿¡æ¯</p><p>å®éªŒç»“æœè¿˜è¯æ˜ï¼Œé€šè¿‡èšåˆé™„åŠ æ·±åº¦ç‰¹å¾ä¿¡æ¯å’Œä¸Šä¸‹æ–‡ç‰¹å¾ä¿¡æ¯æ„å»ºåŠ¨æ€æˆæœ¬é‡æ˜¯æˆ‘ä»¬çš„æ–¹æ³•åœ¨ DTU è¯„ä¼°é›†ä¸Šå®ç°æœ€å…ˆè¿›æ€§èƒ½çš„å…³é”®ã€‚</p><h4 id="4-4-4çº§æ•°number-of-stages">4.4.4çº§æ•°Number of Stages</h4><p>æˆ‘ä»¬è¿›ä¸€æ­¥åœ¨æ€»é˜¶æ®µæ•°ä¸º 2 å’Œ 4 çš„æƒ…å†µä¸‹è¯„ä¼°æˆ‘ä»¬çš„æ–¹æ³•ï¼Œç›¸åº”çš„æœ€ç²¾ç»†é˜¶æ®µçš„åˆ†è¾¨ç‡åˆ†åˆ«ä¸º H4 Ã— W 4 å’Œ HÃ—W ã€‚ æˆ‘ä»¬ä»é‡å»ºè´¨é‡ã€è¿è¡Œæ—¶é—´å’Œ GPU å†…å­˜æ¶ˆè€—æ–¹é¢è¯„ä¼°äº† DTU [1] å’Œ Tanks &amp; Temples [13] ä¸Šçš„æ‰€æœ‰æ¨¡å‹ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬è®¾ç½®äº†ä¸åŒçš„ä¸Šé‡‡æ ·æ¨¡å—æ¯”ç‡ï¼Œä»¥ä½¿æ‰€æœ‰æ¨¡å‹è¾“å‡ºå…¨åˆ†è¾¨ç‡æ·±åº¦å›¾ã€‚ å¦‚è¡¨æ‰€ç¤ºã€‚ 7ã€éšç€é˜¶æ®µæ•°é‡çš„å¢åŠ ï¼Œåœ¨DTUå’ŒTanks &amp; TemplesåŸºå‡†ä¸Šæ€§èƒ½æœ‰äº†æ˜¾ç€æå‡ï¼Œä½†åŒæ—¶è¿è¡Œæ—¶é—´å’ŒGPUæ˜¾å­˜æ¶ˆè€—ä¹Ÿæ˜¾ç€å¢åŠ ã€‚</p><h2 id="5-ç»“è®º">5. ç»“è®º</h2><p>åœ¨è¿™é¡¹å·¥ä½œä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§æ–°é¢–çš„è¿­ä»£åŠ¨æ€æˆæœ¬é‡ï¼Œå¯ä»¥ç”±æˆ‘ä»¬æå‡ºçš„å¤šçº§ GRU è¿›è¡Œå¤„ç†ã€‚ æˆ‘ä»¬çš„æ–¹æ³•éå¸¸æœ‰æ•ˆï¼Œå¯ä»¥å¤„ç†éå¸¸é«˜åˆ†è¾¨ç‡çš„å›¾åƒã€‚ å’Œâ€¦ç›¸æ¯”<br>ä¸å…¶ä»–åŸºäºå­¦ä¹ çš„ MVS æ–¹æ³•ç›¸æ¯”ï¼Œæˆ‘ä»¬çš„æ–¹æ³•åœ¨å‡†ç¡®æ€§ã€é€Ÿåº¦å’Œå†…å­˜ä½¿ç”¨æ–¹é¢è¾¾åˆ°äº†æœ€å…ˆè¿›çš„ç»“æœã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬çš„æ–¹æ³•éå¸¸çµæ´»ï¼Œå¯ä»¥é€šè¿‡è°ƒæ•´æµ‹è¯•é˜¶æ®µçš„è¿­ä»£æ¬¡æ•°åœ¨å‡†ç¡®æ€§å’Œæ•ˆç‡ä¹‹é—´å–å¾—æ›´å¥½çš„å¹³è¡¡ã€‚ æœªæ¥ï¼Œæˆ‘ä»¬å¸Œæœ›åˆ©ç”¨æ›´å¼ºå¤§çš„ç‰¹å¾æå–å™¨æ¥è¿›ä¸€æ­¥æé«˜æ€§èƒ½ã€‚</p><h2 id="è‡´è°¢">è‡´è°¢</h2><p>è¯¥å·¥ä½œå¾—åˆ°äº†å›½å®¶è‡ªç„¶ç§‘å­¦åŸºé‡‘é¡¹ç›®ï¼ˆ62001394ã€61871325ï¼‰å’Œå›½å®¶é‡ç‚¹ç ”å‘è®¡åˆ’é¡¹ç›®ï¼ˆ2018AAA0102803ï¼‰çš„éƒ¨åˆ†æ”¯æŒã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;Effi MVSç¿»è¯‘&lt;/h1&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;p&gt;åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§ç”¨äºå¤šè§†å›¾ç«‹ä½“çš„æ–°é¢–çš„è¿­ä»£åŠ¨æ€æˆæœ¬é‡ã€‚ ä¸å…¶ä»–ä½œå“ç›¸æ¯”ï¼Œæˆ‘ä»¬çš„æˆæœ¬é‡è¦è½»å¾—å¤šï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨åŸºäº 2D å·ç§¯çš„ GRU è¿›è¡Œå¤„ç†ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸€æ­¥GRU çš„è¾“å‡ºå¯è¿›ä¸€</summary>
      
    
    
    
    <category term="åŸºäºæ·±åº¦å­¦ä¹ çš„å¤šè§†è§’ç«‹ä½“åŒ¹é…æŠ€æœ¯" scheme="http://outbreak-sen.github.io/categories/%E5%9F%BA%E4%BA%8E%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%9A%84%E5%A4%9A%E8%A7%86%E8%A7%92%E7%AB%8B%E4%BD%93%E5%8C%B9%E9%85%8D%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="æ·±åº¦å­¦ä¹ " scheme="http://outbreak-sen.github.io/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="MVS" scheme="http://outbreak-sen.github.io/tags/MVS/"/>
    
  </entry>
  
  <entry>
    <title>colmapä»‹ç»å’Œä½¿ç”¨</title>
    <link href="http://outbreak-sen.github.io/2025/02/09/colmap%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8/"/>
    <id>http://outbreak-sen.github.io/2025/02/09/colmap%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8/</id>
    <published>2025-02-09T08:12:29.000Z</published>
    <updated>2025-02-09T08:12:59.310Z</updated>
    
    <content type="html"><![CDATA[<h1>colmapå®˜æ–¹æ•™ç¨‹çš„ç¬”è®°</h1><h2 id="éœ€è¦cudaæ‰èƒ½ç¨ å¯†é‡å»º-å¦åˆ™åªèƒ½ç¨€ç–é‡å»º">éœ€è¦CUDAæ‰èƒ½ç¨ å¯†é‡å»ºï¼Œå¦åˆ™åªèƒ½ç¨€ç–é‡å»º</h2><p><a href="https://blog.csdn.net/weixin_44120025/article/details/123769174">Colmapè®ºæ–‡â€”â€”ã€ŠStructure-from-Motion Revisitedã€‹è®ºæ–‡é˜…è¯»ç¬”è®°</a></p><h2 id="tutorial">Tutorial</h2><p>ä¼ ç»Ÿä¸Šï¼ŒåŸºäºå›¾åƒçš„3Dé‡å»ºé¦–å…ˆä½¿ç”¨â€œè¿åŠ¨ç»“æ„Structure-from-Motionâ€æ¥æ¢å¤åœºæ™¯çš„ç¨€ç–è¡¨ç¤ºå’Œè¾“å…¥å›¾åƒçš„ç›¸æœºå§¿æ€ã€‚ç„¶åï¼Œæ­¤è¾“å‡ºç”¨ä½œâ€œå¤šè§†å›¾ç«‹ä½“Multi-View Stereoâ€çš„è¾“å…¥ï¼Œä»¥æ¢å¤åœºæ™¯çš„å¯†é›†è¡¨ç¤ºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/path/to/project/...</span><br><span class="line">+â”€â”€ images</span><br><span class="line">â”‚   +â”€â”€ image1.jpg</span><br><span class="line">â”‚   +â”€â”€ image2.jpg</span><br><span class="line">â”‚   +â”€â”€ ...</span><br><span class="line">â”‚   +â”€â”€ imageN.jpg</span><br><span class="line">+â”€â”€ database.db</span><br><span class="line">+â”€â”€ project.ini</span><br></pre></td></tr></table></figure><h3 id="é‡å»ºçš„è¿‡ç¨‹">é‡å»ºçš„è¿‡ç¨‹</h3><ul><li><p>Structure-from-Motion</p><ul><li>æ˜¯å°†3Dç»“æ„ä»æŠ•å½±é‡å»ºä¸ºä¸€ç³»åˆ—å›¾åƒçš„è¿‡ç¨‹ã€‚è¾“å…¥æ˜¯ä»ä¸åŒè§†ç‚¹æ‹æ‘„çš„åŒä¸€å¯¹è±¡çš„ä¸€ç»„é‡å å›¾åƒã€‚è¾“å‡ºæ˜¯ç‰©ä½“çš„ä¸‰ç»´é‡å»ºï¼Œä»¥åŠæ‰€æœ‰å›¾åƒçš„é‡å»ºçš„å†…åœ¨å’Œå¤–åœ¨ç›¸æœºå‚æ•°ã€‚</li><li>é€šå¸¸ï¼Œâ€œè¿åŠ¨ç»“æ„â€ç³»ç»Ÿå°†æ­¤è¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š ç‰¹å¾æ£€æµ‹ä¸æå– ç‰¹å¾åŒ¹é…å’Œå‡ ä½•éªŒè¯ ç»“æ„å’Œè¿åŠ¨é‡å»º</li><li>ä¸ºäº†æ›´å¥½çš„é‡å»ºéœ€è¦ï¼š<ul><li>æ•æ‰çº¹ç†è‰¯å¥½çš„å›¾åƒã€‚å¦‚æœåœºæ™¯æœ¬èº«æ²¡æœ‰åŒ…å«è¶³å¤Ÿçš„çº¹ç†ï¼Œå¯ä»¥æ”¾ç½®å…¶ä»–èƒŒæ™¯å¯¹è±¡ï¼Œå¦‚æµ·æŠ¥ç­‰ã€‚</li><li>åœ¨ç›¸ä¼¼çš„ç…§æ˜æ¡ä»¶ä¸‹æ‹æ‘„å›¾åƒã€‚é¿å…é«˜åŠ¨æ€èŒƒå›´çš„åœºæ™¯ï¼ˆä¾‹å¦‚ï¼Œæœ‰é˜´å½±çš„é˜³å…‰ç…§ç‰‡æˆ–é€è¿‡é—¨/çª—çš„ç…§ç‰‡ï¼‰ã€‚é¿å…åœ¨æœ‰å…‰æ³½çš„è¡¨é¢ä¸Šå‡ºç°é•œé¢åå°„ã€‚ æ‹æ‘„å…·æœ‰é«˜åº¦è§†è§‰é‡å çš„å›¾åƒ</li><li>ç¡®ä¿æ¯ä¸ªå¯¹è±¡è‡³å°‘åœ¨3å¼ å›¾åƒä¸­å¯è§â€”â€”å›¾åƒè¶Šå¤šè¶Šå¥½ã€‚ ä»ä¸åŒçš„è§†è§’æ‹æ‘„å›¾åƒã€‚ä¸è¦ä»…é€šè¿‡æ—‹è½¬ç›¸æœºä»åŒä¸€ä½ç½®æ‹æ‘„å›¾åƒï¼Œä¾‹å¦‚ï¼Œåœ¨æ¯æ¬¡æ‹æ‘„åèµ°å‡ æ­¥ã€‚åŒæ—¶ï¼Œå°½é‡ä»ç›¸å¯¹ç›¸ä¼¼çš„è§’åº¦è·å¾—è¶³å¤Ÿçš„å›¾åƒã€‚è¯·æ³¨æ„ï¼Œæ›´å¤šçš„å›¾åƒå¹¶ä¸ä¸€å®šæ›´å¥½ï¼Œå¹¶ä¸”å¯èƒ½å¯¼è‡´é‡å»ºè¿‡ç¨‹ç¼“æ…¢ã€‚å¦‚æœä½¿ç”¨è§†é¢‘ä½œä¸ºè¾“å…¥ï¼Œè¯·è€ƒè™‘å¯¹å¸§é€Ÿç‡è¿›è¡Œä¸‹é‡‡æ ·ã€‚</li></ul></li></ul></li><li><p>Multi-View Stereo</p><ul><li>ç”¨SfMçš„è¾“å‡ºæ¥è®¡ç®—å›¾åƒä¸­æ¯ä¸ªåƒç´ çš„æ·±åº¦å’Œ/æˆ–æ³•çº¿ä¿¡æ¯ã€‚3Dä¸­å¤šä¸ªå›¾åƒçš„æ·±åº¦å›¾å’Œæ³•çº¿å›¾çš„èåˆç„¶åäº§ç”Ÿåœºæ™¯çš„å¯†é›†ç‚¹äº‘ã€‚ç»“åˆèåˆç‚¹äº‘çš„æ·±åº¦å’Œæ³•çº¿ä¿¡æ¯ï¼Œåˆ©ç”¨æ³Šæ¾è¡¨é¢é‡å»ºç®—æ³•å¯ä»¥æ¢å¤åœºæ™¯çš„3Dè¡¨é¢å‡ ä½•å½¢çŠ¶ã€‚</li></ul></li><li><p>Feature Detection and Extraction</p><ul><li>é¦–å…ˆå†³å®šä½¿ç”¨çš„å†…éƒ¨æ‘„å½±æœºæ¨¡å‹ï¼Œå¯ä»¥ä»åµŒå…¥çš„EXIFä¿¡æ¯ä¸­è‡ªåŠ¨æå–ä¿¡æ¯ç„¶ååœ¨å¤§å‹ç›¸æœºæ¨¡å‹æ•°æ®åº“ä¸­æŸ¥æ‰¾ç›¸æœºè§„æ ¼ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šå›ºæœ‰å‚æ•°</li><li>å¦‚æœæ‚¨çš„æ‰€æœ‰å›¾åƒéƒ½æ˜¯ç”±ç›¸åŒçš„ç‰©ç†ç›¸æœºä»¥ç›¸åŒçš„ç¼©æ”¾å› å­æ‹æ‘„çš„ï¼Œå»ºè®®åœ¨æ‰€æœ‰å›¾åƒä¹‹é—´å…±äº«å†…éƒ¨ä¿¡æ¯ã€‚</li><li>å¦‚æœåœ¨æ‰€æœ‰å›¾åƒä¹‹é—´å…±äº«ç›¸åŒçš„ç›¸æœºå‹å·ï¼Œä½†å¹¶éæ‰€æœ‰å›¾åƒéƒ½å…·æœ‰ç›¸åŒçš„å¤§å°æˆ–EXIFç„¦è·ï¼Œåˆ™ç¨‹åºå°†ä¸æ­£å¸¸åœ°é€€å‡ºã€‚</li><li>å¯ä»¥ä»å›¾åƒä¸­æ£€æµ‹å’Œæå–æ–°SIFTç‰¹å¾ï¼Œä¹Ÿå¯ä»¥ä»æ–‡æœ¬æ–‡ä»¶ä¸­å¯¼å…¥ç°æœ‰ç‰¹å¾ï¼Œå¦‚æœå¯¼å…¥ç°æœ‰åŠŸèƒ½ï¼Œåˆ™æ¯å¼ å›¾åƒæ—è¾¹éƒ½å¿…é¡»æœ‰ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ˆä¾‹å¦‚/path/to/image1.jpgå’Œ/path/to/image1.jpg.txtï¼‰ã€‚</li><li>æŒ‰ç…§æƒ¯ä¾‹ï¼Œå›¾åƒçš„å·¦ä¸Šè§’å…·æœ‰åæ ‡ï¼ˆ0ï¼Œ0ï¼‰ï¼Œæœ€å·¦ä¸Šè§’åƒç´ çš„ä¸­å¿ƒå…·æœ‰åæ ‡ï¼ˆ0.5ï¼Œ0.5ï¼‰</li></ul></li><li><p>ç‰¹å¾åŒ¹é…ä¸å‡ ä½•éªŒè¯</p><ul><li>æ‰¾åˆ°ä¸åŒå›¾åƒä¸­ç‰¹å¾ç‚¹ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚</li><li>å¤šç§åŒ¹é…æ–¹æ³•ï¼š<ul><li>ç©·ä¸¾<strong>Exhaustive</strong>åŒ¹é…ï¼šåƒæ•°é‡ç›¸å¯¹è¾ƒä½ï¼ˆæ•°ç™¾å¼ ï¼‰ï¼Œåˆ™è¿™ç§åŒ¹é…æ¨¡å¼åº”è¯¥è¶³å¤Ÿå¿«ï¼Œå¹¶äº§ç”Ÿæœ€ä½³çš„é‡å»ºç»“æœã€‚</li><li>é¡ºåº<strong>Sequential</strong> åŒ¹é…ï¼šå¦‚æœå›¾åƒæ˜¯æŒ‰é¡ºåºé‡‡é›†çš„ï¼Œä¾‹å¦‚é€šè¿‡æ‘„åƒæœºé‡‡é›†ï¼Œåˆ™æ­¤æ¨¡å¼éå¸¸æœ‰ç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿ç»­å¸§å…·æœ‰è§†è§‰é‡å ï¼Œå¹¶ä¸”ä¸éœ€è¦å®Œå…¨åŒ¹é…æ‰€æœ‰å›¾åƒå¯¹ã€‚</li><li>è¯æ±‡æ ‘<strong>Vocabulary Tree</strong>åŒ¹é…ï¼šåœ¨è¿™ç§åŒ¹é…æ¨¡å¼ä¸­ï¼Œä½¿ç”¨å…·æœ‰ç©ºé—´é‡æ–°æ’åºçš„è¯æ±‡æ ‘ï¼Œå°†æ¯ä¸ªå›¾åƒä¸å…¶è§†è§‰ä¸Šæœ€è¿‘çš„é‚»å±…è¿›è¡ŒåŒ¹é…ã€‚è¿™æ˜¯å¤§å‹å›¾åƒé›†åˆï¼ˆæ•°åƒä¸ªï¼‰çš„æ¨èåŒ¹é…æ¨¡å¼ã€‚è¿™éœ€è¦ä¸€ä¸ªé¢„å…ˆè®­ç»ƒå¥½çš„è¯æ±‡æ ‘ã€‚</li><li>ç©ºé—´<strong>Spatial</strong> åŒ¹é…ï¼šè¿™ç§åŒ¹é…æ¨¡å¼å°†æ¯ä¸ªå›¾åƒä¸å…¶ç©ºé—´ä¸Šæœ€è¿‘çš„é‚»å±…è¿›è¡ŒåŒ¹é…ã€‚ç©ºé—´ä½ç½®å¯ä»¥åœ¨æ•°æ®åº“ç®¡ç†ä¸­æ‰‹åŠ¨è®¾ç½®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCOLMAPè¿˜ä¼šä»EXIFä¸­æå–GPSä¿¡æ¯ï¼Œå¹¶å°†å…¶ç”¨äºç©ºé—´æœ€è¿‘é‚»æœç´¢ã€‚</li><li>ä¼ é€’<strong>Transitive</strong>åŒ¹é…ï¼šå¦‚æœå›¾åƒAä¸å›¾åƒBåŒ¹é…å¹¶ä¸”Bä¸CåŒ¹é…ï¼Œåˆ™è¯¥åŒ¹é…å™¨å°è¯•ç›´æ¥å°†Aä¸CåŒ¹é…ã€‚</li><li>è‡ªå®šä¹‰<strong>Custom</strong> åŒ¹é…ï¼šæ­¤æ¨¡å¼å…è®¸æŒ‡å®šå•ä¸ªå›¾åƒå¯¹è¿›è¡ŒåŒ¹é…æˆ–å¯¼å…¥å•ä¸ªç‰¹å¾åŒ¹é…ã€‚è¦æŒ‡å®šå›¾åƒå¯¹ï¼Œå¿…é¡»ä¸ºæ–‡æœ¬æ–‡ä»¶æä¾›æ¯è¡Œä¸€ä¸ªå›¾åƒå¯¹ï¼š</li></ul></li><li>è¯¦å°½åŒ¹é…çš„é¢„æœŸæ—¶é—´ä»å‡ åå¼ å›¾åƒçš„å‡ åˆ†é’Ÿåˆ°æ•°ç™¾å¼ å›¾åƒçš„å‡ ä¸ªå°æ—¶ï¼Œå†åˆ°æ•°åƒå¼ å›¾åƒçš„æ•°å¤©æˆ–æ•°å‘¨ã€‚</li></ul></li><li><p>ç¨€ç–é‡å»º</p><ul><li>COLMAPé¦–å…ˆå°†æ‰€æœ‰ä»æ•°æ®åº“ä¸­æå–çš„æ•°æ®åŠ è½½åˆ°å­˜å‚¨å™¨ä¸­ï¼Œå¹¶ä»åˆå§‹å›¾åƒå¯¹ä¸­å¯¹é‡å»ºè¿›è¡Œç§å­åŒ–ã€‚ç„¶åï¼Œé€šè¿‡æ³¨å†Œæ–°å›¾åƒå’Œä¸‰è§’æµ‹é‡æ–°ç‚¹æ¥é€æ­¥æ‰©å±•åœºæ™¯ã€‚</li></ul></li><li><p>å¯¼å…¥å’Œå¯¼å‡º</p><ul><li>å»ºè®®ä»¥COLMAPçš„æ•°æ®æ ¼å¼å¯¼å‡ºé‡å»ºï¼Œæ–¹æ³•æ˜¯é€‰æ‹©â€œæ–‡ä»¶â€&gt;â€œå¯¼å‡ºâ€å¯¼å‡ºå½“å‰æŸ¥çœ‹çš„æ¨¡å‹ï¼Œæˆ–é€‰æ‹©â€œæ–‡ä»¶&gt;å…¨éƒ¨å¯¼å‡ºâ€å¯¼å‡ºæ‰€æœ‰é‡å»ºçš„æ¨¡å‹ã€‚ä½¿ç”¨é‡å»ºçš„æ‘„å½±æœºã€å›¾åƒå’Œç‚¹çš„å•ç‹¬æ–‡æœ¬æ–‡ä»¶å°†æ¨¡å‹å¯¼å‡ºåˆ°é€‰å®šæ–‡ä»¶å¤¹ä¸­ã€‚å½“ä»¥COLMAPçš„æ•°æ®æ ¼å¼å¯¼å‡ºæ—¶ï¼Œæ‚¨å¯ä»¥é‡æ–°å¯¼å…¥é‡å»ºï¼Œä»¥ä¾¿ä»¥åè¿›è¡Œå¯è§†åŒ–ã€å›¾åƒä¸å¤±çœŸï¼Œæˆ–è€…ä»å®ƒåœæ­¢çš„åœ°æ–¹ç»§ç»­ç°æœ‰çš„é‡å»ºã€‚è¦å¯¼å…¥æ¨¡å‹ï¼Œè¯·é€‰æ‹©â€œæ–‡ä»¶â€&gt;â€œå¯¼å…¥â€ï¼Œç„¶åé€‰æ‹©å¯¼å‡ºæ–‡ä»¶å¤¹è·¯å¾„ã€‚</li><li>ä¹Ÿå¯ä»¥é€šè¿‡é€‰æ‹©â€œæ–‡ä»¶â€&gt;â€œå¯¼å‡ºä¸ºâ€¦â€ä»¥å„ç§å…¶ä»–æ ¼å¼å¯¼å‡ºæ¨¡å‹ï¼Œå¦‚Bundlerã€VisualSfM 1ã€PLYæˆ–VRMLã€‚</li></ul></li><li><p>å¯†é›†é‡å»º</p><ul><li><p>ä¸ºæ‰€æœ‰æ³¨å†Œå›¾åƒç”Ÿæˆæ·±åº¦å›¾å’Œæ³•çº¿å›¾ï¼Œå°†æ·±åº¦å›¾å’Œæ³•å‘å›¾èåˆä¸ºå…·æœ‰æ³•çº¿ä¿¡æ¯çš„å¯†é›†ç‚¹äº‘ï¼Œå¹¶æœ€ç»ˆä½¿ç”¨Poissonæˆ–Delaunayé‡å»ºä»èåˆçš„ç‚¹äº‘ä¸­ä¼°è®¡å¯†é›†è¡¨é¢ã€‚</p></li><li><p>ç‚¹äº‘çš„é‡å»ºæ³•çº¿ä¸èƒ½åœ¨COLMAPä¸­ç›´æ¥å¯è§†åŒ–ï¼Œä½†ä¾‹å¦‚åœ¨Meshlabä¸­ï¼Œé€šè¿‡å¯ç”¨â€œæ¸²æŸ“&gt;æ˜¾ç¤ºæ³•çº¿/æ›²ç‡â€ï¼ˆRender&gt;Show Normal/Curvatureï¼‰ã€‚åŒæ ·ï¼Œé‡å»ºçš„å¯†é›†è¡¨é¢ç½‘æ ¼æ¨¡å‹å¿…é¡»ä½¿ç”¨å¤–éƒ¨è½¯ä»¶è¿›è¡Œå¯è§†åŒ–ã€‚</p></li><li><p>é™¤äº†å†…éƒ¨å¯†é›†é‡å»ºåŠŸèƒ½å¤–ï¼ŒCOLMAPè¿˜å¯¼å‡ºåˆ°å…¶ä»–å‡ ä¸ªå¯†é›†é‡å»ºåº“ï¼Œå¦‚CMVS/PMVSæˆ–CMP-MVSã€‚è¯·é€‰æ‹©â€œé™„åŠ â€&gt;â€œæ— å¤±çœŸå›¾åƒâ€ï¼ˆExtras &gt; Undistort imagesï¼‰ï¼Œç„¶åé€‰æ‹©é€‚å½“çš„æ ¼å¼ã€‚è¾“å‡ºæ–‡ä»¶å¤¹åŒ…å«é‡å»ºå›¾åƒå’Œæœªå¤±çœŸå›¾åƒã€‚æ­¤å¤–ï¼Œè¿™äº›æ–‡ä»¶å¤¹è¿˜åŒ…å«ç”¨äºæ‰§è¡Œå¯†é›†é‡å»ºçš„ç¤ºä¾‹shellè„šæœ¬ã€‚è¦è¿è¡ŒPMVS2ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./path/to/pmvs2 /path/to/undistortion/folder/pmvs/ option-all</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="æ•°æ®æ ¼å¼">æ•°æ®æ ¼å¼</h2><ul><li><p>COLMAPå°†æ‰€æœ‰æå–çš„ä¿¡æ¯å­˜å‚¨åœ¨ä¸€ä¸ªSQLiteæ•°æ®åº“æ–‡ä»¶ä¸­ã€‚å¯ä»¥ä½¿ç”¨COLMAP  GUIä¸­çš„æ•°æ®åº“ç®¡ç†å·¥å…·åŒ…ã€æä¾›çš„C++æ•°æ®åº“APIï¼ˆè¯·å‚é˜…src/COLMAP/scene/database.hï¼‰æˆ–æ‚¨é€‰æ‹©çš„è„šæœ¬è¯­è¨€ï¼ˆè¯·å‚é˜…scripts/python/database.pyï¼‰ï¼Œè¯¥æ•°æ®åº“åŒ…å«ä»¥ä¸‹è¡¨æ ¼ï¼š</p><ul><li><p>camerasï¼šç›¸æœºå’Œå›¾åƒä¹‹é—´çš„å…³ç³»æ˜¯1æ¯”N</p></li><li><p>images</p></li><li><p>keypointsï¼šå…³é”®ç‚¹è¢«å­˜å‚¨ä¸ºå‰ä¸¤åˆ—åˆ†åˆ«æ˜¯å›¾åƒä¸­çš„Xå’ŒYä½ç½®float32äºŒè¿›åˆ¶ã€‚ç¬¬ä¸‰åˆ—æ˜¯ç‰¹å¾çš„æ¯”ä¾‹ï¼Œç¬¬å››åˆ—æ˜¯ç‰¹å¾æ–¹å‘ï¼ˆæ ¹æ®SIFTçº¦å®šï¼‰</p></li><li><p>descriptorsï¼šæè¿°ç¬¦è¢«å­˜å‚¨ä¸ºè¡Œä¸»uint8äºŒè¿›åˆ¶Blobï¼Œå…¶ä¸­æ¯ä¸€è¡Œæè¿°å…³é”®ç‚¹è¡¨ä¸­ç›¸åº”æ¡ç›®çš„ç‰¹å¾å¤–è§‚ï¼Œè¡Œè¡¨æŒ‡å®šæ¯ä¸ªå›¾åƒæ£€æµ‹åˆ°çš„ç‰¹å¾æ•°é‡</p></li><li><p>matchesï¼šç‰¹å¾åŒ¹é…å°†å…¶è¾“å‡ºå­˜å‚¨åœ¨åŒ¹é…è¡¨ä¸­</p></li><li><p>two_view_geometriesï¼šå‡ ä½•éªŒè¯å­˜å‚¨åœ¨two_view_geometriesè¡¨ä¸­</p></li></ul></li></ul><h2 id="ç›¸æœºæ¨¡å‹åˆ†ç±»">ç›¸æœºæ¨¡å‹åˆ†ç±»</h2><ul><li>SIMPLE_PINHOLEï¼ŒPINHOLEï¼šå¦‚æœæ‚¨çš„å›¾åƒäº‹å…ˆæ²¡æœ‰å¤±çœŸï¼Œè¯·ä½¿ç”¨è¿™äº›ç›¸æœºæ¨¡å‹ã€‚å®ƒä»¬åˆ†åˆ«ä½¿ç”¨ä¸€ä¸ªå’Œä¸¤ä¸ªç„¦è·å‚æ•°ã€‚</li><li>IMPLE_RADIALï¼ŒRADIALï¼šå¦‚æœå†…éƒ¨æœªçŸ¥ï¼Œå¹¶ä¸”æ¯å¼ å›¾åƒéƒ½æœ‰ä¸åŒçš„ç›¸æœºæ ¡å‡†ï¼Œä¾‹å¦‚ï¼Œåœ¨äº’è”ç½‘ç…§ç‰‡çš„æƒ…å†µä¸‹ï¼Œè¿™åº”è¯¥æ˜¯é€‰æ‹©çš„ç›¸æœºå‹å·ã€‚è¿™ä¸¤ä¸ªæ¨¡å‹éƒ½æ˜¯OPENCVæ¨¡å‹çš„ç®€åŒ–ç‰ˆæœ¬ï¼Œä»…åˆ†åˆ«ç”¨ä¸€ä¸ªå’Œä¸¤ä¸ªå‚æ•°å¯¹å¾„å‘ç•¸å˜æ•ˆåº”è¿›è¡Œå»ºæ¨¡ã€‚</li><li>OPENCVï¼ŒFULL_OPENCVï¼šå¦‚æœäº‹å…ˆçŸ¥é“æ ¡å‡†å‚æ•°ï¼Œè¯·ä½¿ç”¨è¿™äº›ç›¸æœºæ¨¡å‹ã€‚<ul><li>SIMPLE_RADIAL_FISHEEYEã€RADIAL_FISHEEYEã€OPENCV_FISHEEYã€FOVã€THIN_PRISM_FISHEYEï¼šå°†è¿™äº›ç›¸æœºæ¨¡å‹ç”¨äºé±¼çœ¼é•œå¤´Â·</li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;colmapå®˜æ–¹æ•™ç¨‹çš„ç¬”è®°&lt;/h1&gt;
&lt;h2 id=&quot;éœ€è¦cudaæ‰èƒ½ç¨ å¯†é‡å»º-å¦åˆ™åªèƒ½ç¨€ç–é‡å»º&quot;&gt;éœ€è¦CUDAæ‰èƒ½ç¨ å¯†é‡å»ºï¼Œå¦åˆ™åªèƒ½ç¨€ç–é‡å»º&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/weixin_44120025/article/d</summary>
      
    
    
    
    <category term="ä¼ ç»Ÿå›¾å½¢å­¦" scheme="http://outbreak-sen.github.io/categories/%E4%BC%A0%E7%BB%9F%E5%9B%BE%E5%BD%A2%E5%AD%A6/"/>
    
    
    <category term="SFM" scheme="http://outbreak-sen.github.io/tags/SFM/"/>
    
    <category term="colmap" scheme="http://outbreak-sen.github.io/tags/colmap/"/>
    
  </entry>
  
  <entry>
    <title>HuggingFaceçš„æ¨¡å‹å’Œæ•°æ®é›†dataset</title>
    <link href="http://outbreak-sen.github.io/2025/02/09/HuggingFace%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>http://outbreak-sen.github.io/2025/02/09/HuggingFace%E7%9A%84%E4%BD%BF%E7%94%A8/</id>
    <published>2025-02-09T08:10:15.000Z</published>
    <updated>2025-03-19T09:12:40.069Z</updated>
    
    <content type="html"><![CDATA[<h1>HuggingFaceçš„æ¨¡å‹å’Œæ•°æ®é›†dataset</h1><p>å¾®è°ƒæ•°æ®é›†ï¼šwikitext-103-v1</p><p>æ¨¡å‹ï¼šBigBirdPegasusForCausalLM</p><h2 id="å¦‚ä½•ä¸‹è½½æ¨¡å‹å’Œæ•°æ®é›†å¹¶è°ƒç”¨">å¦‚ä½•ä¸‹è½½æ¨¡å‹å’Œæ•°æ®é›†å¹¶è°ƒç”¨</h2><p>è¿™é‡Œçš„æ¨¡å‹å’Œæ•°æ®é›†æ˜¯éœ€è¦åœ¨huggingfaceä¸Šæ‰¾åˆ°ä¸“é—¨çš„åç§°çš„ï¼Œç„¶åæœ‰å¤šç§ä¸‹è½½æ–¹æ³•ï¼Œé»˜è®¤ä¼šä¸‹è½½åˆ°.cache/huggingface/hub/,ä½†æ˜¯åé¢.cacheå¯èƒ½ä¼šè¢«æ¸…ç©ºã€‚åŠ è½½çš„æ—¶å€™ï¼Œç›´æ¥ä¼ å…¥åœ°å€å³å¯</p><ol><li><p>é€šè¿‡ huggingface model hub ç½‘é¡µçš„ä¸‹è½½æŒ‰é’®è¿›è¡Œä¸‹è½½ã€‚æ¨¡å‹é¡¹ç›®é¡µçš„ <code>Files</code> æ ä¸­å¯ä»¥è·å–æ–‡ä»¶çš„ä¸‹è½½é“¾æ¥ã€‚<strong>æ— éœ€ç™»å½•</strong>ç›´æ¥ç‚¹å‡»ä¸‹è½½</p></li><li><p>é€šè¿‡ huggingface çš„ huggingface_hub å·¥å…·è¿›è¡Œä¸‹è½½</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pip install huggingface_hub</span><br><span class="line">huggingface-cli download internlm/internlm2-chat-7b</span><br><span class="line"># ä½†æ˜¯ç›´æ¥è¿™ä¹ˆä¸‹è½½è¿˜æ˜¯ç½‘ç»œè¶…æ—¶ï¼Œæ‰€ä»¥ä½¿ç”¨é•œåƒ</span><br><span class="line">python -m pip install huggingface_hub</span><br><span class="line">export HF_ENDPOINT=https://hf-mirror.com</span><br><span class="line">huggingface-cli download --resume-download gpt2 --local-dir gpt2</span><br><span class="line">å¯é€‰å‚æ•° --resume-download ï¼ˆå·²åºŸå¼ƒï¼‰ç°åœ¨é»˜è®¤æ–­ç‚¹ç»­ä¼ </span><br><span class="line">å¯é€‰å‚æ•° --local-dir-use-symlinks False å› ä¸ºhuggingfaceçš„å·¥å…·é“¾é»˜è®¤ä¼šä½¿ç”¨ç¬¦å·é“¾æ¥æ¥å­˜å‚¨ä¸‹è½½çš„æ–‡ä»¶ï¼Œå¯¼è‡´--local-diræŒ‡å®šçš„ç›®å½•ä¸­éƒ½æ˜¯ä¸€äº›â€œé“¾æ¥æ–‡ä»¶â€ï¼ŒçœŸå®æ¨¡å‹åˆ™å­˜å‚¨åœ¨~/.cache/huggingfaceä¸‹ï¼Œå¦‚æœä¸å–œæ¬¢è¿™ä¸ªå¯ä»¥ç”¨ --local-dir-use-symlinks Falseå–æ¶ˆè¿™ä¸ªé€»è¾‘ã€‚ ä½†æ˜¯è¿™æ ·çš„è¯æ¯æ¬¡è°ƒç”¨çš„æ—¶å€™éƒ½å¿…é¡»è¾“å…¥ç»å¯¹è·¯å¾„äº†ã€‚</span><br><span class="line">huggingface-cli download --repo-type dataset --resume-download wikitext --local-dir wikitext</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ huggingface çš„ transformers åº“å®ä¾‹åŒ–æ¨¡å‹è¿›è€Œå°†æ¨¡å‹ä¸‹è½½åˆ°ç¼“å­˜ç›®å½•ã€‚å°±æ˜¯è¯´å†™ä»£ç ä»€ä¹ˆæ—¶å€™éœ€è¦ä»€ä¹ˆæ—¶å€™ä¸‹è½½ï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import torch</span><br><span class="line">from transformers import AutoTokenizer, AutoModelForCausalLM</span><br><span class="line">import os</span><br><span class="line"># è®¾ç½® HF_ENDPOINT ç¯å¢ƒå˜é‡</span><br><span class="line">os.environ[&quot;HF_ENDPOINT&quot;] = &quot;https://hf-mirror.com&quot;</span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(&quot;/home/&#123;username&#125;/huggingface/internlm2-chat-7b&quot;, trust_remote_code=True)</span><br><span class="line">model = AutoModelForCausalLM.from_pretrained(&quot;/home/&#123;username&#125;/huggingface/internlm2-chat-7b&quot;, torch_dtype=torch.float16, trust_remote_code=True).cuda()</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨**<a href="https://gist.github.com/padeoe/697678ab8e528b85a2a7bddafea1fa4f">hfd</a>** æ˜¯å›½äººå¼€å‘çš„ huggingface ä¸“ç”¨ä¸‹è½½å·¥å…·ï¼ŒåŸºäºæˆç†Ÿå·¥å…· <code>aria2</code>ï¼Œå¯ä»¥åšåˆ°ç¨³å®šé«˜é€Ÿä¸‹è½½ä¸æ–­çº¿ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://hf-mirror.com/hfd/hfd.shchmod a+x hfd.sh</span><br><span class="line">chmod a+x hfd.sh</span><br><span class="line">export HF_ENDPOINT=https://hf-mirror.com</span><br><span class="line">./hfd.sh gpt2</span><br><span class="line">./hfd.sh wikitext --dataset</span><br></pre></td></tr></table></figure></li></ol><h2 id="datasetåº“çš„ä½¿ç”¨">Datasetåº“çš„ä½¿ç”¨</h2><p>Datasetåº“å…¶å®ä¹Ÿæ˜¯huggingfaceçš„ï¼Œç»´æŠ¤äº†å¾ˆå¤šæ•°æ®é›†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">pip install datasets</span><br><span class="line">import os #æ®è¯´è¿™æ ·å¯ä»¥å¼€å¯ä»£ç† </span><br><span class="line">os.environ[&#x27;HTTP_PROXY&#x27;] = &#x27;http://127.0.0.1:7890&#x27;</span><br><span class="line">os.environ[&#x27;HTTPS_PROXY&#x27;] = &#x27;http://127.0.0.1:7890&#x27;</span><br><span class="line">from datasets import load_dataset</span><br><span class="line">ds = load_dataset(&quot;fancyzhx/ag_news&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹æ•°æ®é›†çš„ç»„æˆï¼Œç”¨featureï¼Œç„¶åå¯ä»¥çœ‹åˆ°åˆ†ä¸ºtextå’Œæ¯ä¸ªtextçš„labelï¼Œè¿™æ˜¯ä¸€ä¸ªæ–‡æœ¬åˆ†ç±»ä»»åŠ¡</span><br><span class="line">ds[&quot;train&quot;].features</span><br><span class="line"># &#123;&#x27;text&#x27;: Value(dtype=&#x27;string&#x27;, id=None),&#x27;label&#x27;: ClassLabel(names=[&#x27;World&#x27;, &#x27;Sports&#x27;, &#x27;Business&#x27;, &#x27;Sci/Tech&#x27;], id=None)&#125;</span><br><span class="line"></span><br><span class="line"># ç›´æ¥è¿™æ ·ä¹Ÿå¯ä»¥è¾“å‡ºdsçš„æ„æˆï¼Œæ˜¯åˆ†ä¸ºtrainå’Œtest</span><br><span class="line">ds</span><br><span class="line">print(ds)</span><br><span class="line"># DatasetDict(&#123;</span><br><span class="line">    train: Dataset(&#123;</span><br><span class="line">        features: [&#x27;text&#x27;, &#x27;label&#x27;],</span><br><span class="line">        num_rows: 120000</span><br><span class="line">    &#125;)</span><br><span class="line">    test: Dataset(&#123;</span><br><span class="line">        features: [&#x27;text&#x27;, &#x27;label&#x27;],</span><br><span class="line">        num_rows: 7600</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>filter</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># ä¼ å…¥ä¸€ä¸ªlamdaå‡½æ•°ï¼Œå…¶ä¸­è¦æ±‚æ•°æ®çš„labelä¸º2</span><br><span class="line">tmp = ds[&quot;train&quot;].filter(lambda x: x[&quot;label&quot;] == 2)</span><br><span class="line">print(tmp)</span><br><span class="line">print(tmp[0])</span><br></pre></td></tr></table></figure></li><li><p>mapï¼Œå¯¹äºæ•°æ®é›†ä¸­çš„åˆ†ç±»è¿›è¡Œä¿®æ”¹ï¼Œæˆ–è€…å¯¹äºå†…å®¹è¿›è¡Œæ‰©å……</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">prompt_cls = &quot;&quot;&quot;ä½ æ˜¯æ–‡æœ¬åˆ†ç±»é¢†åŸŸçš„ä¸“å®¶ï¼Œè¯·ä½ ç»™ä¸‹è¿°æ–‡æœ¬åˆ†ç±»ï¼ŒæŠŠå®ƒåˆ†åˆ°ä¸‹è¿°ç±»åˆ«ä¸­ï¼š</span><br><span class="line">* World</span><br><span class="line">* Sports</span><br><span class="line">* Business</span><br><span class="line">* Science / Technology&#x27;</span><br><span class="line"></span><br><span class="line">textæ˜¯å¾…åˆ†ç±»çš„æ–‡æœ¬ï¼Œlabelæ˜¯æ–‡æœ¬çš„ç±»åˆ«ï¼š</span><br><span class="line">text: &#123;text&#125;</span><br><span class="line">label: </span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"># è¿™ä¸ªlamdaå‡½æ•°å®šä¹‰äº†ä¸€ä¸ªæŠŠprompt_clsä¸­çš„textéƒ¨åˆ†æ›¿æ¢ä¸ºè¾“å…¥çš„textï¼Œä¹Ÿå¯ä»¥æ˜¯text</span><br><span class="line">def trans2llm(item):</span><br><span class="line">    item[&quot;text&quot;] = prompt_cls.format(text=item[&quot;text&quot;])</span><br><span class="line">    return item</span><br><span class="line"></span><br><span class="line">tmp = ds[&quot;test&quot;].map(trans2llm)</span><br><span class="line">print(tmp[0])</span><br></pre></td></tr></table></figure></li><li><p>select æ•°æ®é›†é‡‡æ ·ï¼Œéšæœºé‡‡æ ·ã€ä¸‹æ ‡é‡‡æ ·ç­‰ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ds[&quot;train&quot;].select([0, 10, 20, 30, 40, 50])# éœ€è¦åŠ ä¸‹æ ‡</span><br><span class="line"># å¦‚æœæƒ³è¦éšæœºå–1000ä¸ª</span><br><span class="line">import random  </span><br><span class="line">numbers = list(range(1000))</span><br><span class="line">random_numbers = random.sample(numbers, 100)</span><br><span class="line">ds[&quot;train&quot;].select(random_numbers)</span><br></pre></td></tr></table></figure></li><li><p>concatenate_datasetsæ•°æ®é›†æ‹¼æ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from datasets import concatenate_datasets</span><br><span class="line">dataset = concatenate_datasets([true_dataset, false_dataset])</span><br></pre></td></tr></table></figure></li><li><p>train_test_splitåŒºåˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œå¹¶ä¸”è‡ªåŠ¨åŠ ä¸€ä¸ªçº¬åº¦åˆ’åˆ†ä¸ºtestå’Œtrain</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dataset.train_test_split(train_size=<span class="number">0.8</span>)</span><br><span class="line"></span><br><span class="line">dataset = load_dataset(<span class="string">&quot;wikitext&quot;</span>, <span class="string">&quot;wikitext-103-v1&quot;</span>, split=<span class="string">&quot;train&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(dataset)</span><br><span class="line">dataset = dataset.select(<span class="built_in">range</span>(<span class="number">1000</span>))  <span class="comment"># Use a subset for quick testing</span></span><br><span class="line">train_test_split = dataset.train_test_split(test_size=<span class="number">0.1</span>)</span><br><span class="line"><span class="built_in">print</span>(train_test_split)</span><br><span class="line">train_dataset = train_test_split[<span class="string">&#x27;train&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(train_dataset)</span><br><span class="line">eval_dataset = train_test_split[<span class="string">&#x27;test&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(eval_dataset)</span><br><span class="line"><span class="built_in">print</span>(train_dataset[<span class="number">0</span>])</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Dataset(&#123;</span><br><span class="line">    features: [&#x27;text&#x27;],</span><br><span class="line">    num_rows: 1801350</span><br><span class="line">&#125;)</span><br><span class="line">DatasetDict(&#123;</span><br><span class="line">    train: Dataset(&#123;</span><br><span class="line">        features: [&#x27;text&#x27;],</span><br><span class="line">        num_rows: 900</span><br><span class="line">    &#125;)</span><br><span class="line">    test: Dataset(&#123;</span><br><span class="line">        features: [&#x27;text&#x27;],</span><br><span class="line">        num_rows: 100</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">Dataset(&#123;</span><br><span class="line">    features: [&#x27;text&#x27;],</span><br><span class="line">    num_rows: 900</span><br><span class="line">&#125;)</span><br><span class="line">Dataset(&#123;</span><br><span class="line">    features: [&#x27;text&#x27;],</span><br><span class="line">    num_rows: 100</span><br><span class="line">&#125;)</span><br><span class="line">&#123;&#x27;text&#x27;: &quot; The ship was assigned to the Austro @-@ Hungarian Fleet &#x27;s 1st Battle Squadron after her 1911 commissioning . In 1912 , ZrÃ­nyi and her two sister ships conducted two training cruises into the eastern Mediterranean Sea . On the second cruise into the Aegean Sea , conducted from November to December , ZrÃ­nyi and her sister ships were accompanied by the cruiser SMS Admiral Spaun and a pair of destroyers . After returning to Pola , the entire fleet mobilized for possible hostilities , as tensions flared in the Balkans . \n&quot;&#125;</span><br></pre></td></tr></table></figure></li><li><p>add_columnæ·»åŠ å±æ€§åˆ—</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataset[&quot;train&quot;] = dataset[&quot;train&quot;].add_column(&quot;index&quot;, list(range(786701)))</span><br></pre></td></tr></table></figure></li><li><p>rename_columnå±æ€§åˆ—é‡å‘½å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dataset[&quot;train&quot;] = dataset[&quot;train&quot;].rename_column(&quot;idx&quot;, &quot;file_sent_index&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h2 id="train-loss">train loss</h2><p>å¯¹æ¯”å¾®è°ƒè®­ç»ƒçš„losså˜åŒ–</p><table><thead><tr><th>epoch</th><th>mindnlp+mindspore</th><th>transformer+torchï¼ˆ4060ï¼‰</th></tr></thead><tbody><tr><td>1</td><td>2.9176</td><td>8.7301</td></tr><tr><td>2</td><td>2.79</td><td>8.1557</td></tr><tr><td>3</td><td>2.593</td><td>7.7516</td></tr><tr><td>4</td><td>2.4875</td><td>7.5017</td></tr><tr><td>5</td><td>2.3831</td><td>7.2614</td></tr><tr><td>6</td><td>2.2631</td><td>7.0559</td></tr><tr><td>7</td><td>2.2369</td><td>6.8405</td></tr><tr><td>8</td><td>2.1732</td><td>6.7297</td></tr><tr><td>9</td><td>2.1717</td><td>6.7136</td></tr><tr><td>10</td><td>2.1833</td><td>6.6279</td></tr></tbody></table><h2 id="eval-loss">eval loss</h2><p>å¯¹æ¯”è¯„ä¼°å¾—åˆ†</p><table><thead><tr><th>epoch</th><th>mindnlp+mindspore</th><th>transformer+torchï¼ˆ4060ï¼‰</th></tr></thead><tbody><tr><td>1</td><td>2.6390955448150635</td><td>6.3235931396484375</td></tr></tbody></table><p># æµ‹è¯•æ ·ä¾‹ï¼ˆåŒ…å«çœŸå®æ ‡ç­¾ï¼‰</p><p>test_data = [</p><p>â€‹    {â€œtextâ€: â€œI am a little confused on all of the models of the 88-89 bonnevilles.\nI have heard of the LE SE LSE SSE SSEI. Could someone tell me the\ndifferences are far as features or performance. I am also curious to\nknow what the book value is for prefereably the 89 model. And how much\nless than book value can you usually get them for. In other words how\nmuch are they in demand this time of year. I have heard that the mid-spring\nearly summer is the best time to buy.â€</p><p>â€‹     , â€œtrue_labelâ€: â€œrec.autosâ€},</p><p>â€‹    {â€œtextâ€: â€œIâ€™m not familiar at all with the format of these X-Face:thingies, but\nafter seeing them in some folksâ€™ headers, Iâ€™ve <em>got</em> to <em>see</em> them (and\nmaybe make one of my own)!\n\nIâ€™ve got dpg-viewon my Linux box (which displays uncompressed X-Faces)\nand Iâ€™ve managed to compile [un]compface tooâ€¦ but now that Iâ€™m <em>looking</em>\nfor them, I canâ€™t seem to find any X-Face:'s in anyones news headers!  :-(\n\nCould you, would you, please send me your X-Face:header\n\nI know* Iâ€™ll probably get a little swamped, but I can handle it.\n\n\tâ€¦I hope.â€</p><p>â€‹     , â€œtrue_labelâ€: â€œcomp.windows.xâ€},</p><p>â€‹    {â€œtextâ€: â€œ\nIn a word, yes.\nâ€</p><p>â€‹        , â€œtrue_labelâ€: â€œalt.atheismâ€},</p><p>â€‹    {â€œtextâ€: â€œ\nThey were attacking the Iraqis to drive them out of Kuwait,\na country whose citizens have close blood and business ties\nto Saudi citizens.  And me thinks if the US had not helped out\nthe Iraqis would have swallowed Saudi Arabia, too (or at \nleast the eastern oilfields).  And no Muslim country was doing\nmuch of anything to help liberate Kuwait and protect Saudi\nArabia; indeed, in some masses of citizens were demonstrating\nin favor of that butcher Saddam (who killed lotsa Muslims),\njust because he was killing, raping, and looting relatively\nrich Muslims and also thumbing his nose at the West.\n\nSo how would have <em>you</em> defended Saudi Arabia and rolled\nback the Iraqi invasion, were you in charge of Saudi Arabia???\n\n\nI think that it is a very good idea to not have governments have an\nofficial religion (de facto or de jure), because with human nature\nlike it is, the ambitious and not the pious will always be the\nones who rise to power.  There are just too many people in this\nworld (or any country) for the citizens to really know if a \nleader is really devout or if he is just a slick operator.\n\n\nYou make it sound like these guys are angels, Ilyess.  (In your\nclarinet posting you edited out some stuff; was it the following???)\nFridayâ€™s New York Times reported that this group definitely is\nmore conservative than even Sheikh Baz and his followers (who\nthink that the House of Saud does not rule the country conservatively\nenough).  The NYT reported that, besides complaining that the\ngovernment was not conservative enough, they have:\n\n\t- asserted that the (approx. 500,000) Shiites in the Kingdom\n\t  are apostates, a charge that under Saudi (and Islamic) law\n\t  brings the death penalty.  \n\n\t  Diplomatic guy (Sheikh bin Jibrin), isnâ€™t he Ilyess?\n\n\t- called for severe punishment of the 40 or so women who\n\t  drove in public a while back to protest the ban on\n\t  women driving.  The guy from the group who said this,\n\t  Abdelhamoud al-Toweijri, said that these women should\n\t  be fired from their jobs, jailed, and branded as\n\t  prostitutes.\n\n\t  Is this what you want to see happen, Ilyess?  Iâ€™ve\n\t  heard many Muslims say that the ban on women driving\n\t  has no basis in the Qurâ€™an, the ahadith, etc.\n\t  Yet these folks not only like the ban, they want\n\t  these women falsely called prostitutes?  \n\n\t  If I were you, Iâ€™d choose my heroes wisely,\n\t  Ilyess, not just reflexively rally behind\n\t  anyone who hates anyone you hate.\n\n\t- say that women should not be allowed to work.\n\n\t- say that TV and radio are too immoral in the Kingdom.\n\nNow, the House of Saud is neither my least nor my most favorite government\non earth; I think they restrict religious and political reedom a lot, among\nother things.  I just think that the most likely replacements\nfor them are going to be a lot worse for the citizens of the country.\nBut I think the House of Saud is feeling the heat lately.  In the\nlast six months or so Iâ€™ve read there have been stepped up harassing\nby the muttawain (religious policeâ€”<em>not</em> government) of Western women\nnot fully veiled (something stupid for women to do, IMO, because it\nsends the wrong signals about your morality).  And Iâ€™ve read that\ntheyâ€™ve cracked down on the few, home-based expartiate religious\ngatherings, and even posted rewards in (government-owned) newspapers\noffering money for anyone who turns in a group of expartiates who\ndare worship in their homes or any other secret place. So the\ngovernment has grown even more intolerant to try to take some of\nthe wind out of the sails of the more-conservative opposition.\nAs unislamic as some of these things are, theyâ€™re just a small\ntaste of what would happen if these guys overthrow the House of\nSaud, like theyâ€™re trying to in the long run.\n\nIs this really what you (and Rached and others in the general\nwest-is-evil-zionists-rule-hate-west-or-you-are-a-puppet crowd)\nwant, Ilyess?\nâ€</p><p>â€‹     , â€œtrue_labelâ€: â€œtalk.politics.mideastâ€}</p><p>]</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;HuggingFaceçš„æ¨¡å‹å’Œæ•°æ®é›†dataset&lt;/h1&gt;
&lt;p&gt;å¾®è°ƒæ•°æ®é›†ï¼šwikitext-103-v1&lt;/p&gt;
&lt;p&gt;æ¨¡å‹ï¼šBigBirdPegasusForCausalLM&lt;/p&gt;
&lt;h2 id=&quot;å¦‚ä½•ä¸‹è½½æ¨¡å‹å’Œæ•°æ®é›†å¹¶è°ƒç”¨&quot;&gt;å¦‚ä½•ä¸‹è½½æ¨¡å‹å’Œæ•°æ®é›†å¹¶è°ƒç”¨&lt;/h2</summary>
      
    
    
    
    <category term="æ·±åº¦å­¦ä¹ " scheme="http://outbreak-sen.github.io/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="huggingface" scheme="http://outbreak-sen.github.io/tags/huggingface/"/>
    
  </entry>
  
</feed>
